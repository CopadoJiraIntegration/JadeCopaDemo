"use strict";System.register("app.js",["docgen/docgen.routes.js","quotes/quotes.routes.js","assets/assets.routes.js","contracts/contracts.routes.js","subscriptions/subscriptions.routes.js","products/products.routes.js","favorites/favorites.routes.js","recommendations/recommendations.routes.js","common/core/AppContext.js","common/core/sb-i18n/I18n.js","common/core/sb-router/Router.js","common/common.js","quotes/quotes.js","products/products.js","favorites/favorites.js","assets/assets.js","subscriptions/subscriptions.js","recommendations/recommendations.js"],function(e,t){var s,a,l,u,d,c,h,f,p,v,i;return{setters:[function(e){s=e},function(e){a=e},function(e){l=e},function(e){u=e},function(e){d=e},function(e){c=e},function(e){h=e},function(e){f=e},function(e){p=e.AppContext},function(e){v=e.I18n},function(e){e.Router},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r)}e("App",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(r,null,[{key:"init",value:function(e,t,i,n){var o={};return o[s.PREFIX]=s.ROUTES,o[a.PREFIX]=a.ROUTES,o[c.PREFIX]=c.ROUTES,o[h.PREFIX]=h.ROUTES,o[l.PREFIX]=l.ROUTES,o[u.PREFIX]=u.ROUTES,o[d.PREFIX]=d.ROUTES,o[f.PREFIX]=f.ROUTES,e.allRoutes=o,Promise.all([p.init(i),r._initIntlLocale(n.intl,i.locale)])}},{key:"_initIntlLocale",value:function(t,a){return new Promise(function(o,r){var s=new XMLHttpRequest,e=t+"/locale-data/json/"+a+".json";s.open("GET",e),s.onerror=function(e){r(new Error("Cannot get locale data: "+e))},s.ontimeout=function(e){r(new Error("Timeout for locale data"))},s.onload=function(){if(s.responseText)try{var e=JSON.parse(s.responseText);v.addLocaleData(e),Intl&&Intl.__addLocaleData&&Intl.__addLocaleData(JSON.parse(s.responseText)),o(e)}catch(e){var t=document.getElementById("spinner"),i=document.getElementById("errorToast"),n="There was an error parsing the "+a+" locale. Use a different locale or contact your Salesforce admin.";i.messages=[n],t.show=!1,r(new Error("Cannot parse locale data"))}else t=document.getElementById("spinner"),i=document.getElementById("errorToast"),n="The "+a+" locale isn't supported. Use a different locale or contact your Salesforce admin.",i.messages=[n],t.show=!1,r(new Error("Cannot understand locale data: "+s.statusText))},s.send()})}}]),i=r)),e("App",i)}}}),System.register("labels_en.js",[],function(e,t){var i;return{setters:[],execute:function(){e("LABELS",i={Apply:"Apply","Asset Selection":"Asset Selection",Cancel:"Cancel","Clear Fields":"Clear Fields",Filter:"Filter",Select:"Select",None:"None",searchText:"Search {0}",lookupQueryError:"Can't perform lookup due to field encryption or a querying error",FieldSetWarning:"Create a Field Set with the label of CPQ_Lookup in {0} object setup to determine which fields are displayed in this CPQ list view popup.",numResults:"{0} Results",Save:"Save","Background color":"Background color","Block quote":"Block quote",Bold:"Bold","Bullet list":"Bullet list","Clear formatting":"Clear formatting","Decrease indent":"Decrease indent","Edit Description":"Edit Description","Font family":"Font family","Font size":"Font size","Header size":"Header size","Unsupported HTML tags detected":"Unsupported HTML tags detected, saving may cause original formatting to be altered or lost. If you wish to preserve original formatting, cancel out of the Rich-Text Editor.","Increase indent":"Increase indent","Insert or edit image":"Insert or edit image","Insert or edit link":"Insert or edit link",Italic:"Italic","Numbered list":"Numbered list",Redo:"Redo",Strikethrough:"Strikethrough",Subscript:"Subscript",Superscript:"Superscript","Align left":"Align left",Center:"Center","Align right":"Align right","Text color":"Text color",Underline:"Underline",Undo:"Undo","Constrain proportions":"Constrain proportions",Dimensions:"Dimensions","Insert image":"Insert image",Source:"Source","Search Products":"Search Products","Product Search":"Product Search","Select All":"Reduce search results to fewer than {0} to enable select all",Popup:"Popup","Add Products":"Add Products",Delete:"Delete","Favorite Lookup":"Favorite Lookup","Select & Add More":"Select & Add More",Share:"Share","Share Favorites":"Share Favorites",Attributes:"Attributes",Options:"Options",showAvailableUpgrades:"This feature has products available for upgrade, click the Show Available Upgrades button at the bottom of the feature to select upgrade options.","No visible options in feature":"No visible options in feature '{0}'",Features:"Features","Add Options":"Add Options",Add:"Add","Configure Products":"Configure Products","Configuration Attribute Error":"Please review required configuration attributes","Configuration Error":"Some or all options require further configuration. Look for configuration icon next to options that must be configured.","Maximum Quantity Error":"Exceeded maximum quantity available. Value has been reduced to {0}","Add to Cart":"Add to Cart",Categories:"Categories",Description:"Description",Go:"Go","My Favorites":"My Favorites",Price:"Price","Product Code":"Product Code","Product Name":"Product Name","Start Over":"Start Over",Alert:"Alert",Continue:"Continue","Return to Quote":"The quote line you are attempting to reconfigure does not exist. Please add the product again to configure it.","Contract Selection":"Active Contract Selection","Select Contract":"Select Contract","Active Contracts":"Active Contracts","Evergreen Contracts":"Evergreen Contracts",Skip:"Skip",Favorites:"Favorites","Guided Selling":"Guided Selling","Product Filter":"Product Filter","Product Selection":"Product Selection",Suggest:"Suggest","Available Groups":"Available Groups","Clone To Groups":"Clone To Group(s)","Select Groups":"Select one or more group(s)","Selected Groups":"Selected Groups","Custom Segments":"Custom Segments","Discount Schedule Editor":"Discount Schedule Editor",Update:"Update","Add to Favorites":"Add to Favorites","Favorite Name":"Favorite Name","Choose Price Book":"Choose Price Book",Details:"Details",Total:"Total","Quote Total":"Quote Total","Add To Favorite":"Add To Favorite","Click to edit description":"Click to edit description.",emptyLinesMsg:"This group has no line items. Click on Add Products button or drag lines from other groups.",mobileEmptyLinesMsg:"This group has no line items. Click on Add Products button to add a product.","Remove From Favorites":"Remove From Favorites","Segmented Products":"Segmented Products","Standard Products":"Standard Products",Subtotal:"Subtotal",missingOpportunityLineItem:"This product will not sync to the opportunity because a valid pricebook entry does not exist.",msg_qty_cannot_decrease_on_renewal:"Quantity of Line {0} cannot decrease below original value {1} on a Renewal Quote.",msg_qty_no_negative_on_amend:"The quantities of the assets in the Amendment Quote are not allowed to be negative. Please adjust line(s) {0}.",msg_qty_of_upgrade_exceeds_source_prior:"Combined quantity of upgrades to Line {0} cannot exceed {1}.",msg_qty_of_source_too_low:'Product "{0}" cannot be refunded. The quantity of Line {1} cannot decrease without a corresponding upgrade.',pesterPSLAssignment:"As of Winter â€™21, Salesforce CPQ requires permission set licenses instead of managed package licenses. Contact your Salesforce CPQ admin about upgrading.","Edit Quote":"Edit Quote",emptyGroupedQuoteMsg:"This quote has no line items. Click on Add Group button to select products.",emptyQuoteMsg:"This quote has no line items. Click on Add Products button to select products.",fullScreenMode:"Toggle Full Screen Mode",Reset_Column_Widths:"Reset Column Widths","Accept Recommendation":"Accept Recommendation",Explanation:"Explanation",Floor:"Floor",Norm:"Norm","Pricing Guidance":"Pricing Guidance",PricingGuidanceNotAvailable:"Can't load pricing guidance for this record. Contact your Salesforce admin.",Target:"Target","Back to Quote":"Back to Quote",There_are_unsaved_changes_in_one_or_more_of_your_categories:"There are unsaved changes in one or more of your categories.  We're just making sure you want to go back to the quote without updating.",Leave_page_without_updating:"Leave page without updating?","Consumption Schedule":"Consumption Schedule","Never Mind":"Never Mind",msg_cannot_delete_group:"You cannot delete this Group as it contains Quote Lines being amended.",msg_confirm_group_delete:"All lines will also be deleted. Are you sure you want to delete this group?",msg_confirm_remove_favorite:"Are you sure you want to remove favorite?",msg_confirm_remove_group_from_favorites:"All lines will be removed from favorites. Are you sure you want to remove this group from favorites?",Ok:"Ok",msg_missing_pricebook_id:"A PriceBook Id is missing. Please contact your administrator to resolve the issue.","Consumption Schedule Name":"Consumption Schedule Name",Items_Sorted_by:"{0} Items - Sorted by {1}","Search Consumption Schedule Name":"Search Consumption Schedule Name","There are no rates that match your search criteria":"There are no rates that match your search criteria",Your_search_term_must_have_2_or_more_characters:"Your search term must have 2 or more characters, excluding *, ?, (), or ' '","Recommended Products":"Recommended Products","Subscription Selection":"Subscription Selection","Quick Save and Continue":"Quick Save and Continue",lbl_close:"Close",lbl_groups:"Groups"}),e("LABELS",i)}}}),System.register("org.local.js",[],function(e,t){var i;return{setters:[],execute:function(){e("settings",i={developerPrefix:"SBQQ",isMultiCurrencyOrg:!1,calculateImmediately:!1,locale:"en-US",language:"en",defaultCurrency:"USD",currencySymbol:"",currencyDecimalScale:2,fullName:"Admin User",userName:"admin-user@steelbrick.com",userId:"0XXX1",device:"",isOAuth:!0,additionalLookupSearchTypes:[],oik:"",maxLookupSearchFields:1,isJSProductRulesEnabled:!0,hasQuoteSelectionProductRules:!0,isBundleCollapsible:!0,isPricingGuidanceEnabled:!0,defaultBundleSetting:"Expanded",isColumnResizingEnabled:!1,isManualEditsForUBPEnabled:!0,viewEncryptedDataEnabled:!1}),e("settings",i)}}}),System.register("Utils/CacheManager.js",[],function(e,t){var n,o,i,r,s,a;function l(){o.trace("Creating new instance of cache manager"),this._caches=new Map}return{setters:[],execute:function(){n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=require("js-logger").logger.getLogger(),l.prototype.getCache=function(e,t){if(o.debug("Getting cache by name:",e),"undefined"==typeof window&&process&&process.mainModule&&process.mainModule.filename&&process.mainModule.filename.endsWith("server.js"))return o.trace("Cache with name ",e," requested in main process. Returning new instance."),this._createCacheInstance(e,t);var i=this._caches.get(e);return i?o.trace("Find cache for name:",e):(o.trace("Cache with name:",e,"not exist yet."),i=this._createCacheInstance(e,t),this._caches.set(e,i)),i},l.prototype._createCacheInstance=function(e,t){var i=void 0;if(t){if(o.trace("Cache class defined"),"function"!=typeof t)throw o.warn("Cache class defined, but is not a function.",void 0===t?"undefined":n(t)),new Error("Customize cache class type wrong.");o.trace("Creating new cache by customized class for name:",e),i=new t}else o.trace("Creating new cache as Map for name:",e),i=new Map;if(void 0!==i)return i;throw o.warn("Cache undefined, something wrong."),new Error("Create cache get undefined.")},l.prototype.flushCaches=function(e){o.debug("Flushing all caches"),this._caches.forEach(function(e){e&&"function"==typeof e.clear&&e.clear()}),e&&(o.trace("Rest cache"),this._caches.clear())},i=Symbol.for("client.Utils.CacheManager"),r="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},s=Object.getOwnPropertySymbols(r),-1<s.indexOf(i)||(a=new l,Object.freeze(a),r[i]=a),module.exports={cacheManager:r[i]}}}}),System.register("Utils/Constants.js",[],function(e,t){return{setters:[],execute:function(){module.exports={apiVersion:"55.0"}}}}),System.register("Utils/DateUtils.js",[],function(e,t){function i(e){return e.toISOString().replace(new RegExp("[Tt].*"),"")}function n(e){var t=e.toISOString();return t.slice(0,t.length-1)+"+0000"}function o(e){var t=e.getTimezoneOffset();return new Date(e.setMinutes(e.getMinutes()+parseInt(t))).toLocaleDateString()}function r(e){var t=new RegExp("\\d{4}-\\d{2}-\\d{2}"),i=new RegExp("\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}(Z|(\\+\\d{4}))");return t.test(e)&&10==e.length?"date":!i.test(e)||24!=e.length&&28!=e.length?"none":"datetime"}function s(e,t){if(t<e)return-1*s(t,e);var i=0;return i+=12*(t.getUTCFullYear()-e.getUTCFullYear()),i+=t.getUTCMonth()-e.getUTCMonth()}function a(e,t){if(t<e)return-1*a(t,e);var i=s(e,t),n=new Date(e.getTime());return u(n,i),n<t&&(i+=1),i}function l(e,t){if(t<e)return-1*l(t,e);var i=t.getTime()-e.getTime();return Math.round(i/864e5)}function u(e,t){var i=e.getUTCMonth();e.setUTCMonth(e.getUTCMonth()+t);var n=i+t;return n=n<0?n+12:n,e.getUTCMonth()!==n%12&&e.setUTCDate(0),e}function d(e,t){return e.setUTCDate(e.getUTCDate()+t),e}function c(e,t){var i=h(e,t);return l(e,t)-i}function h(e,t){for(var i,n=0,o=e.getUTCFullYear(),r=t.getUTCFullYear(),s=o;s<=r;s++)if((i=s)%100==0?i%400==0:i%4==0){var a=new Date(s,1,29);e<a&&a<t&&n++}return n}function f(e,t){return 0<h(e,t)}function p(e){if(!e)return null;switch(e.toLowerCase()){case"year":return 12;case"quarter":return 3;case"month":return 1;default:return null}}function v(e,t){return new Date(t,e+1,0).getDate()}function g(e){return e.getUTCDate()===v(e.getUTCMonth(),e.getUTCFullYear())}function y(e){var t=e.getUTCMonth(),i=e.getUTCFullYear();return e.setUTCDate(v(t,i)),e}return{setters:[],execute:function(){module.exports.toApexDate=i,module.exports.toApexDateTime=n,module.exports.toUTCDateString=o,module.exports.monthsBetween=s,module.exports.monthsBetweenRoundPartialUp=a,module.exports.daysBetween=l,module.exports.daysBetweenIgnoringLeapYearDays=c,module.exports.distinguishDateFromDateTime=r,module.exports.addMonths=u,module.exports.addDays=d,module.exports.numberOfMonthsInFixedMdqDimension=p,module.exports.countDaysInMonth=v,module.exports.isEndOfMonth=g,module.exports.moveToEndOfMonth=y,module.exports.containsLeapDay=f}}}),System.register("Utils/IdToValueCache.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this._innerMap=new Map(t)}(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e})(o,[{key:"has",value:function(e){return this._innerMap.has(null!=e?e.slice(0,15):e)}},{key:"get",value:function(e){return this._innerMap.get(null!=e?e.slice(0,15):e)}},{key:"set",value:function(e,t){return this._innerMap.set(null!=e?e.slice(0,15):e,t)}},{key:"forEach",value:function(e){return this._innerMap.forEach(e)}},{key:"entries",value:function(){return this._innerMap.entries()}},{key:"values",value:function(){return this._innerMap.values()}},{key:"clear",value:function(){return this._innerMap.clear()}},{key:"delete",value:function(e){return this._innerMap.delete(null!=e?e.slice(0,15):e)}},{key:"keys",value:function(){return this._innerMap.keys()}},{key:Symbol.iterator,value:function(){return this._innerMap.entries()}},{key:"size",get:function(){return this._innerMap.size}}]),i=o,module.exports=i}}}),System.register("Utils/MathOperations.js",[],function(e,t){var i,n,r;function s(){return n(arguments,function(e,t){return(t=function(e){var t=((e=null==e?0:e).toFixed&&e<1e-6?e.toFixed(15).replace(/(\..*?)(0+)$/,"$1"):e.toString()).split(".");return t.length<2?1:Math.pow(10,t[1].length)}(t))<e?e:t},-1/0)}function a(e,t){return(e*t).toFixed(0)-0}function l(e,o){return e.reduce(function(e,t,i,n){return o(e,t)})}return{setters:[],execute:function(){i=Function.prototype.bind.bind(Function.prototype.call),n=i(Array.prototype.reduce),(r={add:function(){if(Array.isArray(arguments[0]))return l(arguments[0],r.add);var o=s.apply(null,arguments);return n(arguments,function(e,t,i,n){return e+a(t,o)},0)/o},sub:function(){if(Array.isArray(arguments[0]))return l(arguments[0],r.sub);var o=s.apply(null,arguments),e=arguments[0];return delete arguments[0],n(arguments,function(e,t,i,n){return e-a(t,o)},a(e,o))/o},mul:function(){if(Array.isArray(arguments[0]))return l(arguments[0],r.mul);return n(arguments,function(e,t,i,n){var o=s(e,t);return a(e,o)*a(t,o)/(o*o)},1)},div:function(){if(Array.isArray(arguments[0]))return l(arguments[0],r.div);return n(arguments,function(e,t,i,n){var o=s(e,t);return a(e,o)/a(t,o)})}}).subtract=r.sub,r.multiply=r.mul,r.divide=r.div,module.exports=r}}}),System.register("Utils/NumberUtils.js",[],function(e,t){var o;function i(e,t){var i=Math.pow(10,t);e=o.multiply(e,i);var n=Math.round(+e.toFixed(t));return n/=i}return{setters:[],execute:function(){o=require("./MathOperations.js"),module.exports.setScale=i,module.exports.add=o.add,module.exports.subtract=o.subtract,module.exports.multiply=o.multiply,module.exports.divide=o.divide}}}),System.register("Utils/RecordJobManager.js",[],function(e,t){var l;function i(e,t){this._conn=e;var i=t&&0<t.indexOf("_")?"/"+t.slice(0,t.indexOf("_")):"";this._serviceRouterUrl=i+"/ServiceRouter",e.oik&&(this._serviceRouterUrl+="?oik="+e.oik),this._setJobStatusProvider="JobCheckerServiceProvider.SetJobStatus",this._setJobsStatusProvider="JobCheckerServiceProvider.SetJobsStatus"}return{setters:[],execute:function(){l=require("js-logger").logger.getLogger(),i.prototype.updateJobStatus=function(e,t,i,n,o){var r=n?n.substring(0,3999):"",s={saver:this._setJobStatusProvider,model:JSON.stringify({recordId:e,jobType:t,jobStatus:i,jobDetails:r,targetId:o||null})},a=Date.now();return l.info(t+" RecordJobManager.js: Start apex rest call to update job status."),this._conn.apex.post(this._serviceRouterUrl,s).then(function(){var e=Date.now();l.info(t+" RecordJobManager.js: Apex rest call to update job status took "+(e-a)+" ms.")}).catch(function(e){return Promise.reject("Error occurred while updating RecordJob__c Status: "+(e.message||e))})},i.prototype.updateJobsStatus=function(e,t,i,n){var o=n?n.substring(0,3999):"",r={saver:this._setJobsStatusProvider,model:JSON.stringify({recordIds:e,jobType:t,jobStatus:i,jobDetails:o})};return this._conn.apex.post(this._serviceRouterUrl,r).catch(function(e){return Promise.reject("Error occurred while updating RecordJob__c Status: "+(e.message||e))})},module.exports=i}}}),System.register("ajax/ajax.js",[],function(e,t){return{setters:[],execute:function(){"undefined"!=typeof window&&window&&(window.SB=window.SB||{},window.SB.ajax=require("./../calc/Utils/ApexUtils.js"))}}}),System.register("assets/assets.js",[],function(e,t){return{setters:[],execute:function(){}}}),System.register("assets/assets.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/asset"),e("PREFIX","/asset"),e("ROUTES",i={"/lookup":{comp:"sb-asset-lookup",mod:"assets/selection/routes/sb-asset-lookup/AssetLookup.js"},"/upgrade":{comp:"sb-asset-upgrade",mod:"assets/upgrade/routes/sb-asset-upgrade/AssetUpgrade.js"}}),e("ROUTES",i)}}}),System.register("common/Util.js",[],function(e,t){var i,r,s,o,u;function d(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,i){var n=void 0===e?[]:[].concat(d(e));return n[t]=i,n}function l(e,t,i){var n=s({},e);return n[t]=i,n}function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}i=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},e("toFieldName",function(e){return(/^[0-9]/.test(e)?"_"+e:e).replace(/\W/g,"")}),e("immutablePush",function(e,t){return[].concat(d(e),[t])}),e("immutableSplice",function(e,t,i){for(var n=arguments.length,o=Array(3<n?n-3:0),r=3;r<n;r++)o[r-3]=arguments[r];return[].concat(d(e.slice(0,t)),o,d(e.slice(t+i)))}),e("immutableSet",a),e("recordSet",l),e("recordDelete",function(e,t){var i=s({},e);return delete i[t],i}),e("pathGet",function(e,t){for(var i=0;i<t.length&&e;i++)e=e[t[i]];return e}),e("pathSet",function(e,t,i){return function e(t,i,n,o){if(o>=i.length)return n;var r=t?t[i[o]]:void 0,s=e(r,i,n,o+1);return r===s?t:isNaN(i[o])?l(t,i[o],s):a(t,i[o],s)}(e,t,i,0)}),e("pathMutate",function(e,t,i){for(var n=0;n<t.length-1;n++)e[t[n]]||(e[t[n]]=isNaN(t[n])?{}:[]),e=e[t[n]];e[t[t.length-1]]=i}),e("mergeRec",function i(n,e){if(n){if(Array.isArray(e))return e.map(function(e,t){return i(n[t],e)});if(e&&"object"===(void 0===e?"undefined":r(e))){var t=s({},n);for(var o in e)t[o]=i(n[o],e[o]);return t}}return void 0===e?n:e}),e("rationalizeDate",function(e){var t=e?new Date(e):new Date;return isNaN(t)&&"string"==typeof e&&(t=new Date(e.substring(0,e.length-2)+":00")),t}),e("getPrunedRecord",function(e,t){var i={attributes:e.attributes},n=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;void 0!==e[l]&&(i[l]=e[l])}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}),e("clearReferencesToIds",function(e,t,i){var n=new Set(e),o=!0,r=!1,s=void 0;try{for(var a,l=i[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;n.has(u.record[t])&&(u.record[t]=null)}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}}),e("Util",(i(t,null,[{key:"deepEquals",value:function(e,t){return"object"===(void 0===e?"undefined":r(e))&&"object"===(void 0===t?"undefined":r(t))?JSON.stringify(e)===JSON.stringify(t):e===t}},{key:"deepClone",value:function(e){return null==e?e:JSON.parse(JSON.stringify(e))}},{key:"pad",value:function(e,t,i){return i=i||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(i)+e}},{key:"toIsoDate",value:function(e){return(e="number"==typeof e?new Date(e):e).getUTCFullYear()+"-"+t.pad(e.getUTCMonth()+1,2)+"-"+t.pad(e.getUTCDate(),2)+"T"+t.pad(e.getUTCHours(),2)+":"+t.pad(e.getUTCMinutes(),2)+":"+t.pad(e.getUTCSeconds(),2)+"Z"}},{key:"notifyTopObjects",value:function(e,t,i){var n=!0,o=!1,r=void 0;try{for(var s,a=Object.keys(t)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;e.notifyPath(i+"."+l,t[l])}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}},{key:"arithmeticOperatorConversion",value:function(e,t,i){switch((null===e&&void 0===t||void 0===e&&null===t)&&(t=e),"boolean"==typeof e&&("true"===t.toLowerCase()?t=!0:"false"===t.toLowerCase()&&(t=!1)),i){case"equals":return e===t;case"not equals":return e!=t;case"less than":return e<t;case"less or equals":return e<=t;case"greater than":return t<e;case"greater or equals":return t<=e;case"starts with":return(e=e||"").toLowerCase().startsWith(t.toLowerCase());case"ends with":return(e=e||"").toLowerCase().endsWith(t.toLowerCase());case"contains":return(e=e||"").toLowerCase().includes(t.toLowerCase())}}},{key:"toHTML",value:function(e){return null!=e&&(e=e.replace(/(?:\r\n|\r|\n)/g,"<br>")),e}},{key:"horizontalBound",value:function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;setTimeout(function(){var e=t.getBoundingClientRect().left+t.getBoundingClientRect().width;e>window.innerWidth&&(t.style.left=t.offsetLeft-(e-window.innerWidth)-i+"px")})}}]),o=t)),e("Util",o),o.Map=Map,Map&&Map.prototype.get&&Map.prototype.set||(u=document.createElement("iframe"),document.body.appendChild(u),o.Map=u.contentWindow.Map,u.parentNode.removeChild(u))}}}),System.register("common/common.js",["common/behaviors/DeviceBehavior.js","common/behaviors/EventBehavior.js","common/behaviors/LookupBehavior.js","common/core/sb-i18n/I18n.js","common/core/sb-loading-spinner/LoadingSpinner.js","common/core/sf-loading-spinner/LoadingSpinner.js","common/core/sb-page-container/PageContainer.js","common/core/sb-toast/Toast.js","common/core/sb-page-header/PageHeader.js","common/data/sb-service/Service.js","common/data/sb-async-service/AsyncService.js","common/filter/searcher/Searcher.js","common/forms/sb-field/Field.js","common/forms/sb-typeahead/Typeahead.js","common/forms/sb-lookup/Lookup.js","common/forms/sb-lookup-dialog/LookupDialog.js","common/forms/sb-datepicker/Datepicker.js","common/forms/sb-date-range/DateRange.js","common/forms/sb-discount/Discount.js","common/forms/sb-pagination/Pagination.js","common/forms/sb-rte/dialog/RichTextEditorDialog.js","common/forms/sb-rte/imageDialog/RTEImageDialog.js","common/forms/sb-rte/RichTextEditor.js","common/forms/sb-search-bar/SearchBar.js","common/forms/sb-search-bar-dialog/SearchBarDialog.js","common/layout/sb-actions/Actions.js","common/forms/sb-input/Input.js","common/forms/sb-select/Select.js","common/forms/sb-textarea/Textarea.js","common/forms/sb-checkbox/Checkbox.js","common/forms/sb-multi-lookup/MultiLookup.js","common/forms/sb-dual-list-box/DualListBox.js","common/layout/sb-div/Div.js","common/layout/sb-field-item/FieldItem.js","common/layout/sb-field-table/FieldTable.js","common/layout/sb-group/Group.js","common/layout/sb-side-panel/SidePanel.js","common/layout/sb-swipe-container/SwipeContainer.js","common/layout/sb-table-cell/TableCell.js","common/layout/sb-table-cell-select/TableCellSelect.js","common/layout/sb-table-header/TableHeader.js","common/layout/sb-table-row/TableRow.js","common/layout/sb-tabs/Tabs.js","common/layout/sb-dialog/Dialog.js","common/layout/sb-popup/Popup.js","common/layout/sb-lookup-layout/LookupLayout.js","common/layout/sb-filter-layout/FilterLayout.js","common/layout/sb-filter-item/FilterItem.js","common/layout/sb-row-drawer/RowDrawer.js","common/services/sb-line-editor-read/LineEditorReader.js","common/services/sb-job-checker/JobChecker.js","common/services/sb-field-md/FieldMetadata.js","common/services/sb-search-model-load/SearchModelLoader.js","common/services/sb-search-model-select/SearchModelSelector.js","common/data/sb-describe/Describe.js","common/services/sb-product-rules-quote-line-adder/ProductRulesQuoteLineAdder.js"],function(e,t){var i;return{setters:[function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){}],execute:function(){1e3,Polymer&&(i=null,Polymer.Gestures.register({name:"hold",deps:["mousedown","mouseup","touchstart","touchend"],flow:{start:["mousedown","touchstart"],end:["mouseup","touchend"]},emits:["hold"],mouseup:function(e){return this.up(e)},touchend:function(e){return this.up(e.changedTouches[0],e)},up:function(e){return clearTimeout(i),!1},mousedown:function(e){return this.down(e)},touchstart:function(e){return this.down(e.changedTouches[0],e)},down:function(e,t){return i=setTimeout(function(){Polymer.Gestures.fire(Polymer.Gestures.findOriginalTarget(e),"hold",{x:e.clientX,y:e.clientY,sourceEvent:e,preventer:t})},1e3),!1}}))}}}),System.register("contracts/contracts.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/contract"),e("PREFIX","/contract"),e("ROUTES",i={"/lookup":{comp:"sb-contract-lookup",mod:"contracts/selection/routes/sb-contract-lookup/ContractLookup.js"}}),e("ROUTES",i)}}}),System.register("docgen/docgen.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/docgen"),e("PREFIX","/docgen"),e("ROUTES",i={"/preview":{comp:"sb-docgen-preview",mod:"docgen/sb-docgen-preview/DocgenPreview.js"}}),e("ROUTES",i)}}}),System.register("favorites/favorites.js",["favorites/sb-favorite-lookup/FavoriteLookup.js","favorites/sb-favorite-share-dialog/FavoriteShareDialog.js"],function(e,t){return{setters:[function(e){},function(e){}],execute:function(){}}}),System.register("favorites/favorites.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/favorite"),e("PREFIX","/favorite"),e("ROUTES",i={"/lookup":{comp:"sb-favorite-lookup",mod:"favorites/sb-favorite-lookup/FavoriteLookup.js"}}),e("ROUTES",i)}}}),System.register("logging/AppLogger.js",["common/data/client/ServiceClient.js","common/core/AppContext.js"],function(t,e){var i,o,r,s,a,l;return{setters:[function(e){i=e.ServiceClient},function(e){o=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.client=new i}r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},"/connect/proxy/app-analytics-logging",t("LOG_TYPE",a={LOAD_QLE:"loadQLE",RESIZE_COLUMN:"resizeColumn",RESET_COLUMN:"resetColumn",PRICING_GUIDANCE:"pricingGuidance"}),t("LOG_TYPE",a),t("AppLogger",(s(e,[{key:"log",value:function(e,t,i){if("undefined"!=typeof Visualforce){i&&"object"===(void 0===i?"undefined":r(i))&&(i=JSON.stringify(i));try{var n={logLines:[{code:"qtqle",data:{recordId_qtqle:e,osName_qtqle:this._getOSType(),deviceModel_qtqle:this._getDeviceModel(),browserName_qtqle:this._getBrowserType(),eventType_qtqle:t,payload_qtqle:i}}]};this.client.requestPost("/connect/proxy/app-analytics-logging",n)}catch(e){console.error("Error invoking AppLogger.log",e)}}}},{key:"maskCustomerData",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"*****";return!e||e.startsWith(o.org.prefix)?e:t}},{key:"_getDeviceModel",value:function(){var e=window.navigator.userAgent;return-1<e.indexOf("iPad")?"iPad":-1<e.indexOf("Android")?"Android":-1<e.indexOf("iPhone")?"iPhone":"desktop"}},{key:"_getBrowserType",value:function(){var e=window.navigator.userAgent;return-1<e.indexOf("Edg")?"Edge":-1<e.indexOf("Chrome")?"Chrome":-1<e.indexOf("Safari")?"Safari":-1<e.indexOf("Firefox")?"Firefox":null}},{key:"_getOSType",value:function(){var e=window.navigator.userAgent;return-1<e.indexOf("Win")?"Windows":-1<e.indexOf("like Mac")?"iOS":-1<e.indexOf("Mac")?"Macintosh":-1<e.indexOf("Android")?"Android":-1<e.indexOf("Linux")?"Linux":null}}]),l=e)),t("AppLogger",l)}}}),System.register("perfMetrics/MetricsService.js",[],function(e,t){var p,i,o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.salesforceBaseUrl=e}p=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},"cpqEPT","/_ui/common/request/servlet/CPQLoggingServlet","1.0",e("IDLE_RETRIES",2),e("IDLE_RETRIES",2),48,e("MetricsService",(i(t,[{key:"startTransaction",value:function(e){this.canGatherMetrics()&&this._isNotStarted()&&(this._init(),this._queueIdleCallback(),console.log(e||"CPQ Performance Metrics Service: started ept"))}},{key:"startServiceRequest",value:function(e,t){if(this._isNotStarted())return null;window.sb.MetricsService.internal.sptNum+=1;var i=this._getUniqueId();return void 0===e&&(e=""),void 0!==t&&(e=e+"/"+t),window.sb.MetricsService.internal.actions.set(i,this._buildTransportAction(e)),console.log("CPQ Performance Metrics Service: started service call"),i}},{key:"addExternalLogMetrics",value:function(e){e||(e={}),this._externalLogMetrics||(this._externalLogMetrics={}),Object.assign(this._externalLogMetrics,e)}},{key:"_buildTransportAction",value:function(e){return{context:{actionDefs:[e]},pageStartTime:Date.now(),ts:this._getTime(),name:"request",ns:"transport"}}},{key:"stopServiceRequest",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this._isNotStarted()||(window.sb.MetricsService.internal.sptNum-=1,window.sb.MetricsService.internal.idleRetries=2,0<window.sb.MetricsService.internal.idleStart&&(window.sb.MetricsService.internal.idleTime+=this._getTime()-window.sb.MetricsService.internal.idleStart,window.sb.MetricsService.internal.idleStart=0),this._populateTransportAction(e),window.sb.MetricsService.internal.sptTime+=t,console.log("CPQ Performance Metrics Service: ended service call",t))}},{key:"_init",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=Date.now(),i=this._getTime(),n=this._getPageStartTime();if(window.sb.visibilityStateEnd=document.visibilityState,window.sb=window.sb||{},null!=window.sb&&null==window.sb.MetricsService){if(window.sb.MetricsService={},window.sb.MetricsService.bootstrap={id:"qtc:bootstrap"},window.sb.MetricsService.bootstrap.bootstrapEPT=i,window.sb.MetricsService.bootstrap.pageStartTime=n,window.sb.MetricsService.bootstrap.visibilityStateStart=window.sb.visibilityStateStart,window.sb.MetricsService.bootstrap.visibilityStateEnd=window.sb.visibilityStateEnd,window.performance&&performance.timing){var o=window.performance,r=o.timing,s={readyStart:r.fetchStart-r.navigationStart,lookupDomainTime:r.domainLookupEnd-r.domainLookupStart,connectTime:r.connectEnd-r.connectStart,requestTime:r.responseEnd-r.requestStart,initDomTreeTime:r.domInteractive-r.responseEnd,domReadyTime:r.domComplete-r.domInteractive,loadEventTime:r.loadEventEnd-r.loadEventStart,loadTime:r.loadEventEnd-r.fetchStart,unloadEventTime:r.unloadEventEnd-r.unloadEventStart,appCacheTime:r.domainLookupStart-r.fetchStart,redirectTime:r.redirectEnd-r.redirectStart};window.sb.MetricsService.bootstrap.timing=Object.assign(r.toJSON(),s),window.sb.MetricsService.bootstrap.allRequests=[],o.getEntries().forEach(function(e){var t=this._summarizeResourcePerfInfo(e);window.sb.MetricsService.bootstrap.allRequests.push(t)},this)}}else window.sb.MetricsService.bootstrap={};window.sb.MetricsService.internal={lastIdleEndTime:i,sptNum:0,idleStart:0,idleTime:0,sptTime:0,idleRetries:2,actions:new Map},window.sb.MetricsService.currentPage={ept:void 0,bpt:void 0,spt:void 0,pageStartTime:t,ts:i,page:{attributes:{app:{appName:"SteelBrick",appType:"Standard"},url:window.location.href},entity:e}}}},{key:"_idle",value:function(){if(!this._isNotStarted()){if(0===window.sb.MetricsService.internal.sptNum){if(0===window.sb.MetricsService.internal.idleRetries)return this._calcAndDisplayMetrics(),void this._logMetrics();2==window.sb.MetricsService.internal.idleRetries&&(window.sb.MetricsService.internal.lastIdleEndTime=this._getTime()),window.sb.MetricsService.internal.idleRetries--}0===window.sb.MetricsService.internal.idleStart&&(window.sb.MetricsService.internal.idleStart=this._getTime()),this._queueIdleCallback()}}},{key:"_summarizeResourcePerfInfo",value:function(e){return{name:e.name,initiatorType:e.initiatorType,duration:parseInt(e.responseEnd-e.startTime,10),startTime:parseInt(e.startTime,10),fetchStart:parseInt(e.fetchStart,10),requestStart:parseInt(e.requestStart,10),dns:parseInt(e.domainLookupEnd-e.domainLookupStart,10),tcp:parseInt(e.connectEnd-e.connectStart,10),ttfb:parseInt(e.responseStart-e.startTime,10),transfer:parseInt(e.responseEnd-e.responseStart,10),transferSize:parseInt(e.transferSize,10),encodedBodySize:parseInt(e.encodedBodySize,10),decodedBodySize:parseInt(e.decodedBodySize,10)}}},{key:"_populateTransportAction",value:function(e){if(e){var t=window.sb.MetricsService.internal.actions.get(e);t&&(t.duration=parseInt(this._getTime()-t.ts))}}},{key:"_queueIdleCallback",value:function(){this.canGatherMetrics()&&window.requestIdleCallback(this._idle.bind(this))}},{key:"_calcAndDisplayMetrics",value:function(){var e=window.sb.MetricsService.internal.lastIdleEndTime-window.sb.MetricsService.currentPage.ts,t=e-window.sb.MetricsService.internal.idleTime,i=window.sb.MetricsService.internal.sptTime,n=[],o=null;window.performance&&window.performance.getEntriesByType&&(o=window.performance.getEntriesByType("resource"));var r=!0,s=!1,a=void 0;try{for(var l,u=window.sb.MetricsService.internal.actions[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=p(l.value,2),c=(d[0],d[1]);if(null!=o){var h=o.filter(function(e){return e.startTime>=c.ts&&e.startTime<=c.ts+c.duration})[0];null!=h&&(c.resource=h)}n.push(c)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}if(window.sb.MetricsService.internal=null,window.sb.MetricsService.currentPage.ept=e,window.sb.MetricsService.currentPage.bpt=t,window.sb.MetricsService.currentPage.spt=i,window.sb.MetricsService.currentPage.marks={transport:n},console.log("CPQ Performance Metrics Service: ",window.sb.MetricsService.bootstrap,window.sb.MetricsService.currentPage),this._canDisplayMetrics()){var f=new CustomEvent("metrics-changed",{detail:window.sb.MetricsService.currentPage,bootstrap:window.sb.MetricsService.bootstrap});document.dispatchEvent(f)}}},{key:"_normalizeApiHost",value:function(e){var t=/([a-zA-Z0-9_-]+)\.(vpod\.visual\.t\.force|visual\.force|salesforce)\.com$/.exec(e);return t&&(e="vpod.visual.t.force"==t[2]?t[1]+".vpod.t.force.com":t[1]+".salesforce.com"),e}},{key:"_logMetrics",value:function(){var i=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if(!(window.sb.MetricsService.currentPage.ept<150)&&this.salesforceBaseUrl){var e=this.salesforceBaseUrl+"/_ui/common/request/servlet/CPQLoggingServlet",n=new XMLHttpRequest;n.withCredentials=!0,n.open("POST",e,!0);var o=this;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE)if(200==n.status)console.log("CPQ Performance Metrics service Successfully logged");else{if(i)return console.log("Error while logging CPQ Performance Metrics Service:"),void console.log(n.getAllResponseHeaders());console.log("Logging failed, trying on different endpoint..");var e=o._normalizeApiHost(location.host),t=location.protocol+"//"+e;o.salesforceBaseUrl=t,o._logMetrics(!0)}};var t={pkgVersion:window.sb.pkgVersion,apiVersion:48,url:window.sb.MetricsService.currentPage.page.attributes.url,pageStartTime:window.sb.MetricsService.currentPage.pageStartTime,version:"1.0",polymerVersion:"P1"};this._externalLogMetrics&&Object.assign(t,this._externalLogMetrics);var r=[{logName:"cpqEPT",logLevel:"INFO",logAttrs:{attrsId:"cpq:page",ept:window.sb.MetricsService.currentPage.ept,bpt:window.sb.MetricsService.currentPage.bpt,spt:window.sb.MetricsService.currentPage.spt,resources:window.sb.MetricsService.currentPage.marks}}];Object.assign(r[0].logAttrs,t),0!==Object.keys(window.sb.MetricsService.bootstrap).length&&(r.push({logName:"cpqEPT",logLevel:"INFO",logAttrs:{attrsId:window.sb.MetricsService.bootstrap.id,bootstrapEPT:window.sb.MetricsService.bootstrap.bootstrapEPT,visibilityStateStart:window.sb.MetricsService.bootstrap.visibilityStateStart,visibilityStateEnd:window.sb.MetricsService.bootstrap.visibilityStateEnd,resources:window.sb.MetricsService.bootstrap.allRequests,timing:window.sb.MetricsService.bootstrap.timing}}),Object.assign(r[1].logAttrs,t));var s=new FormData;s.append("logLines",JSON.stringify(r)),n.send(s)}}},{key:"_canDisplayMetrics",value:function(){if(!this.canGatherMetrics())return!1;var e=new URL(window.location.href);return 1==new URLSearchParams(e.search).get("eptVisible")}},{key:"canGatherMetrics",value:function(){return"function"==typeof window.requestIdleCallback}},{key:"_isNotStarted",value:function(){return null==window.sb||null==window.sb.MetricsService||null==window.sb.MetricsService.internal||null==window.sb.MetricsService.internal.sptNum}},{key:"_getTime",value:function(){return window.performance?window.performance.now():Date.now()}},{key:"_getPageStartTime",value:function(){var e=window.performance;return e&&e.timing&&e.timing.navigationStart?e.timing.navigationStart:window.pageStartTime}},{key:"_getUniqueId",value:function(){return this._getRandomInt(1,1e4)}},{key:"_getRandomInt",value:function(e,t){return Math.floor(Math.random()*(t-e+1))+e}}]),o=t)),e("MetricsService",o)}}}),System.register("products/products.js",["products/config/attribute/sb-attribute-item/AttributeItem.js","products/config/attribute/sb-attribute-table/AttributeTable.js","products/config/bundles/sb-product-bundles-layout/ProductBundlesLayout.js","products/config/bundles/sb-product-bundles-filter-item/ProductBundlesFilterItem.js","products/config/feature/sb-product-feature/ProductFeature.js","products/config/feature/sb-product-feature-layout/ProductFeatureLayout.js","products/config/feature/sb-product-feature-category-list/ProductFeatureCategoryList.js","products/config/feature/sb-product-feature-list/ProductFeatureList.js","products/config/option/sb-product-option-table/ProductOptionTable.js","products/config/option/sb-option-cell/OptionCell.js","products/config/option/sb-option-drawer/OptionDrawer.js","products/config/routes/services/sb-pc-product-load/ProductLoader.js","products/config/routes/services/sb-pc-option-save/OptionSaver.js","products/config/routes/services/sb-product-rules-invoke/ProductRulesInvoker.js","products/config/routes/services/sb-pc-option-configure/OptionConfigurator.js","products/config/actions/sb-custom-actions/CustomActions.js","products/localization/LocalizeFields.js","products/resources/sb-product-alert/ProductAlert.js"],function(e,t){return{setters:[function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){}],execute:function(){}}}),System.register("products/products.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/product"),e("PREFIX","/product"),e("ROUTES",i={"/dl":{comp:"sb-dynamic-lookup",mod:"products/config/routes/sb-dynamic-lookup/DynamicLookup.js"},"/lookup":{comp:"sb-product-lookup",mod:"products/selection/routes/sb-product-lookup/ProductLookup.js"},"/ol":{comp:"sb-option-lookup",mod:"products/config/routes/sb-option-lookup/OptionLookup.js"},"/pc":{comp:"sb-product-config",mod:"products/config/routes/sb-product-config/ProductConfig.js"},"/search":{comp:"sb-product-search",mod:"products/prototype/sb-product-search/ProductSearch.js"}}),e("ROUTES",i)}}}),System.register("quoteLogger/Publisher.js",["./Utils.js"],function(e,t){var o;return{setters:[function(e){o=e}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),!e||!o.isValidChannel(t))throw"Publisher: Constructor requires 2 valid arguments (tag, channel)";this.tag=e,this.channel=t,this.msgQueue=[]}(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e})(i,[{key:"init",value:function(){this.channel.init(this._publishOnceReady.bind(this))}},{key:"publish",value:function(e){if(e){var t=Object.assign({},e);t.tag=this.tag,this.msgQueue.push(t),this._publishOnceReady()}else console.error("Publisher: publish() must be called with a valid message object argument")}},{key:"shutdown",value:function(){this.msgQueue=[],this.channel.shutdown()}},{key:"_publishOnceReady",value:function(){var t=this;this.channel.isReady()&&(this.msgQueue.forEach(function(e){return t.channel.send(e)}),this.msgQueue=[])}}]),e("default",i)}}}),System.register("quoteLogger/QuoteLogger.js",["./Subscriber.js","./Publisher.js","./Utils.js","./WindowChannel.js"],function(e,t){var o,r,s,a,l,u,d,c,h,f;return{setters:[function(e){o=e.default},function(e){r=e.default},function(e){s=e},function(e){a=e.default}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.subChannel=e,this.pubChannel=t,this.subscriber=e?new o(u,e):null,this.publisher=t?new r(u,t):null,this.isSubscriber=!1,this.isPublisher=!1,this.callbacks=[]}h={tag:u="QuoteLogger",type:d="__SYN__"},f={tag:u,type:c="__ACK__"},100,(l=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e})(i,null,[{key:"appender",value:function(){var i=this;return function(e){if(i.instance){var t=s.makeLogFromArgs(e.data);t.timestamp=e.startTime,i.instance._publish(t)}}}},{key:"configure",value:function(){return this.appender()}},{key:"setInstance",value:function(e){this.instance&&this.instance.shutdown(),this.instance=e}}]),l(i,[{key:"initPublisher",value:function(){if(this.publisher){if(this.pubChannel instanceof a){if(!this.subscriber)return void console.error("QuoteLogger: subChannel is required in order to initPublisher() when using WindowChannel");this.subscriber.init(),this.publisher.init(),this.subscriber.subscribe(this._receiveLog.bind(this)),this._waitForWindow()}else this.publisher.init();this.isPublisher=!0}else console.error("QuoteLogger: pubChannel is required in order to initPublisher()")}},{key:"publish",value:function(){var e=s.makeLogFromArgs.apply(null,arguments);e.timestamp=(new Date).toString(),this._publish(e)}},{key:"initSubscriber",value:function(){this.subscriber?(this.isSubscriber=!0,this.subscriber.init(),this.subscriber.subscribe(this._receiveLog.bind(this))):console.error("QuoteLogger: subChannel is required in order to initSubscriber()")}},{key:"subscribe",value:function(e){this.isSubscriber?"function"==typeof e?this.callbacks.push(e):console.error("QuoteLogger: subscribe() must be called with a valid function"):console.error("QuoteLogger: initSubscriber() must be called prior to any subscribing methods")}},{key:"unsubscribe",value:function(e){if(this.isSubscriber){var t=this.callbacks.indexOf(e);t<0?console.error("QuoteLogger: unsubscribe() must be called with a function previously set using subscribe()"):this.callbacks.splice(t,1)}else console.error("QuoteLogger: initSubscriber() must be called prior to any subscribing methods")}},{key:"shutdown",value:function(){this.subscriber&&this.subscriber.shutdown(),this.publisher&&this.publisher.shutdown(),this.isSubscriber=!1,this.isPublisher=!1,this.callbacks=[]}},{key:"_publish",value:function(e){this.isPublisher?e.type?this.publisher.publish(e):console.error('QuoteLogger: publish() argument missing "type" property'):console.error("QuoteLogger: initPublisher() must be called prior to any publishing methods")}},{key:"_receiveLog",value:function(t){var i=this;t&&(this.subChannel instanceof a&&(t.type===d?new a(t.source).send(f):t.type===c&&this.isPublisher&&this.pubChannel.markReady(),delete t.source),this.callbacks.forEach(function(e){return e(t,i)}))}},{key:"_waitForWindow",value:function(){this.pubChannel.isActive()&&!this.pubChannel.isReady()&&(this.pubChannel.send(h),setTimeout(this._waitForWindow.bind(this),100))}}]),e("default",i)}}}),System.register("quoteLogger/Subscriber.js",["./Utils.js"],function(e,t){var o;return{setters:[function(e){o=e}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),!e||!o.isValidChannel(t))throw"Subscriber: Constructor requires 2 valid arguments (tag, channel)";this.tag=e,this.channel=t,this.callbacks=[]}(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e})(i,[{key:"init",value:function(){this.channel.init(),this.channel.addListener(this._receiveMessage.bind(this))}},{key:"subscribe",value:function(e){"function"==typeof e?this.callbacks.push(e):console.error("Subscriber: subscribe() must be called with a valid function")}},{key:"unsubscribe",value:function(e){var t=this.callbacks.indexOf(e);t<0?console.error("Subscriber: unsubscribe() must be called with a function previously set using subscribe()"):this.callbacks.splice(t,1)}},{key:"shutdown",value:function(){this.callbacks=[],this.channel.shutdown()}},{key:"_receiveMessage",value:function(t){t&&t.tag===this.tag&&this.callbacks.forEach(function(e){return e(t)})}}]),e("default",i)}}}),System.register("quoteLogger/Utils.js",[],function(e,t){var i,n;return{setters:[],execute:function(){i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=["init","isActive","isReady","addListener","removeListener","send","shutdown"],"text",e("isValidChannel",function(t){return!!t&&function(e){return e.reduce(function(e,t){return e&&t},!0)}(n.map(function(e){return"function"==typeof t[e]}))}),e("makeLogFromArgs",function(e){Array.isArray(e)||(e=Array.prototype.slice.call(arguments));var t=e[0];return t&&"object"===(void 0===t?"undefined":i(t))||(t={type:"text",data:e.join(" ")}),t})}}}),System.register("quoteLogger/WindowChannel.js",[],function(e,t){return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===e||!e)throw"WindowChannel: Constructor requires a valid window argument";this.win=e,this.id=Math.random().toString(),this.active=!1,this.ready=!1,this.readyCallbacks=[],this.listeners=[],this._receive=this._receive.bind(this)}(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e})(t,[{key:"init",value:function(e){if(e){if("function"!=typeof e)return void console.error("WindowChannel: init() must be undefined or called with a valid function");this.isReady()?e():this.readyCallbacks.push(e)}if(!this.active){this.active=!0;try{this.win.addEventListener("message",this._receive)}catch(e){}}}},{key:"isActive",value:function(){return this.active&&!this.win.closed}},{key:"isReady",value:function(){return this.isActive()&&this.ready}},{key:"markReady",value:function(){this.ready=!0,this.readyCallbacks.forEach(function(e){return e()}),this.readyCallbacks=[]}},{key:"addListener",value:function(e){"function"==typeof e?this.listeners.push(e):console.error("WindowChannel: addListener() must be called with a valid function")}},{key:"removeListener",value:function(e){var t=this.listeners.indexOf(e);t<0?console.error("WindowChannel: removeListener() must be called with a function previously set using addListener()"):this.listeners.splice(t,1)}},{key:"send",value:function(e){if(e){var t=Object.assign({},e),i=this._getTargetOrigin();t.tag+="__"+this.id,this.win.postMessage(JSON.stringify(t),i)}else console.error("WindowChannel: send() must be called with a valid message object")}},{key:"shutdown",value:function(){this.active=!1,this.ready=!1,this.readyCallbacks=[],this.listeners=[];try{this.win.removeEventListener("message",this._receive)}catch(e){}}},{key:"_receive",value:function(e){if(this._isValidSourceOrigin(e.origin)){if(e&&e.data){var t=JSON.parse(e.data);t.tag&&!t.tag.endsWith(this.id)&&(t.source=e.source,t.tag=t.tag.replace(/__[0-9.]+$/,""),this.listeners.forEach(function(e){return e(t)}))}}else console.warn("WindowChannel: Received message from unknown source origin ("+e.origin+")!")}},{key:"_getTargetOrigin",value:function(){return"*"}},{key:"_isValidSourceOrigin",value:function(e){return!0}}]),e("default",t)}}}),System.register("quoteLogger/main.js",["./QuoteLogger.js","./WindowChannel.js"],function(e,t){var i,n;return{setters:[function(e){i=e.default},function(e){n=e.default}],execute:function(){"undefined"!=typeof window&&window&&(window.sb=window.sb||{},window.sb.QuoteLogger=i,window.sb.WindowChannel=n)}}}),System.register("quotes/QuoteContext.js",[],function(e,t){var r,i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o)}e("QuoteContext",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,r=null,[{key:"isDiscountField",value:function(e){return e===r.ADDITIONAL_DISCOUNT_FIELD}},{key:"isMarkupField",value:function(e){return e===r.MARKUP_FIELD}},{key:"isListPriceField",value:function(e){return e===r.LIST_PRICE_FIELD}},{key:"isProductNameField",value:function(e){return e===r.PRODUCT_NAME_FIELD}},{key:"isNetTotalField",value:function(e){return e===r.NET_TOTAL_FIELD}},{key:"isSubscriptionScopeField",value:function(e){return e===r.SUBSCRIPTION_SCOPE_FIELD}},{key:"isUbpFieldInlineEditable",value:function(e,t){for(var i=r.UBP_FIELDS.ConsumptionRateFields,n=[i.UpperBound,i.LowerBound,i.Price],o=0;o<n.length;o++)if(n[o]===e)return null!=t&&t[e];return!1}},{key:"shouldCalulateImmediately",value:function(e,t,i){return!(!t||null!=i.quoteVO.record[o.constants.TARGET_CUSTOMER_AMOUNT]&&new Set([o.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD,o.constants.ADDITIONAL_DISCOUNT_RATE_FIELD,o.constants.ADDITIONAL_DISCOUNT_FIELD]).has(e))}},{key:"constants",get:function(){return r},set:function(e){r=e}}]),i=o)),e("QuoteContext",i)}}}),System.register("quotes/quotes.js",["quotes/pages/sb-line-editor/LineEditor.js","quotes/pages/sf-ubp-editor/UBPEditor.js","quotes/sb-le-custom-action-services/LECustomActionServices.js","quotes/md/sb-le-field-md/LEFieldMD.js","quotes/layout/sb-le-group/LEGroup.js","quotes/layout/sf-preview-panel/PreviewPanel.js","quotes/tables/sf-standard-table/SFStandardTable.js","quotes/tables/sf-segmented-table/SFSegmentedTable.js","quotes/tables/ubp-rate-table/UBPRateTable.js","quotes/layout/sf-segmented-cell-tooltip/SFSegmentedCellTooltip.js","quotes/layout/sb-segmented-line-details/SegmentedLineDetails.js","quotes/layout/sb-segmented-detail-row/SegmentedDetailRow.js","quotes/layout/sf-table-header/SFTableHeader.js","quotes/layout/sf-le-table-header/SFLETableHeader.js","quotes/layout/sf-le-table-row/SFLETableRow.js","quotes/layout/sf-line-actions/SFLineActions.js","quotes/layout/sf-line-warning/SFLineWarning.js","quotes/layout/sb-le-table-cell/LETableCell.js","quotes/layout/sb-ds-table-cell/DSTableCell.js","quotes/layout/sb-ds-tiers/DSTiers.js","quotes/layout/sb-le-table-header/LETableHeader.js","quotes/layout/sb-le-table-header-cell/LETableHeaderCell.js","quotes/layout/sb-le-footer/LEFooter.js","quotes/layout/sb-le-group-layout/LEGroupLayout.js","quotes/layout/sb-field-set-table-item/FieldSetTableItem.js","quotes/layout/sb-field-set-table/FieldSetTable.js","quotes/layout/sb-le-drawer/LEDrawer.js","quotes/layout/sb-line-editor-tabs/sb-quote-tabs/QuoteTabs.js","quotes/layout/sb-line-editor-tabs/sb-group-tabs/GroupTabs.js","quotes/layout/sb-custom-action/CustomAction.js","quotes/layout/sb-le-summary-row/LESummaryRow.js","quotes/layout/sb-le-summary-row/sb-le-summary-cell/LESummaryCell.js","quotes/layout/ubp-rate-row/UBPRateRow.js","quotes/dialogs/sb-favorite-dialog/FavoriteDialog.js","quotes/dialogs/sb-pricing-guidance-dialog/PricingGuidanceDialog.js","quotes/dialogs/sb-clone-to-group-dialog/CloneToGroupDialog.js","quotes/dialogs/sb-custom-segment-dialog/CustomSegmentDialog.js","quotes/layout/sb-cse-table-cell/CSETableCell.js","quotes/dialogs/sb-pricebook-dialog/PricebookDialog.js","quotes/models/DragDropModel.js","quotes/dialogs/sb-discount-schedule-dialog/DiscountScheduleDialog.js","quotes/usage-based-pricing-dao/UsageBasedPricingDao.js","quotes/consumption-rate-validator/ConsumptionRateValidator.js"],function(e,t){return{setters:[function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){}],execute:function(){}}}),System.register("quotes/quotes.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/quote"),e("PREFIX","/quote"),e("ROUTES",i={"/le":{comp:"sb-line-editor",mod:"quotes/pages/sb-line-editor/LineEditor.js"}}),e("ROUTES",i)}}}),System.register("recommendations/recommendations.js",["recommendations/sb-recommendation-lookup/RecommendationLookup.js"],function(e,t){return{setters:[function(e){}],execute:function(){}}}),System.register("recommendations/recommendations.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/recommend"),e("PREFIX","/recommend"),e("ROUTES",i={"/lookup":{comp:"sb-recommendation-lookup",mod:"recommendations/sb-recommendation-lookup/RecommendationLookup.js"}}),e("ROUTES",i)}}}),System.register("subscriptions/subscriptions.js",[],function(e,t){return{setters:[],execute:function(){}}}),System.register("subscriptions/subscriptions.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/subscription"),e("PREFIX","/subscription"),e("ROUTES",i={"/lookup":{comp:"sb-subscription-lookup",mod:"subscriptions/selection/routes/sb-subscription-lookup/SubscriptionLookup.js"}}),e("ROUTES",i)}}}),System.register("Utils/DAOs/BaseDAO.js",[],function(e,t){var r,o,s,c,a,l;function h(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){u(this,e)}function i(e,t){u(this,i),this._conn=e,this._labels=t,this._QUERY_LENGTH_LIMIT=15e3,this._WHERE_CLAUSE_LENGTH_LIMIT=3800,this._logger=s}r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},s=require("js-logger").logger.getLogger("JSAR Perf"),c=require("./WhereClauseSplitter.js"),o(e,[{key:"addSubqueriesToQuery",value:function(e){throw Error("Error: BaseSubqueryDescriptor.addSubqueriesToQuery() should be overridden by child classes and never invoked directly.")}}]),a=e,o(i,[{key:"_logMessage",value:function(e){this._logger.info(e)}},{key:"_logWarning",value:function(e){this._logger.warn(e)}},{key:"_constructSelectClauseAndCalculateRemainingLength",value:function(e){var t=0,i=[].concat(h(new Set(e))).join(", ");t+=i.length;var n=this._QUERY_LENGTH_LIMIT-t;if(n<18)throw Error("SELECT clause length exceeded safe threshold of 15,000 characters.");return{selectClause:i,maxWhereLength:n<this._WHERE_CLAUSE_LENGTH_LIMIT?n:this._WHERE_CLAUSE_LENGTH_LIMIT}}},{key:"_constructAndPerformQuery",value:function(i,e,t,n,o){var r=this,s=this._constructSelectClauseAndCalculateRemainingLength(e),a=s.selectClause,l=(new c).splitWhereClause(t,s.maxWhereLength),u=l.clauses,d=(l.specificityPreserved,[]);return u.forEach(function(e){var t=r._conn.sobject(i).select(a).where(e);n&&n.addSubqueriesToQuery(t),o&&t.orderby(o[0],o[1]),d.push(t.execute({autoFetch:!0,maxFetch:Number.POSITIVE_INFINITY}))}),Promise.all(d).then(function(e){return r._reconcileQueryResultsWithWhereClauses(e,l)},function(e){return r._simplifyAndRethrowQueryError(e)})}},{key:"_simplifyAndRethrowQueryError",value:function(e){var t=e.message||e,i=t.split("\n");if(5===i.length){var n=""===i[0],o=/^\s*\^$/g.test(i[2]),r=i[3].startsWith("ERROR at Row"),s=i[4].startsWith("No such column '");if(n&&o&&r&&s){var a=/No such column '(\w+)' on entity '(\w+)'./g.exec(i[4]);if(a&&a[1]&&a[2]){var l=this._labels.msg_missing_fls_on_amend_or_renew;throw new Error(l.replace("{0}",a[1]).replace("{1}",a[2]))}}}throw new Error(t)}},{key:"_reconcileQueryResultsWithWhereClauses",value:function(n,o){if(o.specificityPreserved){var t=[],i=new Set;return n.forEach(function(e){e.forEach(function(e){i.has(e.Id)||(t.push(e),i.add(e.Id))})}),t}var e=function(){for(var e=0,u=n,d=o.splitKeyLists,t=o.splitKeysMappedByMaxDepth,i=function(){var a=[],l=[],o=t.get(e),r=new Map,s=new Map;d.forEach(function(e,t){var i=e[0];if(o.has(i)&&!r.has(i))r.set(i,t),s.set(t,{splitKey:i,secondaryIdxs:[]});else if(o.has(i)){var n=r.get(i);s.get(n).secondaryIdxs.push(t)}else s.set(t,null)}),s.forEach(function(e,t){if(null==e)a.push(u[t]),l.push(d[t]);else{var i=e.splitKey,n=u[t],o=e.secondaryIdxs.map(function(e){return u[e]}),r=new Set,s=[];i.startsWith("AND")?(o.forEach(function(e,t){var i=new Set;e.forEach(function(e){!r.has(e.Id)&&0!==t||i.add(e.Id)}),r=i}),n.forEach(function(e){r.has(e.Id)&&s.push(e)})):[n].concat(h(o)).forEach(function(e){e.forEach(function(e){r.has(e.Id)||(s.push(e),r.add(e.Id))})}),a.push(s),l.push(d[t].slice(1))}}),u=a,d=l,e+=1};e<t.size;)i();return{v:u[0]}}();if("object"===(void 0===e?"undefined":r(e)))return e.v}}]),l=i,module.exports.BaseSubqueryDescriptor=a,module.exports.BaseDAO=l}}}),System.register("Utils/DAOs/DAOHelperMethods.js",[],function(e,t){return{setters:[],execute:function(){module.exports.properlyPrefixFields=function(t,e){return e.map(function(e){return e.endsWith("__c")?t+e:e})}}}}),System.register("Utils/DAOs/ProductDAO.js",[],function(e,t){var r,s,f,a,l,u,d,c,p,v,g,y,m,h,b;function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e){_(this,i);var t=C(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t._opts=e,t._salesCloudPrefix=t._opts.prefix,t._includeCosts=!1,t._includePriceEntries=!1,t._includeDimensions=!1,t._includeBlockPrices=!1,t._filteredPricebooks=null,t._filteredCurrencyCodes=null,t._includeOptionsByOptionalSKU=!1,t._mappableOptionFields=null,t._initialized=!1,t}function o(e,t,i){_(this,o);var n=C(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e,i.labels));return n._opts=i,n._prefix=i.prefix,n._services=t,n._cache=d.getCache("ProductCache"),n._initialized=!1,n._logger=u,n}r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},s=require("../IdToValueCache.js"),f=require("./DAOHelperMethods.js"),a=require("./BaseDAO.js").BaseDAO,l=require("./BaseDAO.js").BaseSubqueryDescriptor,u=require("js-logger").logger.getLogger("JSAR Perf"),d=require("../CacheManager.js").cacheManager,c=["Id","Description","BatchQuantity__c","PriceEditable__c","CostEditable__c","PricingMethodEditable__c","PricingMethod__c","NonDiscountable__c","NonPartnerDiscountable__c","CompoundDiscountRate__c","HasConfigurationAttributes__c","ReconfigurationDisabled__c","DescriptionLocked__c","ConfigurationType__c","ConfigurationEvent__c","QuantityEditable__c","QuantityScale__c","AssetAmendmentBehavior__c","Optional__c","Hidden__c","Taxable__c","SubscriptionPricing__c","SubscriptionPercent__c","SubscriptionTerm__c","SubscriptionBase__c","SubscriptionCategory__c","TaxCode__c","SubscriptionTarget__c","ExcludeFromOpportunity__c","SubscriptionType__c","DynamicPricingConstraint__c","BlockPricingField__c","IncludeInMaintenance__c","ExcludeFromMaintenance__c","CostSchedule__c","TermDiscountLevel__c"],p=["Id","Pricebook2Id","UnitPrice","IsActive"],v=["UnitCost__c","Active__c","Product__c"],g=["Id","UnitPrice__c"],y=["Id","Type__c","PriceBook__c","UnitPrice__c"],m=["Id","PriceBook2__c","LowerBound__c","UpperBound__c","Price__c"],"ProductCache",S(i,l),r(i,[{key:"includeJSARSubqueries",value:function(){this.includeJSQCSubqueries(),this._includeCosts=!0,this._includePriceEntries=!0,this._includeDimensions=!0,this._includeOptionsByOptionalSKU=!0}},{key:"includeJSQCSubqueries",value:function(){this._includeBlockPrices=!0}},{key:"addPricebookFilters",value:function(e){var t=this._filteredPricebooks||[];this._filteredPricebooks=t.concat(e)}},{key:"addCurrencyFilters",value:function(e){var t=this._filteredCurrencyCodes||[];this._filteredCurrencyCodes=t.concat(e)}},{key:"init",value:function(e){var t=this;if(this._initialized)return Promise.resolve();var i=[],n=this._salesCloudPrefix+"QuoteLine__c";if(this._includeOptionsByOptionalSKU){var o=this._salesCloudPrefix+"ProductOption__c";i.push(e.fieldMetadataService.getSharedMappableFieldNames(o,n).then(function(e){t._mappableOptionFields=e}))}return Promise.all(i).then(function(){t._initialized=!0})}},{key:"_addSubquery",value:function(e,t,i,n,o){e=e.include(t).select(i.join(", ")),o&&2===o.length&&(e=e.orderby(o[0],o[1])),n&&0<n.length&&(e=e.where(n.join(" AND "))),e=e.end()}},{key:"addSubqueriesToQuery",value:function(e){if(!this._initialized)throw new Error("Cannot call 'addSubqueriesToQuery()' on an uninitialized ProductSubqueryDescriptor.");var t=this._filteredPricebooks&&0<this._filteredPricebooks.length?"'"+this._filteredPricebooks.join("', '")+"'":null,i=this._filteredCurrencyCodes&&0<this._filteredCurrencyCodes.length?"'"+this._filteredCurrencyCodes.join("', '")+"'":null;if(this._includeCosts){var n=f.properlyPrefixFields(this._salesCloudPrefix,v);this._opts.isMultiCurrencyOrg&&n.push("CurrencyIsoCode"),this._addSubquery(e,this._salesCloudPrefix+"Costs__r",n)}if(this._includeOptionsByOptionalSKU){var o=f.properlyPrefixFields(this._salesCloudPrefix,g);o=o.concat(this._mappableOptionFields||[]);var r=[];this._opts.isMultiCurrencyOrg&&(o.push("CurrencyIsoCode"),i&&r.push("CurrencyIsoCode IN ("+i+")")),this._addSubquery(e,this._salesCloudPrefix+"OptionalFor__r",o,r)}if(this._includeDimensions){var s=f.properlyPrefixFields(this._salesCloudPrefix,y);this._opts.isMultiCurrencyOrg&&s.push("CurrencyIsoCode");var a=[];t&&a.push("("+this._salesCloudPrefix+"PriceBook__c IN ("+t+") OR "+this._salesCloudPrefix+"PriceBook__c = null)"),i&&this._opts.isMultiCurrencyOrg&&a.push("CurrencyIsoCode IN ("+i+")"),this._addSubquery(e,this._salesCloudPrefix+"Dimensions__r",s,a)}if(this._includePriceEntries){var l=f.properlyPrefixFields(this._salesCloudPrefix,p);this._opts.isMultiCurrencyOrg&&l.push("CurrencyIsoCode");var u=[];t&&u.push("Pricebook2Id IN ("+t+")"),i&&this._opts.isMultiCurrencyOrg&&u.push("CurrencyIsoCode IN ("+i+")"),this._opts.allowInactivePrices||u.push("IsActive = true"),this._addSubquery(e,"PricebookEntries",l,u)}if(this._includeBlockPrices){var d=f.properlyPrefixFields(this._salesCloudPrefix,m);this._opts.isMultiCurrencyOrg&&d.push("CurrencyIsoCode"),this._opts.overageRateFieldName&&d.push(this._opts.overageRateFieldName);var c=[];t&&c.push("("+this._salesCloudPrefix+"PriceBook2__c IN ("+t+") OR "+this._salesCloudPrefix+"PriceBook2__c = null)"),i&&this._opts.isMultiCurrencyOrg&&c.push("CurrencyIsoCode IN ("+i+")");var h=[this._salesCloudPrefix+"LowerBound__c","ASC"];this._addSubquery(e,this._salesCloudPrefix+"BlockPrices__r",d,c,h)}}},{key:"_getHashKey",value:function(){return"COSTS?"+(this._includeCosts?"YES":"NO")+"_DIMENSIONS?"+(this._includeDimensions?"YES":"NO")+"_PRICEENTRIES?"+(this._includePriceEntries?"YES":"NO")+"_BLOCKPRICES?"+(this._includeBlockPrices?"YES":"NO")+"__PRICEBOOKIDS:"+(this._filteredPricebooks&&0<this._filteredPricebooks.length?JSON.stringify(this._filteredPricebooks):"NONE")+"__CURRENCYCODES:"+(this._filteredCurrencyCodes&&0<this._filteredCurrencyCodes.length?JSON.stringify(this._filteredCurrencyCodes):"NONE")}}]),h=i,S(o,a),r(o,[{key:"_logMessage",value:function(e){this._logger.info(e)}},{key:"_init",value:function(){var t=this;if(this._initialized)return Promise.resolve();var e=this._prefix+"QuoteLine__c";this._logMessage("ProductDAO.js: Initialization. SessionId="+this._opts.userId);var i=Date.now();return this._services.fieldMetadataService.getSharedMappableFieldNames("Product2",e).then(function(e){t._logMessage("ProductDAO.js: Getting shared mappable fields names took "+(Date.now()-i)+" ms. SessionId="+t._opts.userId),t._mappableFields=e,t._initialized=!0})}},{key:"loadProductsByIds",value:function(e,t){var i=this,n=[];new Set(e).forEach(function(e){n.push(e)}),this._logMessage("ProductDAO.js: Initialization. SessionId="+this._opts.userId);var o=void 0,r=Date.now(),s=[];return s.push(this._init()),t&&s.push(t.init(this._services)),Promise.all(s).then(function(){return i._logMessage("ProductDAO.js: Initialization took "+(Date.now()-r)+" ms. SessionId="+i._opts.userId),i._logMessage("ProductDAO.js: Get products by Ids. SessionId="+i._opts.userId),o=Date.now(),i._getProductsByIds(n,t)}).then(function(e){return i._logMessage("ProductDAO.js: Getting products by ids took "+(Date.now()-o)+" ms. SessionId="+i._opts.userId),e}).catch(function(e){var t=i._opts.errorHeader;return Promise.reject(t+(e.message||e))})}},{key:"_getProductsByIds",value:function(e,t){var i=(t?t._getHashKey():"default")+"____"+JSON.stringify(this._opts.extraFields||[]),n=[],o=this._cache.get(i);return 0<(n=o?e.filter(function(e){return!o.has(e)}):(this._cache.set(i,new s),e)).length?this._queryAndCacheProducts(n,t,i):Promise.resolve(o)}},{key:"_queryAndCacheProducts",value:function(e,t,i){var n=this,o=f.properlyPrefixFields(this._prefix,c);this._opts.isMultiCurrencyOrg&&o.push("CurrencyIsoCode"),o=(o=o.concat(this._opts.extraFields||[])).concat(this._mappableFields);var r="Id IN ('"+e.join("', '")+"')";return this._constructAndPerformQuery("Product2",o,r,t).then(function(e){var t=n._cache.get(i);return e.forEach(function(e){t.set(e.Id,e)}),t})}}],[{key:"constructOptsFromJsarSettings",value:function(e){return{prefix:e.salesCloudPrefix,userId:e.userId,isMultiCurrencyOrg:e.isMultiCurrencyOrg,errorHeader:e.labels.msg_amendrenew_err_loading_products,labels:e.labels,allowInactivePrices:e.calcSettings.allowInactivePrices,overageRateFieldName:e.calcSettings.overageRateFieldName,extraFields:e.calcSettings.referencedFieldMap.Product2||[]}}},{key:"constructOptsFromJsqcSettings",value:function(e){return{prefix:e.devPrefix,userId:e.userId,isMultiCurrencyOrg:e.isMultiCurrencyOrg,errorHeader:e.getLabelByKey("msg_amendrenew_err_loading_products"),allowInactivePrices:e.allowInactivePrices,overageRateFieldName:e.overageRateFieldName,extraFields:e.referencedFieldMap.Product2||[],labels:e.jsqcLabels}}}]),b=o,module.exports.DAO=b,module.exports.SubqueryDescriptor=h}}}),System.register("Utils/DAOs/WhereClauseSplitter.js",[],function(e,t){var E,i,f,p,o;function I(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._overallSpecificityPreserved=!0,this._nextNodeKey=0,this._semiJoinRegex=/\s+IN\s+\(\s*SELECT\s+.*?FROM/gi,this._semiJoinMap=new Map,this._semiJoinCounter=0,this._semiJoinReplacementFormat="'____SEMI-JOIN_%____'",this._unescapedDateRegex=/\d{4}-\d{2}-\d{2}(?:(?:T\d{2}:\d{2}:\d{2})(?:Z|[\+\-]\d{2}:\d{2}))?/gi,this._unescapedDateMap=new Map,this._unescapedDateCounter=0,this._unescapedDateReplacementFormat="'____UNESCAPED_DATE_%____'",this._nestedLookupRegex=/\w+\.\w+\.\w+(?:\.\w+)*/gi,this._nestedLookupMap=new Map,this._nestedLookupCounter=0,this._nestedLookupReplacementFormat="'____NESTED_LOOKUP_%____'"}E=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},f=require("node-sqlparser").parse,p=require("node-sqlparser").stringify,i(e,[{key:"_resetModificationInformation",value:function(){this._overallSpecificityPreserved=!0,this._nextNodeKey=0,this._semiJoinMap=new Map,this._semiJoinCounter=0,this._unescapedDateMap=new Map,this._unescapedDateCounter=0,this._nestedLookupMap=new Map,this._nestedLookupCounter=0}},{key:"splitWhereClause",value:function(e,t){var i=this,n={clauses:[],specificityPreserved:!0};if(e.length<=t)return n.clauses.push(e),n;var o="SELECT * FROM SomeTable WHERE "+this._makeWhereClauseParsable(e),r=void 0;try{r=f(o)}catch(e){throw Error("Failed to parse WHERE clause: "+(e.message||e))}var s=r.where;this._recursivelySetLengthOnAstNodes(s);var a=!0;if(this._recursivelySetMinLengthOnAstNodes(s,a),s.minLength>t&&(a=!1,this._recursivelySetMinLengthOnAstNodes(s,a),s.minLength>t))throw Error("WHERE clause cannot be shrunk below maximum acceptable length of "+t+". WHERE CLAUSE: "+e);var l=this._recursivelySplitUntilTargetSizeReached(s,t,a),u=[],d=[],c=new Map;l.forEach(function(e){r.where=e;var t=p(r).slice(30);u.push(i._restoreUnparsableCharacters(t)),i._overallSpecificityPreserved||(d.push(e.splitNodeKeys),e.splitNodeKeys.forEach(function(e,t){(!c.has(e)||c.get(e)<t)&&c.set(e,t)}))});var h=new Map;return this._overallSpecificityPreserved||c.forEach(function(e,t){h.has(e)||h.set(e,new Set),h.get(e).add(t)}),n.clauses=u,n.specificityPreserved=this._overallSpecificityPreserved,n.splitKeyLists=d,n.splitKeysMappedByMaxDepth=h,n}},{key:"_makeWhereClauseParsable",value:function(e){return this._resetModificationInformation(),this._storeAndReplaceNestedLookups(this._storeAndReplaceUnescapedDates(this._storeAndReplaceSemiJoins(e)))}},{key:"_restoreUnparsableCharacters",value:function(e){var t=e,i=[this._unescapedDateMap,this._nestedLookupMap,this._semiJoinMap],n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=!0,d=!1,c=void 0;try{for(var h,f=l[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=E(h.value,2),v=p[0],g=p[1],y=new RegExp(v,"g");t=t.replace(y,g)}}catch(e){d=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw c}}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return t}},{key:"_storeAndReplaceSemiJoins",value:function(e){for(var t=new Map,i=void 0;null!==(i=this._semiJoinRegex.exec(e));)t.set(i.index,i);if(0===t.size)return e;for(var n=new Map,o=e[Symbol.iterator](),r=0,s=void 0,a=[],l=void 0,u=!1,d=void 0,c=void 0,h=0;!(s=o.next()).done;){if(t.has(r))u||0!==a.length||(u=!0,l=0),h++;else if(0<a.length&&s.value===a[0])a.shift();else if('"'===s.value||"'"===s.value)a.unshift(s.value);else if(0===a.length&&u)if("("===s.value)0==l++&&(c=r+1,d=-1);else if(")"===s.value&&0==--l&&(n.set(c,d),u=!1,h===t.size))break;u&&0<l&&d++,r++}if(0===n.size)return e;var f="",p=0,v=!0,g=!1,y=void 0;try{for(var m,b=n.entries()[Symbol.iterator]();!(v=(m=b.next()).done);v=!0){var _=E(m.value,2),C=_[0],S=_[1];f+=e.slice(p,C);var k=e.slice(C,C+S),O=this._semiJoinReplacementFormat.replace("%",++this._semiJoinCounter);f+=O,this._semiJoinMap.set(O,k),p=C+S}}catch(e){g=!0,y=e}finally{try{!v&&b.return&&b.return()}finally{if(g)throw y}}return f+=e.slice(p)}},{key:"_storeAndReplaceUnescapedDates",value:function(e){return this._storeAndReplaceUnparsableSubstrings(e,this._unescapedDateRegex,this._unescapedDateReplacementFormat,this._unescapedDateMap,this._unescapedDateCounter)}},{key:"_storeAndReplaceNestedLookups",value:function(e){return this._storeAndReplaceUnparsableSubstrings(e,this._nestedLookupRegex,this._nestedLookupReplacementFormat,this._nestedLookupMap,this._nestedLookupCounter)}},{key:"_storeAndReplaceUnparsableSubstrings",value:function(e,t,i,n,o){for(var r=new Map,s=void 0;null!==(s=t.exec(e));)r.set(s.index,s);if(0===r.size)return e;for(var a=e[Symbol.iterator](),l=0,u=[],d=0,c="",h=void 0,f=0;!(h=a.next()).done;){if(r.has(l)){if(0===u.length){var p=r.get(l)[0],v=i.replace("%",++o);n.set(v,p),c+=e.slice(d,l)+v,d=l+p.length}if(++f===r.size)break}else 0<u.length&&h.value===u[0]?u.shift():'"'!==h.value&&"'"!==h.value||u.unshift(h.value);l++}return c+=e.slice(d)}},{key:"_recursivelySetLengthOnAstNodes",value:function(e){var t=this,i=0;switch(e.nodeKey=this._nextNodeKey++,e.splitNodeKeys=[],e.type){case"binary_expr":var n=this._recursivelySetLengthOnAstNodes(e.left),o=this._recursivelySetLengthOnAstNodes(e.right),r=e.operator.length;i=n+o+r+2;break;case"expr_list":i=-2,e.value.forEach(function(e){t._recursivelySetLengthOnAstNodes(e),i+=e.length+2}),i+=2;break;case"column_ref":i=e.column.length,0<e.table.length&&(i+=e.table.length+1);break;case"string":var s="'"+e.value+"'";i=this._semiJoinMap.has(s)?this._semiJoinMap.get(s).length:this._unescapedDateMap.has(s)?this._unescapedDateMap.get(s).length:this._nestedLookupMap.has(s)?this._nestedLookupMap.get(s).length:e.value.length+2;break;case"number":i=e.value.toString().length;break;case"bool":i=e.value?4:5;break;case"null":i=4;break;default:throw Error("Unexpected node type "+e.type)}return!0===e.paren&&(i+=2),e.length=i}},{key:"_recursivelySetMinLengthOnAstNodes",value:function(e,t){var i=this,n=void 0;switch(e.type){case"expr_list":var o=e.value.map(function(e){return i._recursivelySetMinLengthOnAstNodes(e,t)+2});n=Math.max.apply(this,o);break;case"binary_expr":var r=!0;switch(e.operator){case"AND":if(t)break;case"OR":var s=this._recursivelySetMinLengthOnAstNodes(e.left,t),a=this._recursivelySetMinLengthOnAstNodes(e.right,t),l=Math.max(s,a);e.paren&&(l+=2),n=l,r=!1}if(!r)break;n=e.length-(e.left.length+e.right.length)+this._recursivelySetMinLengthOnAstNodes(e.left,t)+this._recursivelySetMinLengthOnAstNodes(e.right,t);break;default:n=e.length}return e.minLength=n}},{key:"_recursivelySplitUntilTargetSizeReached",value:function(n,t,e){if(n.length<=t)return[n];switch(n.type){case"expr_list":var i=[[]],o=-2,r=0;n.value.forEach(function(e){e.length+2+o>t?(i.push([e]),r++,o=e.length):(i[r].push(e),o+=e.length+2)});for(var s=[],a=0;a<i.length;a++){var l=JSON.parse(JSON.stringify(n));l.value=i[a],s.push(l)}return s;case"binary_expr":switch(n.operator){case"AND":if(e){var u=void 0,d=void 0,c=void 0,h=void 0,f=t>n.length-n.left.length+n.left.minLength,p=t>n.length-n.right.length+n.right.minLength;if(f)u=t-(n.length-n.left.length),c=this._recursivelySplitUntilTargetSizeReached(n.left,u,e),h=[n.right];else if(p)d=t-(n.length-n.right.length),c=[n.left],h=this._recursivelySplitUntilTargetSizeReached(n.right,d,e);else{var v=n.left.minLength<t/2;u=v?n.left.minLength:Math.max(n.left.minLength,t/2),d=v?Math.max(n.right.minLength,t/2):n.right.minLength,c=this._recursivelySplitUntilTargetSizeReached(n.left,u,e),h=this._recursivelySplitUntilTargetSizeReached(n.right,d,e)}var g=[];return c.forEach(function(i){h.forEach(function(e){var t=JSON.parse(JSON.stringify(n));t.left=i,t.right=e,g.push(t)})}),g}this._overallSpecificityPreserved=!1;case"OR":var y=n.paren?t-2:t,m=this._recursivelySplitUntilTargetSizeReached(n.left,y,e),b=this._recursivelySplitUntilTargetSizeReached(n.right,y,e),_=[].concat(I(m),I(b));return n.paren&&_.forEach(function(e){e.paren=!0}),e||_.forEach(function(e){e.splitNodeKeys.push(n.operator+"_"+n.nodeKey)}),_;case"IN":var C=n.length-n.right.length,S=this._recursivelySplitUntilTargetSizeReached(n.right,t-C,e),k=[],O=e?void 0:n.operator+"_"+n.nodeKey;return n.splitNodeKeys.push(O),S.forEach(function(e){var t=JSON.parse(JSON.stringify(n));t.right=e,k.push(t)}),k}default:return[n]}}}]),o=e,module.exports=o}}}),System.register("Utils/Services/FieldMetadataService.js",[],function(e,t){var i,r,s,a;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this._conn=e,this._salesCloudPrefix=t.salesCloudPrefix?t.salesCloudPrefix.toLowerCase():"",this._serviceCloudPrefix=t.serviceCloudPrefix?t.serviceCloudPrefix.toLowerCase():"",this._userId=t.userId,this._labels=t.labels;var i="undefined"!=typeof window;this._cache=i?r:new Map,this._logger=s}i=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},r=new Map,s=require("js-logger").logger.getLogger("JSAR Perf"),i(o,[{key:"_logMessage",value:function(e){this._logger.info(e)}},{key:"getSharedMappableFieldNames",value:function(e,t){var l=this,u=e+":"+t;if(this._cache.has(u))return Promise.resolve(this._cache.get(u));var i=this.getMappableFields(e),n=this.getMappableFields(t);this._logMessage("FieldMetadataService.js: Get mappable fields. SessionId="+this._userId);var d=Date.now();return Promise.all([i,n]).then(function(e){l._logMessage("FieldMetadataService.js: Getting mappable fields took "+(Date.now()-d)+" ms. SessionId="+l._userId);for(var t=[],i=e[0].fieldArray,n=e[1].fieldMap,o=i.length,r=0;r<o;r++){var s=i[r],a=n.get(s.name);a&&l._fieldsAreCompatible(s,a)&&t.push(a.name)}return l._cache.set(u,t),t},function(e){throw new Error(e)})}},{key:"getMappableFields",value:function(i){var n=this;return this._cache.has("mappableFields")&&this._cache.get("mappableFields")[i]?Promise.resolve(this._cache.get("mappableFields")[i]):(this._cache.has("mappableFields")||this._cache.set("mappableFields",{}),this._getObjectDescribe(i).then(function(e){var t=n._sweepDescribeForMappableFields(e);return n._cache.get("mappableFields")[i]=t},function(e){var t=n._labels.msg_could_not_retrieve_mappable_fields.replace("{0}",i);return Promise.reject(t+(e.message||e))}))}},{key:"checkExistenceOfFields",value:function(n,e){var r=this,s={};this._cache.has("fieldExistence")&&this._cache.get("fieldExistence")[n]?s=this._cache.get("fieldExistence")[n]:this._cache.has("fieldExistence")||this._cache.set("fieldExistence",{});var a={},l=[];return e.forEach(function(e){s[e]?a[e]=s[e]:void 0===s[e]&&l.push(e)}),0===l.length?Promise.resolve(a):this._getObjectDescribe(n).then(function(o){for(var e=o.fields.length,t=function(e){var t=o.fields[e],i=l.findIndex(function(e){return t.name.endsWith(e)});if(-1!==i){var n=l[i];s[n]=t.name,a[n]=t.name,l=l.filter(function(e,t){return t!==i})}},i=0;i<e;i++)t(i);return l.forEach(function(e){s[e]=!1}),r._cache.get("fieldExistence")[n]=s,a})}},{key:"getFieldDescribe",value:function(n,o){var r=this;return this._cache.has("fieldDescribe")&&this._cache.get("fieldDescribe")[n+o]?Promise.resolve(this._cache.get("fieldDescribe")[n+o]):(this._cache.has("fieldDescribe")||this._cache.set("fieldDescribe",{}),this._getObjectDescribe(n).then(function(e){var t=e.fields.find(function(e){return e.name===o});if(t)return r._cache.get("fieldDescribe")[n+o]=t;var i=r._labels.msg_no_such_field.replace("{0}",o).replace("{1}",n);return Promise.reject(i)},function(e){var t=r._labels.msg_could_not_retrieve_field_describe.replace("{0}",n).replace("{1}",o);return Promise.reject(t+(e.message||e))}))}},{key:"isObjectUpdateable",value:function(i){var n=this;if(this._cache.has("objectPermissions")||this._cache.set("objectPermissions",{}),this._cache.get("objectPermissions")[i]){if("undefined"!=this._cache.get("objectPermissions")[i].updateable)return Promise.resolve(this._cache.get("objectPermissions")[i].updateable)}else this._cache.get("objectPermissions")[i]={};return this._getObjectDescribe(i).then(function(e){return n._cache.get("objectPermissions")[i].updateable=e.updateable,e.updateable},function(e){var t=n._labels.msg_could_not_retrieve_crud.replace("{0}",i);return Promise.reject(t+(e.message||e))})}},{key:"_getObjectDescribe",value:function(t){var i=this;if(this._cache.has(t))return Promise.resolve(this._cache.get(t));var n=Date.now();return this._logMessage("FieldMetadataService.js: JSForce call for object describe on "+t+". SessionId="+this._userId),this._conn.sobject(t).describe().then(function(e){return i._logMessage("FieldMetadataService.js: JSForce call for object describe on "+t+" took "+(Date.now()-n)+" ms. SessionId="+i._userId),i._cache.set(t,e),e})}},{key:"_sweepDescribeForMappableFields",value:function(e){for(var t=e.fields,i=[],n=new Map,o=t.length,r=0;r<o;r++){var s=t[r];this._isFieldMappable(s)&&(i.push(s),n.set(s.name,s))}return{fieldArray:i,fieldMap:n}}},{key:"_isFieldMappable",value:function(e){if(!e.custom)return!1;var t=e.name.toLowerCase();return""!==this._salesCloudPrefix&&t.startsWith(this._salesCloudPrefix)?t.startsWith(this._salesCloudPrefix+"sbcustom"):""!==this._serviceCloudPrefix&&t.startsWith(this._serviceCloudPrefix)?t.startsWith(this._serviceCloudPrefix+"sbcustom"):""!==this._salesCloudPrefix||""!==this._serviceCloudPrefix||t.startsWith("sbcustom")}},{key:"_fieldsAreCompatible",value:function(e,t){return!!t.updateable&&e.type===t.type&&("reference"!==e.type.toLowerCase()||e.referenceTo[0]===t.referenceTo[0])}}]),a=o,module.exports=a}}}),System.register("Utils/Services/ServicesManager.js",[],function(e,t){var o,r,s;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.fieldMetadataService=new r(e,t)}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},r=require("./FieldMetadataService.js"),o(i,null,[{key:"constructFromJsarSettings",value:function(e,t){return new i(e,{salesCloudPrefix:t.salesCloudPrefix,serviceCloudPrefix:t.serviceCloudPrefix,userId:t.userId,labels:t.labels})}},{key:"constructFromJsqcSettings",value:function(e,t){return new i(e,{salesCloudPrefix:t.scSettings.salesCloudPrefix,serviceCloudPrefix:t.scSettings.serviceCloudPrefix,userId:t.userId,labels:t.jsqcLabels})}}]),s=i,module.exports=s}}}),System.register("common/behaviors/DeviceBehavior.js",["common/core/AppContext.js"],function(t,e){var i,o,r,s,a,l,u;return{setters:[function(e){i=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}l=a=void(s=r=0),!!(o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}),t("DeviceBehavior",(o(e,[{key:"ready",value:function(){var e=Polymer.dom(this.root).querySelectorAll("*[device]")||[],t=this.getDeviceClasses(),i=!0,n=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;this.toggleClass(a,!0,this);var l=!0,u=!1,d=void 0;try{for(var c,h=e[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var f=c.value;this.toggleClass(a,!0,f)}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this.deviceClasses=t.join(" ")}},{key:"getDeviceClasses",value:function(){return l||(i.hasInitialized()||i.init(window.sb.userSettings),l=i.isPhone?["--phone","--mobile"]:i.isTablet?["--tablet","--mobile"]:["--desktop"])}},{key:"startPerformanceCheck",value:function(){a=performance.now()}},{key:"stopPerformanceCheck",value:function(){var e=performance.now()-a;r+=e,s++,1<e?console.warn("total ("+r.toFixed(2)+"ms) | current ("+e.toFixed(2)+"ms) | totalComponents ("+s+") | component ("+this.tagName.toLowerCase()+")"):console.log("total ("+r.toFixed(2)+"ms) | current ("+e.toFixed(2)+"ms) | totalComponents ("+s+") | component ("+this.tagName.toLowerCase()+")")}}]),u=e)),t("DeviceBehavior",u),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.DeviceBehavior=u.prototype}}}),System.register("common/behaviors/EventBehavior.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("EventBehavior",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"attached",value:function(){if(!this._eventBehaviorInitialized&&this.events){for(var e in this._eventBehaviorListeners={},this.events){var t=this.events[e];if(t&&"function"==typeof t){var i=t.bind(this);this._eventBehaviorListeners[e]=i,window.addEventListener(e,i)}}this._eventBehaviorInitialized=!0}}},{key:"detached",value:function(){if(this._eventBehaviorListeners){for(var e in this._eventBehaviorListeners)window.removeEventListener(e,this._eventBehaviorListeners[e]);this._eventBehaviorInitialized=!1}}}]),i=e)),t("EventBehavior",i),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.EventBehavior=i.prototype}}}),System.register("common/behaviors/LookupBehavior.js",["common/core/AppContext.js"],function(t,e){var i;return{setters:[function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LookupBehavior",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"ready",value:function(){this.handleProductsLoadServerResponse(),this.handleHideSearchFilterIfNoSearchColumnsDisplayed(),this.bindFilterEnterCallBacks()}},{key:"handleHideSearchFilterIfNoSearchColumnsDisplayed",value:function(){this.addEventListener("no-displayed-filters",function(){this.removeFilter()}.bind(this))}}]),i=e)),t("LookupBehavior",i),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.LookupBehavior=i.prototype}}}),System.register("common/behaviors/SFInlineEditBehavior.js",["common/formatter/Formatter.js","common/forms/DateParser.js","common/forms/NumberParser.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/tables/SFAbstractTable.js","common/core/AppContext.js","common/Util.js","../../quotes/QuoteContext.js"],function(t,e){var o,r,s,a,l,u,d,i;return{setters:[function(e){o=e.Formatter},function(e){r=e.DateParser},function(e){s=e.NumberParser},function(e){a=e.TemplateGenerator},function(e){l=e.SFAbstractTable},function(e){u=e.AppContext},function(e){d=e.Util},function(e){e.QuoteContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFInlineEditBehavior",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"toggleInlineEdit",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(e&&e.classList.contains("editable")){var o=e.getAttribute("field"),r=this._getFieldMetadataForInlineEdit(o);"boolean"!==r.type&&"checkbox"!==r.type&&(t&&i&&"richtextarea"===r.extraTypeInfo||this.toggleInlineEditForDeviceDelegate(e,t,o,r,n))}}},{key:"setDiscardPendingEdit",value:function(e){this._discardPendingEdit=e}},{key:"commitPendingEdit",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=!1;if(this._pendingEdit&&!this._discardPendingEdit){var i=this._pendingEdit.field,n=this._pendingEdit.eventDetail,o=this._pendingEdit.eventType,r=this._getFieldMetadataForInlineEdit(i),s=this._parseFieldData(r,n.value);this.commitInlineEdit(i,s),r&&this.handleControllingPicklistAndFields(r,i,o,n),!(t=!0)===e&&this.fireCalculateImmediately(i)}return this._discardPendingEdit=!1,this._pendingEdit=null,t}},{key:"commitInlineEdit",value:function(e,t){this._getRecord()[e]=t}},{key:"_parseFieldData",value:function(e,t){if((""===t||null===t)&&"picklist"!==e.type&&"multipicklist"!==e.type)return null;switch(e.type){case"currency":case"double":case"percent":return(new s).parse(t,!1,e.scale);case"date":case"datetime":var i=(new r).parse(t);return null!==i?"date"===e.type?o.toApexDate(i):o.toApexDateTime(i):t;case"time":return u.i18n.parseTime(t);default:return t}}},{key:"_createWritableElement",value:function(e,t){var i=document.createElement("div");i.className="w";var n=t.getAttribute("index");return this._createEditField(i,n,e),t.appendChild(i),d.horizontalBound(i),i}},{key:"_createEditField",value:function(e,t,i){var n=this._getFieldMetadataForInlineEdit(i),o=this._getEditField(n,t),r={};o.attachTo(r);var s=this.hydrateTemplate(o.html,r);e.appendChild(s.root)}},{key:"_toggleDirtyClass",value:function(e,t,i){if(i){var n=this._getOriginalRecord();if(n)if(this.checkIsDirty(e,n,t)){if(!this._isEditable(t))return;i.classList.contains(a.classNames.DIRTY)||i.classList.add(a.classNames.DIRTY),this.isDirty=!0}else i.classList.remove(a.classNames.DIRTY)}}},{key:"_refreshDirtyIndicators",value:function(){var n=this;this.isDirty&&(Array.from(this.querySelectorAll("div.r")).forEach(function(e){e.classList.toggle("dirty",!1)}),this.isDirty=!1);var o=this._getOriginalRecord(),r=this._getRecord();r&&o&&Object.keys(r).forEach(function(e){var t=r[e];if(n.checkIsDirty(t,o,e)){if(!n._isEditable(e))return;var i=n.querySelector("div.td[field='"+e+"'] div.r");n._enableDirtyClass(i)}})}},{key:"_enableDirtyClass",value:function(e){e&&(e.classList.toggle("dirty",!0),this.isDirty=!0)}},{key:"_handleEditableCellsHover",value:function(e){var t=this;if(!this._pencilLoaded||e){var i=this.querySelectorAll(".container.editable");if(i&&0<i.length){var n=Array.from(i);n.forEach(function(e){if(!e.querySelector("span.pencil")){var t=document.createElement("span");if(t.classList.add(a.classNames.EDIT_ICON),e.classList.contains(a.classNames.RIGHT)||e.classList.contains(a.classNames.CENTER)){var i=e.querySelector("div.r");i.insertBefore(t,i.firstChild)}else e.querySelector("div.r").appendChild(t)}}),setTimeout(function(){t.fire("line-toggled",{index:t.dataIndex})})}this._pencilLoaded=!0}}},{key:"_resetPencilLoaded",value:function(){this._pencilLoaded&&(Array.from(this.querySelectorAll(".container.editable span.pencil")).forEach(function(e){e.parentNode.removeChild(e)}),this._pencilLoaded=!1)}},{key:"onChange",value:function(e){var t=l.findCell(e,this.getCellClass());if(t){var i=t.getAttribute("field"),n=this._getFieldMetadata(i);if(e.detail){this._pendingEdit={field:i,eventDetail:e.detail,eventType:e.type};var o=t.querySelector(".w");"richtextarea"===n.extraTypeInfo?(this.toggleInlineEdit(t,!1),t.removeChild(o),this._applyFocus(t,e)):u.isMobile&&Polymer.RenderStatus.afterNextRender(this,function(){this.commitPendingEdit(),o&&this._deviceDelegate&&this._deviceDelegate._updateEditableField&&this._deviceDelegate._updateEditableField(t,this,i,n,o)})}}}},{key:"toggleInlineEditForDeviceDelegate",value:function(e,t,i,n,o){}},{key:"handleControllingPicklistAndFields",value:function(e,t,i,n){}},{key:"fireCalculateImmediately",value:function(e){}},{key:"_getFieldMetadataForInlineEdit",value:function(e){throw new Error("Must implement method _getFieldMetadataForInlineEdit for SFInlineEditBehavior.")}},{key:"_getEditField",value:function(e,t){throw new Error("Must implement method _getEditField for SFInlineEditBehavior.")}},{key:"_getOriginalRecord",value:function(){throw new Error("Must implement method _getOriginalRecord for SFInlineEditBehavior.")}},{key:"_isEditable",value:function(e){throw new Error("Must implement method _isEditable for SFInlineEditBehavior.")}},{key:"_getRecord",value:function(){throw new Error("Must implement method _getRecord for SFInlineEditBehavior.")}},{key:"checkIsDirty",value:function(e,t,i){throw new Error("Must implement method checkIsDirty for SFInlineEditBehavior.")}},{key:"_formatNewValue",value:function(e,t){throw new Error("Must implement _formatNewValue for SFInlineEditBehavior")}}]),i=e)),t("SFInlineEditBehavior",i),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.SFInlineEditBehavior=i.prototype}}}),System.register("common/behaviors/SFTableRowBehavior.js",["quotes/layout/template-generator/TemplateGenerator.js","quotes/tables/SFAbstractTable.js","common/core/AppContext.js"],function(t,e){var l,u,i;return{setters:[function(e){l=e.TemplateGenerator},function(e){u=e.SFAbstractTable},function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFTableRowBehavior",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"getCellByIndex",value:function(e){var t=this.getContentNode().querySelector("div");if(t){var i=Array.from(t.children);if(i)return i[e=Math.min(Math.max(0,e),i.length-1)]}}},{key:"onHovered",value:function(e){this.toggleClass("show",!0,this.getContentNode()),this.hook_onHovered(e)}},{key:"onUnhovered",value:function(e){this.toggleClass("show",!1,this.getContentNode()),this.hook_onUnhovered(e)}},{key:"onTap",value:function(e){var t=!1,i=this.getTableComponent(e),n=u.findCell(e,this.getCellClass()),o=n&&n.classList.contains(l.classNames.EDITABLE),r=n&&n.classList.contains(l.classNames.BOOLEAN),s=n&&n.classList.contains(l.classNames.HAS_FOCUS),a=n&&n.classList.contains(l.classNames.EDIT_MODE);i&&!s&&(i.applyCellFocus(n),i.setEditOnFocus(!1)),o&&!a&&(s&&!r||function(e){var t=Polymer.dom(e).path;if(t&&0<t.length&&t[0].classList.contains(l.classNames.EDIT_ICON))return t[0]}(e))&&(this.toggleInlineEdit(n,!0),i&&i.setEditOnFocus(!0),t=!0),this.hook_onTap(e,t,o)}},{key:"getTableComponent",value:function(e){return Polymer.dom(e).path.find(function(e){var t=e&&e.tagName?e.tagName.toUpperCase():"";return"SF-STANDARD-TABLE"===t||"SF-SEGMENTED-TABLE"===t||"UBP-RATE-TABLE"===t})}},{key:"getContentNode",value:function(){return this.$$("#content")}},{key:"findElementForEvent",value:function(e,i){return Polymer.dom(e).path.find(function(e){var t=e.classList;return t&&t.contains(i)})}},{key:"getCellClass",value:function(){throw new Error("getCellClass must be implemented by row element")}},{key:"hook_onHovered",value:function(e){}},{key:"hook_onUnhovered",value:function(e){}},{key:"hook_onTap",value:function(e,t){}},{key:"toggleInlineEdit",value:function(e,t){}}]),i=e)),t("SFTableRowBehavior",i),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.SFTableRowBehavior=i.prototype}}}),System.register("common/behaviors/TemplatizationBehavior.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("TemplatizationBehavior",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"hydrateTemplate",value:function(e,t){var i=document.createElement("template");return i.innerHTML=this.isTemplatizeWithRootDivNode()?"<div>"+e+"</div>":e,this.templatize(i),this.stamp(t||{})}},{key:"hydrateTemplateFromNode",value:function(e,t){var i=document.createElement("template");return i.content.appendChild(e),this.templatize(i),this.stamp(t||{})}},{key:"_templateChanged",value:function(){this.templateInstance&&(this.getContentNode().innerHTML="",this.templateInstance=null),this._populateContent()}},{key:"_populateContent",value:function(){var t=this;(this.template||this.templateHTML)&&this.uiData&&(this.templateInstance?Object.keys(this.uiData).forEach(function(e){t.templateInstance[e]=t.uiData[e]}):(this.template?this.templateInstance=this.hydrateTemplateFromNode(this.template.cloneNode(!0),this.uiData):this.templateInstance=this.hydrateTemplate(this.templateHTML,this.uiData),this.getContentNode().appendChild(this.templateInstance.root)),this.postPopulateContent())}},{key:"getContentNode",value:function(){throw"getContentNode() must be implemented!"}},{key:"postPopulateContent",value:function(){}},{key:"isTemplatizeWithRootDivNode",value:function(){return!0}},{key:"_restampField",value:function(e,t){this.templateInstance&&(null!=this.secondaryTemplateInstance&&(this.secondaryTemplateInstance[e]=t),this.templateInstance[e]=t,this.uiData[e]=t)}}],[{key:"properties",get:function(){return{template:{type:Object,observer:"_templateChanged"},templateHTML:{type:String,observer:"_templateChanged"},templateInstance:{type:Object},uiData:{type:Object,observer:"_populateContent"}}}}]),i=e)),t("TemplatizationBehavior",i),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.TemplatizationBehavior=i.prototype}}}),System.register("common/core/AppContext.js",["labels_en.js"],function(e,t){var i,o,r,s,a,l,u,d;function c(){return u.labels||i}return{setters:[function(e){i=e.LABELS}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},{},r={},{},s={},a={},l={},(u=window&&window.sb||{}).ui=u.ui||{},u.common=u.common||{},u.common.core=u.common.core||{},window.sb=u,e("localizeContent",function(e,t){var i=c()[e]||e;return/{[0-9]}/.test(i)&&t&&0<t.length&&(i=function(e,t){for(var i=0,n=t.length;i<n;i++)e=e.replace(new RegExp("{["+i+"]}","g"),t[i]);return e}(i,t)),i}),e("AppContext",(o(t,[{key:"user",get:function(){return s}},{key:"labels",get:function(){return c()}},{key:"org",get:function(){return r}}],[{key:"init",value:function(e){return t.buildUserAndOrgFromSettings(e),t.device="desktop",navigator.userAgent.match(/Tablet|iPad|iPod/i)&&!navigator.userAgent.match(/Tablet PC/i)||navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/Mobi/i)?t.device="tablet":navigator.userAgent.match(/Mobi/i)&&(t.device="phone"),new Promise(function(i,e){System.import("common/core/sb-i18n/I18n.js").then(function(e){var t={labels:c(),user:s};e.I18n&&(l=new e.I18n(t)),i(t)})})}},{key:"hasInitialized",value:function(){return!0===t.userAndOrgSettingsSet}},{key:"buildUserAndOrgFromSettings",value:function(e){e&&(t.userAndOrgSettingsSet=!0,t.user={lang:e.language,locale:e.locale,id:e.userId,fullname:e.fullName,username:e.userName,device:e.device,inCommunity:e.inCommunity,hasQuoteEditPermission:e.hasQuoteEditPermission,oik:e.oik},t.org={prefix:void 0!==e.developerPrefix?e.developerPrefix:"",scPrefix:void 0!==e.scDeveloperPrefix?e.scDeveloperPrefix:"",isMultiCurrencyOrg:e.isMultiCurrencyOrg,isServiceCloudEnabled:e.isServiceCloudEnabled,calculateImmediately:e.calculateImmediately,defaultCurrency:e.defaultCurrency,currencySymbol:e.currencySymbol,currencyDecimalScale:e.currencyDecimalScale,quantityScale:e.quantityScale,isOAuth:e.isOAuth,orgUrl:e.orgUrl,orgInstanceUrl:e.orgInstanceUrl,siteUrl:e.siteUrl,additionalLookupSearchTypes:e.additionalLookupSearchTypes,maxLookupSearchFields:e.maxLookupSearchFields,isJSProductRulesEnabled:e.isJSProductRulesEnabled,hasQuoteSelectionProductRules:e.hasQuoteSelectionProductRules,isUI3Enabled:!0,isBundleCollapsible:e.isBundleCollapsible,defaultBundleSetting:e.defaultBundleSetting,apiVersion:52,isPricingGuidanceEnabled:e.isPricingGuidanceEnabled,isCompactModeEnabled:e.isCompactModeEnabled,isManualEditsForUBPEnabled:e.isManualEditsForUBPEnabled,isColumnResizingEnabled:e.isColumnResizingEnabled,viewEncryptedDataEnabled:e.viewEncryptedDataEnabled})}},{key:"isIE",value:function(){var e=window.navigator.userAgent;return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}},{key:"isChrome",value:function(){return 0<=window.navigator.userAgent.indexOf("Chrome")}},{key:"isFirefox",value:function(){return 0<=window.navigator.userAgent.indexOf("Firefox")}},{key:"isSafari",value:function(){var e=window.navigator.userAgent;return 0<=e.indexOf("Safari")&&e.indexOf("Chrome")<0}},{key:"isBundleCollapsible",value:function(e){return t.org.isBundleCollapsible&&!this.isMobile&&e.data.settings.bundleKeptTogether&&e.largeQuoteExperienceEnabled&&e.isProductHierarchyVisualized()}},{key:"properties",get:function(){return{app:{type:Object,value:function(){return{user:s,labels:c(),org:r,deviceContext:{isDesktop:t.isDesktop,isTablet:t.isTablet,isPhone:t.isPhone,isMobile:t.isPhone||t.isTablet}}}},i18n:{type:Object,value:function(){return l}}}}},{key:"user",get:function(){return s},set:function(e){s=e}},{key:"labels",get:function(){return c()}},{key:"org",get:function(){return r},set:function(e){r=e}},{key:"device",get:function(){return a},set:function(e){a=e}},{key:"isDesktop",get:function(){return s.device?"desktop"===s.device:"desktop"===a}},{key:"isTablet",get:function(){return s.device?"tablet"===s.device:"tablet"===a}},{key:"isPhone",get:function(){return s.device?"phone"===s.device:"phone"===a}},{key:"apiVersion",get:function(){return t.org.apiVersion},set:function(e){t.org.apiVersion=e}},{key:"apiVersionString",get:function(){return t.org.apiVersion+".0"}},{key:"i18n",get:function(){return l}},{key:"isMobile",get:function(){return t.properties.app.value().deviceContext.isMobile}},{key:"defaultBundleSetting",get:function(){return t.org.defaultBundleSetting}},{key:"isPricingGuidanceEnabled",get:function(){return t.org.isPricingGuidanceEnabled}},{key:"isCompactModeEnabled",get:function(){return t.org.isCompactModeEnabled}},{key:"isManualEditsForUBPEnabled",get:function(){return t.org.isManualEditsForUBPEnabled}},{key:"isColumnResizingEnabled",get:function(){return t.org.isColumnResizingEnabled}},{key:"viewEncryptedDataEnabled",get:function(){return t.org.viewEncryptedDataEnabled}}]),d=t)),e("AppContext",d),u.common.core.AppContext=d.prototype}}}),System.register("common/core/Events.js",[],function(e,t){var i;return{setters:[],execute:function(){e("Events",i=Object.freeze({AUTO_LAUNCH_POPUP:"sf-auto-launch-popup",BUILD_LAYOUT:"sf-build-layout",CLEAR_PRODUCT_FILTER:"sf-clear-product-filter",CLOSE_GROUP_PANEL:"sf-close-group-panel",CLOSE_LOOKUP_DIALOG:"sf-close-lookup-dialog",COL_WIDTHS_CHANGED:"sf-col-widths-changed",DELETE_GROUPS:"sf-delete-groups",DESELECT_CHECKBOX:"sf-deselect-checkbox",GROUP_ADDED:"sf-group-added",GROUP_DELETED:"sf-group-deleted",GROUP_PANEL_CREATED:"sf-group-panel-created",GROUP_PANEL_TOGGLED:"sf-group-panel-toggled",GROUP_TOGGLED:"sf-group-toggled",IRON_LIST_RESIZED:"sf-iron-list-resized",LINE_SPLICE_COMPLETE:"sf-line-splice-complete",NAVIGATION_CHANGED:"sf-navigation-changed",OPEN_LOOKUP_DIALOG:"sf-open-lookup-dialog",OPEN_RTE_DIALOG:"sf-open-rte-dialog",OPEN_SEARCH_BAR_DIALOG:"sf-open-search-bar-dialog",PAGE_RESIZED:"sf-page-resized",PANEL_CLOSED:"sf-panel-closed",QUOTE_SAVED:"sf-quote-saved",REFRESH_LINE_ACTIONS:"sf-refresh-line-actions",REFRESH_TABLE:"sf-refresh-table",RENDER_NEW_TAB:"sf-render-new-tab",RESET_ON_ACTION:"sf-reset-on-action",RESET_COL_SIZES:"sf-reset-col-sizes",ROWS_RENUMBERED:"sf-rows-renumbered",SCHEDULE_ACTION:"sf-schedule-action",SORT_LINES_REQUIRED:"sf-sort-lines-required",TOGGLE_OPTIONAL_CLICKED:"sf-toggle-optional-clicked",TOGGLE_PANEL_CLICKED:"sf-toggle-panel-clicked",UPDATE_IRON_LIST:"sf-update-iron-list",VIEWPORT_CHANGED:"sf-viewport-changed",UBP_ROW_REFRESH:"sf-ubp-row-refresh",TOGGLE_QUICKSAVE:"sf-toggle-quicksave",COL_SIZE_ERR:"sf-col-size-err",GENERIC_ERROR:"sf-generic-error",MDQ_LINE_DELETED:"sf-mdq-line-deleted"})),e("Events",i),e("fireEvent",function(e,t){e&&window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent(e,{detail:t}))})}}}),System.register("common/core/History.js",[],function(t,e){var i,d,o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}i=[""],d=[["product","lookup"]],t("History",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,null,[{key:"push",value:function(e,t){this._trackHistory(e,t)&&(i[0]=e)}},{key:"pop",value:function(){return i[0]}},{key:"popPath",value:function(){return this._parsePath(this.pop())}},{key:"resetHistory",value:function(){i=[""]}},{key:"_trackHistory",value:function(e,t){var i=this._parsePath(e),n=this._parsePath(t);if(i[0]!==n[0])return!0;var o=!0,r=!1,s=void 0;try{for(var a,l=d[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;if(i[0]===u[0]&&i[1]===u[1])return!0}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}return!1}},{key:"_parsePath",value:function(e){var t=0===e.indexOf("#/")?2:1;return(e=e.substring(t,e.length)).split("?")[0].split("/")}}]),o=e)),t("History",o)}}}),System.register("common/core/Navigator.js",["common/core/History.js","common/core/Events.js"],function(t,e){var s,o,r,i;return{setters:[function(e){s=e.History},function(e){o=e.Events,r=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Navigator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,null,[{key:"nav",value:function(e,t,i,n,o){var r=this._getLocation(t,i,e);s.push(window.location.hash,r),this._nav(o,r,e)}},{key:"back",value:function(e,t,i){var n=s.pop();n&&n!==window.location.hash||(n=this._getLocation(t,i)),this._nav(e,n)}},{key:"getPreviousRoute",value:function(){return s.popPath().join("/")}},{key:"_getLocation",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"#",n=t?t.length:0,o=e?Object.keys(e):[],r=o.length;if(t)for(var s=0;s<n;s++)null!=t[s]&&null!=t[s]&&""!=t[s]&&(i+="/"+encodeURIComponent(t[s]));for(var a=0;a<r;a++)i+=0==a?"?":"&",i+=encodeURIComponent(o[a])+"="+encodeURIComponent(e[o[a]]);return i}},{key:"_nav",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"#";r(o.NAVIGATION_CHANGED,{url:i,location:t}),window.location.hash=t}}]),i=e)),t("Navigator",i)}}}),System.register("common/core/Page.js",["common/core/sb-page-container/PageContainer.js","common/core/AppContext.js","common/core/Navigator.js"],function(t,e){var i,o,r,s,a,l;return{setters:[function(e){i=e.PageContainer},function(e){o=e.AppContext},function(e){r=e.Navigator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},(a=window&&window.sb||{}).ui=a.ui||{},a.common=a.common||{},a.common.core=a.common.core||{},window.sb=a,t("SIZE_S","S"),t("SIZE_S","S"),t("SIZE_M","M"),t("SIZE_M","M"),t("SIZE_L","L"),t("SIZE_L","L"),t("SIZE_XL","XL"),t("SIZE_XL","XL"),t("Page",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,o),s(e,[{key:"nav",value:function(e,t,i,n){r.nav(e,t,i,n,this)}}],[{key:"properties",get:function(){return Polymer.Base.extend({ctx:{type:Object,value:function(){return{}}},viewport:{type:Object,value:function(){return i.getViewport()}}},o.properties)}}]),l=e)),t("Page",l),a.common.core.Page=l.prototype}}}),System.register("common/formatter/Formatter.js",["common/forms/NumberFormatter.js","common/core/AppContext.js","quotes/QuoteContext.js","common/layout/sb-html/Html.js","quotes/layout/sb-le-table-cell/DiscountConverter.js","common/forms/sb-field/factory/EncryptedFieldFactory.js"],function(e,t){var l,u,d,c,h,f,p,i;return{setters:[function(e){l=e.NumberFormatter},function(e){u=e.AppContext},function(e){d=e.QuoteContext},function(e){c=e.Html},function(e){h=e.getUnitAndDisplayValue,f=e.updateUnitIfAmountInactive},function(e){p=e.formatEncryptedString}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a)}e("Formatter",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(a,null,[{key:"formatFieldData",value:function(e,t,i,n){if(!i)return t;var o=i.type,r=new l(!1,i,u.i18n,o);switch(d.isDiscountField(i.name)&&(o="discount"),d.isMarkupField(i.name)&&(o="markup"),i&&"richtextarea"===i.extraTypeInfo&&(o="richtextarea"),o){case"double":return r.format(t,!1);case"currency":case"percent":return r.format(t,!0);case"discount":case"markup":return this.formatDiscountField(e,r);case"date":case"datetime":return u.i18n.format(t,{date:!0});case"time":return u.i18n.formatTime(t);case"reference":return a.formatReferenceField(i,n)||t;case"richtextarea":case"url":var s=c.sanitizeHtmlText(t);return null===s?"":s;case"string":if(i.calculatedFormula&&c.containsMarkup(t))return c.sanitizeHtmlText(t);break;case"picklist":case"multipicklist":return this.formatPicklistData(i,t);case"encryptedstring":return p(t,i)}return t}},{key:"formatPicklistData",value:function(i,e){var n=this;if(i.picklistValues&&e){var o=[];return e.toString().split(";").forEach(function(e){var t=n.findPickListValue(i,e);t?o.push(t.label):o.push(e)}),o.join(";")}return e}},{key:"findPickListValue",value:function(e,t){var i=this,n=e.name;return this._pickListValuesMap||(this._pickListValuesMap={}),this._pickListValuesMap[n]||(this._pickListValuesMap[n]={},e.picklistValues.forEach(function(e){i._pickListValuesMap[n][e.value]=e})),this._pickListValuesMap[n][t]}},{key:"formatDiscountField",value:function(e,t){f(e,t.metadata.name);var i=h(e,t.metadata.name),n=i.displayValue,o=i.units,r=i.unit;if(null===n||isNaN(n))return"";var s=o.find(function(e){return e.value===r}),a=s?s.label:"";return t.format(n)+" "+a}},{key:"formatReferenceField",value:function(e,t){var i="";return t&&e.relationshipName&&t[e.relationshipName]&&(i=t[e.relationshipName].Name),i}},{key:"toApexDate",value:function(e){return e&&e instanceof Date?e.toISOString().replace(new RegExp("[Tt].*"),""):""}},{key:"toApexDateTime",value:function(e){if(e&&e instanceof Date){var t=e.toISOString();return t.slice(0,t.length-1)+"+0000"}return""}}]),i=a)),e("Formatter",i)}}}),System.register("common/forms/DateParser.js",["common/core/sb-i18n/I18n.js"],function(e,t){var r,i;return{setters:[function(e){r=e.I18n}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.stripTime=e;var t=(r.getLocaleData()?r.getLocaleData().date.formats.dateFormats.yMd:"M/D/YY").replace(new RegExp("[dD]+"),"D").replace(new RegExp("[mM]+"),"M").replace(new RegExp("[yY]+"),"Y");this.separator=t.match(new RegExp("[/.-]"))[0];var i=t.split(this.separator);this.dateIdx=i.indexOf("D"),this.monthIdx=i.indexOf("M"),this.yearIdx=i.indexOf("Y")}e("DateParser",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"parse",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._isValidYear;if("string"!=typeof e)return e;this.stripTime&&(e=e.split(" ")[0]);var i=!0,n=e.split(this.separator),o=n[this.dateIdx],r=n[this.monthIdx],s=n[this.yearIdx];if(s&&4==s.length&&r&&0<r.length&&r.length<=2&&o&&0<o.length&&o.length<=2){if(o=parseInt(o),r=parseInt(r),s=parseInt(s),n.length&&!isNaN(s)&&!isNaN(r)&&!isNaN(o)){if("function"==typeof t&&!t(s))return null;if(1<=r&&r<=12){var a=31;2==r?(a=28,s%4==0&&(s%100!=0?a=29:s%400==0&&(a=29))):4!=r&&6!=r&&9!=r&&11!=r||(a=30),1<=o&&o<=a&&(i=!1)}}return i?null:new Date(Date.UTC(s,r-1,o))}return null}},{key:"_isValidYear",value:function(e){return 1700<=e&&e<=4e3}}]),i=o)),e("DateParser",i)}}}),System.register("common/forms/DependentPicklistBuilder.js",[],function(e,t){var o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.controlledPicklist=e,this.controllingValue=t}e("DependentPicklistBuilder",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"build",value:function(){var e=this.controlledPicklist.picklistValues,t=[];return e.forEach(function(e){this._testBit(atob(e.validFor),this._getControllingValueIndex(this.controllingValue))&&t.push(e)}.bind(this)),t}},{key:"_getControllingValueIndex",value:function(e){if("boolean"===this.controlledPicklist.controllingField.type)return!0===e?1:0;for(var t=this.controlledPicklist.controllingField.picklistValues,i=0,n=t.length;i<n;i++)if(t[i].value==e)return i;return-1}},{key:"_testBit",value:function(e,t){var i=Math.floor(t/8),n=7-t%8;return(Math.pow(2,n)&e.charCodeAt(i))>>n==1}}]),o=i)),e("DependentPicklistBuilder",o)}}}),System.register("common/forms/Locale.js",["common/core/AppContext.js"],function(e,t){var i,o,r;return{setters:[function(e){i=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}e("Locale",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,null,[{key:"get",value:function(){return i.user&&i.user.locale||"en-US"}},{key:"isCommaDecimal",value:function(e){return-1!==r.indexOf(e||t.get())}}]),o=t)),e("Locale",o),e("COMMA_DECIMAL_LOCALES",r=["ar-DZ","bg-BG","ca-ES","hr-HR","cs-CZ","da-DK","nl-AW","nl-BE","nl-NL","nl-SR","en-ZA","et-EE","fi-FI","fr-BE","fr-CA","fr-KM","fr-FR","fr-GN","fr-HT","fr-LU","fr-MR","fr-MC","fr-CH","fr-WF","de-AT","de-DE","de-LU","el-GR","hu-HU","in-ID","it-IT","lv-LV","lt-LT","no-NO","pl-PL","pt-AO","pt-BR","pt-CV","pt-MZ","pt-PT","pt-ST","ro-MD","ro-RO","ru-RU","sr-BA","sr-RS","sr-CS","sk-SK","sl-SI","es-AR","es-BO","es-CL","es-CO","es-CR","es-EC","es-PY","es-ES","es-UY","es-VE","sv-SE","tr-TR","uk-UA","vi-VN"]),e("COMMA_DECIMAL_LOCALES",r)}}}),System.register("common/forms/NumberFormatter.js",["common/core/sb-page-container/PageContainer.js","common/core/AppContext.js","common/forms/Locale.js"],function(e,t){var s,a,o,i;return{setters:[function(e){s=e.PageContainer},function(e){a=e.AppContext},function(e){o=e.Locale}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.editable=e,this.metadata=t,this.i18n=i,this.type=n,this.viewport=o||s.getViewport(),this.appContext=a}e("NumberFormatter",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(r,[{key:"format",value:function(t,e){var i={};if(null!=this.metadata.scale&&0<=this.metadata.scale&&(i.minimumFractionDigits=this.metadata.scale,i.maximumFractionDigits=this.metadata.scale),e&&("currency"===this.type?this._setCurrencyFormatOptions(i):"percent"===this.type&&(this._setPercentFormatOptions(i),t=null!=t?t/100:null)),this.editable&&this.isMobile()&&!o.isCommaDecimal()&&(i.useGrouping=!1),this.isNil(t))return null;try{var n=this.i18n.format(t,i);if("NaN"===n)throw new Error(t+" is not a number");return n}catch(e){return t}}},{key:"isNil",value:function(e){return null==e||""===e||isNaN(e)}},{key:"isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"_setCurrencyFormatOptions",value:function(e){e.style="currency",this.appContext.org.isMultiCurrencyOrg?(e.currency=this.metadata&&this.metadata.CurrencyIsoCode?this.metadata.CurrencyIsoCode:this.appContext.org.defaultCurrency,e.currencyDisplay="code"):(e.currencyDisplay="symbol",this.appContext.org.currencySymbol?e.currency="XXX":e.currency=this.appContext.org.defaultCurrency)}},{key:"_setPercentFormatOptions",value:function(e){e.style="percent"}}]),i=r)),e("NumberFormatter",i)}}}),System.register("common/forms/NumberParser.js",["common/forms/Locale.js"],function(e,t){var i,o;return{setters:[function(e){i=e.Locale}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.locale=e||i.get(),this.isCommaDecimalLocale=i.isCommaDecimal(this.locale)}e("NumberParser",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"parse",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=arguments[2];if("string"!=typeof e)return this.applyScale(e,i);e=this.replaceMinusCharacterToHyphenMinus(e),e=this.removeUnusualSeparators(e),e=this.removeNonDecimalCommas(e),e=this.removeDecimalSepartors(e),e=this.replaceCommaDecimalWithPeriod(e);var n=parseFloat(e);return t?n==e?this.applyScale(n,i):NaN:this.applyScale(n,i)}},{key:"replaceMinusCharacterToHyphenMinus",value:function(e){return e.replace(new RegExp(/\u2212/,"u"),"-")}},{key:"removeUnusualSeparators",value:function(e){return e.replace(new RegExp("[\\s]+","g"),"").replace(new RegExp("'","g"),"").replace(new RegExp("â€™","g"),"")}},{key:"removeNonDecimalCommas",value:function(e){return this.isCommaDecimalLocale?e:e.replace(new RegExp(",","g"),"")}},{key:"removeDecimalSepartors",value:function(e){return this.isCommaDecimalLocale?e.replace(new RegExp("[.]","g"),""):e}},{key:"replaceCommaDecimalWithPeriod",value:function(e){return this.isCommaDecimalLocale?e.replace(new RegExp(",","g"),"."):e}},{key:"applyScale",value:function(e,t){return null==t||"number"!=typeof e?e:parseFloat(e.toFixed(t))}}]),o=t)),e("NumberParser",o)}}}),System.register("common/oauth/OAuth.js",["common/oauth/oauth.local.js"],function(e,t){var i,o,s,a,l,u,d,c,h;return{setters:[function(e){i=e.OAUTH_KEY,o=e.OAUTH_SECRET,s=e.PRIVATE_API_SECRET,a=e.OAUTH_PROXY_URL,l=e.OAUTH_LOGIN_URL}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),!c.clientId||!c.clientSecret)throw Error(this._getNoOAuthClientKeyMessage());var t=jsforce.browser.Client.prototype._storeTokens.bind(jsforce.browser);jsforce.browser.Client.prototype._storeTokens=function(e){t(e),localStorage.setItem(this._prefix+"_refresh_token",e.refresh_token)}.bind(jsforce.browser);var i=jsforce.browser.Client.prototype._removeTokens.bind(jsforce.browser);jsforce.browser.Client.prototype._removeTokens=function(){i(),localStorage.removeItem(this._prefix+"_refresh_token")}.bind(jsforce.browser);var n=jsforce.browser.Client.prototype._getTokens.bind(jsforce.browser);jsforce.browser.Client.prototype._getTokens=function(){var e=n();return e&&(e.refreshToken=localStorage.getItem(this._prefix+"_refresh_token")),e}.bind(jsforce.browser);var o=jsforce.browser.Client.prototype.isLoggedIn.bind(jsforce.browser);jsforce.browser.Client.prototype.isLoggedIn=function(){return!!o()&&this.connection.refreshToken}.bind(jsforce.browser),function(){localStorage.setItem(this._prefix+"_issued_at",(new Date).getTime()),document.cookie=this._prefix+"_loggedin=true;"}.bind(jsforce.browser)(),e&&jsforce.browser._storeTokens(e),jsforce.OAuth2.prototype.refreshToken=this._refresAccessToken,jsforce.browser.init(c)}u=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},d="http://localhost:"+location.port+"/common/oauth",c={clientId:i,clientSecret:o,redirectUri:d+"/callback",proxyUrl:a,loginUrl:l},e("OAuth",(u(r,[{key:"login",value:function(){jsforce.browser.login()}},{key:"getConnection",value:function(){return jsforce.browser.isLoggedIn()?new Promise(function(t){jsforce.browser.once("connect",function(e){e.oik=s,e.once("refresh",function(e){this.accessToken=e}.bind(this)),t(e)}.bind(this)),jsforce.browser.init(c)}.bind(this)):Promise.reject("Please login before establishing a connection at http://localhost:"+location.port+"/common/oauth")}},{key:"_getNoOAuthClientKeyMessage",value:function(){return'Need to add a \'.env.json\' file in the CPQ dir whose contents contains the Consumer Key and Consumer Secret of the Salesforce CPQ Connected App, and then execute a gulp compile.\n{"oauth_key": "<Consumer Key>, "oauth_secret": "<Consumer Secret>"}'}},{key:"_refresAccessToken",value:function(e,t){return this._transport.httpRequest({method:"POST",url:c.proxyUrl,body:"grant_type=refresh_token&refresh_token="+e+"&client_id="+this.clientId+"&client_secret="+this.clientSecret,headers:{"SalesforceProxy-Endpoint":this.tokenServiceUrl,"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){var t;try{t=JSON.parse(e.body)}catch(e){}if(400<=e.statusCode){t=t||{error:"ERROR_HTTP_"+e.statusCode,error_description:e.body};var i=new Error(t.error_description);throw i.name=t.error,i}return t}).thenCall(t)}},{key:"encodeTokenUrl",value:function(){var e=jsforce.browser._getTokens(),t=e.refreshToken,i=encodeURIComponent(e.instanceUrl),n=encodeURIComponent(e.userInfo.url);return d+"?rt="+t+"&org="+i+"&id="+n}},{key:"accessToken",set:function(e){localStorage.setItem(jsforce.browser._prefix+"_access_token",e)}},{key:"tokens",get:function(){return jsforce.browser._getTokens()},set:function(e){jsforce.browser._storeTokens(e)}}],[{key:"decodeTokenUrl",value:function(e){if(e){var t=r._getParameterByName("rt",e),i=r._getParameterByName("org",e),n=r._getParameterByName("id",e);return t&&i&&n?{refresh_token:t,instance_url:i,id:n,access_token:"xyz",issued_at:(new Date).getTime()}:void 0}}},{key:"_getParameterByName",value:function(e,t){e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}}]),h=r)),e("OAuth",h)}}}),System.register("common/oauth/oauth.local.js",[],function(e,t){return{setters:[],execute:function(){e("OAUTH_KEY","undefined"),e("OAUTH_KEY","undefined"),e("OAUTH_SECRET","undefined"),e("OAUTH_SECRET","undefined"),e("PRIVATE_API_SECRET",""),e("PRIVATE_API_SECRET",""),e("OAUTH_PROXY_URL","http://brick-dynos-proxy-na-dev.herokuapp.com/proxy/"),e("OAUTH_PROXY_URL","http://brick-dynos-proxy-na-dev.herokuapp.com/proxy/"),e("OAUTH_LOGIN_URL","https://test.salesforce.com"),e("OAUTH_LOGIN_URL","https://test.salesforce.com")}}}),System.register("common/relationship/RelationshipFieldManager.js",["common/forms/sb-lookup/map/LookupNameMapper.js"],function(e,t){var a,i;return{setters:[function(e){a=e.LookupNameMapper}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this._validateConstructorInputs(i,n),this.field=e,this.record=t,this.getValueCallback=i,this.setValueCallback=n}e("RelationshipFieldManager",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(s,[{key:"hasRelationship",value:function(){return!!this.getRelationship()}},{key:"getRelationship",value:function(){var e=s.getRelationshipField(this.field);if(e)return null!=this.getValueCallback?this.getValueCallback(e):this.record[e]}},{key:"getRelationshipName",value:function(e){var t=this.getRelationship();if(t)return t[e||this._getLookupName(t)]}},{key:"addRelationshipName",value:function(e,t,i){var n=this.buildRelationship(e,t,i);if(n.value.Id||(n.value=null),n)return null!=this.setValueCallback?this.setValueCallback(n.field,n.value):void(this.record[n.field]=n.value)}},{key:"buildRelationship",value:function(e,t,i){var n=s.getRelationshipField(this.field);if(n){var o=this.getRelationship()||{},r=new a(i).getNameField();return o.Id=e,o[r]=t,{value:o,field:n}}}},{key:"_getLookupName",value:function(e){var t=e.attributes?e.attributes.type:"";return new a(t).getNameField()}},{key:"_validateConstructorInputs",value:function(e,t){if(null!=e&&"function"!=typeof e)throw new TypeError("callbacks required when record is null");if(null!=t&&"function"!=typeof t)throw new TypeError("callbacks required when record is null")}}],[{key:"getRelationshipField",value:function(e,t){var i=void 0;return e.endsWith("__c")?i=e.replace(/__c$/,"__r"):e.endsWith("Id")&&(i=e.substring(0,e.length-2)),i&&t?i+"."+new a(t).getNameField():i}}]),i=s)),e("RelationshipFieldManager",i)}}}),System.register("common/rules/QuoteRuleExecutor.js",["common/rules/RuleExecutor.js","common/rules/RuleEvaluator.js"],function(e,t){var i,f,o,s,a;return{setters:[function(e){i=e.RuleExecutor},function(e){f=e.RuleEvaluator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,i,n));return o._init(e),o}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},s=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(n):void 0},e("QuoteRuleExecutor",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,i),o(r,[{key:"_init",value:function(e){this.quote=e,this.response={requiredProductIds:[]};var t=!0,i=!(this.lineItemsById={}),n=void 0;try{for(var o,r=(this.quote.lineItems||[])[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.lineItemsById[s.record[this.PRODUCT]]=s}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"execute",value:function(){var e=new f(this.rules,this.quote,this.prefix,this.errorStrings),t=!0,i=!1,n=void 0;try{for(var o,r=(this.rules||[])[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;if(e.isRuleSatisfied(s)){var a=!0,l=!1,u=void 0;try{for(var d,c=s[this.ACTIONS].records[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value;this._conditionallyAddToResponseObject(h)}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return this.response}},{key:"_conditionallyAddToResponseObject",value:function(e){var t=s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_getResponseType",this).call(this,e[this.TYPE]);null!==t&&("requiredProductIds"===t&&this._productAdded(e[this.PRODUCT])||this.response[t].push(e[this.PRODUCT]))}},{key:"_productAdded",value:function(e){return!!this.lineItemsById[e]}}]),a=r)),e("QuoteRuleExecutor",a)}}}),System.register("common/rules/RuleEvaluator.js",["common/rules/operators/OperatorsUtils.js"],function(e,t){var r,i;return{setters:[function(e){r=e.OperatorsUtils}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.rules=e,this.quote=t,this.prefix=void 0===i?"":i,this.errorStrings=n,this._init()}e("RuleEvaluator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"_init",value:function(){this._setConstants(),this._setAliasedFieldsMap()}},{key:"_setConstants",value:function(){this.ERROR_CONDITIONS=this.prefix+"ErrorConditions__r",this.TESTED_VARIABLE=this.prefix+"TestedVariable__c",this.CONDITIONS_MET=this.prefix+"ConditionsMet__c",this.TESTED_OBJECT=this.prefix+"TestedObject__c",this.TESTED_FIELD=this.prefix+"TestedField__c",this.FILTER_VALUE=this.prefix+"FilterValue__c",this.FILTER_TYPE=this.prefix+"FilterType__c",this.OPERATOR=this.prefix+"Operator__c",this.ACTIONS=this.prefix+"Actions__r"}},{key:"_setAliasedFieldsMap",value:function(){this.aliasedFieldsMap={Quote:{"Group Line Items":this.prefix+"LineItemsGrouped__c"}}}},{key:"isRuleSatisfied",value:function(e){if(!this._hasActions(e))return!1;if(!this._hasErrorConditions(e))return!0;var t=e[this.CONDITIONS_MET],i=!1,n=!0,o=!1,r=void 0;try{for(var s,a=(e[this.ERROR_CONDITIONS].records||[])[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=l[this.TESTED_VARIABLE],d=l[this.TESTED_OBJECT],c=this.packageConditionDetails(l);if("Quote"===d?i=this.evaluateCondition(l,this.quote.record,c):"Quote Line"===d&&0<this.quote.lineItems.length?i=this.evaluateCollection(l,this.quote.lineItems,c):"Quote Line Group"===d&&0<this.quote.lineItemGroups.length?i=this.evaluateCollection(l,this.quote.lineItemGroups,c):u?this._throwError(this.errorStrings.msg_jspr_err_summary_variable_used.replace("{0}",l.Id)):this._throwError(this.errorStrings.msg_jspr_err_no_tested_object.replace("{0}",l.Id)),this._canReturnImmediately(i,t))return i}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}},{key:"packageConditionDetails",value:function(e){var t=new r(e[this.OPERATOR]).getInstance();if(null===t){var i=this.errorStrings.msg_jspr_err_invalid_operator.replace("{0}",e[this.OPERATOR]).replace("{1}",e.Id);this._throwError(i)}return"Variable"===e[this.FILTER_TYPE]&&this._throwError(this.errorStrings.msg_jspr_err_summary_variable_used.replace("{0}",e.Id)),{op:t,filterValue:e[this.FILTER_VALUE]}}},{key:"evaluateCollection",value:function(e,t,i){for(var n=0,o=t.length,r=!1;n<o&&!r;)r=this.evaluateCondition(e,t[n++].record,i);return r}},{key:"evaluateCondition",value:function(e,t,i){var n=this._getValue(e,t);return i.op.evaluate(n,i.filterValue)}},{key:"_getValue",value:function(e,t){var i=e[this.TESTED_OBJECT],n=e[this.TESTED_FIELD],o=this.aliasedFieldsMap[i]&&this.aliasedFieldsMap[i][n]?this.aliasedFieldsMap[i][n]:null,r=null===o?n:o;if(Object.keys(t).indexOf(r)<0){var s=this.errorStrings.msg_jspr_err_no_tested_field.replace("{0}",e.Id).replace("{1}",e[this.TESTED_FIELD]).replace("{2}",i);this._throwError(s)}return t[r]}},{key:"_throwError",value:function(e){throw{msg:e,type:"info"}}},{key:"_canReturnImmediately",value:function(e,t){return!("All"!=t||e)||!("Any"!=t||!e)}},{key:"_hasErrorConditions",value:function(e){return!!e[this.ERROR_CONDITIONS]}},{key:"_hasActions",value:function(e){return!!e[this.ACTIONS]&&0<e[this.ACTIONS].totalSize}}]),i=o)),e("RuleEvaluator",i)}}}),System.register("common/rules/RuleExecutor.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.rules=e,this.prefix=void 0===t?"":t,this.errorStrings=i,this._setConstants()}e("RuleExecutor",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"_setConstants",value:function(){this.ACTIONS=this.prefix+"Actions__r",this.TYPE=this.prefix+"Type__c",this.PRODUCT=this.prefix+"Product__c"}},{key:"_getResponseType",value:function(e){return"Add"===e||"Enable & Add"===e||"Show & Add"===e?"requiredProductIds":null}}]),i=o)),e("RuleExecutor",i)}}}),System.register("common/signal/AbstractFocusSignaler.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.element=e,this.focusEvents=t,this.blurEvents=i}e("AbstractFocusSignaler",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"signalOnFocus",value:function(e,t){this.fireFocusSignal=this.fireFocusSignal||this._fireSignal.bind(this,e,!0),this.fireBlurSignal=this.fireBlurSignal||this._fireSignal.bind(this,e,!1);var i=!0,n=!1,o=void 0;try{for(var r,s=this.focusEvents[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;this.element.removeEventListener(a,this.fireFocusSignal),t||this.element.addEventListener(a,this.fireFocusSignal)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}var l=!0,u=!1,d=void 0;try{for(var c,h=this.blurEvents[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var f=c.value;this.element.removeEventListener(f,this.fireBlurSignal),t||this.element.addEventListener(f,this.fireBlurSignal)}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}}},{key:"fireSignal",value:function(e,t){this._fireSignals(e,t);var i=this._getLastSignaler();i!==this&&(i&&i._fireSignals(e,!1),this._setLastSignaler())}},{key:"getSignalTargets",value:function(){return[]}},{key:"disable",value:function(){this._toggleDisabled(!0)}},{key:"enable",value:function(){this._toggleDisabled(!1)}},{key:"_fireSignal",value:function(e,t){this._isDisabled()||this.fireSignal(e,t)}},{key:"_fireSignals",value:function(e,t){var i=this.getSignalTargets(),n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)s.value.fire(e,{focused:t,signaler:this})}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}},{key:"_getLastSignaler",value:function(){return window&&window.signaler?window.signaler.last:null}},{key:"_isDisabled",value:function(){return window&&window.signaler&&window.signaler.disabled}},{key:"_setLastSignaler",value:function(){var e=window.signaler||{};e.last=this,window.signaler=e}},{key:"_toggleDisabled",value:function(e){var t=window.signaler||{};t.disabled=e,window.signaler=t}}]),i=o)),e("AbstractFocusSignaler",i)}}}),System.register("common/signal/RowFocusSignaler.js",["common/signal/AbstractFocusSignaler.js","common/layout/tables/RowFieldSelector.js"],function(e,t){var i,r,o,s;return{setters:[function(e){i=e.AbstractFocusSignaler},function(e){r=e.RowFieldSelector}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,i,n,o,r,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,e,["tap","mouseenter"],["mouseleave"]));return a.groupId=t,a.cellName=i,a.rowId=n,a.rowIndex=o,a.rowIndexAttribute=r,a.ironList=s,a}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},e("RowFocusSignaler",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,i),o(l,[{key:"getSignalTargets",value:function(){var e=this.groupId.constructor===Array?this.groupId:[this.groupId],t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=this.element.$$("#"+a);if(l){var u=Polymer.dom(l.root).querySelectorAll(this.cellName),d=!0,c=!1,h=void 0;try{for(var f,p=u[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var v=f.value;t.push(v.$$("sb-field"))}}catch(e){c=!0,h=e}finally{try{!d&&p.return&&p.return()}finally{if(c)throw h}}}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"signalNextPreviousEditableTarget",value:function(e,t){var i=this.selector,n=t?i.selectNextEditableField(e):i.selectPreviousEditableField(e);n&&n.fire("sb-field-edit",{next:t})}},{key:"signalFirstLastEditableTarget",value:function(e){var t=this.selector,i=e?t.selectFirstEditableField():t.selectLastEditableField();i&&i.fire("sb-field-edit",{next:e})}},{key:"toggleRowFocus",value:function(e){e.detail.focused&&!this.element.focused?(this.element.focused=!0,this.rowId&&this.element.toggleClass("focused",!0,this.element.$$("#"+this.rowId))):!e.detail.focused&&this.element.focused&&(this.element.focused=!1,this.rowId&&this.element.toggleClass("focused",!1,this.element.$$("#"+this.rowId)))}},{key:"selector",get:function(){return new r(this.element,this.getSignalTargets(),this.rowIndex,this.rowIndexAttribute)}}],[{key:"signalFirstEditableTargetFirstRow",value:function(e,t,i){var n=r.selectFirstEditableFieldInFirstRow(e,t,i);n&&n.fire("sb-field-edit",{next:!0})}},{key:"signalLastEditableTargetLastRow",value:function(e,t,i,n){var o=r.selectLastEditableFieldInLastRow(e,t,i,n);o&&o.fire("sb-field-edit",{next:!1})}}]),s=l)),e("RowFocusSignaler",s)}}}),System.register("docgen/sb-docgen-preview/DocgenPreview.js",["../../common/core/Page.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.Page}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},r=[{name:"t1",title:"My Favorite Template"},{name:"t2",title:"Okay Template"},{name:"t3",title:"Super Template"},{name:"t4",title:"Nasty Template"},{name:"t5",title:"Don't Go Here"}],t("DocgenPreview",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),o(e,[{key:"beforeRegister",value:function(){this.is="sb-docgen-preview",this.properties=Polymer.Base.extend({obj:{type:Object,value:function(){return{}}},templates:{type:Array,value:function(){return r}}},i.properties)}},{key:"cancel",value:function(){this.nav("/entities/quote/detail?id="+this.ctx.params.id)}},{key:"preview",value:function(){this.nav("/docgen/preview?id="+this.ctx.params.id)}},{key:"behaviors",get:function(){return[sb.common.core.Page]}}]),s=e)),t("DocgenPreview",s),Polymer(s)}}}),System.register("favorites/sb-favorite-lookup/FavoriteLookup.js",["common/Util.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js","common/core/Navigator.js","common/core/Page.js","common/data/format/DataBuilder.js","common/data/format/ErrorFormatter.js","quotes/models/Constants.js"],function(t,e){var o,r,s,i,a,l,u,d,c;return{setters:[function(e){o=e.clearReferencesToIds},function(e){r=e.QuoteLineAggregator},function(e){s=e.Navigator},function(e){i=e.Page},function(e){a=e.DataBuilder},function(e){l=e.formatError},function(e){u=e.Constants}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}d=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("FavoriteLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),d(e,[{key:"beforeRegister",value:function(){this.is="sb-favorite-lookup",this.properties=Polymer.Base.extend({lineEditorModel:Object,favoriteModel:Object,selectedFavorites:{type:Object,value:{}},actions:{type:Array,value:[]},errors:{type:Array,value:[],notify:!0},error:{type:Array,value:[]},qId:String,aId:String,groupKey:Number,isMobile:Boolean},i.properties)}},{key:"ready",value:function(){this.qId=this.qId||this.ctx.params.qId,this.aId=this.aId||this.ctx.params.aId,this.groupKey=parseInt(this.groupKey||this.ctx.params.groupKey)||null,this.isMobile=this._isMobileViewport(),this.$.le.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value}.bind(this)),this.$.md.addEventListener("md-changed",function(e){this._setMetaData(e.detail.value.fields)}.bind(this)),this.$.fm.addEventListener("response-changed",function(){this._setSelected()}.bind(this)),this.$.addFavorite.addEventListener("response-changed",function(e){var t=e.detail.value;if(t.partialVO&&(t=this._recombinePartialQuoteWithFullQuote(t)),this.lineEditorModel.quote=t,this._toggleSelected(),!this.addMore){var i={qId:this.qId};0<Object.keys(this.selectedFavorites).length&&(i.jspr=!0),null!=this.ctx.params.groupKey&&(i.groupKey=this.ctx.params.groupKey),s.nav("#",i,["quote","le"],!1,this)}this.$.header.selected=!1,this.addMore=!1}.bind(this)),this.addEventListener("favorite-shared",function(e){this.$.shareFavorites.addEventListener("response-changed",function(){this._toggleSelected()}.bind(this));var t=(new a).add("favIds",Object.keys(this.selectedFavorites)).add("groupIds",e.detail.groups).add("userIds",e.detail.users).build();this.$.shareFavorites.model=t}.bind(this)),this._handleOneFavoriteSelected(),this._handleAllFavoritesSelected()}},{key:"_recombinePartialQuoteWithFullQuote",value:function(e){var t=this.le.quote.lineItems;return e.lineItems=t.concat(e.lineItems),delete e.segmentTemplatesByDimensionTypeByGroupKey,delete e.emptyGroupKeys,e.partialVO=!1,e}},{key:"_setMetaData",value:function(e){this.cols=e.map(function(e){return e.name});var t={},i={},n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;t[l.name]={type:l.type},i[l.name]=l.label}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}this.model=t;var u=this.lineEditorModel.developerPrefix+"Description__c";this.primaryMobileCols=["Name",u],this.colsDisplay=i,this.fieldLabels=e.map(function(e){return e.label})}},{key:"_setSelected",value:function(){this.favoriteModel.favorites.forEach(function(e){e.selected=!1})}},{key:"_handleOneFavoriteSelected",value:function(){this.addEventListener("selection-changed",function(e){var t=e.detail,i=t.selected,n=t.Id;i?this.selectedFavorites[n]=t:delete this.selectedFavorites[n]}.bind(this))}},{key:"_handleAllFavoritesSelected",value:function(){this.addEventListener("header-selection-changed",function(e){e.detail.selected?(this._toggleSelected(!0),this.favoriteModel.favorites.forEach(function(e){this.selectedFavorites[e.record.Id]=e.record}.bind(this))):(this._toggleSelected(!1),this.selectedFavorites={})}.bind(this))}},{key:"_toggleSelected",value:function(e){var t=e||!1;this.$.header.selected=t;var i=Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row");if(i&&0<i.length){var n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)s.value.selected=t}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"_removeSelections",value:function(){this.selectedFavorites={},this._setSelected()}},{key:"_isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"onDeleteFavorite",value:function(){var t=this,i=Object.keys(this.selectedFavorites),e=(new a).add("quoteFavIds",this.le.quote.favoriteIds||[]).add("favIdsToRemove",i).build();this.$.deleteFavorite.save({model:e}).then(function(){var e=new u(t.le.developerPrefix).FAVORITE_ID_FIELD;o(i,e,t.le.quote.lineItems)})}},{key:"toggleAddProducts",value:function(){this._toggleSelected();var e={qId:this.qId};null!=this.groupKey&&(e.groupKey=this.groupKey),this.aId&&(e.aId=this.aId),s.nav("#",e,["product","lookup"],!1,this)}},{key:"onShareFavorite",value:function(){0!==Object.keys(this.selectedFavorites).length?this.$.shareFavorite.$.dialog.toggle():this.error=["Please select at least one favorite to share."]}},{key:"onSelect",value:function(){var e=this.le.settings.largeQuoteThreshold,t=this.le.customLabels.msg_large_quote_sent_without_lines,i=this.le.quote;e&&i.lineItems.length>e&&(i=this._minimizeQuoteVO(i),console.log(t.replace("{0}",i.record.Id).replace("{1}",e)));var n=(new a).addQuote("quote",i).add("groupKey",this.groupKey).add("favIds",Object.keys(this.selectedFavorites)).build();this.$.addFavorite.model=n}},{key:"_minimizeQuoteVO",value:function(e){var t=JSON.parse(JSON.stringify(e)),i=new r(e),n=i.getSegmentTemplatesByDimensionTypeForGroupKey(this.groupKey);return t.segmentTemplatesByDimensionTypeByGroupKey={},t.segmentTemplatesByDimensionTypeByGroupKey[(this.groupKey||-1)+""]=n,t.emptyGroupKeys=i.getKeysOfEmptyGroups(),t.lineItems=[],t.partialVO=!0,t}},{key:"onSelectMore",value:function(){this.addMore=!0,this.onSelect()}},{key:"onCancel",value:function(){var e={qId:this.qId};null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),s.nav("#",e,["quote","le"],!1,this)}},{key:"clearStackTrace",value:function(){this.errors.validations&&0<this.errors.validations.length?this.error=this.errors.validations:this.errors[0]&&(this.error=l(this.errors))}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}}]),c=e)),t("FavoriteLookup",c),Polymer(c)}}}),System.register("favorites/sb-favorite-share-dialog/FavoriteShareDialog.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FavoriteShareDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-favorite-share-dialog",this.properties={favdUsers:{type:Array,value:[]},favdGroups:{type:Array,value:[]},favoriteCallback:{type:Function,value:function(){return this._favoriteCallbackFunction.bind(this)}},iconMap:{type:Object,value:{User:"sf-icon-user",Group:"sf-icon-groups"}},viewport:{type:Object,value:function(){return i.getViewport()}}}}},{key:"ready",value:function(){this.addEventListener("sb-cancel-share-fav",this.onCancel),this.viewport&&this.viewport.isMobile()&&this.toggleClass("mobile",!0,this.$.dialog)}},{key:"_favoriteCallbackFunction",value:function(e){return new Promise(function(i,t){null==e||e.length<2?this.viewport.isMobile()?this.$.multilookup.updateTable([]):i([]):(this.$.service.uid="",this.$.service.context=e,this.$.multilookup.menuItemLabels=["label"],this.$.service.addEventListener("response-changed",function(e){var t=this._parseResults(e.detail.value);this.viewport.isMobile()?this.$.multilookup.updateTable(t):i(t)}.bind(this)),this.$.service.addEventListener("error-changed",function(e){t(e.detail.value)}.bind(this)))}.bind(this))}},{key:"_parseResults",value:function(e){for(var t=e.groups,i=t.length,n=e.users,o=n.length,r=0;r<i;r++)t[r].type="Group",t[r].label="Group - "+t[r].Name;for(var s=0;s<o;s++)n[s].type="User",n[s].label="User - "+n[s].Name;return n.concat(t)}},{key:"onShare",value:function(){for(var t=this.$.multilookup.selectedIdsByItems,e=Object.keys(t).map(function(e){return t[e]}),i=e.length,n=0;n<i;n++){var o="Group"===e[n].type?"favdGroups":"favdUsers";this.push(o,e[n].Id)}this.fire("favorite-shared",{groups:this.favdGroups,users:this.favdUsers}),this.$.dialog.toggle(),this._clearFavdLists()}},{key:"onCancel",value:function(){this.$.dialog.toggle()}},{key:"_clearFavdLists",value:function(){this.set("favdUsers",[]),this.set("favdGroups",[]),this.$.multilookup.clear()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),o=e)),t("FavoriteShareDialog",o),Polymer(o)}}}),System.register("products/localization/LocalizeFields.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.prefix=e}e("LocalizeFields",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"localizeSearchModel",value:function(e){var t=e.localizationByFieldByProductId;if(!t)return e;var i=!0,n=!1,o=void 0;try{for(var r,s=e.results[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=t[a.record.Product2Id];if(l)for(var u in l){var d=this.getLocalizedValue(l[u].record);d&&(a.record.Product2[u]=d)}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return e}},{key:"localizeProduct",value:function(e){if(!e.localizationByFieldByProductId)return e;var t=e.localizationByFieldByProductId[e.record.Id];if(t&&t.Name){var i=this.getLocalizedValue(t.Name.record);i&&(e.untranslatedRecord||(e.untranslatedRecord={Name:JSON.parse(JSON.stringify(e.record.Name))}),e.record.Name=i)}var n=!0,o=!1,r=void 0;try{for(var s,a=e.options[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u={};for(var d in l.localizationByFieldName){var c=null;if(-1!==d.indexOf("__c")){var h=l.localizationByFieldName[d];h&&(c=this.getLocalizedValue(h.record)),"Description__c"===d&&(d=this.prefix+"ProductDescription__c"),u[d=this._appendPrefix(this.prefix,d,h.record[this.prefix+"APIName__c"])]=l.record[d],c&&l.record[d]?l.record[d]=JSON.parse(JSON.stringify(c)):c&&l.record[this.prefix+d]&&(l.record[this.prefix+d]=JSON.parse(JSON.stringify(c)))}}l.untranslatedRecord||(l.untranslatedRecord=u)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}var f=!0,p=!1,v=void 0;try{for(var g,y=e.features[Symbol.iterator]();!(f=(g=y.next()).done);f=!0){var m=g.value;m.untranslatedRecord||(m.untranslatedRecord={Name:JSON.parse(JSON.stringify(m.record.Name))});var b=m.localizationByFieldName;if(b&&b.Name){var _=b.Name,C=this.getLocalizedValue(_.record);C&&(m.record.Name=C)}}}catch(e){p=!0,v=e}finally{try{!f&&y.return&&y.return()}finally{if(p)throw v}}return e}},{key:"_appendPrefix",value:function(e,t,i){return-1===i.indexOf(e)?t:t.replace("__c","")!==i.replace("__c","")||t===i.replace(e,"")?e+t:t}},{key:"getLocalizedValue",value:function(e){return e[this.prefix+"Text__c"]||e[this.prefix+"TextArea__c"]||e[this.prefix+"LongTextArea__c"]||e[this.prefix+"RichTextArea__c"]}}]),i=t)),e("LocalizeFields",i)}}}),System.register("quotes/column-sizing-dao/ColumnSizingDao.js",["common/core/AppContext.js","common/data/client/ServiceClient.js","common/core/Events.js","quotes/models/ClientCache.js","logging/AppLogger.js"],function(e,t){var n,o,r,s,a,l,u,d,c;function h(){a("TestOnlyStates",[c],!1),a("TestOnlyStates",[d],!1)}return{setters:[function(e){n=e.AppContext},function(e){o=e.ServiceClient},function(e){r=e.Events,s=e.fireEvent},function(e){a=e.put},function(e){l=e.AppLogger,u=e.LOG_TYPE}],execute:function(){function i(e,t,i,n,o){return e.then(function(e){if(a("TestOnlyStates",o,!0),e.isSuccessful){var t=new l;t.log(null,n,{field:t.maskCustomerData(i)})}else s(r.COL_SIZE_ERR,{errorMessage:e.errorMessage})},function(e){a("TestOnlyStates",o,!0),s(r.COL_SIZE_ERR,{errorMessage:e})})}d="columnSizeSaved",c="columnSizeReset",e("saveColumnObjects",function(e,t){h(),i((new o).save(n.org.prefix,"ColumnSizingServiceProvider.SaveColumnSizes",e),e,t,u.RESIZE_COLUMN,[d])}),e("resetColumnSizes",function(e){h(),i((new o).save(n.org.prefix,"ColumnSizingServiceProvider.ResetColumnSizes",e),e,"",u.RESET_COLUMN,[c])}),e("columnResizeResponse",i)}}}),System.register("quotes/consumption-rate-validator/ConsumptionRateValidator.js",[],function(e,t){var r,l,u,s,d,n,c,h,f,p,i;function v(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}return{setters:[],execute:function(){r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},l=function(e,t,i){var n=[],o={scheduleId:e,rateId:t.Id};return null==t[i.Price]&&n.push(r({},o,{errorMsg:p.msg_missing_rate_field})),null==t[i.ProcessingOrder]&&n.push(r({},o,{errorMsg:p.msg_missing_rate_field})),null==t[i.LowerBound]&&n.push(r({},o,{errorMsg:p.msg_missing_rate_field})),n},u=function(e,t,i){if(null!=t[i.Price]){var n="";if("number"!=typeof t[i.Price])n=p.msg_rate_price_not_a_number;else parseInt(t[i.Price],10)<0&&(n=p.msg_rate_price_is_negative);if(""!==n)return[{scheduleId:e,rateId:t.Id,ratePrice:t[i.Price],errorMsg:n}]}return[]},s=function(e){var t=parseInt(e,10);return t.toString()===e.toString()&&0<=t},d=function(e,t,i){var n=t[i.LowerBound],o=t[i.UpperBound],r="";return null!=n&&!s(n)||null!=o&&!s(o)?r=p.msg_bound_fields_must_be_positive:null!=n&&null!=o&&parseInt(n,10)>=parseInt(o,10)&&(r=p.msg_lower_bound_greater_than_upper_bound),""!==r?[{scheduleId:e,rateId:t.Id,lowerBound:n,upperBound:o,errorMsg:r}]:[]},n=function(i){return function(e,t){return e[i.ProcessingOrder]>t[i.ProcessingOrder]?1:e[i.ProcessingOrder]===t[i.ProcessingOrder]&&e[i.LowerBound]>t[i.LowerBound]?1:-1}},c=function(e,t,i,n){if(null!=i&&null!=t[n.ProcessingOrder]&&null!=i[n.ProcessingOrder]){var o=parseInt(t[n.ProcessingOrder],10);if(o===parseInt(i[n.ProcessingOrder],10))return[{scheduleId:e,processingOrder:o,errorMsg:p.msg_duplicate_rate_processing_order}]}return[]},h=function(e,t,i,n){return i||null!=t[n.UpperBound]?[]:[{scheduleId:e,rateId:t.Id,errorMsg:p.msg_lesser_rate_has_null_upper_bound}]},f=function(e,t,i,n){if(null!==i&&null!=t[n.UpperBound]&&null!=i[n.LowerBound]){var o=parseInt(t[n.UpperBound],10),r=parseInt(i[n.LowerBound],10)-o;if(0<r)return[{scheduleId:e,errorMsg:p.msg_gaps_between_rates_bounds}];if(r<0)return[{scheduleId:e,errorMsg:p.msg_overlap_between_rates_bounds}]}return[]},p=void 0,e("ConsumptionRateValidator",i=function(e,t,i){var s=[];p=i;var a=t.UBP_FIELDS.ConsumptionRateFields;return Object.keys(e).forEach(function(o){var r=e[o].sort(n(a));r.forEach(function(e,t){var i=t+1,n=r.length<=i?null:r[i];s=[].concat(v(s),v(l(o,e,a)),v(u(o,e,a)),v(d(o,e,a)),v(c(o,e,n,a)),v(f(o,e,n,a)),v(h(o,e,i===r.length,a)))})}),s}),e("ConsumptionRateValidator",i)}}}),System.register("quotes/models/AssetQuantityValidator.js",["common/core/AppContext.js"],function(e,t){var u,o;return{setters:[function(e){u=e.localizeContent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.quoteModel=e,this.constants=t}e("AssetQuantityValidator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"validateAssetQuantityChanges",value:function(){var e=this.quoteModel.record[this.constants.TYPE_FIELD];return"Renewal"===e?this._validateAssetQuantityChangeForRenewal():"Amendment"===e?this._validateAssetQuantityChangeForAmendment():[]}},{key:"_validateAssetQuantityChangeForRenewal",value:function(){var s=[],a=u("msg_qty_cannot_decrease_on_renewal");return this.quoteModel.lineItems.forEach(function(e){var t=e.record[this.constants.RENEWAL_CHECKBOX],i=e.record[this.constants.EXISTING_FIELD],n=e.record[this.constants.PRIOR_QUANTITY_FIELD];if(t&&i&&null!=n){var o=e.record[this.constants.QUANTITY_FIELD];if(0!=o&&o<n){var r=a.replace("{0}",e.record[this.constants.NUMBER_FIELD]).replace("{1}",n);s.push(r)}}},this),s}},{key:"_validateAssetQuantityChangeForAmendment",value:function(){var s=this,o=[],i=[],n=[],r=[];if(this.quoteModel.lineItems.forEach(function(e){if(null!=e.record[this.constants.UPGRADED_ASSET_FIELD])if(e.record[this.constants.QUANTITY_FIELD]<0)e.record[this.constants.EXISTING_FIELD]&&e.record[this.constants.RENEWAL_CHECKBOX]&&i.push(e);else if(e.record[this.constants.EXISTING_FIELD]||e.record[this.constants.CARRYOVER_LINE_FIELD]){var t=e.record[this.constants.UPGRADED_QUANTITY];e.record[this.constants.PRIOR_QUANTITY_FIELD]<t?n.push(e):!e.record[this.constants.ALLOW_ASSET_REFUND_FIELD]&&function(e){var t=e.record[s.constants.QUANTITY_FIELD],i=e.record[s.constants.PRIOR_QUANTITY_FIELD]||0,n=e.record[s.constants.UPGRADED_QUANTITY]||0,o=e.record[s.constants.EXISTING_FIELD],r=e.record[s.constants.CARRYOVER_LINE_FIELD];return o||r?t-i+n:t}(e)<0&&r.push(e)}},this),0<i.length){var e=u("msg_qty_no_negative_on_amend"),t="";i.forEach(function(e){t+=e.record[this.constants.NUMBER_FIELD]+", "},this),t=t.substr(0,t.lastIndexOf(",")),o.push(e.replace("{0}",t))}if(0<n.length){var a=u("msg_qty_of_upgrade_exceeds_source_prior");n.forEach(function(e){var t=e.record[this.constants.NUMBER_FIELD],i=e.record[this.constants.PRIOR_QUANTITY_FIELD],n=a.replace("{0}",t).replace("{1}",i);o.push(n)},this)}if(0<r.length){var l=u("msg_qty_of_source_too_low");r.forEach(function(e){var t=e.record[this.constants.PRODUCT_NAME_FIELD],i=e.record[this.constants.NUMBER_FIELD],n=l.replace("{0}",t).replace("{1}",i);o.push(n)},this)}return o}}]),o=i)),e("AssetQuantityValidator",o)}}}),System.register("quotes/models/ClientCache.js",["common/Util.js"],function(e,t){var i,o;function h(e,t){return e.has(t)||e.set(t,{fields:new Map,observers:[]}),e.get(t)}return{setters:[function(e){i=e.pathGet,o=e.pathSet}],execute:function(){function c(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return i(__clientCache.data[e],t)}function t(e,t,i){var n=__clientCache.data[e];__clientCache.data[e]=o(n,t,i),function t(i,n,o,r,s){if(o!==r&&i){var e=!0,a=!1,l=void 0;try{for(var u,d=i.observers[Symbol.iterator]();!(e=(u=d.next()).done);e=!0)(0,u.value)(r)}catch(e){a=!0,l=e}finally{try{!e&&d.return&&d.return()}finally{if(a)throw l}}var c=function(e){t(i.fields.get(e),n,o?o[e]:void 0,r?r[e]:void 0,s+1)};s<n.length?c(n[s]):i.fields.forEach(function(e,t){c(t)})}}(__clientCache.observers.get(e),t,n,__clientCache.data[e],0)}window.__clientCache={data:{},observers:new Map},e("get",c),e("put",t),e("observe",function(e,t,i){if("function"!=typeof i)throw new Error("Observer must be a function!");var n=h(__clientCache.observers,e),o=!0,r=!1,s=void 0;try{for(var a,l=t[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;n=h(n.fields,u)}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}n.observers.push(i);var d=c(e,t);return void 0!==d&&i(d),function(){n.observers.splice(n.observers.indexOf(i),1)}}),e("del",function(e){t(e,[],void 0),__clientCache.observers.delete(e),delete __clientCache.data[e]})}}}),System.register("quotes/models/ClientModels.js",[],function(e,t){var i,n,o,r,s;function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}return{setters:[],execute:function(){e("UBPClientState",i=function e(t,i,n){l(this,e),this.quoteLineOrProdId=t,this.lineKey=i,this.queryLimit=n,this.categoryIndex=0,this.errorMsg=null,this.searchKeyword=null,this.requestCount=0}),e("UBPClientState",i),e("QuoteLineRelated",n=function e(t){l(this,e),this.categoryIds=t,this.ubpFields=null}),e("QuoteLineRelated",n),e("Category",o=function e(t,i,n,o,r,s,a){l(this,e),this.name=t,this.label=i,this.fields=n,this.orderedRates=o,this.rateCount=r,this.rateCardFields=s,this.sortField=a,this.sortOrder="asc"}),e("Category",o),e("FieldMetadata",r=function e(t,i,n){l(this,e),this.field=t,this.type=i,this.label=n}),e("FieldMetadata",r),e("TYPES",s={RootState:{fields:{spinnerMessage:{type:"string",localizable:!0,required:!0},spinnerStatus:{type:"string"},showSpinnerMessage:{type:"boolean",required:!0}}}}),e("TYPES",s)}}}),System.register("quotes/models/Constants.js",[],function(t,e){var i;return{setters:[],execute:function(){t("CONSTANTS",i=null),t("CONSTANTS",i),t("Constants",function(e){this.QUOTE=e+"Quote__c",this.QUOTE_LINE=e+"QuoteLine__c",this.QUOTE_LINE_GROUP=e+"QuoteLineGroup__c",this.LAST_MODIFIED_DATE_FIELD="LastModifiedDate",this.ACCOUNT_FIELD=e+"Account__r",this.ACCOUNT_ID_FIELD=e+"Account__c",this.ACTION_FIELD=e+"Action__c",this.ADDITIONAL_DISCOUNT_AMOUNT_FIELD=e+"AdditionalDiscountAmount__c",this.ADDITIONAL_DISCOUNT_FIELD=e+"AdditionalDiscount__c",this.ADDITIONAL_DISCOUNT_RATE_FIELD=e+"Discount__c",this.ADDITIONAL_QUANTITY_FIELD=e+"AdditionalQuantity__c",this.ALLOW_ASSET_REFUND_FIELD=e+"AllowAssetRefund__c",this.BATCH_QUANTITY=e+"BatchQuantity__c",this.BUNDLE_FIELD=e+"Bundle__c",this.BUNDLED_FIELD=e+"Bundled__c",this.BUNDLED_QUANTITY_FIELD=e+"BundledQuantity__c",this.CARRYOVER_LINE_FIELD=e+"CarryoverLine__c",this.CLASS_FIELD=e+"Class__c",this.COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD=e+"ComponentDiscountedByPackage__c",this.COMPONENT_LIST_TOTAL_FIELD=e+"ComponentListTotal__c",this.COMPONENT_SUBSCRIPTION_SCOPE_FIELD=e+"ComponentSubscriptionScope__c",this.COMPONENT_VISIBILITY_FIELD=e+"ComponentVisibility__c",this.CONDITIONS_MET_FIELD=e+"ConditionsMet__c",this.CONSUMPTION_RATE_OVERRIDE=e+"ConsumptionRateOverride__c",this.COST_EDITABLE_FIELD=e+"CostEditable__c",this.CUSTOM_ACTION_CONDITIONS_FIELD=e+"Custom_Action_Conditions__r",this.CUSTOMER_AMOUNT_FIELD=e+"CustomerAmount__c",this.CUSTOMER_PRICE_FIELD=e+"CustomerPrice__c",this.DEFAULT_SUBSCRIPTION_TERM_FIELD=e+"DefaultSubscriptionTerm__c",this.DEFAULT_FIELD=e+"Default__c",this.DESCRIPTION_FIELD=e+"Description__c",this.DIMENSION_ID_FIELD=e+"Dimension__c",this.DIMENSION_FIELD=e+"Dimension__r",this.DISCOUNT_AMOUNT_FIELD=e+"DiscountAmount__c",this.DISCOUNT_SCHEDULE_FIELD=e+"DiscountSchedule__c",this.DISCOUNT_SCHEDULE_TYPE_FIELD=e+"DiscountScheduleType__c",this.DISCOUNT_TIER_FIELD=e+"DiscountTier__c",this.DISCOUNT_TIERS_FIELD=e+"DiscountTiers__r",this.DISCOUNT_UNIT_FIELD=e+"DiscountUnit__c",this.DISTRIBUTOR_DISCOUNT_FIELD=e+"DistributorDiscount__c",this.EFFECTIVE_END_DATE_FIELD=e+"EffectiveEndDate__c",this.EFFECTIVE_QUANTITY=e+"EffectiveQuantity__c",this.END_DATE_FIELD=e+"EndDate__c",this.EVENT_HANDLER_NAME_FIELD=e+"EventHandlerName__c",this.EXISTING_FIELD=e+"Existing__c",this.FAVORITE_ID_FIELD=e+"Favorite__c",this.FIELD_FIELD=e+"Field__c",this.FILTER_VALUE_FIELD=e+"FilterValue__c",this.GROUP_LINE_ITEMS_FIELD=e+"LineItemsGrouped__c",this.ICON_CLASS_FIELD=e+"IconClass__c",this.LABEL_FIELD=e+"Label__c",this.LIST_PRICE_FIELD=e+"ListPrice__c",this.LOCATION_FIELD=e+"Location__c",this.LONG_TEXT_AREA_FIELD=e+"LongTextArea__c",this.LOWER_BOUND_FIELD=e+"LowerBound__c",this.MARKUP_AMOUNT_FIELD=e+"MarkupAmount__c",this.MARKUP_FIELD=e+"Markup__c",this.MARKUP_RATE_FIELD=e+"MarkupRate__c",this.NET_AMOUNT_FIELD=e+"NetAmount__c",this.NET_PRICE_FIELD=e+"NetPrice__c",this.NET_TOTAL_FIELD=e+"NetTotal__c",this.NON_DISCOUNTABLE_FIELD=e+"NonDiscountable__c",this.NON_PARTNER_DISCOUNTABLE_FIELD=e+"NonPartnerDiscountable__c",this.NUMBER_FIELD=e+"Number__c",this.OPERATOR_FIELD=e+"Operator__c",this.OPPORTUNITY_FIELD=e+"Opportunity2__r",this.OPPORTUNITY_ID_FIELD=e+"Opportunity2__c",this.OPTION_LEVEL_FIELD=e+"OptionLevel__c",this.OPTION_TYPE_FIELD=e+"OptionType__c",this.OPTIONAL_FIELD=e+"Optional__c",this.ORIGINAL_QUOTE_LINE_FIELD=e+"OriginalQuoteLine__c",this.ORIGINAL_SCHEDULE_FIELD=e+"OriginalDiscountSchedule__c",this.OVERRIDE_BEHAVIOR_FIELD=e+"OverrideBehavior__c",this.PAGE_FIELD=e+"Page__c",this.PARENT_CUSTOM_ACTION_FIELD=e+"ParentCustomAction__c",this.PARTNER_DISCOUNT_FIELD=e+"PartnerDiscount__c",this.PARTNER_PRICE_FIELD=e+"PartnerPrice__c",this.PRICE_EDITABLE_FIELD=e+"PriceEditable__c",this.PRICEBOOK_ID_FIELD=e+"PricebookId__c",this.PRICEBOOK_LOOKUP_ID_FIELD=e+"PriceBook__c",this.PRICING_GUIDANCE_FIELD=e+"Guidance__c",this.PRICING_METHOD_EDITABLE_FIELD=e+"PricingMethodEditable__c",this.PRICING_METHOD_FIELD=e+"PricingMethod__c",this.PRIMARY_FIELD=e+"Primary__c",this.PRICE_SCALE_FIELD=e+"PriceScale__c",this.BRAND_BUTTON_FIELD=e+"BrandButton__c",this.PRIOR_QUANTITY_FIELD=e+"PriorQuantity__c",this.PRODUCT=e+"Product__c",this.PRODUCT_CODE_FIELD=e+"ProductCode__c",this.PRODUCT_NAME_FIELD=e+"ProductName__c",this.PRORATE_MULTIPLIER_FIELD=e+"ProrateMultiplier__c",this.QUANTITY_FIELD=e+"Quantity__c",this.QUOTE_PROCESS_FIELD=e+"QuoteProcess__c",this.QUOTE_PROCESS_ID_FIELD=e+"QuoteProcessId__c",this.REGULAR_PRICE_FIELD=e+"RegularPrice__c",this.RENEWAL_CHECKBOX=e+"Renewal__c",this.RENEWED_ASSET_ID_FIELD=e+"RenewedAsset__c",this.RENEWED_ASSET_RELATIONSHIP_FIELD=e+"RenewedAsset__r",this.RENEWED_SUBSCRIPTION_RELATIONSHIP_FIELD=e+"RenewedSubscription__r",this.REQUIRED_BY_FIELD=e+"RequiredBy__c",this.RICH_TEXT_AREA_FIELD=e+"RichTextArea__c",this.SEGMENT_INDEX_FIELD=e+"SegmentIndex__c",this.SEGMENT_KEY_FIELD=e+"SegmentKey__c",this.SEGMENT_LABEL_FIELD=e+"SegmentLabel__c",this.SOLUTION_GROUP_ID_FIELD=e+"SolutionGroup__c",this.SOURCE_FIELD=e+"Source__c",this.SPECIAL_PRICE_FIELD=e+"SpecialPrice__c",this.START_DATE_FIELD=e+"StartDate__c",this.SUBSCRIBED_ASSET_IDS_FIELD=e+"SubscribedAssetIds__c",this.SUBSCRIPTION_BASE_FIELD=e+"SubscriptionBase__c",this.SUBSCRIPTION_PRICING_FIELD=e+"SubscriptionPricing__c",this.SUBSCRIPTION_SCOPE_FIELD=e+"SubscriptionScope__c",this.SUBSCRIPTION_TERM_FIELD=e+"SubscriptionTerm__c",this.TARGET_CUSTOMER_AMOUNT=e+"TargetCustomerAmount__c",this.SUBSCRIPTION_TYPE_FIELD=e+"SubscriptionType__c",this.TARGET_CUSTOMER_AMOUNT=e+"TargetCustomerAmount__c",this.TARGET_OBJECT_FIELD=e+"TargetObject__c",this.TEXT_FIELD=e+"Text__c",this.TEXT_AREA_FIELD=e+"TextArea__c",this.TYPE_FIELD=e+"Type__c",this.UNIT_COST_FIELD=e+"UnitCost__c",this.UPGRADE_CONVERSION_RATE=e+"UpgradeConversionRate__c",this.UPGRADED_ASSET_FIELD=e+"UpgradedAsset__c",this.UPGRADED_QUANTITY=e+"UpgradedQuantity__c",this.UPGRADED_SUBSCRIPTION_FIELD=e+"UpgradedSubscription__c",this.UPGRADED_CONTRACT_LINE="UpgradedContractLine__c",this.UPLIFT_FIELD=e+"Uplift__c",this.UPPER_BOUND_FIELD=e+"UpperBound__c",this.URL_TARGET_FIELD=e+"URLTarget__c",this.URL_FIELD=e+"URL__c",this.RETURN_URL_FIELD=e+"ReturnURL__c",this.USE_PRICE_FOR_AMOUNT_FIELD=e+"UsePriceForAmount__c",this.USER_DEFINED_FIELD=e+"UserDefined__c",this.UNOPENED_FIELD=e+"Unopened__c",this.HAS_CONSUMPTION_SCHEDULE=e+"HasConsumptionSchedule__c",this.CUSTOM_VALUE="Custom",this.PANEL_ADDED_INDEX=2,this.PERCENT_OF_TOTAL="Percent Of Total",this.TYPE_STANDARD="Standard",this.TYPE_YEARLY_DIMENSION="Year",this.TYPE_QUARTERLY_DIMENSION="Quarter",this.TYPE_MONTHLY_DIMENSION="Month",this.TYPE_SINGLE_DIMENSION="One-time",this.TYPE_CUSTOM_DIMENSION="Custom",this.STANDARD_LINE="STANDARD_LINE",this.SEGMENTED_LINE="SEGMENTED_LINE",this.GROUP_HEADER="GROUP_HEADER",this.GROUP_FOOTER="GROUP_FOOTER",this.PRICING_GUIDANCE_TARGET=e+"Target__c",this.PRICING_GUIDANCE_FLOOR=e+"Floor__c",this.PRICING_GUIDANCE_NORM=e+"Norm__c",this.PRICING_GUIDANCE_EXPLANATION=e+"Explanation__c",this.QUANTITY_FIELDS=new Set([this.ADDITIONAL_QUANTITY_FIELD,this.BATCH_QUANTITY,this.BUNDLED_QUANTITY_FIELD,this.EFFECTIVE_QUANTITY,this.PRIOR_QUANTITY_FIELD,this.QUANTITY_FIELD,this.UPGRADED_QUANTITY]),this.UNIT_PRICE_FIELDS=new Set([this.ADDITIONAL_DISCOUNT_FIELD,this.CUSTOMER_PRICE_FIELD,this.LIST_PRICE_FIELD,this.MARKUP_AMOUNT_FIELD,this.NET_PRICE_FIELD,this.PARTNER_PRICE_FIELD,this.REGULAR_PRICE_FIELD,this.SPECIAL_PRICE_FIELD,this.UNIT_COST_FIELD]),this.UBP_FIELDS={ConsumptionSchedule:e+"QuoteLineConsumptionSchedule__r",ConsumptionScheduleId:e+"QuoteLineConsumptionSchedule__c",ConsumptionRateFields:{UpperBound:e+"UpperBound__c",LowerBound:e+"LowerBound__c",ProcessingOrder:e+"ProcessingOrder__c",Price:e+"Price__c"}},this.FIELD_SET_METADATA={Default:e+"Default__c",FieldSet:e+"FieldSet__c",ObjectType:e+"ObjectType__c"},this.COLUMN_METADATA={FieldColumnSize:e+"FieldColumnSize__c",FieldName:e+"FieldName__c",FieldSetMetadata:e+"FieldSetMetadata__c",FieldSetMasterDetail:e+"FieldSetMetadata__r",FieldSet:e+"FieldSet__c"},this.prefix=e,t("CONSTANTS",i=this)})}}}),System.register("quotes/models/CustomActionModel.js",["common/Util.js","quotes/models/LineModel.js","common/core/AppContext.js"],function(e,t){var a,i,r;return{setters:[function(e){a=e.Util},function(e){e.LineModel},function(e){i=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.editorModel=e,this.record=t,this.customActionModelsByParentId=i,this.renderLocation=n,this.record&&(this.icon=this.record[this.editorModel.constants.ICON_CLASS_FIELD],this.class=this.icon?this.icon:"",this.caClass=this.record[this.editorModel.constants.CLASS_FIELD],this.location=this.record[this.editorModel.constants.LOCATION_FIELD],this.eventHandlerName=this.record[this.editorModel.constants.EVENT_HANDLER_NAME_FIELD],this.label=this.record[this.editorModel.constants.LABEL_FIELD],this.title=this.icon?this.record[this.editorModel.constants.LABEL_FIELD]:null,this.type=this.record[this.editorModel.constants.TYPE_FIELD],this.isSeparator="Separator"===this.type,this.primary=this.record[this.editorModel.constants.BRAND_BUTTON_FIELD],this.urlTarget=this.record[this.editorModel.constants.URL_TARGET_FIELD],this.url=this.record[this.editorModel.constants.URL_FIELD],this.name=this.record.Name),"Line"===this.renderLocation&&(this.class=this.class+" "+this.eventHandlerName+" lineAction")}e("CustomActionModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"isHidden",value:function(e){if(e&&(this.model=e),e&&!this._customActionsConditionsMet)return!0;if("Line"===this.renderLocation&&e)switch(this.eventHandlerName){case"onAddToFavorites":return e.favorite||e.hasParent||e.existing;case"onRemoveFromFavorites":return!e.favorite||e.existing;case"onDeleteLine":return e.hasParent||e.existing&&this.editorModel.quoteModel.isAmendment;case"onCloneLine":return e.hasParent;case"onReconfigureLine":return e.hasParent||!e.configurable;case"onResegmentLine":return!e.lineVO.productHasDimensions||e.segmented||e.existing||e.bundle;case"onDesegmentLine":return!e.lineVO.productHasDimensions||!e.segmented||e.existing||e.bundle;case"showDSModal":var t=this.editorModel.constants.DISCOUNT_SCHEDULE_FIELD;return null==e.lineVO.record[t]||e.isDiscountScheduleIdExcluded(e.lineVO.record[t]);case"onViewConsumptionSchedule":return i.isMobile||!e.lineVO.record[this.editorModel.constants.HAS_CONSUMPTION_SCHEDULE]||!this.editorModel.data.settings.isUsageBasedPricingEnabled;case"onViewPricingGuidance":return!i.isPricingGuidanceEnabled||null==e.lineVO.quoteLinePricingGuidance||e.lineVO.quoteLinePricingGuidance.isDeleted}else{if("Quote"===this.renderLocation&&"Quote/Group"===this.location&&this.editorModel.quoteModel.grouped)return!0;switch(this.eventHandlerName){case"onUngroup":return!this.editorModel.quoteModel.grouped;case"updateLineOptional":return!this.editorModel.toggleOptionalShown||"Group"!==this.location&&"optionalAllBtn"===this.caClass===this.editorModel.quoteModel.allOptional;case"onRenewSubscriptions":return!this.editorModel.data.settings.renewSubscriptionsButtonRendered||this.editorModel.quoteModel.isAmendmentOrChangeQuote;case"onAmendSubscriptions":return!this.editorModel.quoteModel.isAmendment;case"onUpgradeAssets":return!this.editorModel.data.settings.upgradeAssetsButtonRendered;case"onDeleteLines":return!this.editorModel.data.settings.multiLineDeleteEnabled}}return!1}},{key:"_customActionsConditionsMet",get:function(){var e=this,t=this.editorModel.constants;if(!this.record||!this.record[t.CUSTOM_ACTION_CONDITIONS_FIELD])return!0;for(var i,n="Any"!==this.record[t.CONDITIONS_MET_FIELD],o=this.record[t.CUSTOM_ACTION_CONDITIONS_FIELD].records,r=0,s=o.length;r<s;r++)if("Product"===(i=o[r])[t.TARGET_OBJECT_FIELD]?!e.model.productVO||a.arithmeticOperatorConversion(e.model.productVO.record[i[t.FIELD_FIELD]],i[t.FILTER_VALUE_FIELD],i[t.OPERATOR_FIELD]):"Quote"!==i[t.TARGET_OBJECT_FIELD]||a.arithmeticOperatorConversion(e.editorModel.quoteModel.quoteVO.record[i[t.FIELD_FIELD]],i[t.FILTER_VALUE_FIELD],i[t.OPERATOR_FIELD])){if(!n)return!0}else if(n)return!1;return n}},{key:"hasMenu",get:function(){if(this.children||(this.children=this.customActionModelsByParentId?this.customActionModelsByParentId[this.record.Id]:null),"Menu"===this.type&&this.children&&0<this.children.length)for(var e=0,t=this.children.length;e<t;e++)if(!this.children[e].isHidden(this.model))return!0;return!1}},{key:"default",get:function(){var e=this.record[this.editorModel.constants.DEFAULT_FIELD];return this.record[this.editorModel.constants.DEFAULT_FIELD]=!1,e}},{key:"customActionId",get:function(){return this.record.Id}}]),r=o)),e("CustomActionModel",r)}}}),System.register("quotes/models/DataHandlerBehavior.js",["./ClientCache.js"],function(e,t){var a,n,i;function l(t,i){t._ignoreFns.hasOwnProperty(i)&&t._ignoreFns[i](),t._ignoreFns[i]=n(t._recordIds[i],t.properties[i].observing.path,function(e){t.__data__?t.set(i,e):t._detach()})}return{setters:[function(e){a=e.put,n=e.observe}],execute:function(){e("DataHandlerBehavior",i={ready:function(){var s=this;this._ignoreFns={},this._recordIds={};function e(t){var i=s.properties[t].observing;if(i){if(!Array.isArray(i.path))throw new Error("Expected path to be an Array. Got: "+i.path);if(i.twoWay){var e="__"+t+"Changed";s[e]=function(e){s._recordIds.hasOwnProperty(t)&&a(s._recordIds[t],i.path,e)},s._createPropertyObserver(t,e)}var n="__"+t+"IdChanged";if(i.hasOwnProperty("id"))s._recordIds[t]=i.id,l(s,t);else if(i.hasOwnProperty("idProperty"))s[n]=function(){s._recordIds[t]=s.hasOwnProperty(t)?s[i.idProperty]:s.__data__[i.idProperty],l(s,t)},s._addObserverEffect(i.idProperty,n);else{var o=i.idFunction.indexOf("("),r=-1===o?null:i.idFunction.substring(0,o);s[n]=function(){s._recordIds[t]=s[r].apply(s,arguments),l(s,t)},s._addComplexObserverEffect(n+i.idFunction.substring(o))}}}for(var t in this.properties)e(t)},attached:function(){for(var e in this._recordIds)l(this,e)},detached:function(){this._detach()},_detach:function(){for(var e in this._ignoreFns)this._ignoreFns[e]()}}),e("DataHandlerBehavior",i)}}}),System.register("quotes/models/DiscountTierModel.js",[],function(e,t){var i;return{setters:[],execute:function(){e("DiscountTierModel",i=function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.template=t,this.discountSchedule=i,this.selected=!1,this.hidden=!1,this.disabled=!1,this.tiers=[]}),e("DiscountTierModel",i)}}}),System.register("quotes/models/DiscountTiersValidator.js",[],function(e,t){var o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.schedule=e,this.editorModel=t,this.constants=t.constants,this.unitPriceScale=t.data.settings.priceScale,this.isMultiCurrencyOrg=t.data.settings.isMultiCurrencyOrg}e("DiscountTiersValidator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"validate",value:function(e){var l=new Map,u=null,d=this.editorModel.data.customLabels,c=this.schedule;return e.forEach(function(t){var i=null,n=t.template[this.constants.NUMBER_FIELD],e=t.template[this.constants.LOWER_BOUND_FIELD],o=t.template[this.constants.UPPER_BOUND_FIELD],r=null!=u?u[this.constants.UPPER_BOUND_FIELD]:null,s=c[this.constants.DISCOUNT_UNIT_FIELD],a=t.template[this.constants.ADDITIONAL_DISCOUNT_RATE_FIELD];delete t.template.Price,null==e?i=this.formatLabel(d.msg_missing_lower_bound_tier,[n]):null!=u&&e!=r?i=this.formatLabel(d.msg_unequal_lower_upper_bounds_tier,[n]):null!=a||null!=s&&"PERCENT"!==s.toUpperCase()?null!=o&&""!=o&&o<=e?i=this.formatLabel(d.msg_upper_greater_tier,[n]):s&&"AMOUNT"===s.toUpperCase()?t.tiers.forEach(function(e){null===this.discountFormatted(e)&&(i=this.isMultiCurrencyOrg?this.formatLabel(d.msg_missing_discount_amount_tier_currency,[n,t.CurrencyIsoCode]):this.formatLabel(d.msg_missing_discount_amount_tier,[n]))}.bind(this)):null!=o&&""!=o&&o<=e&&(i=this.formatLabel(d.msg_upper_greater_tier,[n])):i=this.formatLabel(d.msg_missing_discount_tier,[n]),null!=i&&l.set(Number(n),i),u=t.template}.bind(this)),l}},{key:"discountFormatted",value:function(e){return null==e[this.constants.DISCOUNT_AMOUNT_FIELD]?null:Number(e[this.constants.DISCOUNT_AMOUNT_FIELD]).toFixed(this.unitPriceScale)}},{key:"formatLabel",value:function(e,t){for(var i=0,n=t.length;i<n;i++)e=e.replace("{"+i+"}",t[i].toString());return e}}]),o=i)),e("DiscountTiersValidator",o)}}}),System.register("quotes/models/DragDropModel.js",["perfMetrics/MetricsService.js","common/core/AppContext.js"],function(e,t){var s,a,l,d,c;function p(e){e.classList.add(a)}function v(e){e.classList.add(l)}return{setters:[function(e){s=e.MetricsService},function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i,n,o,r,s,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.host=e,this.keepBundleTogether=t,this.draggable=i,this.validTargets=n,this.sourceElement,this.hoverOver,this.placeHolderComp=null,this.ghostField,this.targetClass,this.dropBefore,this.usePlaceholder,this.highlightTargetPosition,this.highlightableElements=[],this.enableHighLight,this.lineEditor=document.body.querySelector("sb-page-container")?Polymer.dom(document.body.querySelector("sb-page-container").root).querySelector("sb-line-editor"):document.body.querySelector("sb-line-editor"),this.linesByParentKey=this.lineEditor&&this.lineEditor.editorModel?this.lineEditor.editorModel.quoteModel.linesByParentItemKey:null,this.standardLinesByParentKey=this.lineEditor&&this.lineEditor.editorModel?this.lineEditor.editorModel.quoteModel.standardLinesByParentItemKey:null,this.segmentedLinesByParentKey=this.lineEditor&&this.lineEditor.editorModel?this.lineEditor.editorModel.quoteModel.segmentedLinesByParentItemKey:null,this.ghost=null,this.ghostXOffset=null==a?60:a,this.ghostYOffset=null==l?23:l,this.handleDrag=o,this.handleTrack=r,this.handleDrop=s,this._bootstrapMetricsService()}function f(e){e.classList.contains(a)&&e.classList.remove(a),e.classList.contains(l)&&e.classList.remove(l)}function i(e){if(e&&e.lineModel)return e.lineModel.component}function o(e,t){if(e.lineModel&&t.lineModel)return e.lineModel.lineVO.parentItemKey===t.lineModel.lineVO.parentItemKey}function r(e,t){if(e.lineModel&&t.lineModel)return e.lineModel.lineVO.key===t.lineModel.lineVO.parentItemKey}a="droppableTopBorder",l="droppableBottomBorder",60,d=!23,e("DragDropModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(u,[{key:"_bootstrapMetricsService",value:function(){window.sb&&window.sb.MetricsService&&!this.metricsService&&(this.metricsService=new s)}},{key:"_onTrack",value:function(e){var t=e.detail.x,i=e.detail.y;switch(function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}(e),e.detail.state){case"start":if(Math.abs(e.detail.dx)<9&&Math.abs(e.detail.dy)<4)return;this.metricsService&&this.metricsService.startTransaction("CPQ Performance Metrics Service: drag start ept"),d=!0,this.lineEditor.toggleClass("disable-selection",!0),this.sourceElement=Polymer.dom(e).localTarget;var n=this.sourceElement.getBoundingClientRect();this.sourceWidth=n.width,this.sourceHeight=n.height,this.handleDrag(this.sourceElement,e),this._appendGhostImage(t,i);break;case"track":if(!d)return;this.metricsService&&this.metricsService.startTransaction("CPQ Performance Metrics Service: drag tracking ept");try{this._moveGhost(t,i);var o=Polymer.dom(e).event.detail.hover();if("sf-le-table-row"!==this.draggable||"panel"!==o.id&&!o.classList.contains("nav-item")?this._showGhost():this._hideGhost(),this.handleTrack(o),this.host.debounce("Cursor flipping",function(){var e=this;Polymer.RenderStatus.afterNextRender(this.lineEditor,function(){e.hoverOver&&0!=Object.keys(e.hoverOver).length?(o!==e.previousHoverOverComp&&e.lineEditor.toggleClass("dropCursor",!0),e.previousHoverOverComp=e.hoverOver.comp):(e.lineEditor.toggleClass("dropCursor",!1),e._removePlaceholder())})}.bind(this),15),!this.hoverOver||0==Object.keys(this.hoverOver).length)return void this._removeHighlightHover(this.previousHoverOverComp);this.host.debounce("Apply Placeholder",function(){this._removePlaceholder(),this.usePlaceholder&&this.hoverOver&&0!=Object.keys(this.hoverOver).length&&this._usePlaceholder(t,i)}.bind(this),22),this.enableHighLight&&(this._removeHighlightHover(this.previousHoverOverComp),this._highlightHover(this.hoverOver.comp))}catch(e){this.sourceElement.toggleAttribute?this.sourceElement.toggleAttribute("hidden",!1):this.sourceElement.removeAttribute("hidden"),this._removeGhost(),this._removePlaceholder(),this.lineEditor.toggleClass("dropCursor",!1)}break;case"end":if(!d)return;this.metricsService&&this.metricsService.startTransaction("CPQ Performance Metrics Service: drag end ept"),this._removePlaceholder(),this._removeGhost(),this.hoverOver?(this.handleDrop(this.sourceElement,this.hoverOver.comp,this.targetClass,this.dropBefore),this._removeHighlightHover(this.hoverOver.comp)):this.handleDrop(this.sourceElement,null,this.targetClass,this.dropBefore),this.lineEditor.toggleClass("dropCursor",!1),this.sourceElement=null,this.previousHoverOverComp=null,this.hoverOver={},d=!1,this.lineEditor.toggleClass("disable-selection",!1)}}},{key:"_appendGhostImage",value:function(e,t){var i=this._clonePolymerElement(this.sourceElement),n=i.querySelector(".loadingSpinner");n&&n.remove(),i.hidden=!1;var o=e-this.ghostXOffset+"px",r=t-this.ghostYOffset+"px";this.ghost.style.width=this.sourceWidth+"px",this.ghost.style.height=this.sourceHeight+"px",this.ghost.style.left=o,this.ghost.style.top=r,this.ghost.style.visibility="visible",this.ghost.appendChild(i)}},{key:"_moveGhost",value:function(e,t){var i=e-this.ghostXOffset+"px",n=t-this.ghostYOffset+"px";this.ghost.style.left=i,this.ghost.style.top=n}},{key:"_removeGhost",value:function(){this.ghost.innerHTML="",this.ghost.style.left="",this.ghost.style.top="",this.ghost.style.width="",this.ghost.style.height="",this.ghost.style.visibility="hidden"}},{key:"_hideGhost",value:function(){this.ghost.style.visibility="hidden"}},{key:"_showGhost",value:function(){this.ghost.style.visibility="visible"}},{key:"_findTableRowValidTarget",value:function(e){return e?this._ifParentIsValidTarget(e)&&!e.classList.contains("tfoot")&&"header"!==e.id&&"template"!==e.localName&&"sb-le-summary-row"!==e.localName?e:e.domHost?this._findTableRowValidTarget(e.domHost):e.host?this._findTableRowValidTarget(e.host):e.parentNode?this._findTableRowValidTarget(e.parentNode):null:null}},{key:"_updateMDQTableRowHoverOverObject",value:function(e,t){t.lineModel.dimensionType!==e.lineModel.dimensionType?this.hoverOver=null:this.keepBundleTogether&&e.lineModel.component&&t.lineModel.groupModel.groupKey!==e.lineModel.groupModel.groupKey?this.hoverOver=null:this.hoverOver={comp:t,phLoc:"both"}}},{key:"_findSidePanelGroupValidTarget",value:function(e){if(this._ifParentIsValidTarget(e))return e;if("panel"!==e.id)return null;var t=e.querySelectorAll(".nav-item");return t[t.length-1]}},{key:"updateTableRowHoverOverObject",value:function(e){if(e)if("placeholder"===e.id&&(e="before"===e.ref?this._getPreviousLineSibling(e):this._getNextLineSibling(e)),!this.keepBundleTogether&&e.lineModel)this.hoverOver={comp:e,phLoc:"both"};else if(e.lineModel){var t=e.lineModel.lineVO.key;if(i(this.sourceElement)){if(i(this.sourceElement))if(o(e,this.sourceElement)&&r(e,this._getNextLineSibling(e)))this.hoverOver={comp:e,phLoc:"before"};else{if(!o(e,this.sourceElement))return void(this.hoverOver=null);this.hoverOver={comp:e,phLoc:"both"}}}else if(this.standardLinesByParentKey[t]||e.lineModel.component){if(!e.lineModel.bundle||e.lineModel.component)return void(this.hoverOver=null);this.hoverOver={comp:e,phLoc:"before"}}else this.hoverOver={comp:e,phLoc:"both"}}else e.classList.contains("tfoot"),this.hoverOver=null}},{key:"_getNextLineSibling",value:function(e){var t=parseInt(e.getAttribute("data-index"))+1;return this._helpGetLineSibling(t,e)}},{key:"_getPreviousLineSibling",value:function(e){var t=parseInt(e.getAttribute("data-index"))-1;return this._helpGetLineSibling(t,e)}},{key:"_helpGetLineSibling",value:function(e,t){var i="sf-le-table-row[data-index='"+e+"']";return t.parentNode.querySelector(i)}},{key:"_findParentCustomElement",value:function(e,t,i){if(!e)return null;switch(i){case"id":if(e.id===t)return e;break;case"class":if(e.classList.contains(t))return e;break;case"nodeName":if(e.nodeName===t)return e}return e.rootNode?this._findParentCustomElement(e.rootNode,t,i):e.host?this._findParentCustomElement(e.host,t,i):e.parentNode?this._findParentCustomElement(e.parentNode,t,i):null}},{key:"_highlightHover",value:function(e){this.host.toggleClass("hoverover",!0,e)}},{key:"_ifParentIsValidTarget",value:function(e){if(!e||!e.parentElement)return!1;for(var t=Array.from(e.parentElement.classList),i=0,n=t.length;i<n;i++)if(this.validTargets.has(t[i]))return this.targetClass=t[i],!0;return!1}},{key:"_removePlaceholder",value:function(){this.placeHolderComp&&this.placeHolderComp.parentElement&&(this.placeHolderComp.parentElement.removeChild(this.placeHolderComp),this.placeHolderComp=null)}},{key:"_removeHighlightHover",value:function(e){var t=this;e&&e.parentNode&&Polymer.dom(e.parentNode).querySelectorAll(e.localName).forEach(function(e){t.host.toggleClass("hoverover",!1,e)})}},{key:"_highlightDroppableBorder",value:function(e,t){var i=this.hoverOver.comp.getBoundingClientRect(),n=i.top+i.height/2,o=this.highlightableElements;switch(this.hoverOver.phLoc){case"both":if(t<n){for(var r=0,s=o.length;r<s;r++)f(o[r]),p(o[r]);this.dropBefore=!0}else if(n<t){for(var a=0,l=o.length;a<l;a++)f(o[a]),v(o[a]);this.dropBefore=!1}break;case"before":for(var u=0,d=o.length;u<d;u++)f(o[u]),p(o[u]);this.dropBefore=!0;break;case"after":for(var c=0,h=o.length;c<h;c++)f(o[c]),v(o[c]);this.dropBefore=!1}}},{key:"_removeHighlightDroppableBorder",value:function(e){if(e)for(var t=0,i=e.length;t<i;t++)f(e[t])}},{key:"_usePlaceholder",value:function(e,t){if(this.hoverOver&&this.hoverOver.comp!==this.placeHolderComp){var i=this.hoverOver.comp.getBoundingClientRect(),n=i.top+i.height/2;if(!this.placeHolderComp){if(this.sourceElement.deepCloneNode)this.placeHolderComp=this.sourceElement.deepCloneNode(),this.placeHolderComp.hidden=!1,this.placeHolderComp.setAttribute("id","placeholder"),this.placeHolderComp.$$&&this.placeHolderComp.toggleClass("placeholder",!0,this.placeHolderComp.$$(".tr"));else{for(var o in this.placeHolderComp=this.host.create(this.draggable),this.placeHolderComp.setAttribute("id","placeholder"),this.placeHolderComp.$$&&this.placeHolderComp.toggleClass("placeholder",!0,this.placeHolderComp.$$(".tr")),this.sourceElement.properties)if("data"!==o)try{this.placeHolderComp[o]=this.sourceElement[o]}catch(e){}this.placeHolderComp.data=this.sourceElement.data}this.placeHolderComp.style.width=i.width+"px",this.placeHolderComp.style.height=i.height+"px",this.placeHolderComp.style.backgroundColor="#d8dde6"}switch(this.hoverOver.phLoc){case"both":t<n?(Polymer.dom(this.targetHost.root).querySelector("."+this.targetClass).appendChild(this.placeHolderComp),this.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp,this.hoverOver.comp),this.placeHolderComp.setAttribute("ref","after"),this.dropBefore=!0):n<t&&(Polymer.dom(this.targetHost.root).querySelector("."+this.targetClass).appendChild(this.placeHolderComp),this.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp,this.hoverOver.comp.nextElementSibling),this.placeHolderComp.setAttribute("ref","before"),this.dropBefore=!1);break;case"before":Polymer.dom(this.host.root).querySelector("."+this.targetClass).appendChild(this.placeHolderComp),this.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp,this.hoverOver.comp),this.placeHolderComp.setAttribute("ref","after"),this.dropBefore=!0;break;case"after":Polymer.dom(this.host.root).querySelector("."+this.targetClass).appendChild(this.placeHolderComp),this.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp,this.hoverOver.comp.nextElementSibling),this.placeHolderComp.setAttribute("ref","before"),this.dropBefore=!1}}else if(this.hoverOver&&this.hoverOver.comp===this.placeHolderComp){if(!this.placeHolderComp.hasAttribute("ref"))return;"before"===this.placeHolderComp.getAttribute("ref")?(this.hoverOver.comp=this.hoverOver.comp.previousElementSibling,this.dropBefore=!1):"after"===this.placeHolderComp.getAttribute("ref")&&(this.hoverOver.comp=this.hoverOver.comp.nextElementSibling,this.dropBefore=!0)}}},{key:"_clonePolymerElement",value:function(e){if(e.deepCloneNode)return e.deepCloneNode();var t=e.cloneNode(!0);for(var i in e.properties)if("data"!==i)try{t[i]=e[i]}catch(e){}return t.data=e.data,t}}]),c=u)),e("DragDropModel",c),e("removeTableRowBorderClass",function(e){for(var t=Array.from(Polymer.dom(e.root).querySelector(".tr").getElementsByClassName("td")),i=0,n=t.length;i<n;i++)f(t[i])}),e("removeTopBottomBorderClass",f),e("isComponent",i),e("ifLineElementsShareParent",o),e("ifLineElementsAreParentChild",r)}}}),System.register("quotes/models/EditorModel.js",["common/core/AppContext.js","quotes/models/QuoteModel.js","quotes/models/Constants.js","quotes/models/CustomActionModel.js"],function(e,t){var r,i,s,g,a,l,u,d,c,h;return{setters:[function(e){r=e.AppContext},function(e){i=e.QuoteModel},function(e){s=e.Constants},function(e){g=e.CustomActionModel}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.i18n=r.properties.i18n.value(),this._observers=new Map,this.data=e,this.md=t,this.fieldsetMap=l(this.data,this.md),this.columnMetadata=this.data.columnMetadata,this.constants=new s(e.developerPrefix),this.deviceContext=i?i.app.deviceContext:{},this.fieldNameSet=i?i.fieldNameSet:{},this.fieldSetNames=this.data.fieldSetNames,this.md.fieldsMap[this.data.quoteLineObjectName][this.constants.SUBSCRIPTION_SCOPE_FIELD].required=!0,this.data.excludedDiscountScheduleIds=Array.isArray(this.data.excludedDiscountScheduleIds)?this._convertExcludedDiscountScheduleIdsToObject(this.data.excludedDiscountScheduleIds):this.data.excludedDiscountScheduleIds||{},this.largeQuoteExperienceEnabled=e.settings.largeQuoteExperienceEnabled&&!this.deviceContext.isMobile,this.summarized=e.quote.summaries&&0<Object.keys(e.quote.summaries).length,this.createQuoteModel(e.quote),this.standardPrimaryMobileCols=[],this.segmentedPrimaryMobileCols=[],this.segmentedDetailsPrimaryMobileCols=[],this.toggleOptionalShown=d(this),i&&i.editorModel?(this.customActionsByLocation=i.editorModel.customActionsByLocation,this.customActionsByLocationMobile=i.editorModel.customActionsByLocationMobile,this.groupMobileMenuButtonAction=i.editorModel.groupMobileMenuButtonAction,h(this)):c(e.customActions,this),this.quoteCustomActions=this.deviceContext.isMobile?this.customActionsByLocationMobile.Quote:this.customActionsByLocation.Quote,this.lineCustomActions=this.deviceContext.isMobile?this.customActionsByLocationMobile.Line:this.customActionsByLocation.Line,this.styleQuoteAndGroupActionButtons(),this.communityPrefix=this._getCommunityPrefix(),this.scPrefix=r.org.scPrefix,this._verifyAdditionalDiscountUnitOptions()}e("EditorModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"createQuoteModel",value:function(e){this.quoteModel=new i(e,this)}},{key:"styleQuoteAndGroupActionButtons",value:function(){function e(e){for(var t=!0,i=s.customActionsByLocation[e],n=i[0],o=0,r=i.length;o<r;o++)i[o].isHidden(s.quoteModel)||(i[o].first=t,i[o].isSeparator?(t=!0,n.last=!0):(t=!1,(n=i[o]).last=!1));n&&(n.last=!0)}var s=this;e("Quote"),e("Group")}},{key:"_verifyAdditionalDiscountUnitOptions",value:function(){0===this.data.additionalDiscountUnitOptions.length&&this.data.additionalDiscountUnitOptions.push({label:"%",value:"Percent"})}},{key:"_getCommunityPrefix",value:function(){var e=document.location.pathname,t=e.indexOf("/apex");return t<0?"":e.substring(0,t)}},{key:"getFieldMetadata",value:function(e,t){var i=this.md.fieldsMap[this.data.quoteLineObjectName][e];return t&&this.data.settings.isMultiCurrencyOrg&&"currency"===i.type&&t.CurrencyIsoCode&&((i=JSON.parse(JSON.stringify(i))).CurrencyIsoCode=t.CurrencyIsoCode),i}},{key:"getDependentFields",value:function(t){var i=this.md.fieldsMap[this.data.quoteLineObjectName];return Object.keys(i).filter(function(e){return i[e].controllerName===t})}},{key:"hasDrawerFields",value:function(){return 0<this.fieldsetMap.standardLineItemDrawerFieldNames.length}},{key:"isProductHierarchyVisualized",value:function(){return this.data.settings.productHierarchyVisualized}},{key:"isMultiLineDeleteEnabled",value:function(){return this.data.settings.multiLineDeleteEnabled}},{key:"_convertExcludedDiscountScheduleIdsToObject",value:function(e){if(e)return e.reduce(function(e,t){return e[t]=!0,e},{})}},{key:"actionsOnTheLeft",get:function(){return"Left"===this.data.settings.actionsColumnPlacement}}]),a=o)),e("EditorModel",a),l=function(e,i){var t=u(e.developerPrefix),n={};return t.forEach(function(t){e[t.name]?(n[t.name]=[],e[t.name].forEach(function(e){i.fieldsMap[t.table]&&i.fieldsMap[t.table][e]&&n[t.name].push(e)})):n[t.name]=e[t.name]}),n},u=function(e){return[{table:e+"QuoteLine__c",name:"lineFieldNames"},{table:e+"QuoteLine__c",name:"lineFieldNamesTablet"},{table:e+"QuoteLine__c",name:"lineFieldNamesPhone"},{table:e+"QuoteLine__c",name:"standardLineItemDrawerFieldNames"},{table:e+"QuoteLine__c",name:"multiSegmentLineFieldNames"},{table:e+"QuoteLine__c",name:"multiSegmentLineSummaryFieldNames"},{table:e+"DiscountTier__c",name:"discountScheduleModalFieldNames"},{table:e+"Quote__c",name:"quoteFieldNames"},{table:e+"QuoteLineGroup__c",name:"groupFieldNames"}]},d=function(n){function e(e){for(var t=0,i=e.length;t<i;t++)if(e[t]===n.constants.OPTIONAL_FIELD)return!0}return e(n.fieldsetMap.lineFieldNames)||e(n.fieldsetMap.multiSegmentLineFieldNames)||e(n.fieldsetMap.standardLineItemDrawerFieldNames)},c=function(e,r){r.defaultCustomActions=[];for(var s=["Quote","Group","Line"],a={Quote:[],Group:[],Line:[]},l={Quote:[],Group:[],Line:[]},u={Quote:{},Group:{},Line:{}},d=void 0,t=function(e,t){if(-1!==s.indexOf(t)){var i=new g(r,e,u[t],t);if(i.isSeparator||l[t].push(i),i.default&&r.defaultCustomActions.push(i),"onAddGroup"===i.eventHandlerName&&(d=i),e[r.constants.PARENT_CUSTOM_ACTION_FIELD]){var n=e[r.constants.PARENT_CUSTOM_ACTION_FIELD],o=u[t][n];o?o.push(i):u[t][n]=[i]}else a[t].push(i)}},i=0,n=e.length;i<n;i++){var o=e[i][r.constants.LOCATION_FIELD];"Quote/Group"===o?(t(e[i],"Quote"),t(e[i],"Group")):o&&"Configurator"!==o&&t(e[i],o)}if(r.customActionsByLocation=a,r.customActionsByLocationMobile=l,r.groupMobileMenuButtonAction=new g(r),r.groupMobileMenuButtonAction.children=l.Group,r.data.settings.solutionGroupsEnabled&&0<r.data.solutionGroups.length&&d){var c=r.data.solutionGroups,h=u.Quote[d.record.Id]||[];d.type="Menu";for(var f=0,p=c.length;f<p;f++){var v=new g(r,c[f]);v.type="Solution Group",v.eventHandlerName="onAddGroup",v.label=c[f].Name,h.push(v)}d.children=h}},e("getSubchange",function(e,t,i){for(var n=0;n<i;n++){if(e.length<=1||"splices"===e[1])return null;t=t[e[0].startsWith("#")?e[0].substring(1):e[0]],e=e.slice(1)}return{path:e,target:t}}),h=function(a){function e(e){for(var t in e){var i=!0,n=!1,o=void 0;try{for(var r,s=e[t][Symbol.iterator]();!(i=(r=s.next()).done);i=!0){r.value.editorModel=a}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}}a.deviceContext.isMobile?(e(a.customActionsByLocationMobile),a.groupMobileMenuButtonAction.editorModel=a):e(a.customActionsByLocation)}}}}),System.register("quotes/models/GroupModel.js",["common/core/sb-page-container/PageContainer.js","common/layout/fields/FieldSetHandler.js","quotes/layout/sb-le-table-cell/DiscountConverter.js","quotes/models/EditorModel.js","quotes/models/LineModel.js","quotes/models/UiNotifier.js","../../common/Util.js","common/core/AppContext.js"],function(e,t){var i,r,s,a,l,u,d,c,h,f,p;return{setters:[function(e){i=e.PageContainer},function(e){r=e.FieldSetHandler},function(e){s=e.setDiscountValue},function(e){a=e.getSubchange},function(e){l=e.LineModel},function(e){u=e.register,d=e.notify,c=e.setThenNotify},function(e){h=e.toFieldName},function(e){f=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.groupVO=e,this.quoteModel=t,this.standardLines=[],this.segmentedLines=[],this.dimensions=[],this.dimensionsMap={},this.segmentedLinesByDimension={},this.segmentedLinesBySegmentKey={},this.segmentedLineKeysBySegmentKey={},this.standardSubscriptionScopeEditable=!1,this.segmentedSubscriptionScopeEditable=!1,this.groupObjectName=this.constants.QUOTE_LINE_GROUP,this.summaries=this.quoteModel.grouped?this.groupVO.summaries:this.quoteModel.quoteVO.summaries,this.multiSegmentColumnTotals=this.groupVO.multiSegmentColumnTotals?this.groupVO.multiSegmentColumnTotals:this.quoteModel.quoteVO.multiSegmentColumnTotals,this.netMultiSegmentTotal=this.groupVO.netMultiSegmentTotal?this.groupVO.netMultiSegmentTotal:this.quoteModel.quoteVO.netMultiSegmentTotal,this.hasVisibleStandardLines=!1,this.hasVisibleSegmentedLines={},this.standardLineFieldNames=this._setStandardLineFieldNames(),this.groupFieldNames=this._getFieldSetNames(),this._setDrawerFields(),u(this,function(e){"lineType"!==e[0]&&(i.lineType===i.constants.TYPE_STANDARD?"standardLines"!==e[0]:"segmentedLinesByDimension"!==e[0]||e[1]!==i.lineType)||d(i,["flattenedRows"])})}e("GroupModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"processQuoteLines",value:function(e){var t=new l(e,this);(this.quoteModel.lineModelsByKey[t.lineVO.key]=t).segmented?this._addSegmentedLine(t):this._addStandardLine(t),t.lineVO.parentItemKey&&(!t.segmented||t.segmented&&t.segments)&&this.addToLinesByParentItemKey(t)}},{key:"_addStandardLine",value:function(e){e.visible&&(this.hasVisibleStandardLines=!0),this.quoteModel.indexByGroupKey[e.lineVO.parentGroupKey].indexByLineKey[e.lineVO.key]=this.standardLines.length,this.standardLines.push(e),e.subscriptionScopeEditable&&this.quoteModel.grouped&&(this.standardSubscriptionScopeEditable=!0)}},{key:"_addSegmentedLine",value:function(e){var t=e.lineVO,i=t.record,n=t.key,o=i[this.constants.SEGMENT_KEY_FIELD],r=i[this.constants.SEGMENT_LABEL_FIELD],s=this.quoteVO.multiSegmentKeys?this.quoteVO.multiSegmentKeys[o]:null;if(this.segmentedLinesBySegmentKey[o])this.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[n]=this.segmentedLinesBySegmentKey[o].segments.length,e.segmentedLineKey=this.segmentedLineKeysBySegmentKey[o],this.segmentedLinesBySegmentKey[o].segments.push(e),this.segmentedLinesBySegmentKey[o].segmentsByLabel[r]=e;else{e.visible&&!this.hasVisibleSegmentedLines[s]&&(this.hasVisibleSegmentedLines[s]=!0);var a=new l(t,this);this.setDimensionProperties(s),e.addToSegmentsArray(a),e.addToSegmentsByLabel(r,e),this.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[n]=e.segments.length-1,a.segmentedLineKey=this.segmentedLineKeysBySegmentKey[o],this.segmentedLines.push(e),s&&(this.quoteModel.indexByGroupKey[this.groupKey].indexBySegmentKey[o]=this.segmentedLinesByDimension[s].length,this.segmentedLinesByDimension[s].push(e),(this.segmentedLinesBySegmentKey[o]=e).dimensionType=s)}e.subscriptionScopeEditable&&this.quoteModel.grouped&&(this.segmentedSubscriptionScopeEditable=!0)}},{key:"removeDimensionProperties",value:function(e){e&&this.segmentedLinesByDimension[e]&&0===this.segmentedLinesByDimension[e].length&&(delete this.segmentedLinesByDimension[e],this.dimensionsMap[e]&&delete this.dimensionsMap[e],this.dimensions.splice(this.dimensions.indexOf(e),1))}},{key:"setDimensionProperties",value:function(e){e&&(this.dimensionsMap[e]||(this.dimensionsMap[e]=!0,this.dimensions.push(e)),this.segmentedLinesByDimension[e]||(this.segmentedLinesByDimension[e]=[]))}},{key:"getDimensionColWidths",value:function(e){var t={};for(var i in this.colWidth[e])t[h(i)]=this.colWidth[e][i];return t}},{key:"addToLinesByParentItemKey",value:function(e){var t=this.quoteModel.linesByParentItemKey,i=this.quoteModel.standardLinesByParentItemKey,n=this.quoteModel.segmentedLinesByParentItemKey,o=e.lineVO.parentItemKey;o&&(t[o]||(t[o]=[]),t[o].push(e),e.segmented?(n[o]||(n[o]=[]),n[o].push(e)):(i[o]||(i[o]=[]),i[o].push(e)))}},{key:"cloneLine",value:function(e,t,i){var n=JSON.parse(JSON.stringify(e.lineVO));n.record=JSON.parse(JSON.stringify(e.lineVO.record));var o=i||e.groupModel,r=new l(n,o);if(r.lineVO.parentItemKey=t||null,r.segmented&&!e.segmentedLineKey&&(r.segments=[],r.segmentsByLabel={}),f.isBundleCollapsible(e.editorModel)&&(r.bundleCollapsed=e.bundleCollapsed,r.bundleVisible=e.bundleVisible),(r.lineVO.record.Id=null)!=r.lineVO.quoteLinePricingGuidance&&r.lineVO.quoteLinePricingGuidance.record&&(r.lineVO.quoteLinePricingGuidance.record.Id=null),r.lineVO.record[this.constants.REQUIRED_BY_FIELD]=null,r.lineVO.record[this.constants.SOURCE_FIELD]=e.lineVO.record.Id||e.lineVO.record[this.constants.SOURCE_FIELD],null!=r.lineVO.record[this.constants.LAST_MODIFIED_DATE_FIELD]&&(r.lineVO.record[this.constants.LAST_MODIFIED_DATE_FIELD]=null),"Amendment"===e.editorModel.quoteModel.quoteVO.record[this.constants.TYPE_FIELD]){if(f.org.isServiceCloudEnabled){var s=""+f.org.scPrefix+this.constants.UPGRADED_CONTRACT_LINE;r.lineVO.record[s]=null}else r.lineVO.record[this.constants.UPGRADED_SUBSCRIPTION_FIELD]=null;r.lineVO.record[this.constants.EXISTING_FIELD]=!1,r.lineVO.record[this.constants.RENEWAL_CHECKBOX]=!1,r.lineVO.record[this.constants.UPGRADED_ASSET_FIELD]=null,r.lineVO.record[this.constants.NET_TOTAL_FIELD]=null,r.lineVO.record[this.constants.PRIOR_QUANTITY_FIELD]=null,r.lineVO.record[this.constants.RENEWED_ASSET_ID_FIELD]=null,r.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD]=null}return r.lineVO.key=++r.editorModel.quoteModel.quoteVO.nextKey,i&&(r.lineVO.parentGroupKey=i.groupKey),this._updateColWidths(e),r}},{key:"cloneSegmentedLine",value:function(e,t,i){var n=this.cloneLine(e,t,i),o=Math.random().toString(36).substr(2,9);n.lineVO.record[this.constants.SEGMENT_KEY_FIELD]=o;var r=n.lineVO.record[this.constants.SEGMENT_KEY_FIELD],s=e.lineVO.record[this.constants.SEGMENT_KEY_FIELD],a=this.quoteModel.quoteVO.multiSegmentRowTotals;a&&(a[r]=a[s]),this.segmentedLinesBySegmentKey[r]=n,this.quoteVO.multiSegmentKeys[r]=n.lineVO.dimensionType;for(var l=0,u=e.segments.length;l<u;l++){var d=this.cloneLine(e.segments[l],null,i);if(d.lineVO.record[this.constants.SEGMENT_KEY_FIELD]=r,d.lineVO.parentItemKey=n.lineVO.parentItemKey,d.segmentedLineKey=n.lineVO.key,n.segments&&n.segments.push(d),n.segmentsByLabel){var c=d.lineVO.record[this.constants.SEGMENT_LABEL_FIELD];n.segmentsByLabel[c]=d}}n.dimensionType=e.dimensionType;var h=n.dimensionType;return this.segmentedLinesByDimension[h]||this.setDimensionProperties(h),this.quoteModel.grouped&&(this._updateColWidths(e,h),this.groupVO.multiSegmentColumns[h]=e.groupModel.groupVO.multiSegmentColumns[h],this.groupVO.localizedMultiSegmentColumns[h]=e.groupModel.groupVO.localizedMultiSegmentColumns[h]),n}},{key:"_updateColWidths",value:function(e,t){this.editorModel.deviceContext.isMobile||(this.colWidth||(this.colWidth={}),this.colWidth[t]||(this.colWidth[t]=e.groupModel.colWidth[t]),this.colWidth.Standard||(this.colWidth.Standard=e.groupModel.colWidth.Standard))}},{key:"_groupHasStandardProducts",value:function(){this.hasVisibleStandardLines=!1;for(var e=0,t=this.standardLines.length;e<t;e++)if(this.standardLines[e].visible){this.hasVisibleStandardLines=!0;break}return this.hasVisibleStandardLines}},{key:"_groupHasSegmentedProducts",value:function(){Object.keys(this.hasVisibleSegmentedLines);var e=!1;for(var t in this.segmentedLinesByDimension){this.hasVisibleSegmentedLines[t]=!1;for(var i=0,n=this.segmentedLinesByDimension[t].length;i<n;i++)if(this.segmentedLinesByDimension[t][i].visible){e=this.hasVisibleSegmentedLines[t]=!0;break}}return e}},{key:"_updateStandardSubscriptionScopeEditable",value:function(e){if(this.quoteModel.grouped)for(var t=0,i=this.standardLines.length;t<i;t++)if(this.standardLines[t].visible&&this.standardLines[t].subscriptionScopeEditable&&this.standardLines[t]!==e)return void(this.standardSubscriptionScopeEditable=!0);this.standardSubscriptionScopeEditable=!1}},{key:"_updateSegmentedSubscriptionScopeEditable",value:function(e){if(this.quoteModel.grouped)for(var t=0,i=this.segmentedLines.length;t<i;t++)if(this.segmentedLines[t].visible&&this.segmentedLines[t].subscriptionScopeEditable&&this.segmentedLines[t]!==e)return void(this.segmentedSubscriptionScopeEditable=!0);this.segmentedSubscriptionScopeEditable=!1}},{key:"renumberStandardIndexes",value:function(){for(var e=0,t=this.standardLines.length;e<t;e++)this.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[this.standardLines[e].lineVO.key]=e}},{key:"renumberSegmentedIndexes",value:function(){for(var e=0,t=this.dimensions.length;e<t;e++)for(var i=this.dimensions[e],n=this.segmentedLinesByDimension[i],o=0;o<n.length;o++)for(var r=n[o].lineVO.record[this.constants.SEGMENT_KEY_FIELD],s=n[this.quoteModel.indexByGroupKey[this.groupKey].indexBySegmentKey[r]=o].segments,a=0,l=s.length;a<l;a++)this.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[s[a].lineVO.key]=a}},{key:"canDelete",value:function(){function e(e){return e.every(function(e){return!e.existing})}return e(this.standardLines)&&e(this.segmentedLines)}},{key:"_setStandardLineFieldNames",value:function(){var e=new r(this.editorModel.fieldsetMap,"lineFieldNames","lineFieldNamesTablet","lineFieldNamesPhone");return this.fieldSet=e.getByViewport(i.getViewport()),this.fieldSetName!=this.fieldSet.name&&(this.fieldSetName=this.fieldSet.name),this._getFields()}},{key:"_getFields",value:function(){return this.standardSubscriptionScopeEditable?[this.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields):this.fieldSet.fields}},{key:"_setDrawerFields",value:function(){var e=this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames,t=this.editorModel.deviceContext.isMobile;e&&!t?this.standardLineDrawerFieldNames=e:e&&t&&(this.standardLineFieldNames=this.standardLineFieldNames.concat(e))}},{key:"toggleOptional",value:function(t){var i=this;this._callChildren(function(e){c(e,["lineVO","record",i.constants.OPTIONAL_FIELD],t)})}},{key:"notifyUi",value:function(e){var t="segmentedLinesByDimension"===e[0]?a(e,this,3):"standardLines"===e[0]?a(e,this,2):null;null!==t?d(t.target,t.path):d(this,e)}},{key:"_getFieldSetNames",value:function(){for(var e=this.editorModel.fieldsetMap.groupFieldNames.slice(),t=0,i=e.length;t<i;t++)this.isMobile||this.constants.DESCRIPTION_FIELD!=e[t]&&"Name"!=e[t]||(e.splice(t,1),t--);return e}},{key:"getFieldMD",value:function(e){return this.groupMD[e]}},{key:"toggleSelected",value:function(t){this._callChildren(function(e){c(e,["selected"],t)})}},{key:"resetDiscounts",value:function(){var t=this;this._callChildren(function(e){s(e,t.constants.ADDITIONAL_DISCOUNT_FIELD,null)})}},{key:"_callChildren",value:function(t){var i=this;this.standardLines.forEach(t),this.dimensions.forEach(function(e){i.segmentedLinesByDimension[e].forEach(function(e){e.segments.forEach(t)})})}},{key:"editorModel",get:function(){return this.quoteModel.editorModel}},{key:"constants",get:function(){return this.editorModel.constants}},{key:"quoteVO",get:function(){return this.quoteModel.quoteVO}},{key:"lineType",get:function(){return this._lineType||(this._lineType=0<this.standardLines.length||0===this.dimensions.length?"Standard":this.dimensions[0]),this._lineType},set:function(e){this._lineType=e,d(this,["lineType"])}},{key:"tabs",get:function(){var t=this;return(0===this.dimensions.length?[]:0<this.standardLines.length?["Standard"].concat(this.dimensions):this.dimensions).map(function(e){return{name:e,label:t.editorModel.i18n.l(e)}})}},{key:"groupMD",get:function(){return this.editorModel.md.fieldsMap[this.constants.QUOTE_LINE_GROUP]}},{key:"standardLineColumnWidths",get:function(){return this.colWidth.Standard}},{key:"groupKey",get:function(){return this.groupVO.key}},{key:"serviceModel",get:function(){return{keys:[this.groupKey],favIds:[this.groupVO.record[this.constants.FAVORITE_ID_FIELD]]}}},{key:"flattenedRows",get:function(){var t=this.lineType===this.constants.TYPE_STANDARD?this.constants.STANDARD_LINE:this.constants.SEGMENTED_LINE,e=t===this.constants.STANDARD_LINE?this.standardLines:this.segmentedLinesByDimension[this.lineType];return[{rowType:this.constants.GROUP_HEADER,model:this}].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(e.map(function(e){return{rowType:t,model:e}})),[{rowType:this.constants.GROUP_FOOTER,model:this}])}},{key:"modelType",get:function(){return"GroupModel"}}]),p=o)),e("GroupModel",p)}}}),System.register("quotes/models/JSQCNotifier.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.lineEditorComponent=e,this.editorModel=this.lineEditorComponent.editorModel,this.indexByGroupKey=this.editorModel.quoteModel.indexByGroupKey,this.fieldNameSet=this.lineEditorComponent.editorModel.fieldNameSet,this.propertyNameSet=new Set,this.propertyNameSet.add("multiSegmentRowTotals"),this.propertyNameSet.add("multiSegmentColumnTotals"),this.propertyNameSet.add("netMultiSegmentTotal"),this.propertyNameSet.add("summaries"),this.propertyNameSet.add("fieldVisibility"),this.propertyNameSet.add("fieldEditability"),this.pathNameSet=new Set(this.fieldNameSet);var t=!0,i=!1,n=void 0;try{for(var o,r=this.propertyNameSet[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.pathNameSet.has(s)||this.pathNameSet.add(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.constants=this.editorModel.constants,this.pathsToNotify={},this.originalPathValues={},this.pathsToSet={},this.groupModels=this.editorModel.quoteModel.lineGroups,this.quoteVO=this.editorModel.quoteModel.quoteVO}e("JSQCNotifier",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(a,[{key:"notify",value:function(e,t,i,n,o){var r=void 0,s=void 0;if(this.pathNameSet.has(t.split(".").pop()))if("QuoteModel"==e){if(this.notifyPath("editorModel.quoteModel.quoteVO."+t,i,o,e),"multiSegmentRowTotals"==t){if(!i)return;for(var a=0,l=this.groupModels.length;a<l;a++)for(var u=this.groupModels[a].dimensions,d=0,c=u.length;d<c;d++)for(var h=0,f=this.groupModels[a].segmentedLinesByDimension[u[d]].length;h<f;h++){var p=this.groupModels[a].segmentedLinesByDimension[u[d]][h].lineVO.record[this.constants.SEGMENT_KEY_FIELD];this.notifyPath("groupModels."+a+".segmentedLinesByDimension."+u[d]+"."+h+".total",i[p],o,e)}}if(n.grouped)return;var v=this.indexByGroupKey[this.groupModels[0].groupVO.key].index;this.notifySpecificPath(v,t,n,i,o,e)}else if("QuoteLineGroupModel"==e)null!=this.indexByGroupKey[n.key]&&null!=this.indexByGroupKey[n.key].index&&(r=this.indexByGroupKey[n.key].index,this.notifyPath("groupModels."+r+".groupVO."+t,i,o,e),this.notifySpecificPath(r,t,n,i,o,e));else if("QuoteLineModel"==e)if(r=this.indexByGroupKey[n.parentGroupKey].index,s=this.indexByGroupKey[n.parentGroupKey].indexByLineKey[n.key],n.record[this.constants.SEGMENT_KEY_FIELD]){var g=n.parentQuote.multiSegmentKeys[n.record[this.constants.SEGMENT_KEY_FIELD]],y=this.indexByGroupKey[n.parentGroupKey].indexBySegmentKey[n.record[this.constants.SEGMENT_KEY_FIELD]];this.notifyPath("groupModels."+r+".segmentedLinesByDimension."+g+"."+y+".segments."+s+".lineVO."+t,i,o,e),t=="record."+[this.constants.NET_TOTAL_FIELD]&&this.notifyPath("groupModels."+r+".segmentedLinesByDimension."+g+"."+y+"."+n.record[this.constants.SEGMENT_LABEL_FIELD].replace(/\W/g,""),i,o,e)}else this.notifyPath("groupModels."+r+".standardLines."+s+".lineVO."+t,i,o,e)}},{key:"notifySpecificPath",value:function(e,t,i,n,o,r){if("multiSegmentColumnTotals"==t||"netMultiSegmentTotal"==t||"summaries"==t)if("summaries"!=t){if(n)for(var s=i.localizedMultiSegmentColumns?Object.keys(i.localizedMultiSegmentColumns):Object.keys(i.multiSegmentColumnTotals),a=0,l=s.length;a<l;a++){var u="netMultiSegmentTotal"==t?i.netMultiSegmentTotal[s[a]]:i.multiSegmentColumnTotals[s[a]];if("netMultiSegmentTotal"==t)this.set("groupModels."+e+".netMultiSegmentTotal."+s[a],n[s[a]],o,r);else for(var d=Object.keys(u),c=0,h=d.length;c<h;c++)this.set("groupModels."+e+".multiSegmentColumnTotals."+s[a]+"."+d[c],n[s[a]][d[c]],o,r)}}else this.set("groupModels."+e+".summaries",n,o,r)}},{key:"notifyPath",value:function(e,t,i,n){this.originalPathValues.hasOwnProperty(e)||(this.originalPathValues[e]=i),this.pathsToNotify[e]={value:t,root:n}}},{key:"set",value:function(e,t,i,n){this.originalPathValues.hasOwnProperty(e)||(this.originalPathValues[e]=i),this.pathsToSet[e]={value:t,root:n}}},{key:"fireEvent",value:function(e,t){this.lineEditorComponent.fire(e,t)}}]),i=a)),e("JSQCNotifier",i)}}}),System.register("quotes/models/LineModel.js",["common/core/AppContext.js"],function(e,t){var o;return{setters:[function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),e&&(this.lineVO=e,this.groupModel=t,this.selected=!1,this.lineItemDrawerIconClass=this._getLineItemDrawerIconClass(),this.expandedIconClass=this._getExpansionClass(),this.visible=this.isVisibleInLineEditor(),this.hasParent=this.hasParentLine(),this.bundleVisible=!0,this.setItemClassMap(),null==this.lineVO.record[this.constants.PRICING_METHOD_FIELD]&&(this.lineVO.record[this.constants.PRICING_METHOD_FIELD]="List"),this.cellClasses={})}e("LineModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"isDiscountScheduleIdExcluded",value:function(e){return this.editorModel.data.excludedDiscountScheduleIds.hasOwnProperty(e)}},{key:"getFieldMD",value:function(e){return this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName][e]}},{key:"getField",value:function(e){return this.lineVO.record[e]}},{key:"getLineVOProperty",value:function(e){return this.lineVO[e]}},{key:"_getExpansionClass",value:function(){return this.segmented?this.lineVO.expanded?"sf-icon-down":"sf-icon-right":""}},{key:"_hasStandardLineItemDrawer",value:function(){return this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames&&0<this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length&&!this.editorModel.deviceContext.isMobile&&!this.segmented}},{key:"_getLineItemDrawerIconClass",value:function(){return this.segmented||!this.hasStandardLineItemDrawer?"":this.lineVO.expanded?"sf-icon-chevrondown":"sf-icon-chevronright"}},{key:"isEditable",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.lineVO.fieldEditability,i=this.getFieldMD(e);return!!i&&(t&&null!=t[e]?t[e]:("richtextarea"!==i.extraTypeInfo||!this.editorModel.deviceContext.isMobile)&&(i.name==this.constants.QUANTITY_FIELD||i.name==this.constants.ADDITIONAL_QUANTITY_FIELD?i.updateable&&this.quantityEditable:i.name==this.constants.LIST_PRICE_FIELD?i.updateable&&this.listPriceEditable:i.name==this.constants.ADDITIONAL_DISCOUNT_FIELD||i.name==this.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD||i.name==this.constants.ADDITIONAL_DISCOUNT_RATE_FIELD?this.discountable&&this.discountEditable:i.name==this.constants.PARTNER_DISCOUNT_FIELD?!this.nonPartnerDiscountable&&this.partnerDiscountEditable:i.name==this.constants.DISTRIBUTOR_DISCOUNT_FIELD?this.discountEditable:i.name==this.constants.UPLIFT_FIELD?i.updateable&&this.lineVO.upliftable:i.name==this.constants.UNIT_COST_FIELD?i.updateable&&this.unitCostEditable:i.name==this.constants.CUSTOMER_PRICE_FIELD?i.updateable&&this.pricingMethodCustom:i.name==this.constants.PRICING_METHOD_FIELD?i.updateable&&!this.pricingMethodDisabled:i.name==this.constants.MARKUP_FIELD?!this.bundled&&this.pricingMethodCost&&this.discountEditable:i.name!=this.constants.NET_PRICE_FIELD&&i.name!=this.constants.PARTNER_PRICE_FIELD&&(i.name==this.constants.DESCRIPTION_FIELD?!this.descriptionLocked:i.name!=this.constants.PACKAGE_PRODUCT_CODE_FIELD&&i.name!=this.constants.PRORATED_LIST_PRICE_FIELD&&i.name!=this.constants.REGULAR_PRICE_FIELD&&("Evergreen"!==this.lineVO.record[this.constants.SUBSCRIPTION_TYPE_FIELD]||i.name!==this.constants.SUBSCRIPTION_TERM_FIELD&&i.name!==this.constants.END_DATE_FIELD)&&(i.name==this.constants.START_DATE_FIELD||i.name==this.constants.END_DATE_FIELD?this.subscription&&(!this.isMDQ||this.isCustomDimension):i.name===this.constants.SUBSCRIPTION_SCOPE_FIELD?i.updateable&&this.subscriptionScopeEditable:i.name!=this.constants.PRICING_GUIDANCE_FIELD&&!!i&&i.updateable))))}},{key:"isFieldRendered",value:function(e,t){if(this.lineVO.fieldVisibility&&null!=this.lineVO.fieldVisibility[e])return this.lineVO.fieldVisibility[e];var i=this.getFieldMD(e);return i&&i.name==this.constants.SUBSCRIPTION_TERM_FIELD?this.subscription:!i||"richtextarea"!==i.extraTypeInfo||!t||this.lineVO.record[e]&&t}},{key:"isVisibleInLineEditor",value:function(){var e=null==this.lineVO.componentVisibility||""==this.lineVO.componentVisibility||"Always"==this.lineVO.componentVisibility||"Editor Only"==this.lineVO.componentVisibility;return!(e&&null!=this.lineVO.record[this.constants.RENEWED_ASSET_ID_FIELD]&&this.quoteModel.isRenewal&&this.editorModel.data.settings.renewedAssetsHiddenWhenEditing)&&e}},{key:"hasParentLine",value:function(){return null!==this.lineVO.parentItemKey}},{key:"addToSegmentsArray",value:function(e){this.segments||(this.segments=[]),this.segments.push(e)}},{key:"removeFromSegmentsArray",value:function(e){this.segments.splice(this.segments.indexOf(e),1),0===this.segments.length&&delete this.segments}},{key:"addToSegmentsByLabel",value:function(e,t){this.segmentsByLabel||(this.segmentsByLabel={}),this.segmentsByLabel[e]=t}},{key:"removeFromSegmentsByLabel",value:function(e){this.segmentsByLabel[e]&&delete this.segmentsByLabel[e],0==Object.keys(this.segmentsByLabel).length&&delete this.segmentsByLabel}},{key:"setLineTypeClass",value:function(){return this.bundle?"parent-line":this.component?"component":"standalone"}},{key:"setItemClassMap",value:function(){var e=this.editorModel.deviceContext.isMobile,t={};for(var i in this.lineVO.record)this.isFieldRendered(i,e)||(t[i]=e?"hiddenInMobile":"hiddenInDesktop"),this.segmented&&(t[i]?t[i]+=" mdqSummaryRow":t[i]="mdqSummaryRow"),t.total="hiddenInMobile";for(var n=this.standardLineDrawerFieldNames||[],o=0;o<n.length;o++){var r=n[o];this.lineVO.record[r]||this.isFieldRendered(r,e)||(t[r]=e?"hiddenInMobile":"hiddenInDesktop")}this.itemClassMap=t}},{key:"editorModel",get:function(){return this.quoteModel.editorModel}},{key:"quoteModel",get:function(){return this.groupModel.quoteModel}},{key:"constants",get:function(){return this.editorModel.constants}},{key:"fieldNames",get:function(){return this.constants}},{key:"component",get:function(){return null!=this.lineVO.record[this.constants.OPTION_LEVEL_FIELD]}},{key:"subscription",get:function(){return null!=this.lineVO.record[this.constants.SUBSCRIPTION_PRICING_FIELD]}},{key:"isMDQ",get:function(){return null!=this.lineVO.record[this.constants.SEGMENT_LABEL_FIELD]}},{key:"dynamicSubscription",get:function(){return"Percent Of Total"==this.lineVO.record[this.constants.SUBSCRIPTION_PRICING_FIELD]}},{key:"isCustomDimension",get:function(){return!!this.lineVO.record[this.constants.SEGMENT_KEY_FIELD]&&"Custom"===this.quoteModel.quoteVO.multiSegmentKeys[this.lineVO.record[this.constants.SEGMENT_KEY_FIELD]]}},{key:"dynamic",get:function(){return"Percent Of Total"==this.lineVO.record[this.constants.SUBSCRIPTION_PRICING_FIELD]||"Percent Of Total"==this.lineVO.record[this.constants.PRICING_METHOD_FIELD]}},{key:"isBundle",get:function(){return this.bundle&&this.quoteModel.linesByParentItemKey[this.lineVO.key]}},{key:"subscriptionScopeEditable",get:function(){return this.dynamic&&null==this.lineVO.record[this.constants.COMPONENT_SUBSCRIPTION_SCOPE_FIELD]&&null==this.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD]}},{key:"rootPackage",get:function(){return(this.bundle||this.lineVO.productPullIns&&(this.lineVO.productPullIns.hasConfiguration||this.lineVO.productPullIns.hasConfigurationAttributes))&&!this.component}},{key:"legacySupport",get:function(){return!(1==this.lineVO.record[this.constants.RENEWAL_CHECKBOX]&&1!=this.lineVO.record[this.constants.EXISTING_FIELD]&&null==this.lineVO.record[this.constants.PRIOR_QUANTITY_FIELD])||this.editorModel.data.settings.renewalQuotesWithoutAssetsAllowed}},{key:"quantityEditable",get:function(){return(null==this.lineVO.record[this.constants.BUNDLED_QUANTITY_FIELD]||!this.component)&&this.legacySupport&&this.lineVO.productQuantityEditable||1==this.lineVO.quantityEditable}},{key:"costEditable",get:function(){return 1==this.lineVO.record[this.constants.COST_EDITABLE_FIELD]}},{key:"unitCostEditable",get:function(){return this.costEditable&&!this.bundled&&!this.dynamic}},{key:"pricingMethodList",get:function(){return"List"==this.lineVO.record[this.constants.PRICING_METHOD_FIELD]}},{key:"pricingMethodCustom",get:function(){return"Custom"==this.lineVO.record[this.constants.PRICING_METHOD_FIELD]}},{key:"pricingMethodCost",get:function(){return"Cost"==this.lineVO.record[this.constants.PRICING_METHOD_FIELD]}},{key:"pricingMethodDisabled",get:function(){return this.dynamicSubscription||this.bundled||!this.lineVO.record[this.constants.PRICING_METHOD_EDITABLE_FIELD]}},{key:"bundled",get:function(){return 1==this.lineVO.record[this.constants.BUNDLED_FIELD]}},{key:"bundle",get:function(){return 1==this.lineVO.record[this.constants.BUNDLE_FIELD]}},{key:"nonDiscountable",get:function(){return 1==this.lineVO.record[this.constants.NON_DISCOUNTABLE_FIELD]}},{key:"nonPartnerDiscountable",get:function(){return 1==this.lineVO.record[this.constants.NON_PARTNER_DISCOUNTABLE_FIELD]}},{key:"partnerDiscountEditable",get:function(){return!this.quoteModel.isAmendmentOrChangeQuote||!this.existing}},{key:"componentDiscountedByPackage",get:function(){return 1==this.lineVO.record[this.constants.COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD]}},{key:"discountable",get:function(){return!(this.bundled||this.nonDiscountable||this.pricingMethodCustom||this.componentDiscountedByPackage)}},{key:"discountEditable",get:function(){return!this.quoteModel.isAmendmentOrChangeQuote||!this.existing}},{key:"removable",get:function(){return!this.component&&(!this.quoteModel.isAmendment||this.quoteModel.isAmendment&&!this.existing)}},{key:"configurable",get:function(){return this.rootPackage&&!this.lineVO.reconfigurationDisabled&&"Disabled"!=this.lineVO.configurationType&&(null==this.lineVO.configurationEvent||"Always"==this.lineVO.configurationEvent||"Edit"==this.lineVO.configurationEvent)}},{key:"listPriceEditable",get:function(){return this.lineVO.record[this.constants.PRICE_EDITABLE_FIELD]&&!this.bundled&&!this.dynamicSubscription&&this.pricingMethodList}},{key:"segmented",get:function(){return null!=this.lineVO.record[this.constants.SEGMENT_KEY_FIELD]}},{key:"favorite",get:function(){return!this.component&&null!=this.lineVO.record[this.constants.FAVORITE_ID_FIELD]}},{key:"existing",get:function(){return this.lineVO.record[this.constants.EXISTING_FIELD]}},{key:"descriptionLocked",get:function(){return this.lineVO.descriptionLocked}},{key:"hasStandardLineItemDrawer",get:function(){return this._hasStandardLineItemDrawer()}},{key:"asset",get:function(){return null!=this.lineVO.record[this.constants.RENEWED_ASSET_ID_FIELD]}},{key:"renewal",get:function(){return this.lineVO.record[this.constants.RENEWAL_CHECKBOX]}},{key:"hasSubscribedAssetIds",get:function(){return null!=this.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD]}},{key:"isAsset",get:function(){return null!=this.lineVO.record[this.constants.UPGRADED_ASSET_FIELD]}},{key:"isDeltaQty",get:function(){return!this.existing||this.existing&&!this.renewal&&(this.lineVO.record[this.constants.UPGRADED_ASSET_FIELD]||this.asset)}},{key:"standardLineFieldNames",get:function(){return this.groupModel.standardLineFieldNames}},{key:"standardLineDrawerFieldNames",get:function(){return this.groupModel.standardLineDrawerFieldNames}},{key:"standardLineColumnWidths",get:function(){return this.editorModel.layout.colWidths[this.groupModel.groupKey].Standard}},{key:"serviceModel",get:function(){var e=[];if(this.segments)for(var t=0,i=this.segments.length;t<i;t++)e.push(this.segments[t].lineVO.key);else e.push(this.lineVO.key);return{keys:e,segmentKey:this.getField(this.constants.SEGMENT_KEY_FIELD),segmented:this.segmented,updateCustomSegments:!1,favIds:[this.getField(this.constants.FAVORITE_ID_FIELD)],scheduleId:this.getField(this.constants.DISCOUNT_SCHEDULE_FIELD)}}},{key:"modelType",get:function(){return"LineModel"}}],[{key:"recordPath",get:function(){return"lineModel.lineVO.record"}}]),o=i)),e("LineModel",o)}}}),System.register("quotes/models/MDQSegmentHelper.js",["quotes/models/LineModel.js"],function(e,t){var o;return{setters:[function(e){e.LineModel}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.MONTHLY_DIM="Month",this.YEARLY_DIM="Year",this.QUARTERLY_DIM="Quarter",this.editorModel=e,this.groupModelsByKey=t,this.prefix=e.developerPrefix,this.START_DATE_FIELD=this.prefix+"StartDate__c",this.END_DATE_FIELD=this.prefix+"EndDate__c",this.SUBSCRIPTION_TERM_FIELD=this.prefix+"SubscriptionTerm__c",this.LINES_GROUPED_FIELD=this.prefix+"LineItemsGrouped__c",this.SEGMENT_KEY_FIELD=this.prefix+"SegmentKey__c",this.SEGMENT_INDEX_FIELD=this.prefix+"SegmentIndex__c",this.SEGMENT_LABEL_FIELD=this.prefix+"SegmentLabel__c",this.FIRST_SEGMENT_END_DATE_FIELD=this.prefix+"FirstSegmentTermEndDate__c",this.TYPE_FIELD=this.prefix+"Type__c",this.EXISTING_FIELD=this.prefix+"Existing__c",this._segmentsChanged=!1}e("MDQSegmentHelper",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"updateSegments",value:function(){var t=this.editorModel.quote;return this._hasMultiSegmentLines(t)&&(t.grouped||t.record[this.LINES_GROUPED_FIELD]?t.lineItemGroups.forEach(function(e){this._adjustSegments(t,e)},this):this._adjustSegments(t,null)),this._segmentsChanged}},{key:"_hasMultiSegmentLines",value:function(e){for(var t=e.lineItems.length,i=0;i<t;i++)if(null!=e.lineItems[i].record[this.SEGMENT_KEY_FIELD])return!0;return!1}},{key:"_adjustSegments",value:function(e,t){var i=this._calculateSubscriptionTerm(e,t),n=t?e.lineItems.filter(function(e){return e.parentGroupKey===t.key}):e.lineItems;this._calculateSegmentDeltasAndModifySegments(e,t,n,i,this.YEARLY_DIM),this._calculateSegmentDeltasAndModifySegments(e,t,n,i,this.MONTHLY_DIM),this._calculateSegmentDeltasAndModifySegments(e,t,n,i,this.QUARTERLY_DIM)}},{key:"_calculateSubscriptionTerm",value:function(e,t){var i=t&&t.record[this.START_DATE_FIELD]||e.record[this.START_DATE_FIELD],n=t&&t.record[this.END_DATE_FIELD]||e.record[this.END_DATE_FIELD],o=t&&null!=t.record[this.SUBSCRIPTION_TERM_FIELD]?t.record[this.SUBSCRIPTION_TERM_FIELD]:e.record[this.SUBSCRIPTION_TERM_FIELD],r=i?new Date(i):null,s=n?new Date(n):null,a=e.record[this.FIRST_SEGMENT_END_DATE_FIELD],l=a?new Date(a):null;if(l){r=r||new Date,s||(s=new Date(r.getTime()),this.editorModel.settings.subscriptionTermUnitIsDay?s.setUTCDate(s.getUTCDate()+o-1):(SB.addMonths(s,o),s.setUTCDate(s.getUTCDate()-1)));var u=new Date(l.getTime());return u.setUTCDate(u.getUTCDate()+1),s.setDate(s.getDate()+1),this.editorModel.settings.subscriptionTermUnitIsDay?SB.daysBetween(u,s):SB.monthsBetweenRoundPartialUp(u,s)}return r&&s?(s.setDate(s.getDate()+1),this.editorModel.settings.subscriptionTermUnitIsDay?SB.daysBetween(r,s):SB.monthsBetweenRoundPartialUp(r,s)):o}},{key:"_calculateSegmentDeltasAndModifySegments",value:function(e,t,i,n,o){var r=this._calculateSegmentDeltas(e,i,n,o);0!=r.size&&this._modifySegmentsBasedOnDelta(e,t,r,o)}},{key:"_calculateSegmentDeltas",value:function(s,a,l,u){var d=this.editorModel.settings.subscriptionTermUnitIsDay;l=null==l?d?365:12:l;var e=function(){for(var e=new Map,t=a.length,i=0;i<t;i++){var n=a[i];if(n.dimensionType==u){var o=n.record[this.SEGMENT_KEY_FIELD],r=e.get(o)||0;e.set(o,r+1)}}return e}.bind(this)(),i=function(){var e=0,t=s.record[this.FIRST_SEGMENT_END_DATE_FIELD],i=t?new Date(t):null;if(i){e=1;var n=new Date(i.getTime());n.setUTCDate(n.getUTCDate()+1)}if(d){var o=n||new Date(this.editorModel.quote.record[this.START_DATE_FIELD]),r=this.editorModel.quote.record[this.END_DATE_FIELD]?new Date(this.editorModel.quote.record[this.END_DATE_FIELD]):new Date(o.setUTCDate(o.getUTCDate()+l));l=SB.monthsBetween(o,r),o.setUTCMonth(o.getUTCMonth()+l),o.setUTCDate(o.getUTCDate()-1),o<r&&(l+=1)}switch(u){case this.YEARLY_DIM:e+=Math.ceil(l/12);break;case this.QUARTERLY_DIM:e+=Math.ceil(l/3);break;case this.MONTHLY_DIM:e+=l}return e}.bind(this)(),n=new Map;return e.forEach(function(e,t){n.set(t,i-e)}),n}},{key:"_modifySegmentsBasedOnDelta",value:function(p,e,t,v){t.forEach(function(e,t){var i=this._getLastSegmentFromQuote(p,t,v),n=0===e,o="Amendment"===p.record[this.TYPE_FIELD]&&i.record[this.EXISTING_FIELD],r=i.record[this.START_DATE_FIELD],s=i.record[this.END_DATE_FIELD],a=r?new Date(r):null,l=s?new Date(s):null;if(!n&&!o)if(0<e&&a<=l){this._segmentsChanged=!0;for(var u=1;u<=e;u++){var d=this._createNewSegment(p,i,u);p.lineItems.push(d),this.groupModelsByKey&&this.groupModelsByKey[d.parentGroupKey].processQuoteLines(d)}}else if(e<0){this._segmentsChanged=!0;for(var c=0;e<c;c--){var h=this._getLastSegmentFromQuote(p,t,v);if(this._removeSegment(p,h),this.groupModelsByKey){var f=this.groupModelsByKey[h.parentGroupKey].segmentedLinesBySegmentKey[t];f.segments.splice(f.segments.length-1,1)}}}},this)}},{key:"_getLastSegmentFromQuote",value:function(e,i,n){var o=null,r=null;return e.lineItems.forEach(function(e){if(e.record[this.SEGMENT_KEY_FIELD]===i&&e.dimensionType===n){var t=e.record[this.SEGMENT_INDEX_FIELD];null!=t&&(null==r||r<t)&&(r=t,o=e)}},this),o}},{key:"_createNewSegment",value:function(e,t,i){var n=JSON.parse(JSON.stringify(t));n.key=++e.nextKey,n.record.Id=null,n.record[this.SEGMENT_KEY_FIELD]=t.record[this.SEGMENT_KEY_FIELD],n.record[this.SEGMENT_INDEX_FIELD]=t.record[this.SEGMENT_INDEX_FIELD]+i;var o=n.record[this.SEGMENT_INDEX_FIELD]<10?"  ":" ";return n.record[this.SEGMENT_LABEL_FIELD]=t.dimensionType+o+n.record[this.SEGMENT_INDEX_FIELD],n}},{key:"_removeSegment",value:function(e,t){for(var i=e.lineItems.length,n=0;n<i;n++){var o=e.lineItems[n];if(o.key===t.key)return e.lineItems=e.lineItems.slice(0,n).concat(e.lineItems.slice(n+1,i)),void(e.deletedLineIds&&o.record&&o.record.Id&&e.deletedLineIds.push(o.record.Id))}}}]),o=i)),e("MDQSegmentHelper",o)}}}),System.register("quotes/models/QuoteMessenger.js",[],function(e,t){var o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.editorModel=e,this.targetRecord=t}e("QuoteMessenger",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"getRequest",value:function(){return{target:this.targetRecord,quote:this.editorModel.quoteModel.quoteVO.record,lines:[],actions:[]}}},{key:"getResponse",value:function(e){if(e)switch(e.actions[0].toLowerCase().replace(" ","")){case"save":return{lines:e.lines,action:"save"};case"quicksave":return{lines:e.lines,action:"quicksave"};case"reload":return{lines:e.lines,action:"reload"};case"none":default:return{lines:e.lines,action:"none"}}}}]),o=i)),e("QuoteMessenger",o)}}}),System.register("quotes/models/QuoteModel.js",["quotes/models/EditorModel.js","quotes/models/GroupModel.js","quotes/models/LineModel.js","quotes/QuoteContext.js","quotes/models/UiNotifier.js","common/core/AppContext.js","quotes/models/ClientCache.js"],function(e,t){var i,C,S,k,O,r,s,E,o;return{setters:[function(e){i=e.getSubchange},function(e){C=e.GroupModel},function(e){e.LineModel},function(e){e.QuoteContext},function(e){S=e.register,k=e.notify},function(e){O=e.AppContext},function(e){r=e.get,s=e.put}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t){var i=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_),this.quoteVO=e,this.editorModel=t,this.grouped=e.record[this.constants.GROUP_LINE_ITEMS_FIELD],this.groupsByKey={},this.lineModelsByKey={},this.indexByGroupKey={},this.lineGroups=[],this.linesByParentItemKey={},this.standardLinesByParentItemKey={},this.segmentedLinesByParentItemKey={},this.selectedLinesByKey={},this.allOptional=!0,this.isPrimary=this.quoteVO.record[this.constants.PRIMARY_FIELD],this.isRenewal=this.quoteVO.record[this.constants.TYPE_FIELD]===E.RENEWAL,this.isAmendment=this.quoteVO.record[this.constants.TYPE_FIELD]===E.AMENDMENT,this.isChangeQuote=this.quoteVO.record[this.constants.TYPE_FIELD]===E.CHANGE_ORDER,this.isAmendmentOrChangeQuote=this.isAmendment||this.isChangeQuote,this.hasConsumptionSchedules=this.quoteVO.hasConsumptionSchedules,this.grouped&&0==this.quoteVO.lineItemGroups.length){var n={Name:"Group1"};n[this.constants.prefix+"Number__c"]=1;var o={key:++this.quoteVO.nextKey,record:n,multiSegmentColumns:{},localizedMultiSegmentColumns:{}},r=new C(o,this);this.quoteVO.lineItemGroups.push(o),this.groupsByKey[r.groupVO.key]=r,this.indexByGroupKey[r.groupVO.key]={index:Object.keys(this.indexByGroupKey).length,indexByLineKey:{},indexBySegmentKey:{}};for(var s=this.quoteVO.lineItems,a=0;a<s.length;a++){s[a].parentGroupKey=r.groupVO.key}}for(var l=this.grouped?this.quoteVO.lineItemGroups:[{key:null,record:{}}],u=0,d=l.length;u<d;u++){var c=new C(l[u],this);this.lineGroups.push(c),this.groupsByKey[c.groupVO.key]=c,this.indexByGroupKey[c.groupVO.key]={index:u,indexByLineKey:{},indexBySegmentKey:{}},this.quoteVO.nextGroupKey=c.groupVO.key+1}var h=!0,f=!1,p=void 0;try{for(var v,g=this.quoteVO.lineItems[Symbol.iterator]();!(h=(v=g.next()).done);h=!0){var y=v.value;y.record[this.constants.OPTIONAL_FIELD]||(this.allOptional=!1),this.groupsByKey[y.parentGroupKey].processQuoteLines(y)}}catch(e){f=!0,p=e}finally{try{!h&&g.return&&g.return()}finally{if(f)throw p}}O.isBundleCollapsible(this.editorModel)&&this._setBundleExpansionStates();function m(){b&&setTimeout(function(){k(i,["flattenedRows"]),b=!0},0),b=!1}var b=!0;S(this,function(e){"lineGroups"===e[0]&&m()}),this.lineGroups.forEach(function(e){S(e,function(e){"flattenedRows"===e[0]&&m()})})}E={RENEWAL:"Renewal",AMENDMENT:"Amendment",CHANGE_ORDER:"Re-Quote"},e("QuoteModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(_,[{key:"getFieldMD",value:function(e){return this.quoteMD[e]}},{key:"renumberIndexes",value:function(e){for(var t=0,i=this.lineGroups.length;t<i;t++){var n=this.lineGroups[t].groupKey;this.indexByGroupKey[n].index=t,e&&(this.lineGroups[t].renumberStandardIndexes(),this.lineGroups[t].renumberSegmentedIndexes())}}},{key:"renumber",value:function(){for(var e=1,t=3e3,i=0,n=this.lineGroups.length;i<n;i++){for(var o=this.lineGroups[i],r=0,s=o.dimensions.length;r<s;r++)for(var a=o.dimensions[r],l=o.segmentedLinesByDimension[a],u=0,d=l.length;u<d;u++){var c=l[u].segments;if(l[u].visible){this.lineGroups[i].segmentedLinesByDimension[a][u].lineVO.record[this.constants.NUMBER_FIELD]=e;for(var h=0,f=c.length;h<f;h++)c[h].lineVO.record[this.constants.NUMBER_FIELD]=e;e++}else{l[u].lineVO.record[this.constants.NUMBER_FIELD]=t;for(var p=0,v=c.length;p<v;p++)c[p].lineVO.record[this.constants.NUMBER_FIELD]=t;t++}}for(var g=0,y=o.standardLines.length;g<y;g++)o.standardLines[g].visible?(this.lineGroups[i].standardLines[g].lineVO.record[this.constants.NUMBER_FIELD]=e,e++):(o.standardLines[g].lineVO.record[this.constants.NUMBER_FIELD]=t,t++)}}},{key:"toggleOptional",value:function(t,e){this._callChildren(e,function(e){e.toggleOptional(t)})}},{key:"resetDiscounts",value:function(e){this._callChildren(e,function(e){e.resetDiscounts()})}},{key:"_callChildren",value:function(e,t){e?t(this.groupsByKey[e]):this.lineGroups.forEach(t)}},{key:"notifyUi",value:function(e){var t="lineGroups"===e[0]?i(e,this,2):null;null!==t?t.target.notifyUi(t.path):k(this,e)}},{key:"setHiddenFromPSPClass",value:function(){var e={};for(var t in this.quoteVO.fieldVisibility)0==this.isFieldVisible(t)&&(e[t]="hiddenFromPSP");return e}},{key:"isFieldVisible",value:function(e){if(this.quoteVO.fieldVisibility&&null!=this.quoteVO.fieldVisibility[e])return this.quoteVO.fieldVisibility[e]}},{key:"_setBundleExpansionStates",value:function(){var o=this;Object.keys(this.lineModelsByKey).forEach(function(e){var t=o.lineModelsByKey[e];if(t.isBundle){var i="l"+t.lineVO.key,n=r("BundleCollapsed",[i]);t.bundleCollapsed=null!=n?n:"Collapsed"===O.defaultBundleSetting,s("BundleCollapsed",[i],t.bundleCollapsed),t.bundleCollapsed&&t.bundleVisible&&o._hideTree(t)}})}},{key:"_hideTree",value:function(e){var t=this,i=e.isBundle;i&&i.forEach(function(e){e.bundleVisible=!1,t.linesByParentItemKey[e.lineVO.key]&&t._hideTree(e)})}},{key:"constants",get:function(){return this.editorModel.constants}},{key:"quoteMD",get:function(){return this.editorModel.md.fieldsMap[this.editorModel.data.quoteObjectName]}},{key:"flattenedRows",get:function(){var e;return(e=[]).concat.apply(e,function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(this.lineGroups.map(function(e){return e.flattenedRows})))}},{key:"modelType",get:function(){return"QuoteModel"}}]),o=_)),e("QuoteModel",o)}}}),System.register("quotes/models/SafeClientCache.js",["common/core/AppContext.js","common/Util.js","quotes/models/ClientCache.js","quotes/models/ClientModels.js"],function(e,t){var u,i,d,c,n;return{setters:[function(e){u=e.localizeContent},function(e){i=e.mergeRec},function(e){d=e},function(e){c=e.TYPES}],execute:function(){function r(e,t){if(!e.hasOwnProperty(t))throw new Error("Metadata type does not exist.");return e[t]}function s(e,t){if(!e.fields||!e.fields.hasOwnProperty(t))throw new Error("Field does not exist in metadata.");return e.fields[t]}function a(e,t){var i=e.type;if(i&&(void 0===t?"undefined":n(t))!==i)throw new Error("Given type does not match field metadata.")}function l(e,t){if(e.required&&(null==t||""===t))throw new Error("Field is required to have a value set.")}n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e("put",function(e,t,i){var n=s(r(c,e),t);a(n,i),l(n,i);var o=n.localizable?u(i):i;d.put(e,[t],o)}),e("clear",function(e,t){d.put(e,[t],null)}),e("get",function(e,t){return d.get(e,[t])}),e("getOnce",function(e,n){return new Promise(function(t){var i=d.observe(e,n,function(e){setTimeout(function(){i()}),t(e)})})}),e("merge",function(e){for(var t in e)d.put(t,[],i(d.get(t,[]),e[t]))}),e("_getFieldTypeMD",r),e("_getFieldMD",s),e("_typeCheck",a),e("_requiredCheck",l)}}}),System.register("quotes/models/SortLinesHandler.js",["quotes/models/Constants.js"],function(e,t){var i,o;return{setters:[function(e){i=e.Constants}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.constants=new i(e)}e("SortLinesHandler",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"sortLineItems",value:function(e,r){return e.sort(function(e,t){if(e.lineSortValue=e.record[r],t.lineSortValue=t.record[r],null!=e.lineSortValue&&null!=t.lineSortValue&&e.lineSortValue!=t.lineSortValue){var i=e.lineSortValue-t.lineSortValue;return i==i?i:e.lineSortValue<t.lineSortValue?-1:1}if(e.lineSortValue!=t.lineSortValue)return null==e.lineSortValue?-1:null==t.lineSortValue?1:e.record[this.constants.NUMBER_FIELD]-t.record[this.constants.NUMBER_FIELD];var n=e.record[this.constants.SEGMENT_INDEX_FIELD],o=t.record[this.constants.SEGMENT_INDEX_FIELD];return n==o?e.record[this.constants.NUMBER_FIELD]-t.record[this.constants.NUMBER_FIELD]:null==n?-1:null==o?1:n-o}.bind(this)),e}}]),o=t)),e("SortLinesHandler",o)}}}),System.register("quotes/models/UiNotifier.js",[],function(t,e){var n,r;return{setters:[],execute:function(){function e(e,t){n.has(e)||n.set(e,new Set);var i=n.get(e);return i.add(t),function(){i.delete(t)}}function o(e,t){n.has(e)&&n.get(e).forEach(function(e){e(t)})}n=new Map,t("register",e),t("notify",o),r=new Map,t("registerComponent",function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"model";r.has(t)&&r.get(t)(),r.set(t,e(t[i],function(e){t.notifyPath([i].concat(e).join("."))}))}),t("setThenNotify",function(e,t,i){var n=t.length-1;t.slice(0,n).reduce(function(e,t){return e[t]},e)[t[n]]=i,o(e,t)})}}}),System.register("quotes/precaching/IdConverter.js",[],function(e,t){var i;function n(e){if(e){if(18===e.length)return e;if(15!==e.length)return null;var t=o(e.slice(0,5)),i=o(e.slice(5,10)),n=o(e.slice(10,15));return e+t+i+n}return null}function o(e){return i[function(e){return e.replace(/[^A-Z]/g,"0").replace(/[A-Z]/g,"1")}(function(e){return e.split("").reverse().join("")}(e))]}return{setters:[],execute:function(){module.exports=n,i={"00000":"A","00001":"B","00010":"C","00011":"D","00100":"E","00101":"F","00110":"G","00111":"H","01000":"I","01001":"J","01010":"K","01011":"L","01100":"M","01101":"N","01110":"O","01111":"P",1e4:"Q",10001:"R",10010:"S",10011:"T",10100:"U",10101:"V",10110:"W",10111:"X",11e3:"Y",11001:"Z",11010:"0",11011:"1",11100:"2",11101:"3",11110:"4",11111:"5"}}}}),System.register("quotes/precaching/JSQCPrecacheWorker.js",[],function(e,t){return{setters:[],execute:function(){self.addEventListener("message",function(e){(new Date).getTime();importScripts("//cdnjs.cloudflare.com/ajax/libs/jsforce/1.7.0/jsforce.min.js"),importScripts("https://www.promisejs.org/polyfills/promise-7.0.4.min.js");var t=new jsforce.Connection({sessionId:e.data.sessionId,instanceUrl:e.data.siteUrl});t.oik=e.data.oik;var i=function(s){function n(e,n,o,r){return new Promise(function(t,i){s.load(e,n,o||"",r).then(function(e){t(e)},function(e){i(e.message||e)})})}return{read:function(e,n,o){return new Promise(function(t,i){s.read(e,n,o).then(function(e){t(e)},function(e){i(e.message||e)})})},load:n,md:function(e,t,i){return n(i,"MetaDataServiceProvider.FieldMetaDataLoader",null,{fields:t})},setOptions:function(e){s.setOptions(e)}}}(require("./PrecacheRestClient.js")(t,e.data.orgUrl,e.data.siteUrl,e.data.proxyUrl)),n=e.data.precacheSequence,o=function(e){return{PriceRuleSequence:require("./PrecacheSequenceRunners/PriceRuleSequenceRunner.js"),MetadataSequence:require("./PrecacheSequenceRunners/MetadataSequenceRunner.js"),OptionSequence:require("./PrecacheSequenceRunners/OptionSequenceRunner.js"),DiscountAndAccountSequence:require("./PrecacheSequenceRunners/DiscountScheduleSequenceRunner.js"),ProductSequence:require("./PrecacheSequenceRunners/ProductSequenceRunner.js"),RelatedRecordSequence:require("./PrecacheSequenceRunners/RelatedRecordSequenceRunner.js"),UbpSequence:require("./PrecacheSequenceRunners/UbpSequenceRunner.js"),PricingGuidanceSequence:require("./PrecacheSequenceRunners/PricingGuidanceSequenceRunner.js")}[e]||null}(n);o||(self.postMessage({failure:!0,sequence:n,msg:"Unrecognized sequence"}),close());var r=function(e,t,i,n){var o=[t,i.prefix,n];switch(e){case"PriceRuleSequence":return o.concat([i.accountId]);case"MetadataSequence":return o.concat([i.referencedFieldMap,i.settings]);case"DiscountAndAccountSequence":return o.concat([i.quote,i.accountId]);case"RelatedRecordSequence":return o.concat([i.quote,i.lookupFieldMap,i.referencedFieldMap]);case"ProductSequence":case"OptionSequence":return o.concat([i.quote,i.referencedFields]);case"UbpSequence":return o.concat([i.quote,i.settings]);case"PricingGuidanceSequence":return o.concat([i.quote,i.accountId,i.settings]);default:return null}}(n,i,e.data,self.postMessage);o.apply(null,r).executeSequence().then(function(){close()})})}}}),System.register("quotes/precaching/JSQCPrecacheWorkerManager.js",["quotes/models/Constants.js"],function(e,t){var i,o;return{setters:[function(e){i=e.Constants}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=e,this.orgUrl=this.data.settings.orgUrl,this.siteUrl=this.data.settings.siteUrl,this.proxyUrl=this.data.settings.proxyUrl,this.oik=this.data.settings.oik,this.prefix=this.data.developerPrefix?this.data.developerPrefix.slice(0,this.data.developerPrefix.indexOf("_")):"",this.constants=new i(this.data.developerPrefix),this.filePath=this.siteUrl+"/resource/"+(new Date).getTime()+"/"+this.data.developerPrefix+"PrecacherUI2"}e("JSQCPrecacheWorkerManager",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"beginPrecaching",value:function(){this.sessionId=window.sb.vfSessionId,this._spoolWorkers()}},{key:"_spoolWorkers",value:function(){var e=this.data.quote.record[this.constants.ACCOUNT_ID_FIELD],o=this.data.settings,t=this.data.quote,i=this.data.settings.referencedFieldMap,n=this._createWorker(),r=this._createWorkerContext("PriceRuleSequence",new Map([["accountId",e]]));n.postMessage(r);var s=this._createWorker(),a=this._createWorkerContext("MetadataSequence",new Map([["referencedFieldMap",i],["settings",o]]));s.postMessage(a);var l=this._createWorker(),u=this._createWorkerContext("DiscountAndAccountSequence",new Map([["accountId",e],["quote",t]]));l.postMessage(u);var d=this._createWorker(),c={quoteLookups:o.quoteLookups||{},groupLookups:o.groupLookups||{},lineLookups:function(){var e=o.lineLookups||{},t={},i=o.developerPrefix||"";for(var n in e)n!==i+"Product__c"&&n!==i+"ProductOption__c"&&(t[n]=e[n]);return t}()},h=this._createWorkerContext("RelatedRecordSequence",new Map([["quote",t],["referencedFieldMap",i],["lookupFieldMap",c]]));d.postMessage(h);var f=this._createWorker(),p=this._createWorkerContext("ProductSequence",new Map([["quote",t],["referencedFields",o.referencedFieldMap.Product2]]));f.postMessage(p);var v=o.developerPrefix||"",g=this._createWorker(),y=this._createWorkerContext("OptionSequence",new Map([["quote",t],["referencedFields",o.referencedFieldMap[v+"ProductOption__c"]]]));g.postMessage(y);var m=this._createWorker(),b=this._createWorkerContext("UbpSequence",new Map([["quote",t],["settings",o]]));if(m.postMessage(b),o&&o.isPricingGuidanceEnabled){var _=this._createWorker(),C=this._createWorkerContext("PricingGuidanceSequence",new Map([["accountId",e],["quote",t],["settings",o]]));_.postMessage(C)}}},{key:"_createWorkerContext",value:function(e,t){var i={orgUrl:this.orgUrl,siteUrl:this.siteUrl,proxyUrl:this.proxyUrl,sessionId:this.sessionId,precacheSequence:e,prefix:this.prefix,oik:this.oik};return t&&0!=t.size&&t.forEach(function(e,t){i[t]=e}),i}},{key:"_createWorker",value:function(){var e=new Worker(this.filePath),t=this._precache;return e.addEventListener("message",function(e){e.data.successful?t(e.data.provider,e.data.uid,e.data.results):e.data.failure?console.error("Main thread received failure from precache sequence "+e.data.sequence+": "+e.data.msg):e.data.err&&console.error("Main thread received error from precache sequence "+e.data.sequence+": "+e.data.msg)}),e}},{key:"_precache",value:function(e,t,i){SB&&SB.JSQCPrecacher&&(new SB.JSQCPrecacher).precacheValue(e,t,i)}}]),o=t)),e("JSQCPrecacheWorkerManager",o)}}}),System.register("quotes/precaching/PrecacheRestClient.js",[],function(e,t){function i(e,t,i,n){var a=function(o,r,s,a){function i(e,t,i){e+=void 0===o.oik?"":"&oik="+o.oik;var n={url:""!=s?s+"/services/apexrest"+e:a,method:t,headers:{"SalesforceProxy-Endpoint":r+"/services/apexrest"+e,"Content-Type":"application/json"}};return i&&(n.body=i),o.request(n)}return{get:function(e){return i(e,"GET")},patch:function(e,t){return i(e,"PATCH",t)}}}(e,t,i,n);function l(e){var t="/ServiceRouter";return e?"/"+e+t:t}function u(t){try{return JSON.parse(t)}catch(e){return t}}return{read:function(e,n,o){var r=l(e);return new Promise(function(t,i){a.get(r+"?reader="+n+"&uid="+o).then(function(e){t(u(e))},function(e){i(e)})})},load:function(e,n,o,t){var r=l(e),s=JSON.stringify({context:JSON.stringify(t)});return new Promise(function(t,i){a.patch(r+"?loader="+n+"&uid="+o,s).then(function(e){t(u(e))},function(e){i(e)})})},setOptions:function(e){}}}return{setters:[],execute:function(){module.exports=i}}}),System.register("quotes/sb-le-custom-action-services/LECustomActionServices.js",["common/aggregate/quote-line-aggregator/QuoteLineAggregator.js","common/core/AppContext.js","common/core/Events.js","common/core/Navigator.js","common/core/sb-page-container/PageContainer.js","common/data/client/ConnectionClient.js","common/data/format/ErrorFormatter.js","common/data/format/JsonFormatter.js","common/formatter/Formatter.js","common/relationship/RelationshipFieldManager.js","common/Util.js","quotes/models/AssetQuantityValidator.js","quotes/models/GroupModel.js","quotes/models/JSQCNotifier.js","quotes/models/MDQSegmentHelper.js","quotes/models/QuoteMessenger.js","quotes/models/SafeClientCache.js","quotes/models/SortLinesHandler.js","quotes/ui-data-manager/UIDataManager.js","quotes/models/ClientCache.js","quotes/usage-based-pricing-dao/UsageBasedPricingDao.js","logging/AppLogger.js","quotes/QuoteContext.js"],function(t,e){var s,y,m,b,i,o,d,c,h,R,r,f,a,p,l,u,v,g,_,N,C,S,k,O,E,I,j,B,w,M;function L(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}return{setters:[function(e){s=e.QuoteLineAggregator},function(e){y=e.AppContext},function(e){m=e.Events,b=e.fireEvent},function(e){i=e.Navigator},function(e){o=e.PageContainer},function(e){d=e.ConnectionClient},function(e){c=e.formatError},function(e){h=e.JsonFormatter},function(e){R=e.Formatter},function(e){r=e.RelationshipFieldManager},function(e){f=e.getPrunedRecord,E=e.mergeRec,I=e.Util},function(e){a=e.AssetQuantityValidator},function(e){p=e.GroupModel},function(e){l=e.JSQCNotifier},function(e){u=e.MDQSegmentHelper},function(e){v=e.QuoteMessenger},function(e){g=e.getOnce},function(e){_=e.SortLinesHandler},function(e){N=e.UIDataManager},function(e){C=e.put,S=e.get,k=e.del},function(e){O=e.overrideRecValues},function(e){j=e.AppLogger,B=e.LOG_TYPE},function(e){w=e.QuoteContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LECustomActionServices",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-custom-action-services",this.properties={editorModel:Object,eventDetail:Object,response:{type:Object,notify:!0},error:{notify:!0}}}},{key:"_executeServiceAction",value:function(e,t,i){var n=t||(this.eventDetail&&this.eventDetail.model?this.eventDetail.model.serviceModel:null);this.editorModel&&(this._usesClientCalculator()&&this.sortLines(this.editorModel.quoteModel.quoteVO,!1),this.editorModel.quoteModel.quoteVO.lineItems=this._reorderLineItems(),this._reorderGroups());var o=this.editorModel?this.editorModel.quoteModel.quoteVO:this.data.quote,r=i&&n?i(o,n):o.lineItems,s=o.lineItems;o.partialVO=s.length!=r.length,o.lineItems=r;var a=this.data.settings.largeQuoteThreshold,l=a&&o.lineItems.length>a;if(("saveService"===e||"quickSaveService"===e)&&l&&SB&&SB.QuoteDAO)return o.lineItems=s,o.partialVO=!1,void this._saveLargeQuote(o,e);var u={cleanRootProperty:"record",cleanPathFromRoot:["ui_original_record"],keepIfDirtyWhenParentContains:"attributes",keepIfDirtyAllowList:{type:[this.prefix+"QuoteLineConsumptionSchedule__c",this.prefix+"QuoteLineConsumptionRate__c"]}};n?(this.$[e].model=void 0,n.quote=new h(!0,null,null,u).format(o),this.$[e].model=n):(this.$[e].model=void 0,this.$[e].model=new h(!0,null,null,u).format(o)),o.lineItems=s,o.partialVO=!1}},{key:"_executeQuotelessServiceAction",value:function(e,t){var i=t||(this.eventDetail&&this.eventDetail.model?this.eventDetail.model.serviceModel:null);i?(this.$[e].model=void 0,this.$[e].model=i):console.log("no service model means nothing to do")}},{key:"_saveLargeQuote",value:function(n,o){var r=this,e=!0,t=!1,i=void 0;try{for(var s,a=n.lineItemGroups[Symbol.iterator]();!(e=(s=a.next()).done);e=!0){var l=s.value;l.record.attributes||(l.record.attributes={type:this.prefix+"QuoteLineGroup__c"})}}catch(e){t=!0,i=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw i}}var u=this.app.org.prefix;Promise.resolve().then(function(){return r.data.settings.enableLQTValidations?g("validationErrorConditionDependencies",[]).then(function(t){if(t.errors)throw new Error(c(t.errors));return r.$.productRuleValidator.load({uid:n.record.Id,context:{quote:n.record,quoteLineGroups:n.lineItemGroups.map(function(e){return e.record}),quoteLines:n.lineItems.map(function(e){return f(e.record,t.fields)})}})}):[]}).then(function(e){if(0<e.length)throw new Error(c(e));return new d(u).getConnection()}).then(function(i){return new SB.QuoteDAO(u,i,r.data.settings).saveQuote(n).then(function(){var e=new SB.QuoteOpportunitySynchronizer(r.data.settings,i,u),t=[];return t.push(e.updateOpportunityProducts(n)),t.push(r._checkIfRecordJobFailed()),Promise.all(t)})}).then(function(e){return"Failed"!==e[1]?Promise.resolve():r._setRecordJob("Completed")}).then(function(){return r._handleLargeQuoteSaveResponse(o)}).catch(function(e){r.error=r.$[o].createError(e),r.showSpinner=!1;var t=e.message||e,i=e.stack||e;r._setRecordJob("Failed",t,i)})}},{key:"_checkIfRecordJobFailed",value:function(){var e={recordId:this.editorModel.quoteModel.quoteVO.record.Id,jobType:"QuoteCalculator"};return this.$.getRecordJobStatus.load({context:e})}},{key:"_setRecordJob",value:function(e,t,i){var n={recordIds:[this.editorModel.quoteModel.quoteVO.record.Id],jobType:"QuoteCalculator",jobStatus:e,jobDetails:t,stacktrace:i};return this.$.setJobStatus.save({model:n})}},{key:"_handleLargeQuoteSaveResponse",value:function(e){"saveService"===e?this.saverResponse="SUCCESS":"quickSaveService"===e&&(this._reloadEditor(),this._getDomHost().$.sbLineEditorRead.update(!0))}},{key:"_reorderLineItems",value:function(){for(var e=[],t=this.editorModel.quoteModel.lineGroups,i=0,n=t.length;i<n;i++){for(var o=t[i],r=0,s=o.dimensions.length;r<s;r++)for(var a=o.dimensions[r],l=o.segmentedLinesByDimension[a],u=0,d=l.length;u<d;u++)for(var c=l[u].segments,h=0,f=c.length;h<f;h++)e.push(c[h].lineVO);for(var p=0,v=o.standardLines.length;p<v;p++)e.push(o.standardLines[p].lineVO)}return e}},{key:"_reorderGroups",value:function(){for(var e=this.domHost.groupModels,t=0;t<e.length;t++)e[t].groupVO.record[this.editorModel.constants.NUMBER_FIELD]=t+1}},{key:"updateUIAfterCalculate",value:function(e){var t=e.lineSortField&&e.lineSortField==this.editorModel.constants.NUMBER_FIELD;this.domHost.updateAfterJSQC(this.notifier,t),this.sortLines(e,!0)||b(m.REFRESH_TABLE)}},{key:"_saveFavorite",value:function(e){var s=this;this._executeServiceAction("favoriteLinesService",{keys:e.detail.keys,favName:e.detail.name,groupKey:e.detail.groupKey},function(e,t){var i=null==e.lineItems||0==e.lineItems.length,n=null==t.keys||0==t.keys.length;if(i||n)return[];var o=new Set;t.keys.forEach(function t(i){o.add(i),e.lineItems.forEach(function(e){e.parentItemKey===i&&(o.add(e.key),e.record[s.data.developerPrefix+"Bundle__c"]&&t(e.key))})});var r=[];return e.lineItems.forEach(function(e){o.has(e.key)&&r.push(e)}),r})}},{key:"_handleFavoriteResponse",value:function(){this.domHost.updateQuote(this.favoriteResponse,function(e,t){var n=t.lineItems,o=n.length;e.lineItems&&0!==e.lineItems.length&&e.lineItems.forEach(function(e){for(var t=e.key,i=0;i<o;i++)if(n[i].key===t){n[i]=e;break}});var r=t.lineItemGroups,s=r.length;return e.lineItemGroups&&0!==e.lineItemGroups.length&&e.lineItemGroups.forEach(function(e){for(var t=e.key,i=0;i<s;i++)if(r[i].key===t){r[i]=e;break}}),e.lineItems=n,e.lineItemGroups=r,e})}},{key:"_handleUnfavoriteResponse",value:function(){this._removeFavoritesFromQuote(this.unfavoriteResponse)}},{key:"_removeFavoritesFromQuote",value:function(e){var t=new Set(e),i=this.editorModel.constants.FAVORITE_ID_FIELD;if(this.editorModel.quoteModel.quoteVO.lineItems.forEach(function(e){t.has(e.record[i])&&(e.record[i]=null)}),this.editorModel.quoteModel.quoteVO.lineItemGroups.forEach(function(e){t.has(e.record[i])&&(e.record[i]=null)}),this.editorModel.quoteModel.quoteVO.favoriteIds){var n=this.editorModel.quoteModel.quoteVO.favoriteIds;this.editorModel.quoteModel.quoteVO.favoriteIds=n.filter(function(e){return!t.has(e)})}this._updateQuote(this.editorModel.quoteModel.quoteVO)}},{key:"_executeCustomAction",value:function(){var e=this.eventDetail.customAction;"function"==typeof this[e.eventHandlerName]?this[e.eventHandlerName]():e.url&&e.urlTarget?this._executeCustomURLAction(e.url,e.urlTarget,this.eventDetail.model):this._executeServiceAction(this.eventDetail.customAction.eventHandlerName)}},{key:"onSaveAndNavigate",value:function(){this.onSave()}},{key:"_executeCustomURLAction",value:function(e,t,i){switch(i.modelType){case"QuoteModel":this.model=i.quoteVO;break;case"LineModel":this.model=i.lineVO;break;case"GroupModel":this.model=i.groupVO;break;default:this.model=i.quoteVO||i.lineVO||i.groupVO}var n=this._parseURL(e,this.model,this.editorModel.quoteModel);"Popup"===t?this._handlePopup(n,this.model.record):this._navigateToURL(n)}},{key:"_handleCalculateResponse",value:function(){var e=this.calculateResponse;e&&(null!=e.jobId?this._onJobChecker(e):this._updateQuote(e))}},{key:"_updateQuote",value:function(e){this.domHost.updateQuote(e)}},{key:"_checkForGuidedMessages",value:function(){this.saverResponse.guidedMessages&&0<this.saverResponse.guidedMessages.length?(this.domHost.handleProductRuleAlertModal("saveService",this.saverResponse),this.showSpinner=!1):this.navigateToReturnUrl(!0)}},{key:"navigateToReturnUrl",value:function(e){if(e&&this.saverResponse&&this.saverResponse.messages&&0<this.saverResponse.messages.length)return this.showSpinner&&(this.showSpinner=!1),void(this.domHost.error={validations:this.saverResponse.messages});var t="";if("onSaveAndNavigate"===this.eventDetail.customAction.eventHandlerName)t=this._parseURL(this.eventDetail.customAction.url,this.editorModel.quoteModel.quoteVO,this.editorModel.quoteModel);else{var i=this.editorModel.quoteModel.quoteVO.record.Id;if((t=this.eventDetail.customAction.record?this.eventDetail.customAction.record[this.editorModel.constants.RETURN_URL_FIELD]:null)&&(15!==(t=this._parseURL(t,this.editorModel.quoteModel.quoteVO,this.editorModel.quoteModel)).length&&18!==t.length||!t.match(/^[a-zA-Z0-9]*$/)||(i=t,t=null)),this._getDomHost().inFullScreenMode&&this._getDomHost().exitFullScreenMode(),window.parent.postMessage({acknowledgement:"I acknowledge that this is an unsupported feature that may stop working at any time.",recordId:i},"*"),!t){if(this._isLightningExperience()){var n=this._getRecordIdsToRefresh(i);return window.SfdcApp&&window.SfdcApp.projectOneNavigator&&window.SfdcApp.projectOneNavigator.fireContainerEvent("force__vfGetRecordNotifyChange",{recordIds:n},!0),sforce.one.navigateToSObject(i),this._closeSubTab(),void(this.showSpinner&&(this.showSpinner=!1))}if("undefined"!=typeof Sfdc&&Sfdc&&Sfdc.Url){var o=Sfdc.Url.getUrlParameters(window.location.href);if(this._areUrlParamsValid(o))return void this._navigateByWindowLocation(this.editorModel.communityPrefix+"/"+i+"?isdtp="+o.isdtp)}}t=t||this.editorModel.communityPrefix+"/"+i}this.showSpinner&&(this.showSpinner=!1),this._navigateToURL(t,!0)}},{key:"_getRecordIdsToRefresh",value:function(e){var t=[{recordId:e}];return(this.editorModel.quoteModel.quoteVO.lineItems||[]).forEach(function(e){e.record.Id&&t.push({recordId:e.record.Id})}),(this.editorModel.quoteModel.lineGroups||[]).forEach(function(e){e.groupVO.record.Id&&t.push({recordId:e.groupVO.record.Id})}),(this.editorModel.quoteModel.quoteVO.deletedLineIds||[]).forEach(function(e){t.push({recordId:e})}),(this.editorModel.quoteModel.quoteVO.deletedGroupIds||[]).forEach(function(e){t.push({recordId:e})}),t}},{key:"_areUrlParamsValid",value:function(e){return e&&("nv"===e.isdtp||"vw"===e.isdtp)}},{key:"_closeSubTab",value:function(){if(sforce&&sforce.console)try{sforce.console.getEnclosingTabId(function(e){sforce.console.closeTab(e.id)})}catch(e){}}},{key:"_reloadEditor",value:function(){this.domHost.destampGroups(),this.domHost.md=void 0,this._clearAppliedUbpChanges(),Polymer.RenderStatus.afterNextRender(this,function(){var e=this.editorModel.data.settings.largeQuoteThreshold;(null==e||this.editorModel.quoteModel.quoteVO.lineItems.length<=e)&&(this.domHost.rawData=this.quoteEditorModelResponse,this.quoteEditorModelResponse.guidedMessages&&0<this.quoteEditorModelResponse.guidedMessages.length&&(this.domHost.$.productAlertModal.displayContinueButton=!1,this.domHost.handleProductRuleAlertModal("quickSaveService",this.quoteEditorModelResponse))),Polymer.RenderStatus.afterNextRender(this,function(){this.showSpinner=!1,b(m.TOGGLE_QUICKSAVE,{enable:!0})})})}},{key:"_handleToggleGroupResponse",value:function(){this.domHost.set("editorModel.quoteModel.quoteVO",this.toggleGroupResponse),this.domHost.$$("#quoteTabs")&&this.domHost.$$("#quoteTabs").destroyTabs();var e=this.editorModel.quoteModel,t=e.quoteVO.lineItemGroups;if(e.grouped){this.domHost.set("editorModel.quoteModel.grouped",!1),this.domHost.rightSideButton=!1,b(m.CLOSE_GROUP_PANEL);for(var i=0;i<this.domHost.groupModels.length;i++)this.domHost.set("groupModels."+i+".groupVO",{})}else"Solution Group"===this.eventDetail.customAction.type&&this._extendSolutionGroupRecord(t[0].record),this.set("editorModel.quoteModel.grouped",!0),this.set("editorModel.quoteModel.quoteVO.lineItemGroups",e.quoteVO.lineItemGroups);this._updateQuote(e.quoteVO),this.domHost.viewport.isMobile()&&this.domHost.buildQuoteTabs(),this.domHost.quoteHasNoLines()}},{key:"_handlePopupResponse",value:function(){switch(this.popupResponse.action){case"save":this.onSave();break;case"quicksave":this.onQuickSave();break;case"reload":this._reload()}}},{key:"_reload",value:function(){window.location.reload()}},{key:"_handlePopup",value:function(e,t){var i=this.$.popup;i.url=e,i.messenger=new v(this.editorModel,t),i.open()}},{key:"_parseURL",value:function(e,s,a){return e.replace(/{!(.*?)}/g,function(e,t){var i=void 0,n=t.split("."),o=n[0];o==this.app.org.prefix+"__Quote__c"||o==this.app.org.prefix+"__Quote__r"||"Quote__c"==o||"Quote__r"==o?(i=a.quoteVO.record,n.shift()):o===this.app.org.prefix+"__Group__c"||o===this.app.org.prefix+"__Group__r"||"Group__c"==o||"Group__r"==o?(i=a.groupsByKey[this.model.parentGroupKey].groupVO.record,n.shift()):i=s.record;for(var r=0;r<n.length;r++){if(r===n.length-1)return i[n[r]];i=i[n[r]]}}.bind(this))}},{key:"_navigateToURL",value:function(e,t){this._isLightningExperience()?y.user.inCommunity?this._navigateInLightningCommunity(e,t):sforce.one.navigateToURL(e,!!t):this._navigateByWindowLocation(e)}},{key:"_navigateInLightningCommunity",value:function(e,t){if(e)if(e.startsWith("http"))sforce.one.navigateToURL(e,!!t);else{var i=e;i.startsWith("/")||(i="/"+i),i=this.editorModel.communityPrefix+i,sforce.one.navigateToURL(i,!!t)}}},{key:"_navigateByWindowLocation",value:function(e){window.location.href=e}},{key:"_isLightningExperience",value:function(){return"undefined"!=typeof sforce&&sforce&&!!sforce.one}},{key:"onFlagCalculate",value:function(e,t,i){this.domHost.errors=null,this._usesClientCalculator()?(this.domHost.calculateGetCacheArray=[],this._jsqcCalculate(e).then(function(e){return t||e.updateQuoteRequired?(this.data.quote.calculationRequired=!1,void this._updateQuote(e.value)):this.data.quote.calculationRequired?(this.data.quote.calculationRequired=!1,e.value.lineSortField&&e.value.lineSortField!=this.data.developerPrefix+"Number__c"&&(e.value.lineItems=new _(this.data.developerPrefix).sortLineItems(e.value.lineItems,e.value.lineSortField)),void this.domHost._createEditorModel(this.domHost.data,this.domHost.md)):(this.updateUIAfterCalculate(e.value),void("function"==typeof i&&i(e.value)))}.bind(this),function(e){"function"==typeof i&&i(),void 0===this.editorModel?(this.$.alertModal.displayContinueButton=!1,this.$.alertModal.cancelCB=function(){location.reload()}.bind(this),this.$.alertModal.alerts=[e.message]):this.domHost.error=e}.bind(this))):(this.$.calculateService.model=void 0,this.$.calculateService.background=!1===e,this._executeServiceAction("calculateService"),"function"==typeof i&&i())}},{key:"onSave",value:function(){this.showSpinner=!0,this.$.saveService.background=!0,this._save("saveService")}},{key:"onQuickSave",value:function(){if(this.$.quickSaveService.uid=this.editorModel.quoteModel.quoteVO.record.Id.substring(0,15),this.showSpinner=!0,this.$.quickSaveService.background=!0,this.domHost.$.sbLineEditorRead.clearCache(),this.editorModel.largeQuoteExperienceEnabled){for(var e=this.editorModel.quoteModel.lineGroups,t=0,i=e.length;t<i;t++)if(e[t].groupKey==this.domHost.selectedGroupKey){this.domHost.returnGroupKeyAfterQuickSave=t+2;break}}else this.domHost.returnGroupKeyAfterQuickSave=null;this._save("quickSaveService"),b(m.QUOTE_SAVED)}},{key:"onCancel",value:function(){this.showSpinner=!0,this.navigateToReturnUrl()}},{key:"onAddProducts",value:function(){this._navigateToLookup("product")}},{key:"onAddFavorites",value:function(){this._navigateToLookup("favorite")}},{key:"onDeleteLines",value:function(){if(this._usesClientCalculator()){var t=new Set;if(this._retrieveKeysOfSelected().forEach(function(e){t.add(e)}),this._deleteLines(t,this.editorModel.quoteModel.quoteVO,!0),this.domHost.renumber(),this.onFlagCalculate(!0,!1),this.domHost.quoteHasNoLines(),this.editorModel.largeQuoteExperienceEnabled||this.editorModel.deviceContext.isMobile){this.editorModel.deviceContext.isMobile&&this.domHost.buildQuoteTabs();for(var e=0,i=this.editorModel.quoteModel.lineGroups.length;e<i;e++)b(m.RENDER_NEW_TAB,{groupKey:this.editorModel.quoteModel.lineGroups[e].groupKey})}}else this._executeServiceAction("onDeleteLine",{keys:this._retrieveKeysOfSelected()})}},{key:"onDeleteLine",value:function(){if(this._usesClientCalculator()){var e=new Set;e.add(this.eventDetail.model.serviceModel.keys[0]),this._deleteLines(e,this.editorModel.quoteModel.quoteVO,!0),this.domHost.renumber(),this.onFlagCalculate(!0,!1),this.domHost.quoteHasNoLines(),this.editorModel.deviceContext.isMobile?(this.domHost.buildQuoteTabs(),b(m.RENDER_NEW_TAB,{groupKey:this.eventDetail.model.groupModel.groupKey})):this.editorModel.largeQuoteExperienceEnabled&&b(m.RENDER_NEW_TAB,{groupKey:this.domHost.selectedGroupKey})}else this._executeServiceAction("onDeleteLine",{keys:this.eventDetail.model.serviceModel.keys})}},{key:"onAddGroup",value:function(){this._resetOnActionSignal(),this.editorModel.quoteModel.grouped?(this._addGroup(),this.onFlagCalculate(!0,!0)):this._groupQuote()}},{key:"onUngroup",value:function(){this._resetOnActionSignal(),this._ungroupQuote()}},{key:"_groupQuote",value:function(){var t=this.editorModel.quoteModel,e=t.quoteVO;if(e.record[this.data.developerPrefix+"LineItemsGrouped__c"]=!0,0===e.lineItemGroups.length){var i=this.editorModel.data.customLabels.lbl_default_group_name;if(e.record[this.data.developerPrefix+"DefaultGroupName__c"]){var n=e.record[this.data.developerPrefix+"DefaultGroupName__c"];n&&(i=n)}var o=this.editorModel.constants,r=this._createGroupRecord(t);r.Name=i,r[o.NUMBER_FIELD]=1,r=JSON.parse(JSON.stringify(r)),"Solution Group"===this.eventDetail.customAction.type&&this._extendSolutionGroupRecord(r),t.lineGroups[0].groupVO={key:++t.quoteVO.nextGroupKey,record:r,multiSegmentColumns:{},localizedMultiSegmentColumns:{}},sb.common.core.AppContext.org.isMultiCurrencyOrg&&(t.lineGroups[0].groupVO.CurrencyIsoCode=e.record.CurrencyIsoCode),t.grouped=!0,e.lineItemGroups.push(t.lineGroups[0].groupVO),t.groupsByKey[t.lineGroups[0].groupVO.key]=t.lineGroups[0],delete t.groupsByKey.null;var s=t.indexByGroupKey;s[t.lineGroups[0].groupVO.key]={index:Object.keys(s).length,indexByLineKey:{},indexBySegmentKey:{}},e.lineItems.forEach(function(e){e.parentGroupKey=t.lineGroups[0].groupVO.key}),this.onFlagCalculate(!0,!0),this.editorModel.largeQuoteExperienceEnabled&&this.domHost.set("selectedGroupKey",t.lineGroups[0].groupVO.key)}}},{key:"_ungroupQuote",value:function(){var e=this.editorModel.quoteModel;e.indexByGroupKey.null={index:0,indexByLineKey:{},indexBySegmentKey:{}},e.grouped=!1;var t=e.quoteVO,i=this.data.developerPrefix,n=[];0!==t.lineItemGroups.length&&(t.lineItemGroups.forEach(function(e){e.record.Id&&-1===n.indexOf(e.record.Id)&&n.push(e.record.Id)}),t.lineItemGroups=[],t.deletedGroupIds=n,t.lineItems.forEach(function(e){e.parentGroupKey=null,e.record[i+"Group__c"]=null})),t.record[i+"LineItemsGrouped__c"]=!1,this.onFlagCalculate(!0,!0),this.domHost.rightSideButton=!1,b(m.CLOSE_GROUP_PANEL),this.editorModel.largeQuoteExperienceEnabled&&(this.domHost.set("groupModels",[]),this.domHost.set("selectedGroupKey",null))}},{key:"onResegmentLine",value:function(){var e=this.editorModel.data.settings.largeQuoteThreshold,t=this.editorModel.data.customLabels.msg_large_quote_sent_without_lines;if(null!=e&&e<this.editorModel.quoteModel.quoteVO.lineItems.length){var i=this.eventDetail.model.lineVO.parentGroupKey,n=this.editorModel.quoteModel.quoteVO,o=new s(n).getSegmentTemplatesByDimensionTypeForGroupKey(i);n.segmentTemplatesByDimensionTypeByGroupKey={},n.segmentTemplatesByDimensionTypeByGroupKey[(i||-1)+""]=o;var r=t.replace("{0}",n.record.Id).replace("{1}",e);console.log(r),this._executeServiceAction("onResegmentLine",null,function(e,t){for(var i=t.keys[0],n=[],o=e.lineItems.length,r=0;r<o;r++){var s=e.lineItems[r];if(s.key==i){n.push(s);break}}return n})}else this._executeServiceAction("onResegmentLine")}},{key:"_handleResegmentResponse",value:function(){var l=this;delete this.resegmentResponse.segmentTemplatesByDimensionTypeByGroupKey,this.domHost.updateQuote(this.resegmentResponse,function(e,t){for(var i=void 0,n=e.lineItems.length,o=l.editorModel.constants,r=0;r<n;r++){var s=e.lineItems[r];if(1==s.record[o.SEGMENT_INDEX_FIELD]){i=s.key;break}}var a=[];return t.lineItems.forEach(function(e){e.key!==i&&a.push(e)}),a=a.concat(e.lineItems),e.lineItems=a,e})}},{key:"onDesegmentLine",value:function(){var t=this.editorModel.constants,i=(this.eventDetail&&this.eventDetail.model?this.eventDetail.model.serviceModel:null).segmentKey,e=JSON.parse(JSON.stringify(this.editorModel.quoteModel.quoteVO)),n=void 0,o=new Set;e.lineItems.forEach(function(e){e.record[t.SEGMENT_KEY_FIELD]===i&&(1===e.record[t.SEGMENT_INDEX_FIELD]?n=e:o.add(e.key))});var r=this._transformLineToNonSegmentedLine(n);0!==o.size&&this._deleteLines(o,e,!1);var s=[],a=null!=r.parentItemKey;e.lineItems.forEach(function(e){e.key!=r.key&&s.push(e),a&&r.parentItemKey==e.key&&(s.push(r),a=!1)}),null==r.parentItemKey&&s.push(r),e.lineItems=s,e.calculationRequired=!0,this._updateQuote(e)}},{key:"_deleteLines",value:function(r,s,e){var a=this,u=this.editorModel.constants,d=new Set,c=new Set,t=this._getAllRelatedKeys(r,e);r=new Set([].concat(L(r),L(t))),s.lineItems.forEach(function(e,t){if(r.has(e.key)){if(d.add(t),e.record.Id&&c.add(e.record.Id),y.isManualEditsForUBPEnabled&&e.record[a.editorModel.constants.HAS_CONSUMPTION_SCHEDULE]){var i="AppliedUbpChanges_"+a._getLineOrProdId(e.record)+"_"+e.key;k(i)}if(e.parentGroup&&(e.parentGroup.record[u.FAVORITE_ID_FIELD]=null),e.record[u.FAVORITE_ID_FIELD]&&s.favoriteIds){var n=e.record[u.FAVORITE_ID_FIELD],o=[];s.favoriteIds.forEach(function(e){e!=n&&o.push(e)}),s.favoriteIds=o}}});var h=[];s.lineItems.forEach(function(e,t){if(d.has(t)){var i=e.parentGroupKey,n=this.editorModel.quoteModel.indexByGroupKey[e.parentGroupKey].index;if(e.record[this.editorModel.constants.SEGMENT_KEY_FIELD]){var o=e.record[this.editorModel.constants.SEGMENT_KEY_FIELD],r=this.editorModel.quoteModel.lineModelsByKey[e.key];if(r.segments&&0<r.segments.length){var s=r.dimensionType,a=this.editorModel.quoteModel.indexByGroupKey[i].indexBySegmentKey[o];r.segments=[],this.domHost.splice("groupModels."+n+".segmentedLinesByDimension."+s,a,1)}}else{var l=this.editorModel.quoteModel.indexByGroupKey[i].indexByLineKey[e.key];this.domHost.splice("groupModels."+n+".standardLines",l,1)}this.editorModel.quoteModel.renumberIndexes(!0)}else c.has(e.record[u.SOURCE_FIELD])&&(e.record[u.SOURCE_FIELD]=null),h.push(e)}.bind(this)),0<d.size&&b(m.LINE_SPLICE_COMPLETE),s.lineItems=h,s.deletedLineIds=s.deletedLineIds||[],c.forEach(function(e){s.deletedLineIds.push(e)})}},{key:"_transformLineToNonSegmentedLine",value:function(e){var o=this.editorModel.constants;e.dimensionType=null,e.record[o.DIMENSION_ID_FIELD]=null,e.record[o.DIMENSION_FIELD]=null,e.record[o.SEGMENT_KEY_FIELD]=null,e.record[o.SEGMENT_INDEX_FIELD]=null,e.record[o.SEGMENT_LABEL_FIELD]=null,e.record[o.START_DATE_FIELD]=null,e.record[o.END_DATE_FIELD]=null;var t=e.record[o.OPTION_TYPE_FIELD];return t&&"component"===t.toLowerCase()?e.record[o.BUNDLED_QUANTITY_FIELD]=function(e){if(null!=e.actualQuantity)return e.actualQuantity;var t=e.record[o.QUANTITY_FIELD],i=e.record[o.PRIOR_QUANTITY_FIELD]||0,n=e.record[o.UPGRADED_QUANTITY]||0;return e.record[o.EXISTING_FIELD]||e.record[o.CARRYOVER_LINE_FIELD]?t-i+n:t}(e):t&&"accessory"===t.toLowerCase()&&(e.record[o.BUNDLED_QUANTITY_FIELD]=e.record[o.QUANTITY_FIELD]),e}},{key:"onResetDiscounts",value:function(){this.editorModel.quoteModel.resetDiscounts(this.eventDetail.model.groupKey),w.shouldCalulateImmediately(w.constants.ADDITIONAL_DISCOUNT_FIELD,y.org.calculateImmediately,this.editorModel.quoteModel)&&this.onFlagCalculate(!0,!1)}},{key:"updateLineOptional",value:function(){var e=void 0;this.eventDetail.model.groupKey&&(e=this.eventDetail.model.groupKey),this.editorModel.quoteModel.allOptional="optionalAllBtn"===this.eventDetail.customAction.caClass,this.editorModel.styleQuoteAndGroupActionButtons(),this.notifyPath("editorModel.quoteModel.allOptional",this.editorModel.quoteModel.allOptional),b(m.TOGGLE_OPTIONAL_CLICKED,{toggleOptionalBoolean:this.editorModel.quoteModel.allOptional,groupKey:e})}},{key:"onUpgradeAssets",value:function(){this._navigateToLookup("asset")}},{key:"onRenewSubscriptions",value:function(){this._navigateToLookup("subscription")}},{key:"onAmendSubscriptions",value:function(){this._navigateToLookup("subscription")}},{key:"onAddRecommendedProducts",value:function(){this._navigateToLookup("recommend")}},{key:"onCloneGroup",value:function(){this.$.showSpinner=!0;var e=this.editorModel.quoteModel,t=this.eventDetail.model.serviceModel.keys[0];this._cloneGroup(e,t),delete this.eventDetail.model,this.onFlagCalculate(!0,!1)}},{key:"_cloneGroup",value:function(e,t){var i=this,n=e.groupsByKey[t];if(n){this._addGroup(n.groupVO);var o=e.groupsByKey[e.quoteVO.nextGroupKey-1];if(o){var r=new Set,s=n.quoteModel.lineModelsByKey;for(var a in s)s.hasOwnProperty(a)&&(s[a].lineVO.parentItemKey||s[a].lineVO.parentGroupKey==t||r.add(s[a].lineVO.key));n.segmentedLines.forEach(function(e){var t=null;e.lineVO.parentItemKey&&(t=i._getRootPackage(s[e.lineVO.parentItemKey],s)),t&&r.has(t.lineVO.key)?i._cloneLine(t,o):e.lineVO.parentItemKey||i._cloneLine(e,o)}),n.standardLines.forEach(function(e){if(e.lineVO.key){var t=null;e.lineVO.parentItemKey&&(t=i._getRootPackage(s[e.lineVO.parentItemKey],s)),t&&r.has(t.lineVO.key)?i._cloneLine(t,o):e.lineVO.parentItemKey||i._cloneLine(e,o)}})}}}},{key:"_getRootPackage",value:function(e,t){return e.lineVO.parentItemKey?this._getRootPackage(t[e.lineVO.parentItemKey],t):e}},{key:"onDeleteGroup",value:function(){var t=this,e=this._getDomHost().i18n.l;!this.editorModel.quoteModel.isAmendmentOrChangeQuote||this.eventDetail.model.canDelete()?sb.dialog.confirm(e("msg_confirm_group_delete"),{ok:e("Ok"),cancel:e("Cancel")},function(e){e&&t._deleteGroup()}):this.domHost.errors=[e("msg_cannot_delete_group")]}},{key:"_deleteGroup",value:function(){var e=this.eventDetail.model.serviceModel.keys[0],t=this.editorModel.quoteModel;this.eventDetail.model=void 0,null!=t.groupsByKey&&(this._removeGroup(t,e),this.onFlagCalculate(!0,!0),this._updateQuote(t.quoteVO),1==t.lineGroups.length&&b(m.CLOSE_GROUP_PANEL),this.editorModel.largeQuoteExperienceEnabled&&t.lineGroups[0]&&b(m.GROUP_DELETED,{groupKey:t.lineGroups[0].groupKey}))}},{key:"_removeGroup",value:function(e,i){var t=this,n=!0,o=new Set;if(0<e.quoteVO.lineItems.length&&(e.quoteVO.lineItems.forEach(function(e){e.parentItemKey&&e.parentGroupKey==i&&o.add(e.parentItemKey)}),e.quoteVO.lineItems.forEach(function(e){e.parentGroupKey!=i&&o.has(e.key)&&(n=!1)}),n)){var r,s=new Set,a=[];e.quoteVO.lineItems.forEach(function(e){e.parentGroupKey!=i?a.push(e):e.record.Id&&!s.has(e.record.Id)&&s.add(e.record.Id)}),a.forEach(function(e){s.has(e.record[t.editorModel.constants.SOURCE_FIELD])&&(e.record[t.editorModel.constants.SOURCE_FIELD]=null)}),e.quoteVO.deletedLineIds=(r=e.quoteVO.deletedLineIds).concat.apply(r,L(s)),e.quoteVO.lineItems=a}if(n){var l=[],u=[];e.quoteVO.lineItemGroups.forEach(function(e){e.key!=i?l.push(e):e.record.Id&&-1==u.indexOf(e.record.Id)&&u.push(e.record.Id)}),e.quoteVO.lineItemGroups=l,e.quoteVO.deletedGroupIds=e.quoteVO.deletedGroupIds.concat(u);var d=[],c=-1;e.lineGroups.forEach(function(e,t){e.groupKey!=i?d.push(e):c=t}),e.lineGroups=d,delete e.groupsByKey[i],delete e.indexByGroupKey[i],-1<c&&(this.domHost.splice("groupModels",c,1),Polymer.dom.flush())}}},{key:"onReconfigureLine",value:function(){var e={lineKey:this.eventDetail.model.lineVO.key,qId:this.editorModel.quoteModel.quoteVO.record.Id,ignoreCache:!0};this.eventDetail.model.groupModel.quoteModel.grouped&&(e.groupKey=this.eventDetail.model.groupModel.groupKey),i.nav("#",e,["product","pc"],!1,this)}},{key:"onAddToFavorites",value:function(){this._openDialog("favDialog")}},{key:"onViewPricingGuidance",value:function(){this._openPricingGuidanceDialog("pricingGuidanceDialog")}},{key:"onViewConsumptionSchedule",value:function(){this.fire("toggle-ubp-editor",{lineModel:this.eventDetail.model,visible:!0})}},{key:"onRemoveFromFavorites",value:function(){var t=this,e=this._getDomHost().i18n.l;"Line"===this.eventDetail.customAction.location?sb.dialog.confirm(e("msg_confirm_remove_favorite"),{ok:e("Ok"),cancel:e("Cancel")},function(e){e&&t._executeQuotelessServiceAction("onRemoveFromFavorites")}):sb.dialog.confirm(e("msg_confirm_remove_group_from_favorites"),{ok:e("Ok"),cancel:e("Cancel")},function(e){e&&t._executeQuotelessServiceAction("onRemoveFromFavorites")})}},{key:"_onAcceptPricingGuidance",value:function(){if(this.eventDetail&&this.eventDetail.model&&this.eventDetail.model.lineVO&&this.eventDetail.model.lineVO.record&&this.eventDetail.model.lineVO.quoteLinePricingGuidance&&this.eventDetail.model.lineVO.quoteLinePricingGuidance.record&&this.eventDetail.model.groupModel&&this.eventDetail.model.groupModel.quoteModel&&this.eventDetail.model.groupModel.quoteModel.quoteVO&&this.eventDetail.model.groupModel.quoteModel.quoteVO.lineItems){for(var e=this.eventDetail.model.lineVO,t=e.record,i=this.data.developerPrefix,n=e.quoteLinePricingGuidance.record[i+"Target__c"],o=!1,r=i+"Product__c",s=t[r],a=i+"Discount__c",l=i+"AdditionalDiscountAmount__c",u=this.eventDetail.model.groupModel.quoteModel.quoteVO.lineItems,d=0;d<u.length;d++){var c=u[d].record;c[r]===s&&u[d].quoteLinePricingGuidance&&(c[a]===n&&null==c[l]||(c[a]=n,o=!(c[l]=null)))}o&&this.onFlagCalculate(!0,!1);var h=this.eventDetail.model.groupModel.quoteModel.quoteVO.record.Id;(new j).log(h,B.PRICING_GUIDANCE,JSON.stringify({pricingGuidanceAction:"Accepted",quoteLineId:t.Id}))}}},{key:"_cloneToGroup",value:function(e){var t=e.detail;if(0!==t.length){var i=this.editorModel.quoteModel,n=this.editorModel.constants,o=this.domHost,r=i.indexByGroupKey;for(var s in this.selectedLinesByKey){for(var a=this.selectedLinesByKey[s],l=0,u=t.length;l<u;l++){var d=i.groupsByKey[t[l].value];this._cloneLine(a,d)}var c=r[a.lineVO.parentGroupKey],h=c.index,f=a.segmented?c.indexBySegmentKey[a.lineVO.record[n.SEGMENT_KEY_FIELD]]:c.indexByLineKey[s];this._clearSelectedCheckbox(f,h,o,a.lineVO.dimensionType)}if(this.editorModel.largeQuoteExperienceEnabled)for(var p=0,v=t.length;p<v;p++)b(m.RENDER_NEW_TAB,{groupKey:t[p].value});this.onFlagCalculate(!0,!1)}}},{key:"_clearSelectedCheckbox",value:function(e,t,i,n){n?i.set("groupModels."+t+".segmentedLinesByDimension."+n+"."+e+".selected",!1):i.set("groupModels."+t+".standardLines."+e+".selected",!1)}},{key:"onCloneLine",value:function(){var i=this,n=this.eventDetail.model;if(n.selected&&this.editorModel.quoteModel.grouped){this.selectedLinesByKey=this.editorModel.quoteModel.selectedLinesByKey;var e=this.$.cloneToGroupDialog;return e.quoteModel=this.editorModel.quoteModel,void e.open()}function o(){i.showSpinner=!1}this.showSpinner=!0,Polymer.RenderStatus.afterNextRender(this,function(){if(i.editorModel.data.settings.caPlugin){var t={};t.originalLines=i._getOriginalLineKeys(n),i.callPlugin("onBeforeCloneLine",t).then(function(){var e=i._cloneLine(n);return t.clonedLines=i._getClonedLineKeys(e),i.callPlugin("onAfterCloneLine",t)}).then(function(){delete i.eventDetail.model,i.onFlagCalculate(!0,!1,o)})}else i._cloneLine(n),delete i.eventDetail.model,i.onFlagCalculate(!0,!1,o)})}},{key:"callPlugin",value:function(r,s){var a=this;return new Promise(function(t,i){if(SB&&SB.JSQC){var e=new d(a.app.org.prefix);a.notifier=!a.data.quote.calculationRequired&&a.domHost.editorModel?new l(a.domHost):null;var n=new SB.JSQC(a.data.settings,a.data.quote,a.notifier),o=[e.getConnection(),e.getConnection()];Promise.all(o).then(function(e){n.setConnection(e[0]),n.setCustomerOnlyConnection(e[1]),n.onCallCAPlugin(r,s).then(function(e){a.updateUIAfterCalculate(e),a.showSpinner=!1,t()},function(e){a.showSpinner=!1;var t=e.message||e;a.domHost.errors=[a.domHost.i18n.l(t)],i({message:t})})},function(e){a.showSpinner=!1;var t=e.message||e;a.domHost.errors=[a.domHost.i18n.l(t)],i({message:t})})}else i({message:"ERROR: Could not find the Client-Side Calculator"})})}},{key:"_getOriginalLineKeys",value:function(e,t,i){if(i=i||{},e.segmented){i.segmented||(i.segmented={});var n=e.dimensionType;i.segmented[n]||(i.segmented[n]=[]);for(var o=0;o<e.segments.length;o++)i.segmented[n].push(e.segments[o].lineVO.key)}else{i.standard||(i.standard=[]),i.standard.push(e.lineVO.key);var r=this.editorModel.quoteModel.linesByParentItemKey[e.lineVO.key];if(r)for(var s=0,a=r.length;s<a;s++)i=this._getOriginalLineKeys(r[s],r[s].lineVO.key,i)}return i}},{key:"_getClonedLineKeys",value:function(e){for(var t={standard:[]},i=0;i<e.standard.length;i++)t.standard.push(e.standard[i].lineVO.key);for(var n in t.segmented={},e.segmented)if(e.segmented.hasOwnProperty(n)){t.segmented[n]||(t.segmented[n]=[]);for(var o=e.segmented[n].lines,r=0;r<o.length;r++)for(var s=o[r],a=0;a<s.segments.length;a++)t.segmented[n].push(s.segments[a].lineVO.key)}return t}},{key:"_cloneLine",value:function(u,h){var f=this,d=[],p={Year:{lines:[]},Quarter:{lines:[]},Month:{lines:[]},Custom:{lines:[]}},v=this.domHost.groupModels,e=h?h.groupKey:u.lineVO.parentGroupKey,g=e?this.editorModel.quoteModel.indexByGroupKey[e].index:0;return function e(t,i){var n=void 0;if(t.segmented?(n=v[g].cloneSegmentedLine(t,i,h),p[n.dimensionType].lines.push(n),p[n.dimensionType].key=t.lineVO.key):(n=v[g].cloneLine(t,i,h),d.push(n)),v[g].addToLinesByParentItemKey(n),t.bundle&&v[g].quoteModel.linesByParentItemKey[t.lineVO.key])for(var o=v[g].quoteModel.linesByParentItemKey[t.lineVO.key],r=0,s=o.length;r<s;r++)e(o[r],n.lineVO.key)}(u),function(){var e=v[g].standardLines.length;if(0<d.length){var t=void 0,i=void 0,n=v[g].standardLines.length;if(h)t=n;else for(i=0;i<n;i++)if(u.lineVO.key===v[g].standardLines[i].lineVO.key){t=i+1;break}if(u.bundle)if(f.editorModel.data.settings.bundleKeptTogether)for(var o=i;o<n;o++){if(!v[g].standardLines[o].component&&v[g].standardLines[o].lineVO.key!==u.lineVO.key){t=o;break}t=n}else t=n;for(var r=0,s=d.length;r<s;r++){var a=d[r];f.domHost.splice("groupModels."+g+".standardLines",t,0,a),v[g].quoteModel.quoteVO.lineItems.push(a.lineVO),f.editorModel.quoteModel.lineModelsByKey[a.lineVO.key]=a,t++}f.editorModel.deviceContext.isMobile&&0===e&&b(m.RENDER_NEW_TAB,{groupKey:h.groupKey})}}(),function(){for(var e in p)if(0<p[e].lines.length){var t=0,i=p[e].lines,n=v[g].segmentedLinesByDimension[e],o=n.length,r=p[e].key;if(h)t=o;else for(var s=0,a=n.length;s<a;s++)if(n[s].lineVO.key===r){t=s+1;break}for(var l=0,u=i.length;l<u;l++){var d=i[l];f.domHost.splice("groupModels."+g+".segmentedLinesByDimension."+e,t+l,0,d),f.domHost.push("groupModels."+g+".segmentedLines",d);for(var c=0;c<d.segments.length;c++)v[g].quoteModel.quoteVO.lineItems.push(d.segments[c].lineVO),f.editorModel.quoteModel.lineModelsByKey[d.segments[c].lineVO.key]=d.segments[c];0<d.segments.length&&(f.editorModel.quoteModel.lineModelsByKey[d.segments[0].lineVO.key].segments=d.segments,f.editorModel.quoteModel.lineModelsByKey[d.segments[0].lineVO.key].dimensionType=d.dimensionType)}0===o&&b(m.RENDER_NEW_TAB,{groupKey:h.groupKey})}}(),function(){if(y.isManualEditsForUBPEnabled&&u.lineVO.record[f.editorModel.constants.HAS_CONSUMPTION_SCHEDULE]){var e="AppliedUbpChanges_"+f._getLineOrProdId(u.lineVO.record)+"_"+u.lineVO.key,t=S(e,["rates"]);if(t){var i=!0,n=!1,o=void 0;try{for(var r,s=d[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l="AppliedUbpChanges_"+f._getLineOrProdId(a.lineVO.record)+"_"+a.lineVO.key;C(l,["rates"],I.deepClone(t))}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}}}(),this.domHost.renumber(),this.editorModel.quoteModel.renumberIndexes(!0),{standard:d,segmented:p}}},{key:"_usesClientCalculator",value:function(){return this.data.settings.usesClientCalculator}},{key:"_jsqcCalculate",value:function(a){return this.showSpinner=!(!a&&null!=a)||this.showSpinner,new Promise(function(t,i){if(SB&&SB.JSQC){var n={},e=this.data.settings,o=new d(this.app.org.prefix);this.notifier=!this.data.quote.calculationRequired&&this.domHost.editorModel?new l(this.domHost):null,e.displayedLookupMap=this.getDisplayedLookupNames(this.data),(this.editorModel?new u(this.data,this.editorModel.quoteModel.groupsByKey):new u(this.data,null)).updateSegments()&&!this.data.quote.calculationRequired&&(n.updateQuoteRequired=!0,this.notifier=null);var r=new SB.JSQC(e,this.data.quote,this.notifier),s=[o.getConnection(),o.getConnection()];Promise.all(s).then(function(e){r.setConnection(e[0]),r.setCustomerOnlyConnection(e[1]),r.initServices(e[0]),r.onCalc().then(function(e){n.value=e,this.showSpinner=!a&&null!=a&&this.showSpinner,t(n)}.bind(this),function(e){this.showSpinner=!a&&null!=a&&this.showSpinner,i({message:e.message||e})}.bind(this))}.bind(this),function(e){i({message:e.message||e})}.bind(this))}else i({message:"ERROR: Could not find the Client-Side Calculator"})}.bind(this))}},{key:"getDisplayedLookupNames",value:function(e){var t={line:[],group:[],quote:[]},i=e.settings.lineLookups?Object.keys(e.settings.lineLookups):[],n=e.settings.groupLookups?Object.keys(e.settings.groupLookups):[],o=e.settings.quoteLookups?Object.keys(e.settings.quoteLookups):[];return i.forEach(function(e){t.line.push(r.getRelationshipField(e))}),n.forEach(function(e){t.group.push(r.getRelationshipField(e))}),o.forEach(function(e){t.quote.push(r.getRelationshipField(e))}),t}},{key:"_onJobChecker",value:function(e){e.jobType="QuoteCalculator",this.$.jobchecker.useSpinner=!this.$.calculateService.background,this.$.jobchecker.data=e}},{key:"_jobCompleted",value:function(){if(null!=this.$.jobchecker.result.payload){var e=JSON.parse(this.$.jobchecker.result.payload);if(e.backgroundCalculatePending=!1,this.saveServiceAfterBackgroundCalc)return this.editorModel.createQuoteModel(e),this._executeServiceAction(this.saveServiceAfterBackgroundCalc),void(this.saveServiceAfterBackgroundCalc=null);this._getDomHost().updateQuote(e)}}},{key:"_save",value:function(i){this.editorModel.data.settings.usesClientCalculator?this._jsqcCalculate(!1).then(function(e){this._mergeUbpEdits(this.editorModel.quoteModel.quoteVO);var t=new a(this.editorModel.quoteModel.quoteVO,this.editorModel.constants).validateAssetQuantityChanges();0!==t.length?this.domHost.error={validations:t}:this._executeServiceAction(i)}.bind(this),function(e){this.domHost.error=e}.bind(this)):this.editorModel.data.settings.usesBackgroundCalculator?(this.saveServiceAfterBackgroundCalc=i,this.onFlagCalculate(!1)):this._executeServiceAction(i)}},{key:"_mergeUbpEdits",value:function(l){var u=this;y.isManualEditsForUBPEnabled&&function(){var n=Object.keys(u.editorModel.constants.UBP_FIELDS.ConsumptionRateFields).map(function(e){return{fieldPath:u.editorModel.constants.UBP_FIELDS.ConsumptionRateFields[e]}}),o=!1,e=!0,t=!1,i=void 0;try{for(var r,s=function(){var t=r.value;if(t.record[u.editorModel.constants.HAS_CONSUMPTION_SCHEDULE]){var e="AppliedUbpChanges_"+u._getLineOrProdId(t.record)+"_"+t.key,i=S(e,["rates"]);i&&Object.keys(i).forEach(function(e){t.ubpChanges||(t.ubpChanges={rates:{}}),t.ubpChanges.rates[e]||(t.ubpChanges.rates[e]={Id:e,attributes:{type:u.editorModel.constants.prefix+"QuoteLineConsumptionRate__c"}}),t.ubpChanges.rates[e]=O(t.ubpChanges.rates[e]||{},i[e],n),o=!0})}},a=l.lineItems[Symbol.iterator]();!(e=(r=a.next()).done);e=!0)s()}catch(e){t=!0,i=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw i}}o&&(l.record[u.editorModel.constants.CONSUMPTION_RATE_OVERRIDE]=!0)}();var e=!0,t=!1,i=void 0;try{for(var n,o=function(){var t=n.value;t.record[u.editorModel.constants.HAS_CONSUMPTION_SCHEDULE]&&t.ubpChanges&&t.ubpChanges.rates&&Object.keys(t.ubpChanges.rates).forEach(function(e){C(e,["record"],E(S(e,["record"])||{},t.ubpChanges.rates[e]))})},r=l.lineItems[Symbol.iterator]();!(e=(n=r.next()).done);e=!0)o()}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}}},{key:"_clearAppliedUbpChanges",value:function(){var i=this;y.isManualEditsForUBPEnabled&&this.quoteEditorModelResponse&&this.quoteEditorModelResponse.quote&&this.quoteEditorModelResponse.quote.lineItems&&this.quoteEditorModelResponse.quote.lineItems.forEach(function(e){var t="AppliedUbpChanges_"+i._getLineOrProdId(e.record)+"_"+e.key;k(t)})}},{key:"_navigateToLookup",value:function(e){this._resetOnActionSignal(),this.domHost.errors=null;var t={qId:this.editorModel.quoteModel.quoteVO.record.Id,aId:this.eventDetail.customAction.customActionId};this.eventDetail.model&&this.eventDetail.model.groupKey&&(t.groupKey=this.eventDetail.model.groupKey),i.nav("#",t,[e,"lookup"],!1,this)}},{key:"_retrieveKeysOfSelected",value:function(){for(var e=[],t=this.editorModel.quoteModel.lineGroups,i=0,n=t.length;i<n;i++){for(var o=t[i].standardLines,r=0,s=t[i].standardLines.length;r<s;r++)o[r].selected&&o[r].removable&&e.push(o[r].lineVO.key);for(var a=t[i].segmentedLines,l=0,u=a.length;l<u;l++)if(a[l].selected&&a[l].removable)for(var d=a[l].segments,c=0,h=d.length;c<h;c++)e.push(d[c].lineVO.key)}return e}},{key:"_getAllRelatedKeys",value:function(e,s){var a=this,l=new Set;return e.forEach(function(e){if(e){var t=a.editorModel.quoteModel.lineModelsByKey[e],i=a.editorModel.quoteModel.linesByParentItemKey[e];if(i){for(var n=new Set,o=0;o<i.length;o++)n.add(i[o].lineVO.key);var r=a._getAllRelatedKeys(n,s);l=new Set([].concat(L(l),L(n),L(r)))}else s&&t.segmented&&t.segments&&t.segments.forEach(function(e){l.add(e.lineVO.key)})}}),l}},{key:"_addGroup",value:function(e){var t=this.editorModel.constants,i=this.editorModel.quoteModel,n=!1,o=!1;if(e){var r=this.editorModel.quoteModel.groupsByKey[e.key];n=r.standardSubscriptionScopeEditable,o=r.segmentedSubscriptionScopeEditable}else{var s=this._createGroupRecord(i);s.Name="Group"+(i.lineGroups.length+1),e={record:s,multiSegmentColumns:{},localizedMultiSegmentColumns:{}}}"Solution Group"===this.eventDetail.customAction.type&&this._extendSolutionGroupRecord(e.record),(e=JSON.parse(JSON.stringify(e))).key=i.quoteVO.nextGroupKey,i.quoteVO.nextGroupKey++,e.record.Id=void 0;var a=new p(e,i);a.standardSubscriptionScopeEditable=n,a.segmentedSubscriptionScopeEditable=o,i.quoteVO.lineItemGroups.push(e),i.groupsByKey[a.groupVO.key]=a;var l=i.indexByGroupKey;l[a.groupVO.key]={index:Object.keys(l).length,indexByLineKey:{},indexBySegmentKey:{}},this.domHost.push("groupModels",a);for(var u=0;u<i.quoteVO.lineItemGroups.length;u++)i.quoteVO.lineItemGroups[u].record[t.NUMBER_FIELD]=u+1;this.domHost.rightSideButton=1<i.lineGroups.length&&this.editorModel.quoteModel.grouped,this.domHost.notifyPath("editorModel.quoteModel.lineGroups.length",this.editorModel.quoteModel.lineGroups.length),i.lineGroups.length==t.PANEL_ADDED_INDEX?b(m.GROUP_PANEL_CREATED,{groupKey:a.groupVO.key}):b(m.BUILD_LAYOUT,{group:a}),this.editorModel.largeQuoteExperienceEnabled&&b(m.GROUP_ADDED,{groupKey:a.groupVO.key}),this.domHost.quoteHasNoLines()}},{key:"_createGroupRecord",value:function(e){var t={},i=this.editorModel.constants;return t[i.QUOTE_PROCESS_FIELD]=this.editorModel.data.defaultQuoteProcessId,t[i.ACCOUNT_FIELD]=e.quoteVO.record[i.ACCOUNT_FIELD],t[i.ACCOUNT_ID_FIELD]=e.quoteVO.record[i.ACCOUNT_ID_FIELD],t.attributes={type:this.prefix+"QuoteLineGroup__c"},t}},{key:"_extendSolutionGroupRecord",value:function(e){e.Name=this.eventDetail.customAction.record.Name,e[this.editorModel.constants.DESCRIPTION_FIELD]=this.eventDetail.customAction.record[this.editorModel.constants.DESCRIPTION_FIELD],e[this.editorModel.constants.SOLUTION_GROUP_ID_FIELD]=this.eventDetail.customAction.record.Id}},{key:"_openDialog",value:function(e){var t=this.$[e];if("Line"===this.eventDetail.customAction.location)t.favoritedLine=this.eventDetail.model.serviceModel.keys;else{var i=[].concat(this.eventDetail.model.standardLines).concat(this.eventDetail.model.segmentedLines);if(0===i.length)return void(this.domHost.errors=[y.properties.i18n.value().l("Please select a group with one or more lines to favorite.")]);t.favoritedGroup=this.eventDetail.model.groupKey,t.groupLines=i}t.$.dialog.toggle()}},{key:"_openPricingGuidanceDialog",value:function(e){var t=this.$[e],i=this.eventDetail.model.lineVO,n=this.editorModel.md.fieldLabelsMap[this.editorModel.constants.QUOTE_LINE],o=[],r=this.data.lineFieldNames,s=!1,a=!1,l={},u={},d=!1,c=[],h=this.eventDetail.model;if(i.quoteLinePricingGuidance&&i.quoteLinePricingGuidance.record){t.pricingGuidanceRecord=i.quoteLinePricingGuidance.record;var f={type:"percent",scale:2};if(null!=i.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_TARGET]){var p=i.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_TARGET],v=R.formatFieldData(h,p,f,i.record);this.pushPricingGuidanceValueToArray(o,"Target",v),a=s=!0}if(null!=i.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_NORM]){var g=i.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_NORM],y=R.formatFieldData(h,g,f,i.record);this.pushPricingGuidanceValueToArray(o,"Norm",y),a=!0}if(null!=i.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_FLOOR]){var m=i.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_FLOOR],b=R.formatFieldData(h,m,f,i.record);this.pushPricingGuidanceValueToArray(o,"Floor",b),a=!0}if(null!=i.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_EXPLANATION]){var _=i.quoteLinePricingGuidance.record[this.editorModel.constants.PRICING_GUIDANCE_EXPLANATION];this.pushPricingGuidanceValueToArray(o,"Explanation",_),a=!0}t.pricingGuidanceArray=o}a||(l={errorMessage:[this.domHost.i18n.l("PricingGuidanceNotAvailable")]});var C=N.prepareSingleLineData(h,0,r,this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName]);if(r){var S=!0,k=!1,O=void 0;try{for(var E,I=Object.values(r)[Symbol.iterator]();!(S=(E=I.next()).done);S=!0){var w=E.value;c.push({key:n[w],value:C[w]}),u[w]=n[w]}}catch(e){k=!0,O=e}finally{try{!S&&I.return&&I.return()}finally{if(k)throw O}}}this.editorModel.deviceContext&&this.editorModel.deviceContext.isMobile&&(d=!0),t.pricingGuidanceRecord=l,t.isPricingGuidanceAvailable=a,t.lineVO=i,t.isPricingRecommendationAvailable=s,t.isMobileDevice=d,t.quoteLineObjectArray=c,t.$.dialog.toggle();for(var M=i.record,L=this.data.developerPrefix,D=L+"IsViewed__c",T=L+"Product__c",P=M[T],F=this.eventDetail.model.groupModel.quoteVO.lineItems,A=0;A<F.length;A++)F[A].record[T]==P&&F[A].quoteLinePricingGuidance&&(F[A].quoteLinePricingGuidance.record[D]=!0);var x=this.eventDetail.model.groupModel.quoteModel.quoteVO.record.Id;(new j).log(x,B.PRICING_GUIDANCE,JSON.stringify({pricingGuidanceAction:"Viewed",quoteLineId:M.Id}))}},{key:"pushPricingGuidanceValueToArray",value:function(e,t,i){var n=this.domHost.i18n.l(t);e.push({name:t,value:i,displayName:n})}},{key:"sortLines",value:function(e,t){var i=e.lineSortField;return!(!e.lineSortField||i==this.editorModel.constants.NUMBER_FIELD||(b(m.SORT_LINES_REQUIRED,{lineSortField:i,notify:t}),0))}},{key:"_resetOnActionSignal",value:function(){b(m.RESET_ON_ACTION)}},{key:"_getDomHost",value:function(){return this.domHost}},{key:"_getViewport",value:function(){return o.getViewport()}},{key:"_getLineOrProdId",value:function(e){return e.Id||e[this.editorModel.constants.SOURCE_FIELD]||e[this.editorModel.constants.PRODUCT]}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"sb-favorite-saved":"_saveFavorite","sb-clone-to-group-selected":"_cloneToGroup","job-completed":"_jobCompleted","sb-accept-pricing-guidance":"_onAcceptPricingGuidance"}}},{key:"observers",get:function(){return["_executeCustomAction(eventDetail)","_handleCalculateResponse(calculateResponse)","_checkForGuidedMessages(saverResponse)","_reloadEditor(quoteEditorModelResponse)","_handleFavoriteResponse(favoriteResponse)","_handleUnfavoriteResponse(unfavoriteResponse)","_handleResegmentResponse(resegmentResponse)","_updateQuote(quoteVOResponse)","_handleToggleGroupResponse(toggleGroupResponse)","_handlePopupResponse(popupResponse)"]}},{key:"prefix",get:function(){if(void 0!==this.app)return this.app.org.prefix?this.app.org.prefix+"__":""}}]),M=e)),t("LECustomActionServices",M),Polymer(M)}}}),System.register("quotes/sb-line-sort/QuoteLineSort.js",["../layout/sb-le-table-cell/Localizer.js"],function(e,t){var s,l,u,d;function c(e,t){return e.lineVO.key-t.lineVO.key}function h(e,t){var i=u&&e.lineVO.record[l]?e.lineVO.record[l][u]:e.lineVO.record[l],n=u&&t.lineVO.record[l]?t.lineVO.record[l][u]:t.lineVO.record[l],o=void 0,r=void 0;if(l===d.LIST_PRICE_FIELD)o=e.lineVO.record[d.BUNDLED_FIELD],r=t.lineVO.record[d.BUNDLED_FIELD];else if(e.groupModel.quoteVO.localizationByFieldByProductId&&0<Object.keys(e.groupModel.quoteVO.localizationByFieldByProductId).length){i=s.getLocalizedValue(e,l,u)||i,n=s.getLocalizedValue(t,l,u)||n}return(i=a(i,o))==(n=a(n,r))?0:i<n?-1:n<i?1:null==i?-1:null==n?1:0}function f(e,t){var i=u&&e.lineVO.record[l]?e.lineVO.record[l][u]:e.lineVO.record[l],n=u&&t.lineVO.record[l]?t.lineVO.record[l][u]:t.lineVO.record[l],o=void 0,r=void 0;if(l===d.LIST_PRICE_FIELD)o=e.lineVO.record[d.BUNDLED_FIELD],r=t.lineVO.record[d.BUNDLED_FIELD];else if(e.groupModel.quoteVO.localizationByFieldByProductId&&0<Object.keys(e.groupModel.quoteVO.localizationByFieldByProductId).length){i=s.getLocalizedValue(e,l,u)||i,n=s.getLocalizedValue(t,l,u)||n}return(i=a(i,o))==(n=a(n,r))?0:n<i?-1:i<n?1:null==i?1:null==n?-1:0}function a(e,t){return t&&(e=0),"string"==typeof e?e.toUpperCase():void 0===e&&(e=null),e}return{setters:[function(e){s=e.Localizer}],execute:function(){d=u=l=void 0,e("depthFirstLineItemsTreeSort",function(t,e,i,n,o){var r=0;d=t[0].editorModel.constants;var s=n;l=t[0].segmented&&!t[0].lineVO.record[e]?d.NET_TOTAL_FIELD:e,u=o;var a=function(e){var i=void 0,n=void 0;return e.forEach(function(e){var t=e.lineVO.record[d.NUMBER_FIELD];e.visible?i=!i||t<i?t:i:n=!n||t<n?t:n}.bind(this)),{lowestVisibleNumber:i,lowestInvisibleNumber:n}}(t);return s?function e(t,i,n,o){var r=t[i];if(r){""===n?r.sort(c.bind(this)):"asc"===n?r.sort(h.bind(this)):"desc"===n&&r.sort(f.bind(this));for(var s=0;s<r.length;s++)o(r[s]),e(t,r[s].lineVO.key,n,o)}}(function(e){for(var t={},i=0;i<e.length;i++)t[e[i].lineVO.parentItemKey]||(t[e[i].lineVO.parentItemKey]=[]),t[e[i].lineVO.parentItemKey].push(e[i]);return t}(t),null,i,function(e){t[r++]=e}):"asc"===i?t.sort(h.bind(this)):"desc"===i?t.sort(f.bind(this)):""===i&&t.sort(c.bind(this)),t=function(e,t,i){if(0<i.length)var n=i[0].groupModel.quoteModel.indexByGroupKey,o=i[0].lineVO.parentGroupKey;for(var r=0;r<i.length;r++){var s=i[r].lineVO.key;i[r].lineVO.record[d.SEGMENT_KEY_FIELD]?n[o].indexBySegmentKey[i[r].lineVO.record[d.SEGMENT_KEY_FIELD]]=r:n[o].indexByLineKey[s]=r,i[r].visible?(i[r].lineVO.record[d.NUMBER_FIELD]=e,e++):(i[r].lineVO.record[d.NUMBER_FIELD]=t,t++)}return i}(a.lowestVisibleNumber,a.lowestInvisibleNumber,t)})}}}),System.register("quotes/sf-component-factory/SFComponentFactory.js",["common/forms/sb-field/factory/FieldFactory.js","common/core/AppContext.js","quotes/QuoteContext.js","common/forms/DependentPicklistBuilder.js"],function(t,e){var u,d,c,i;return{setters:[function(e){u=e.fieldFactory},function(e){d=e.AppContext},function(e){e.QuoteContext},function(e){c=e.DependentPicklistBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}"refDisplay",t("SFComponentFactory",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,null,[{key:"getFieldComponent",value:function(e,t,i,n){var o=e.type,r=e.name||e.fieldPath;n=n||t.lineVO.record;var s=null,a=null;if("reference"===o)s={refDisplay:n&&e.relationshipName&&n[e.relationshipName]?n[e.relationshipName].Name:"",refDisplayName:"refDisplay",refTable:function(e){if(void 0!==e)return e.referenceTable?e.referenceTable:e.referenceTo&&0<e.referenceTo.length?e.referenceTo[0]:null}(e),refObjects:[],record:n};else if("picklist"===o||"multipicklist"===o)if(e.controllerName){var l=n[e.controllerName];a=new c(e,l).build()}else a=e.picklistValues;return u(o,t,n[r],!0,!1,!1,i,e,d.i18n,"richtextarea"===e.extraTypeInfo,a,s)}}]),i=e)),t("SFComponentFactory",i)}}}),System.register("quotes/tables/QLESegmentedTableBehavior.js",["common/core/sb-page-container/PageContainer.js","../../common/Util.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.PageContainer},function(e){o=e.toFieldName}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("QLESegmentedTableBehavior",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"groupPanelToggled",value:function(e){this.drawerState=e.detail.drawerState,this._setColumnWidths(e)}},{key:"groupPanelCreated",value:function(e){this._setColumnWidths(e)}},{key:"groupToggled",value:function(e){this._ironListResize(e)}},{key:"_getFields",value:function(){var e=this.editorModel.fieldsetMap.multiSegmentLineSummaryFieldNames;return this.groupModel.segmentedSubscriptionScopeEditable?[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(e):e}},{key:"_setColumnWidths",value:function(e){var t={};if(!this.editorModel.deviceContext.isMobile&&this.editorModel.layout&&this.groupModel.colWidth[this.dimension]){if(!(t=this.groupModel.getDimensionColWidths(this.dimension)))return;this._setSubtotalColumnWidth(t,this.editorModel.layout.leftOffset)}this.set("columnWidths",t),this._ironListResize(e)}},{key:"_setSubtotalColumnWidth",value:function(e,t){if(e){for(var i=t,n=0,o=this.fieldNames.length;n<o;n++)i+=e[this.fieldNames[n]];this.labelColWidth=i+"px",this.totalColWidth=e.total+"px"}}},{key:"_setSubtotalColWidth",value:function(e,t){return t[o(e)]+"px"}},{key:"colWidthsChanged",value:function(e){this._setColumnWidths(e)}},{key:"_ironListResize",value:function(e){this.$$("iron-list")&&e&&e.detail&&e.detail.groupKey===this.groupModel.groupKey&&this.$$("iron-list").fire("iron-resize")}},{key:"onTrack",value:function(e){this.domHost.domHost._onTrack(e)}},{key:"getMultiSegmentColumnTotal",value:function(e){if(this.groupModel.multiSegmentColumnTotals[this.dimension])return[this.groupModel.multiSegmentColumnTotals[this.dimension][e]]}},{key:"getMultiSegmentTotalField",value:function(){if(this.groupModel.netMultiSegmentTotal)return this.groupModel.netMultiSegmentTotal[this.dimension]}},{key:"_showSubtotal",value:function(){this.currencyMd||(this.currencyMd={type:"currency",scale:this._getPriceScale(),CurrencyIsoCode:this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode}),"doNotDisplay"!=this.editorModel.data.settings.lineEditorSubtotalsField?(this._getNetTotalFieldMd(),this.showSubtotal=!0):this.showSubtotal=!1}},{key:"_getNetTotalFieldMd",value:function(){var e=this.editorModel.data.settings,t=e.lineEditorSubtotalsField;return{type:"currency",scale:e.isMultiCurrencyOrg?this.quoteVO.currencyDecimalScale:"Default"==t||"doNotDisplay"==t||null==t?this.editorModel.md.fieldsMap[e.developerPrefix+"QuoteLine__c"][this.editorModel.constants.NET_TOTAL_FIELD].scale:this.editorModel.md.fieldsMap[e.developerPrefix+"QuoteLine__c"][t].scale,CurrencyIsoCode:this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode}}},{key:"_onSortLinesByHeader",value:function(e){this.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension],e.detail.field,e.detail.order,!1,!0)}},{key:"sortLinesRequired",value:function(e){var t=e.detail.notify,i=e.detail.lineSortField;this.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension],i,"asc",!1,t)}},{key:"getZIndex",value:function(e){return this.lineModels.length+10-e}},{key:"_onUpdateSizeForItem",value:function(e){if(e.detail.index)this.$$("iron-list").updateSizeForItem(e.detail.index);else for(var t=0,i=this.lineModels.length;t<i;t++)this.$$("iron-list").updateSizeForItem(t)}},{key:"toggleOptional",value:function(e){if(!e.detail.groupKey||e.detail.groupKey==this.groupModel.groupVO.key)for(var t=0,i=this.groupModel.segmentedLinesByDimension[this.dimension].length;t<i;t++)for(var n=0,o=this.groupModel.segmentedLinesByDimension[this.dimension][t].segments.length;n<o;n++){var r=this.groupModel.segmentedLinesByDimension[this.dimension][t].segments[n];r.lineVO._transient_||(r.lineVO._transient_={},r.lineVO._transient_.original=r.lineVO._transient_.original||JSON.parse(JSON.stringify(r.lineVO.record))),this.set("groupModel.segmentedLinesByDimension."+this.dimension+"."+t+".segments."+n+".lineVO.record."+this.constants.OPTIONAL_FIELD,e.detail.toggleOptionalBoolean)}}},{key:"_resetOnAction",value:function(e){Array.from(this.lineModels).forEach(function(e){e.lineVO.expanded=!1})}},{key:"columnNamesChanged",value:function(e,t){}},{key:"observers",get:function(){return["_render(groupModel)","_segmentedLinesByDimensionChanged(groupModel.segmentedLinesByDimension.*)","_showSubtotal(groupModel.*)"]}},{key:"editorModel",get:function(){return this.groupModel.quoteModel.editorModel}},{key:"quoteVO",get:function(){return this.editorModel.quoteModel.quoteVO}},{key:"constants",get:function(){return this.editorModel.constants}}],[{key:"properties",get:function(){return{fieldNames:{type:Object},quoteLineFields:{type:Object},columnNames:{type:Array,observer:"columnNamesChanged"},currencyMd:{type:Object,computed:"_getNetTotalFieldMd(groupModel)"},viewport:{type:Object,value:function(){return i.getViewport()}},groupModel:Object}}}]),r=e)),t("QLESegmentedTableBehavior",r),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.QLESegmentedTableBehavior=r.prototype}}}),System.register("quotes/tables/QLEStandardTableBehavior.js",["common/core/sb-page-container/PageContainer.js","quotes/QuoteContext.js","common/layout/fields/FieldSetHandler.js","common/signal/RowFocusSignaler.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.PageContainer},function(e){o=e.QuoteContext},function(e){r=e.FieldSetHandler},function(e){s=e.RowFocusSignaler}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("QLEStandardTableBehavior",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"init",value:function(){this.groupModel&&(this.addEventListener("table-header-sort-clicked",this._onSortLinesByHeader),this.summaries=this.groupModel.quoteModel.grouped?this.groupModel.groupVO.summaries:this.groupModel.quoteModel.quoteVO.summaries,o.constants=this.editorModel.constants)}},{key:"_buildRows",value:function(){this.groupModel&&this.groupModel.quoteModel&&this.groupModel.quoteModel.editorModel&&this.editorModel.fieldsetMap&&(this.toggleClass("largeQuote",this.editorModel.largeQuoteExperienceEnabled,this),this.actionsOnTheLeft=this.editorModel.actionsOnTheLeft,this.multiLineDeleteEnabled=this.editorModel.data.settings.multiLineDeleteEnabled,this.fieldSetHandler=new r(this.editorModel.fieldsetMap,"lineFieldNames","lineFieldNamesTablet","lineFieldNamesPhone"),this._setFieldNames(),this.columnWidths={},this._setColumnWidths(),this.columnNames=null,this.fieldLabelsMap=this.editorModel.md.fieldLabelsMap[this.prefix+"QuoteLine__c"],this.quoteLineFields=this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName],this._setDrawerFields(),this.settings=this.editorModel.data.settings,this.postBuildRowRefresh(),this.$$("iron-list")&&this.groupModel.groupKey&&1==this.editorModel.quoteModel.quoteVO.lineItemGroups.length&&this.$$("iron-list").notifyResize())}},{key:"_setColumnWidths",value:function(e){var t=null;!this.editorModel.deviceContext.isMobile&&this.editorModel.layout&&(t=this.groupModel.colWidth.Standard,this._setSubtotalColumnWidth(t,this.editorModel.layout.leftOffset)),this.set("columnWidths",t),this._ironListResize(e)}},{key:"_setSubtotalColumnWidth",value:function(e,t){for(var i=t,n=this.fieldNames.length,o=0;o<n-1;o++)i+=e[this.fieldNames[o]];this.labelColWidth=i+6+"px";var r=e[this.fieldNames[this.fieldNames.length-1]];this.subtotalColWidth=r+6+"px"}},{key:"colWidthsChanged",value:function(e){this._setColumnWidths(e)}},{key:"_ironListResize",value:function(e){this.$$("iron-list")&&e&&e.detail&&e.detail.groupKey===this.groupModel.groupKey&&this.$$("iron-list").fire("iron-resize")}},{key:"_setDrawerFields",value:function(){var e=this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames,t=this.editorModel.deviceContext.isMobile;e&&!t?this.drawerFieldNames=e:e&&t&&(this.fieldNames=this.fieldNames.concat(e))}},{key:"_showSubtotal",value:function(){if(this.groupModel&&this.groupModel.quoteModel&&this.groupModel.quoteModel.editorModel&&this.editorModel.md){var e=this.editorModel.data.settings;this.subtotalMd||(this.subtotalMd={type:"currency",scale:this._getPriceScale(),CurrencyIsoCode:this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode}),"doNotDisplay"!=e.lineEditorSubtotalsField&&0<this.groupModel.standardLines.length?(this._getSubtotal(),this.showSubtotal=!0):this.showSubtotal=!1}}},{key:"_getPriceScale",value:function(){var e=this.editorModel.data.settings,t=e.lineEditorSubtotalsField;return e.isMultiCurrencyOrg?this.groupModel.quoteModel.quoteVO.currencyDecimalScale:"Default"==t||"doNotDisplay"==t||null==t?this.editorModel.md.fieldsMap[this.prefix+"QuoteLine__c"][this.editorModel.constants.NET_TOTAL_FIELD].scale:this.editorModel.md.fieldsMap[this.prefix+"QuoteLine__c"][t].scale}},{key:"_getSubtotal",value:function(){var e=void 0,t=void 0,i=this.editorModel.data.settings,n=this.groupModel.standardLines;e="Default"==i.lineEditorSubtotalsField||null==i.lineEditorSubtotalsField?this.editorModel.constants.NET_TOTAL_FIELD:i.lineEditorSubtotalsField;for(var o=t=0,r=n.length;o<r;o++){var s=n[o];isNaN(s.lineVO.record[e])||(t+=s.lineVO.record[e])}this.subtotal=t}},{key:"onTrack",value:function(e){this.removeCellFocus&&this.removeCellFocus(this.focusedCell),this.dragDrop._onTrack(e)}},{key:"dragFunc",value:function(e){var i=this.dragDrop;i.ghost=i.lineEditor.$.ghost,this.lineModelsByKey=this.groupModel.quoteModel.lineModelsByKey,i.dragKeys=[],i.dragStandardIndexes=[],i.dragMdqIndexesByDim={},i.dragLineModels=[],i.dragGroupModel=e.lineModel.groupModel,i.dragKeys.push(e.lineModel.lineVO.key),i.keepBundleTogether&&this._getBundleWithChildren(i.dragKeys[0],i.dragKeys),i.dragKeys.forEach(function(e){var t=this.lineModelsByKey[e];i.dragLineModels.push(t),this.lineModelsByKey[e].segmented?i.dragMdqIndexesByDim[t.dimensionType]?i.dragMdqIndexesByDim[t.dimensionType].push(this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[t.dimensionType],e)):i.dragMdqIndexesByDim[t.dimensionType]=[this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[t.dimensionType],e)]:i.dragStandardIndexes.push(this._getLineIndexFromKey(this.groupModel.standardLines,e))}.bind(this)),i.dragTargetElementIndex=this._getLineIndexFromKey(this.groupModel.standardLines,e.lineModel.lineVO.key);for(var t,n=0;n<i.dragStandardIndexes.length;n++)t=i.dragStandardIndexes[n],this.set("groupModel.standardLines."+t+".hidden",!0);if(0!=Object.keys(i.dragMdqIndexesByDim).length)for(var o in i.dragMdqIndexesByDim)for(var r,s=0;s<i.dragMdqIndexesByDim[o].length;s++)r=i.dragMdqIndexesByDim[o][s],this.set("groupModel.segmentedLinesByDimension."+o+"."+r+".hidden",!0);i.ghostField=e.lineModel.lineVO.record[this.editorModel.constants.PRODUCT_CODE_FIELD]}},{key:"trackFunc",value:function(e){var t=this.dragDrop,i=this.groupModel.editorModel.data.settings.bundleKeptTogether;if(this.groupModel.standardLines.length,e=t._findTableRowValidTarget(e))switch(t.targetClass){case"sb-droppable-standardRows":if(t.updateTableRowHoverOverObject(e),!t.hoverOver)return;t.targetHost=t.hoverOver.comp.domHost,t.usePlaceholder=!0,t.enableHighLight=!0;break;case"sb-droppable-emptyTable":i&&t.sourceElement.lineModel.hasParent?t.hoverOver=null:t.hoverOver={comp:e},t.usePlaceholder=!1,t.enableHighLight=!0;break;case"sb-droppable-sidePanelGroups":i&&t.sourceElement.lineModel.hasParent?t.hoverOver=null:t.hoverOver={comp:e},t.targetHost=t.hoverOver.comp.parentNode.parentNode,t.usePlaceholder=!1,t.enableHighLight=!0}else t.hoverOver=null}},{key:"_removeLinesByIndex",value:function(e){e.sort(function(e,t){return e-t});for(var t=0;t<e.length;t++)this.splice("groupModel.standardLines",e[t],1),e=e.map(function(e){return--e})}},{key:"_getBundleWithChildren",value:function(e,t){var i=void 0;if(this.dragDrop.linesByParentKey[e]){i=this.dragDrop.linesByParentKey[e].length;for(var n=0;n<i;n++){var o=this.dragDrop.linesByParentKey[e][n].lineVO.key;t.push(o),this.dragDrop.linesByParentKey[o]&&this._getBundleWithChildren(o,t)}}}},{key:"_getLineIndexFromKey",value:function(e,t){for(var i=0;i<e.length;i++)if(e[i].lineVO.key===t)return i}},{key:"_getStandardLineIndexesFromKeys",value:function(e,t){for(var i=[],n=0;n<t.length;n++)i.push(this._getStandardLineIndexFromKey(e,t[n]));return i}},{key:"_setFieldNames",value:function(){this.fieldSet=this.fieldSetHandler.getByViewport(this.viewport),this.fieldSetName!=this.fieldSet.name&&(this.fieldSetName=this.fieldSet.name),this.fieldNames=this._getFields()}},{key:"_getFields",value:function(){return this.groupModel.standardSubscriptionScopeEditable?[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields):this.fieldSet.fields}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport,this._setFieldNames()}},{key:"groupPanelToggled",value:function(e){this.drawerState=e.detail.drawerState,this._setColumnWidths(e)}},{key:"groupPanelCreated",value:function(e){this._setColumnWidths(e)}},{key:"groupToggled",value:function(e){var t=this;this._ironListResize(e),this._prepareUIData(),setTimeout(function(){t._onUpdateSizeForItem(e)})}},{key:"_prepareUIData",value:function(){}},{key:"toggleOptional",value:function(e){if(!e.detail.groupKey||e.detail.groupKey==this.groupModel.groupVO.key)for(var t=0,i=this.groupModel.standardLines.length;t<i;t++)this.set("groupModel.standardLines."+t+".lineVO.record."+this.editorModel.constants.OPTIONAL_FIELD,e.detail.toggleOptionalBoolean)}},{key:"getZIndex",value:function(e){return this.groupModel.standardLines.length+10-e}},{key:"sortLinesRequired",value:function(e){var t=e.detail.notify,i=e.detail.lineSortField;this.sortLines(this.groupModel.standardLines,i,"asc",!1,t)}},{key:"_updatePrimaryMobileColumnsObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._updatePrimaryMobileColumns(e,t)}},{key:"_updatePrimaryMobileColumns",value:function(){this.groupModel.editorModel.standardPrimaryMobileCols&&0<this.groupModel.editorModel.standardPrimaryMobileCols.length&&this.fieldSet.name.endsWith("Phone")&&(this.groupModel.editorModel.standardPrimaryMobileCols[0]=this.fieldSet.fields[0])}},{key:"_onUpdateSizeForItem",value:function(e){if(e.detail.index)this.$$("iron-list").updateSizeForItem(e.detail.index);else for(var t=0,i=this.groupModel.standardLines.length;t<i;t++)this.$$("iron-list").updateSizeForItem(t)}},{key:"_initVisibleLines",value:function(){return this.groupModel.standardLines.filter(function(e){return e.visible}.bind(this))}},{key:"_initTabIndex",value:function(){return this.viewport&&this.viewport.isMobile()?-1:0}},{key:"_updateDragDropParentKey",value:function(e){this.dragDrop&&e&&(this.dragDrop.linesByParentKey=e)}},{key:"forwardFocusDown",value:function(e){9!==e.keyCode||e.shiftKey||s.signalFirstEditableTargetFirstRow(this,this.getRowComponentName(),"data-index")}},{key:"forwardFocusUp",value:function(e){9===e.keyCode&&e.shiftKey&&s.signalLastEditableTargetLastRow(this,this.getRowComponentName(),this.visibleLines.length,"data-index")}},{key:"dropFunc",value:function(e,t,i,n){var o=void 0,r=e.domHost.domHost,s=this.dragDrop;s.dropKey=null,s.dropIndex=null,s.dropGroupModel=null;for(var a,l=0,u=s.dragStandardIndexes?s.dragStandardIndexes.length:0;l<u;l++)a=s.dragStandardIndexes[l],this.set("groupModel.standardLines."+a+".hidden",!1);if(0!=Object.keys(s.dragMdqIndexesByDim).length)for(var d in s.dragMdqIndexesByDim)for(var c,h=0;h<s.dragMdqIndexesByDim[d].length;h++)c=s.dragMdqIndexesByDim[d][h],this.set("groupModel.segmentedLinesByDimension."+d+"."+c+".hidden",!1);if(t){switch(e.lineModel.subscriptionScopeEditable&&(t.domHost.groupModel.colWidth=e.lineModel.groupModel.colWidth,s.dragGroupModel._updateStandardSubscriptionScopeEditable(e.lineModel),this._setFieldNames(),this._setColumnWidths()),this._removeLinesByIndex(s.dragStandardIndexes),i){case"sb-droppable-standardRows":s.dropKey=t.lineModel.lineVO.key,s.dropGroupModel=t.lineModel.groupModel,s.dropIndex=this._getLineIndexFromKey(s.dropGroupModel.standardLines,s.dropKey),o=t.domHost.domHost,n?s.dropIndex=0<=s.dropIndex?s.dropIndex:0:++s.dropIndex;break;case"sb-droppable-emptyTable":case"emptyTableMessage":o=Polymer.dom(t).getOwnerRoot().host,s.dropGroupModel=o.groupModel;break;case"sb-droppable-sidePanelGroups":var f="Group"+t.getAttribute("id"),p=s._findParentCustomElement(t,"groupContainer","id");o=p.querySelector("#"+f),s.dropGroupModel=o.groupModel}for(var v=0;v<s.dragLineModels.length;v++)if(s.dragLineModels[v].segmented){if(s.dragGroupModel.groupKey===s.dropGroupModel.groupKey)continue;s.dropGroupModel.dimensions.includes(s.dragLineModels[v].segmentType)?o.addSegmentedLineToExistingTab(s.dragLineModels[v]):o.addSegmentedLineToEmptyTable(s.dragLineModels[v])}else{if(s.dragLineModels[v].subscriptionScopeEditable&&(s.dropGroupModel.standardSubscriptionScopeEditable=s.dragLineModels[v].quoteModel.grouped,Polymer.RenderStatus.afterNextRender(Polymer.dom(o.root).querySelector("#standardLines"),function(){Polymer.dom(o.root).querySelector("#standardLines")._setFieldNames(),Polymer.dom(o.root).querySelector("#standardLines")._setColumnWidths()})),s.dragLineModels[v].visible)switch(i){case"sb-droppable-standardRows":t.domHost.splice("groupModel.standardLines",s.dropIndex,0,s.dragLineModels[v]);break;case"sb-droppable-emptyTable":case"emptyTableMessage":case"sb-droppable-sidePanelGroups":o.push("groupModel.standardLines",s.dragLineModels[v])}else o.push("groupModel.standardLines",s.dragLineModels[v]);s.dragLineModels[v].groupModel=s.dropGroupModel,s.dragLineModels[v].lineVO.parentGroupKey=s.dropGroupModel.groupKey,s.dropIndex++}if(0!=Object.keys(s.dragMdqIndexesByDim).length)for(var g in s.dragMdqIndexesByDim){s.dragMdqIndexesByDim[g].reverse();for(var y,m=0;m<s.dragMdqIndexesByDim[g].length;m++)if(y=s.dragMdqIndexesByDim[g][m],this.set("groupModel.segmentedLinesByDimension."+g+"."+y+".hidden",!1),s.dragGroupModel.groupKey!==s.dropGroupModel.groupKey){var b=r.groupModel.segmentedLinesByDimension[g][y];r.removeSegmentedLine(b)}}this.fire("renumber-lines"),this.editorModel.data.settings.usesClientCalculator&&this.editorModel.quoteModel.renumberIndexes(!0),this.postDrop(e,t)}}},{key:"_lineSplicesListener",value:function(e){e&&(this.set("groupModel.hasVisibleStandardLines",this.groupModel._groupHasStandardProducts()),this._showSubtotal())}},{key:"postDrop",value:function(e,t){}},{key:"postBuildRowRefresh",value:function(){}},{key:"observers",get:function(){return["_buildRows(groupModel)","_updatePrimaryMobileColumnsObserver(fieldSet, groupModel.editorModel.standardPrimaryMobileCols)","_lineSplicesListener(groupModel.standardLines.splices)","_showSubtotal(groupModel.*)","_updateDragDropParentKey(groupModel.editorModel.quoteModel.linesByParentItemKey)"]}},{key:"editorModel",get:function(){return this.groupModel.quoteModel.editorModel}},{key:"md",get:function(){return this.editorModel.md}},{key:"prefix",get:function(){return this.editorModel.data.developerPrefix}}],[{key:"properties",get:function(){return{groupModel:{type:Object,notify:!0},settings:Object,fieldNames:Array,quoteLineFields:Object,fieldLabelsMap:{type:Object,notify:!0},subtotal:{type:Number},subtotalMd:Object,dragDrop:Object,viewport:{type:Object,value:function(){return i.getViewport()}},visibleLines:{type:Array,computed:"_initVisibleLines(groupModel)"},tabIndex:{type:Number,computed:"_initTabIndex(viewport)"}}}}]),a=e)),t("QLEStandardTableBehavior",a),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.QLEStandardTableBehavior=a.prototype}}}),System.register("quotes/tables/SFAbstractTable.js",["quotes/layout/template-generator/TemplateGenerator.js","quotes/layout/template-generator/LETemplateGenerator.js","quotes/layout/template-generator/MobileLETemplateGenerator.js","common/core/AppContext.js"],function(e,t){var m,r,s,a,i,b,o;function _(e,t,i){if(e){var n=e.tagName,o=t?"previousElementSibling":"nextElementSibling";if(i){var r=void 0;if(null===e.dataIndex||void 0===e.dataIndex)r=e.parentElement[o];else{var s=parseInt(e.dataIndex,10),a=t?s-1:s+1;(r=e.parentElement.parentElement.querySelector(n+'[data-index="'+a+'"]'))&&(r=r.parentElement)}for(;r;){var l=!0,u=!1,d=void 0;try{for(var c,h=r.children[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var f=c.value;if(f&&f.tagName==n&&"none"!==f.style.display)return f}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}r=r[o]}}else for(var p=e[o];p;){if(p&&p.tagName==n)return p;p=p[o]}return null}}function C(e,t){var i=e?e.getAttribute("field"):null;return t||(t=e?S(e):null),t&&i?t._getFieldMetadata(i):null}function S(e){if(e&&e.parentElement)return"SF-LE-TABLE-ROW"===e.parentElement.tagName||"UBP-RATE-ROW"===e.parentElement.tagName?e.parentElement:S(e.parentElement)}return{setters:[function(e){m=e.TemplateGenerator},function(e){r=e.LETemplateGenerator},function(e){s=e.MobileLETemplateGenerator},function(e){a=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y)}i=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},13,32,27,9,37,39,38,40,b={INPUT:new Set([37,39]),TEXTAREA:new Set([37,39,38,40]),SELECT:new Set([38,40])},e("SFAbstractTable",(i(y,[{key:"getTemplateGenerator",value:function(e,t,i,n,o){return a.isMobile?new s(e,t,i,n,o):new r(e,t,i,n,o)}},{key:"_onFocusOut",value:function(e){var o=this,t=!1;if(null!=e.relatedTarget&&null!=e.relatedTarget.parentElement&&"SB-CUSTOM-ACTION"===e.relatedTarget.parentElement.tagName&&null!=e.relatedTarget.parentElement.customAction){var i=e.relatedTarget.parentElement.customAction.eventHandlerName;"onQuickSave"!==i&&"onSave"!==i&&"onFlagCalculate"!==i||(t=!0)}setTimeout(function(e){for(var t=null,i=!1,n=document.activeElement;n;){if(n.classList&&n.classList.contains("focusable"))t=n;else if("SF-STANDARD-TABLE"===n.tagName||"SF-SEGMENTED-TABLE"===n.tagName||"UBP-RATE-TABLE"===n.tagName){i=Polymer.dom(n).node===o;break}n=n.parentElement}null!==t&&i||o.removeCellFocus(o.focusedCell,e)},5,t)}},{key:"_onKeyDown",value:function(e){switch(e.keyCode){case 13:this._onEnterKeyPress(e);break;case 32:this._onSpaceBarPress(e);break;case 27:this._onEscapePress(e);break;case 9:this._moveCellFocus(e,e.shiftKey?"left":"right");break;case 37:this._moveCellFocus(e,"left");break;case 38:this._moveCellFocus(e,"up");break;case 39:this._moveCellFocus(e,"right");break;case 40:this._moveCellFocus(e,"down")}}},{key:"_onEscapePress",value:function(e){this._routeKeyEvent(e)||(this._toggleInlineEditIfFocused(e,!1),this._editOnFocus=!1,this.focusedCell&&this.applyCellFocus(this.focusedCell))}},{key:"_onSpaceBarPress",value:function(e){this._routeKeyEvent(e)||(this._editOnFocus=!!this._toggleInlineEditIfFocused(e,!0))}},{key:"_routeKeyEvent",value:function(e){var t=S(e.target);if(t&&t.onKeyDown)return t.onKeyDown(e)}},{key:"_onEnterKeyPress",value:function(e){var t=y.findCell(e,this.getCellClass());if(this._isCellFocusedAndInteractive(t)){var i=t.classList.contains(m.classNames.EDIT_MODE),n=C(t);if(n&&i&&("textarea"===n.type||"reference"===n.type||"id"===n.type))return;i&&document.activeElement&&document.activeElement.blur(),this._editOnFocus=!!this._toggleInlineEditIfFocused(e,!i),i&&this.focusedCell&&this.applyCellFocus(this.focusedCell)}}},{key:"_toggleTappableCell",value:function(e,t,i){return!!e.classList.contains(m.classNames.TAPPABLE)&&(t.hook_onTap(i,!1),!0)}},{key:"_openLookupDialog",value:function(){this.keepEditableFocus=!0}},{key:"_closeLookupDialog",value:function(){this.keepEditableFocus=!1}},{key:"_toggleInlineEditIfFocused",value:function(e,t){var i=y.findCell(e,this.getCellClass());if(this._isCellFocusedAndInteractive(i)){var n=S(i);if(n)return!this._toggleTappableCell(i,n,e)&&(n.toggleInlineEdit(i,t),!0)}}},{key:"_isCellFocusedAndInteractive",value:function(e){return e&&e.classList&&e.classList.contains(m.classNames.HAS_FOCUS)&&(e.classList.contains(m.classNames.EDITABLE)||e.classList.contains(m.classNames.TAPPABLE))}},{key:"unfocus",value:function(){this.removeCellFocus(this.focusedCell)}},{key:"removeCellFocus",value:function(e,t){if(e&&e.classList&&e.classList.contains(m.classNames.HAS_FOCUS)&&!this.keepEditableFocus){var i=S(e);return i&&(i.toggleInlineEdit(e,!1,!1,t),i.toggleCellClass(m.classNames.HAS_FOCUS,!1,e,e.getAttribute("field"))),e===this.focusedCell&&(this.focusedCell=null),i}}},{key:"applyCellFocus",value:function(t){var i=this;t&&t.classList&&setTimeout(function(){!t.classList.contains("focusable")&&t.querySelector(".focusable")&&(t=t.querySelector(".focusable")),i._isMobile()||t.focus();var e=S(t);e&&e.toggleCellClass(m.classNames.HAS_FOCUS,!0,t,t.getAttribute("field")),i.focusedCell!==t&&i.focusedCell&&i.removeCellFocus(i.focusedCell),i.focusedCell=t},10)}},{key:"_isMobile",value:function(){return a.isMobile}},{key:"setEditOnFocus",value:function(e){this._editOnFocus=e}},{key:"_moveCellFocus",value:function(e,t){if(e&&t&&!function(e){var t=e.target&&e.target.tagName?e.target.tagName:"",i=b[t];return i&&i.has(e.keyCode)}(e)){var i=y.findCell(e,"focusable");if(i){var n=S(i),o=n,r=null;if(n){var s=n.getContentNode().querySelector("div");switch(t){case"up":case"down":var a="up"===t,l=i.classList.contains(m.classNames.EDIT_MODE),u=C(i,n);if(u&&l&&("reference"===u.type||"id"===u.type||"date"===u.type||"datetime"===u.type))return;var d=_(n,a,this._rowHasParentDiv());if(d){o=d;var c=function(e,t){for(;t.parentElement!==e&&t.parentElement;)t=t.parentElement;return Array.from(e.children).indexOf(t)}(s,i);r=d.getCellByIndex(c)}break;case"left":case"right":var h=s.querySelectorAll(".focusable"),f=Array.from(h).indexOf(i),p="left"==t,v=h.length;if(0==f&&p||!p&&f==v-1){var g=_(n,p,this._rowHasParentDiv());g&&(o=g,r=p?g.getCellByIndex(v-1):g.getCellByIndex(0))}else r=h[f+(p?-1:1)]}}r&&(this.applyCellFocus(r),this._editOnFocus&&o&&o.toggleInlineEdit(r,!0,!0))}}}},{key:"_rowHasParentDiv",value:function(){return this.editorModel&&this.editorModel.largeQuoteExperienceEnabled}},{key:"getCellClass",value:function(){return"sf-le-table-cell"}}],[{key:"findCell",value:function(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"sf-le-table-cell";return Polymer.dom(e).path.find(function(e){var t=e.classList;return t&&t.contains(i)})}}]),o=y)),e("SFAbstractTable",o),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.SFAbstractTable=o.prototype}}}),System.register("quotes/tables/SFTableHeaderBehavior.js",["common/core/AppContext.js"],function(t,e){var r,i;return{setters:[function(e){r=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFTableHeaderBehavior",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"startResize",value:function(e){if(r.isColumnResizingEnabled){e.preventDefault();var t=e.target,i=t.parentElement;if(t.classList.contains("col-adj-bar")&&null!=i.getAttribute("field")){var n=this.querySelector("div#col-resize-indicator"),o=this.getBoundingClientRect().x;(document._currentHeaderSource=this)._currentHeaderCell=i,this._currentCellWidth=parseFloat(i.style.maxWidth.replace("px","")),this._mouseXStartPos=e.clientX-o,this._currOffset=-o,n.style.transform="translate3d("+this._mouseXStartPos+"px, 0px, 0px)",n.style.visibility="visible",this._changeVisibilityOnColAdjBars(this,"hidden"),document.addEventListener("mousemove",this._onResize,!1),document.addEventListener("mouseup",this._stopResize,!1)}}}},{key:"_onResize",value:function(e){var t=this._currentHeaderSource,i=t.querySelector("div#col-resize-indicator"),n=e.clientX+t._currOffset,o=t._mouseXStartPos-n,r=t._currentCellWidth-o;67<r&&(t._currentCellWidth=r,t._mouseXStartPos=n,i.style.transform="translate3d("+t._mouseXStartPos+"px, 0px, 0px)")}},{key:"_stopResize",value:function(e){e.preventDefault();var t=this._currentHeaderSource,i=t._currentHeaderCell,n=t.querySelector("div#col-resize-indicator");t._changeVisibilityOnColAdjBars(t,"visible"),n.style.visibility="hidden",this.removeEventListener("mousemove",t._onResize,!1),this.removeEventListener("mouseup",t._stopResize,!1),t.fire("sf-col-size-adjusted",{fieldsWidth:t._currentCellWidth,field:i.getAttribute("field"),dimension:t.lineModels[0].dimensionType,fieldSet:t.fieldSetName}),delete this._currentHeaderSource}},{key:"onHover",value:function(e){var t=this.findElementForEvent(e,"th");if(t){var i=t.getAttribute("field");if(i)return void this.showTooltip(t,this.getTooltipContent(i))}}},{key:"showTooltip",value:function(e,t){if(!e.querySelector("paper-tooltip")){var i=document.createElement("paper-tooltip");i.position="bottom",i.animationDelay=0,i.fitToVisibleBounds="true",e.appendChild(i),Polymer.dom(i).textContent=t}}},{key:"onTap",value:function(e){if(!this.onTap_hook(e)){var t=this.findElementForEvent(e,"checkboxcontainer");if(t)this.toggleSelection(t);else{var i=this.findElementForEvent(e,"sortable");i&&this.sortLines(i)}}}},{key:"findElementForEvent",value:function(e,i){return Polymer.dom(e).path.find(function(e){var t=e.classList;return t&&t.contains(i)})}},{key:"_columnsResized",value:function(i,e){var n=this;null!=i&&null!=e&&Object.keys(i).forEach(function(e){var t=n.$$("div.th[field='"+e+"']");t&&(t.style.minWidth=i[e]+"px",t.style.maxWidth=i[e]+"px")})}},{key:"_changeVisibilityOnColAdjBars",value:function(e,t){e.querySelectorAll(".col-adj-bar").forEach(function(e){e.style.visibility=t})}},{key:"sortLines",value:function(e){this.lastSortedByField!==e.getAttribute("field")&&(this.byOrder=""),this.resetHeaderCellStyles(),this.updateSortColumnHeaderStyles(e,this._getNewByOrder(this.byOrder)),this._fireSortClickedEvent(e)}},{key:"resetHeaderCellStyles",value:function(){for(var e=this.querySelectorAll(".sortable"),t=0;t<e.length;t++)this._resetHeaderCellState(e[t])}},{key:"_resetHeaderCellState",value:function(e){var t=e.querySelector(".arrow");t&&(this.toggleClass("sf-icon-arrowup",!1,t),this.toggleClass("sf-icon-arrowdown",!1,t),this.toggleClass("arrow-on-hover",!0,e),this.toggleClass("column-selected",!1,e))}},{key:"_fireSortClickedEvent",value:function(e){var t={lineSortField:e.getAttribute("field"),order:this.byOrder};this.fire("table-header-sort-clicked",t)}},{key:"_getNewByOrder",value:function(e){switch(e){case"asc":return"desc";case"desc":return"";case"":default:return"asc"}}},{key:"updateSortColumnHeaderStyles",value:function(e,t){var i=e.querySelector(".arrow");this.toggleClass("column-selected",!0,e),this.toggleClass("arrow-on-hover",!1,e),"asc"===t?(this.toggleClass("sf-icon-arrowup",!0,i),this.toggleClass("sf-icon-arrowdown",!1,i)):"desc"===t?(this.toggleClass("sf-icon-arrowup",!1,i),this.toggleClass("sf-icon-arrowdown",!0,i)):""===t&&this._resetHeaderCellState(e),this.lastSortedByField=e.getAttribute("field"),this.byOrder=t}},{key:"toggleSelection",value:function(e){}},{key:"onTap_hook",value:function(e){}},{key:"getTooltipContent",value:function(e){return""}},{key:"setSort",value:function(e,t){if(e!==this.lastSortedByField||t!==this.byOrder){this.resetHeaderCellStyles();var i=this._getHeaderCell(e);i&&this.updateSortColumnHeaderStyles(i,t)}}},{key:"_getHeaderCell",value:function(e){return this.querySelector("div[field='"+e+"']")}}],[{key:"properties",get:function(){return{columnWidths:{type:Object,observer:"_columnsResized"},byOrder:{type:String,value:null},lastSortedByField:{type:String,value:null},fieldSetName:String}}}]),i=e)),t("SFTableHeaderBehavior",i),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.SFTableHeaderBehavior=i.prototype}}}),System.register("quotes/ui-data-manager/UIDataManager.js",["common/formatter/Formatter.js","quotes/QuoteContext.js","common/core/AppContext.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/sf-component-factory/SFComponentFactory.js","quotes/layout/sb-le-table-cell/Localizer.js","common/Util.js"],function(t,e){var l,u,d,c,h,f,i;return{setters:[function(e){l=e.Formatter},function(e){u=e.QuoteContext},function(e){d=e.AppContext},function(e){c=e.TemplateGenerator},function(e){e.SFComponentFactory},function(e){h=e.Localizer},function(e){f=e.toFieldName}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("UIDataManager",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,null,[{key:"prepareLineData",value:function(e,n,o){var r=[];return e&&e.forEach(function(e,t){null==e.lineVO.ui_original_record&&(e.lineVO.ui_original_record=JSON.parse(JSON.stringify(e.lineVO.record)));var i=this.prepareSingleLineData(e,t,n,o);r.push(i)}.bind(this)),r}},{key:"prepareSingleLineData",value:function(i,e,t,n){var o=i.lineVO.record,r={Id:o.Id},s=i.lineVO.fieldVisibility;t.forEach(function(e){var t=n[e];r[e]=this.prepareFieldData(o,e,t,i,s),this.computeCellClass(o,e,r,i,s,t)}.bind(this)),i.hasOwnProperty("segments")&&this.prepareSegmentedLineData(i,o,r,n,s);var a=i.editorModel.constants;return r.lineNumber=o[a.NUMBER_FIELD],r.rowIndex=e,r.lineModel=i,this.prepareSelectionCheckbox(i,r),this.prepareWarningIcon(i,r),this.prepareBundleCaret(i,r),r._cellClasses||(r._cellClasses={}),r}},{key:"prepareBundleCaret",value:function(e,t){e.editorModel.isProductHierarchyVisualized()&&!e.segmented&&e.isBundle?(t._caretContent=e.bundleCollapsed?c.classNames.CHEVRON_RIGHT_CONTENT:c.classNames.CHEVRON_DOWN_CONTENT,d.isBundleCollapsible(e.editorModel)&&(t._cellClasses=t._cellClasses||{},t._cellClasses._isFocusable="focusable")):t._caretContent=""}},{key:"prepareSelectionCheckbox",value:function(e,t){e.editorModel.data.settings.multiLineDeleteEnabled&&e.component&&(t._cellClasses=t._cellClasses||{},t._cellClasses._selectionCB=c.classNames.DISABLED)}},{key:"prepareWarningIcon",value:function(e,t){!1===e.lineVO.validPricebookEntryExists&&(t.hasLineWarning=!0,e.groupModel.quoteModel.isPrimary&&0==e.lineVO.opportunityLineItemExists?(t.lineWarningKey="missingOpportunityLineItem",t.lineWarningMsg="This product will not sync to the opportunity because a valid pricebook entry does not exist."):(t.lineWarningKey="invalidPricebookEntry",t.lineWarningMsg="There is not a valid price book entry for this line item."))}},{key:"prepareFieldData",value:function(e,t,i,n,o){if(o&&!1===o[t])return"";if(u.isSubscriptionScopeField(t)&&!n.subscriptionScopeEditable)return"";if(n.bundled&&u.isListPriceField(t))return d.properties.i18n.value().l("Included");var r=h.getLocalizedValue(n,t);if(r)return r;if(i){var s=this._getFieldMetadata(e,i,n),a=n.lineVO.ui_original_record;return e.Id||e.hasOwnProperty(t)||!a||a.Id||a.hasOwnProperty(t)||!s.defaultValue||(n.lineVO.ui_original_record[t]=s.defaultValue,e[t]=s.defaultValue),l.formatFieldData(n,e[t],s,e)}return e[t]}},{key:"_getFieldMetadata",value:function(e,t,i){var n="currency"===t.type,o=i.editorModel.constants.QUANTITY_FIELDS.has(t.name)&&null!==i.lineVO.productQuantityScale;return(n||o)&&(t=JSON.parse(JSON.stringify(t)),n&&(t.CurrencyIsoCode=e.CurrencyIsoCode),o&&(t.scale=i.lineVO.productQuantityScale)),t}},{key:"prepareSegmentedLineData",value:function(i,e,n,o,r){var s=this,a={};e.CurrencyIsoCode&&(a.CurrencyIsoCode=e.CurrencyIsoCode);var l=i.editorModel.constants;i.segments.forEach(function(e){var t=f(e.lineVO.record[l.SEGMENT_LABEL_FIELD]);a[t]=e.lineVO.record[l.NET_TOTAL_FIELD]});var t=i.editorModel.quoteModel.quoteVO;a.total=t.multiSegmentRowTotals[e[l.SEGMENT_KEY_FIELD]],Object.keys(a).forEach(function(e){var t=o[l.NET_TOTAL_FIELD];n[e]=s.prepareFieldData(a,e,t,i,r),s.computeCellClass(a,e,n,i,r,o[e])}),n._cellClasses._expansionIcon=i.lineVO.expanded?c.classNames.DOWN_ICON:c.classNames.RIGHT_ICON}},{key:"computeCellClass",value:function(e,t,i,n,o,r){var s="";o&&!1===o[t]||(s+=n.isEditable(t)&&!n.dimensionType?c.classNames.EDITABLE+" ":"",s+=n.itemClassMap[t]?n.itemClassMap[t]:""),o&&!1===o[t]&&r&&"boolean"===r.type&&(s+=c.classNames.HIDE_CHECKBOX+" "),n.editorModel.isProductHierarchyVisualized()&&!n.segmented&&(s+=this.computeProductHierarchyCss(t,e,n)),d.isBundleCollapsible(n.editorModel)&&!n.isBundle&&(s+=" focusable");var a=n.cellClasses?n.cellClasses[t]:null;if(a)for(var l in a)a[l]&&(s+=" "+l);s&&(i._cellClasses=i._cellClasses||{},i._cellClasses[t]=s)}},{key:"computeProductHierarchyCss",value:function(e,t,i){var n="",o=c.classNames;return d.isMobile?(u.isProductNameField(e)||u.isNetTotalField(e))&&null!==t[u.constants.OPTION_LEVEL_FIELD]&&(n+=""+o.INDENT+t[u.constants.OPTION_LEVEL_FIELD]+" "):u.isProductNameField(e)&&(i.isBundle||i.component||(n+=o.TOP_LEVEL+" "),i.component&&(i.isBundle||(n+=o.OPTION+" "),n+=""+o.INDENT+t[u.constants.OPTION_LEVEL_FIELD]+" ")),n}}]),i=e)),t("UIDataManager",i)}}}),System.register("quotes/usage-based-pricing-dao/UsageBasedPricingDao.js",["common/core/AppContext.js","common/data/client/ServiceClient.js","common/Util.js","quotes/models/ClientCache.js","quotes/QuoteContext.js","common/data/cache/Cache.js"],function(e,t){var n,o,y,s,m,b,_,C,u,S;function d(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function k(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function c(e){b("UBPClientState",["requestCount"],m("UBPClientState",["requestCount"])+e)}function h(){var e=m("UBPClientState",[]),t=e.quoteLineOrProdId,i=e.categoryIndex,n=m(t,["related","categoryIds"]);return n?n[i]:null}function O(e,t){return e+"_"+t}function f(e,t,i){return(new o).load(n.org.prefix,e,t,i)}return{setters:[function(e){n=e.AppContext},function(e){o=e.ServiceClient},function(e){y=e.mergeRec,s=e.pathMutate},function(e){m=e.get,b=e.put},function(e){_=e.QuoteContext},function(e){C=e.Cache}],execute:function(){function a(e,t,i,n){return c(1),o(e,t,i,n).then(function(){c(-1)}).catch(function(e){throw c(-1),e})}function o(n,o,e,r){return e(n,o).then(function(e){var t=r(e,n,o);for(var i in t)b(i,[],y(m(i,[]),t[i]))}).catch(function(e){throw b("UBPClientState",["errorMsg"],[e instanceof Error?e.message:e]),e})}function l(e,t,i){var n=m("UBPClientState",[]),o=n.quoteLineOrProdId,r=n.queryLimit,s=n.searchKeyword,a=[{field:t,order:i}],l=_.constants.prefix+"ProcessingOrder__c";return t!==l&&a.push({field:l,order:"asc"}),{quoteLineOrProdId:o,queryLimit:r,searchKeyword:s,offSet:e,sortOrders:a,currencyCode:m(o,["record","CurrencyIsoCode"])}}function r(e,s,t){if(e.rateFieldsMd){var i=e.rateFieldsMd,n={},o={};Object.keys(i).forEach(function(e){var t=i[e].scale?k({},e,{scale:i[e].scale}):{};Object.assign(n,k({},e,i[e].updatable)),o=S({},o,t)}),b("ConsumptionRateMetadata",["rateEditable"],n),b("ConsumptionRateMetadata",["rateScale"],o)}var r=t.sortOrders[0],a=r.field,l=r.order,u=m("ConsumptionRateMetadata",["rateScale"]),d={},c=[];u?e.categories.forEach(function(e){var t=e.fields.map(function(e){var t=e.fieldPath,i=u[t]?u[t]:{};return S({},e,i)});e.fields=t,c.push(e)}):c=e.categories;var h=c.map(function(e){var t=e.name,i=e.nameSpace,n=e.label,o=e.fields,r=O(s,t);return d[r]={name:t,nameSpace:i,label:n,fields:o,sortField:a,sortOrder:l},r}),f=[];if(e.qlFieldMD){var p=C.get("describe",_.constants.prefix+"QuoteLine__c","value");p&&p.fields?e.qlFieldMD.forEach(function(t){var e=p.fields.find(function(e){return e.name===t.fieldPath});f.push(Object.assign(t,e||{}))}):f=e.qlFieldMD}d[s]={related:{categoryIds:h,ubpFields:f}},e.customLabels&&(d.ubpLabels=e.customLabels);var v=e.resultSet.categoryName;return d.UBPClientState={categoryIndex:h.indexOf(O(s,v))},y(d,g(e,s,S({},t,{category:v})))}function g(e,t,i){var n=e.resultSet,o=n.totalCount,r=n.records,s=i.offSet,a=O(t,i.category),l={};l[a]={rateCount:o};var u=m(a,["orderedRates"])||[];return s<=u.length&&(r=r||[],l[a].orderedRates=[].concat(d(u.slice(0,s)),d(r.map(function(e){return l[e.Id]={record:e},e.Id})))),l}function t(e,t,i){var n=e.fields,o=e.record,r={};return r[i.categoryId]={rateCardFields:n},r[t]={record:o},r}u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},e("loadUbp",function(){var e=m("UBPClientState",["quoteLineOrProdId"]),t=null==m("ConsumptionRateMetadata"),i=m("ubpLabels",["labels"]),n=null==i;return a(e,S({},l(0,_.constants.UBP_FIELDS.ConsumptionSchedule+".Name","asc"),{loadCategories:!0,shouldLoadRateFieldsMd:t,shouldLoadLabels:n}),function(e,t){return f("ConsumptionServiceProvider.UBPLoader",e,t)},r)}),e("loadRates",function(e){var t=h();if(!t)return Promise.resolve();var i=m(t,[]),n=i.name,o=i.nameSpace,r=i.sortField,s=i.sortOrder;return a(m("UBPClientState",["quoteLineOrProdId"]),S({},l(e,r,s),{category:n,nameSpace:o}),function(e,t){return f("ConsumptionServiceProvider.ConsumptionCategoryRateLoader",e,t)},g)}),e("loadRateCardSummary",function(e){return o(e,{categoryId:h()},function(e,t){return f("ConsumptionServiceProvider.ConsumptionScheduleLoader",e,t)},t)}),e("getDataFromCache",function(e,t){return m(e,t)}),e("getDataFromCacheAsync",function(t,i,e){var n=m(t,i);if(n||!e)return Promise.resolve(n);if("function"==typeof e)return e().then(function(e){return Promise.resolve(m(t,i))});throw new Error("Expecting loadFunction to be a function but got "+(void 0===e?"undefined":u(e)))}),e("handleRequestSync",a),e("handleRequest",o),e("getLoadRatesContext",l),e("normalizeUbp",r),e("normalizeRates",g),e("normalizeRateCardSummary",t),e("overrideRecValues",function(e,t,i){var n=JSON.parse(JSON.stringify(e));return t&&i.forEach(function(e){t.hasOwnProperty(e.fieldPath)&&s(n,e.fieldPath.split("."),t[e.fieldPath])}),n})}}}),System.register("recommendations/sb-recommendation-lookup/RecommendationLookup.js",["common/core/Page.js","common/data/format/ErrorFormatter.js","products/localization/LocalizeFields.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.Page},function(e){o=e.formatError},function(e){r=e.LocalizeFields}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("RecommendationLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),s(e,[{key:"beforeRegister",value:function(){this.is="sb-recommendation-lookup",this.properties=Polymer.Base.extend({lineEditorModel:Object,selectedProducts:{type:Object,value:{}},errors:{type:Array,value:[],notify:!0},error:{type:Array,value:[]},qId:String,redirectUrl:String},i.properties)}},{key:"ready",value:function(){this.handleSelectButtonClickedServerResponseAndNavigation(),this.$.lookupLayout.additionalFields=["PricebookEntry.UnitPrice"]}},{key:"handleProductsLoadServerResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.quote=e.detail.value.quote,this.localizer=new r(this.app.org.prefix?this.app.org.prefix+"__":""),this.$.smLoadService.quote=this.$.smSelectService.quote=this.quote}.bind(this)),this.$.smLoadService.addEventListener("search-model-changed",function(e){this.searchModel=this.localizer.localizeSearchModel(e.detail.value),this.$.lookupLayout.fieldPrefix=this.searchModel.targetObjectName+"."}.bind(this))}},{key:"bindFilterEnterCallBacks",value:function(){}},{key:"handleSelectButtonClickedServerResponseAndNavigation",value:function(){this.$.smSelectService.addEventListener("result-changed",function(e){this.lineEditorModel.quote=e.detail.value.quote,0==e.detail.value.configuredProducts.length&&this.handleNonConfigurableProducts(e),0<e.detail.value.configuredProducts.length&&this.handleConfigurableProducts(e)}.bind(this))}},{key:"handleNonConfigurableProducts",value:function(e){"LineEditor"===this.redirectUrl?this.navigateToLineEditor():"RecommendationLookup"===this.redirectUrl&&(this.$.smSelectService.quote=e.detail.value.quote,this.$.lookupLayout.deSelectAll(),this.spinner=!1)}},{key:"handleConfigurableProducts",value:function(e){var t={};e.detail.value.selectedProducts=this.selectedProducts;var i=this.getConfigProductIds(e);t.qId=e.detail.value.quote.record.Id,t.pId=i,t.redirectUrl=this.redirectUrl,t.open=0,this.nav("#",t,["product","pc"],!1)}},{key:"getConfigProductIds",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e.detail.value.configuredProducts[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.record.Id)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t.join(",")}},{key:"onSelect",value:function(){this.redirectUrl="LineEditor",this.selectedProducts&&0<Object.keys(this.selectedProducts).length?(this.spinner=!0,this.$.smSelectService.selectedProductList=this.getOrderedSelectedProducts()):this.navigateToLineEditor()}},{key:"onSelectMore",value:function(){this.redirectUrl="RecommendationLookup",this.selectedProducts&&0<Object.keys(this.selectedProducts).length&&(this.spinner=!0,this.$.smSelectService.selectedProductList=this.getOrderedSelectedProducts())}},{key:"getOrderedSelectedProducts",value:function(){var e=Object.keys(this.selectedProducts).sort(function(e,t){return this.selectedProducts[e].index-this.selectedProducts[t].index}.bind(this)),t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=this.selectedProducts[a];l.invalid||t.push(l)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"navigateToLineEditor",value:function(){var e={qId:this.quote.record.Id};0<Object.keys(this.selectedProducts).length&&(e.jspr=!0),this.nav("#",e,["quote","le"],!1)}},{key:"onCancel",value:function(){var e={qId:this.quote.record.Id};this.nav("#",e,["quote","le"],!1)}},{key:"clearStackTrace",value:function(){this.errors.validations&&0<this.errors.validations.length?this.error=this.errors.validations:this.errors[0]&&(this.error=o(this.errors))}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.LookupBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}}]),a=e)),t("RecommendationLookup",a),Polymer(a)}}}),System.register("common/aggregate/quote-aggregator/QuoteAggregator.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.clientQuote=e,this.serverQuote=t,this.requiredKeys=i}e("QuoteAggregator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"reconcileServerQuoteWithUIQuote",value:function(){for(var t=this,i=new Map,e=[],n=this.serverQuote.lineItems.length,o=void 0,r=0;r<n;r++){var s=this.serverQuote.lineItems[r];this.requiredKeys&&this.requiredKeys.has(s.key)?(i.set(s.key,[s]),o=s.key):o&&s.parentItemKey?i.get(o).push(s):(o=null,e.push(s))}var a=[];return this.clientQuote.lineItems.forEach(function(e){t.requiredKeys&&!t.requiredKeys.has(e.key)?a.push(e):i.has(e.key)&&(a=a.concat(i.get(e.key)))}),a=a.concat(e),this.serverQuote.lineItems=a,this.serverQuote}}]),i=o)),e("QuoteAggregator",i)}}}),System.register("common/aggregate/quote-line-aggregator/QuoteLineAggregator.js",["quotes/models/Constants.js"],function(e,t){var r,i;return{setters:[function(e){r=e.Constants}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this._quote=e,this._linesByKey=new Map,null!=this._quote.lineItems&&this._quote.lineItems.forEach(function(e){t._linesByKey.set(e.key,e)});var i="Quote__c"===e.record.attributes.type?"":e.record.attributes.type.slice(0,-8);this._constants=new r(i)}e("QuoteLineAggregator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"mapPriorBundledQuantityByLineKey",value:function(){var t=this,i={};return null!=this._quote.lineItems&&this._quote.lineItems.forEach(function(e){i[e.key+""]=t._getPriorBundledQuantity(e)}),i}},{key:"getUpgradedAssetIdsAsArray",value:function(){var i=new Set,n=this._constants.UPGRADED_ASSET_FIELD;null!=this._quote.lineItems&&this._quote.lineItems.forEach(function(e){var t=e.record[n];null!=t&&i.add(t)});var t=[];return i.forEach(function(e){t.push(e)}),t}},{key:"getExistingProductIdsFromLines",value:function(){var t=new Set,i=this._constants.EXISTING_FIELD,n=this._constants.PRODUCT;null!=this._quote.lineItems&&this._quote.lineItems.forEach(function(e){e.record[i]&&t.add(e.record[n])});var o=[];return t.forEach(function(e){o.push(e)}),o}},{key:"getSegmentTemplatesByDimensionTypeForGroupKey",value:function(n){var o=this,e={},r=void 0,s=void 0,a=void 0,l=void 0,u=[],d=[],c=[],h=[],f=this._constants.DIMENSION_ID_FIELD,p=this._constants.DIMENSION_FIELD,v=this._constants.TYPE_FIELD,g=this._constants.SEGMENT_KEY_FIELD;return this._quote.lineItems&&this._quote.lineItems.forEach(function(e){if(e.parentGroupKey==n){var t=e.dimensionType||(e.record[f]?e.record[p][v]:null),i=e.record[g];switch(t){case o._constants.TYPE_CUSTOM_DIMENSION:r&&r!=i||(r=i,u.push(e));break;case o._constants.TYPE_YEARLY_DIMENSION:s&&s!=i||(s=i,c.push(e));break;case o._constants.TYPE_MONTHLY_DIMENSION:a&&a!=i||(a=i,d.push(e));break;case o._constants.TYPE_QUARTERLY_DIMENSION:l&&l!=i||(l=i,h.push(e))}}}),e[this._constants.TYPE_CUSTOM_DIMENSION]=u,e[this._constants.TYPE_MONTHLY_DIMENSION]=d,e[this._constants.TYPE_YEARLY_DIMENSION]=c,e[this._constants.TYPE_QUARTERLY_DIMENSION]=h,e}},{key:"getKeysOfEmptyGroups",value:function(){if(!this._quote.lineItemGroups||0==this._quote.lineItemGroups.length)return[];var t=new Set;this._quote.lineItemGroups.forEach(function(e){t.add(e.key)}),this._quote.lineItems&&this._quote.lineItems.forEach(function(e){t.delete(e.parentGroupKey)});var i=[];return t.forEach(function(e){i.push(e)}),i}},{key:"_getPriorBundledQuantity",value:function(e){var t=void 0,i=void 0;return null!=(i=this._isCarryoverLine(e)?(t=this._getCarryoverQuantity(e),this._linesByKey.get(e.parentItemKey).record[this._constants.QUANTITY_FIELD]):(t=e.record[this._constants.PRIOR_QUANTITY_FIELD],this._linesByKey.get(e.parentItemKey)?this._linesByKey.get(e.parentItemKey).record[this._constants.PRIOR_QUANTITY_FIELD]:null))&&null!=t&&this._optionTypeIsComponent(e)?t/i:t}},{key:"_isCarryoverLine",value:function(e){return 1==e.record[this._constants.CARRYOVER_LINE_FIELD]}},{key:"_getCarryoverQuantity",value:function(e){var t=e.record[this._constants.PRIOR_QUANTITY_FIELD],i=this._linesByKey.get(e.parentItemKey);if(null!=e.sourceLineKey&&i){var n=this._linesByKey.get(e.sourceLineKey);n&&(t=this._getPriorBundledQuantity(n),this._optionTypeIsComponent(n)&&(t*=i.record[this._constants.QUANTITY_FIELD]))}return t}},{key:"_optionTypeIsComponent",value:function(e){var t=e.record[this._constants.OPTION_TYPE_FIELD];return null!=t&&"component"===t.toLowerCase()}}]),i=o)),e("QuoteLineAggregator",i)}}}),System.register("common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.upgradeHandler=e}e("AssetUpgradeQuantityCalculator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"setQuantitiesByRatio",value:function(){var e=void 0,t=void 0,i=this.upgradeHandler.isSourceLine();i?(e=this.upgradeHandler.getLine(),t=this._getUpgrade(e,null)):(t=this.upgradeHandler.getLine(),e=this._getSource(null,t)),e&&t&&(this.upgradeHandler.setSourceAndUpgrade(e,t),this._setAutomaticQuantity(e,t,i))}},{key:"_getSource",value:function(e,t){return this.upgradeHandler.getSourceOrUpgrade(e,t)}},{key:"_getUpgrade",value:function(e,t){return this.upgradeHandler.getSourceOrUpgrade(e,t)}},{key:"_setAutomaticQuantity",value:function(e,t,i){var n=this._getUpgradeRatio(e,t,this.upgradeHandler.getSourceIdField(),this.upgradeHandler.getUpgradeConversionRateField());if(null!=n){var o=this.upgradeHandler.getSourceCurrentQuantityField(e),r=this.upgradeHandler.getUpgradeCurrentQuantityField(t),s=n.split(":")[0],a=n.split(":")[1],l=o,u=r,d=this.upgradeHandler.getSourcePriorQuantity(e);o<0?(e.invalidQuantity=o,e.validQuantity=0):r<0&&(t.invalidQuantity=r,t.validQuantity=0),this.upgradeHandler.didSourceQuantityChange(i,e,t)?u=a/s*(d-o):this.upgradeHandler.didUpgradeQuantityChange(i,e)&&(l=d-r*(s/a)),l<0?(l=0,this.upgradeHandler.isSelected(t)&&(u=d*(a/s))<r&&(t.invalidQuantity=r,t.validQuantity=u)):u<0&&(u=0,this.upgradeHandler.isSelected(e)&&(l=d)<o&&(e.invalidQuantity=o,e.validQuantity=l)),this.upgradeHandler.setUpdatedQuantity(e,t,l,u)}}},{key:"_getUpgradeRatio",value:function(e,t,i,n){for(var o in t.upgradeSourcesBySourceProductId)if(o===e.record[i])return t.upgradeSourcesBySourceProductId[o][n]}}]),i=t)),e("AssetUpgradeQuantityCalculator",i)}}}),System.register("common/core/sb-i18n/I18n.js",["../AppContext.js","../../Util.js"],function(e,t){var i,o,s,r,a,l,u,d,c,h;return{setters:[function(e){i=e.AppContext,o=e.localizeContent},function(e){s=e.Util,r=e.rationalizeDate}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.app=e}a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},l=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},u=new s.Map,d=new s.Map,c=void 0,e("I18n",(l(t,[{key:"beforeRegister",value:function(){this.is="sb-i18n",this.properties=Polymer.Base.extend({locale:{type:String,notify:!1,value:function(){return""}},key:{type:String,notify:!1},value:{type:String,value:null},values:{type:Array,value:[]}},i.properties)}},{key:"attached",value:function(){this.key=this.key?this.key:this.innerHTML,/{[0-9]}/.test(this.innerHTML)&&(this.innerHTML="")}},{key:"_localizeObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.localize(e,t,i)}},{key:"localize",value:function(){this.innerHTML=this.l(this.key,this.value?[this.value]:this.values)}},{key:"l",value:function(e,t){return o(e,t)}},{key:"_getFormat",value:function(e,t,i){var n=null;if(e&&t){var o=i?u.get(e):d.get(e);o||(o=new s.Map,(i?u:d).set(e,o));var r=JSON.stringify(t);(n=o.get(r))||(n=i?new Intl.DateTimeFormat(e,t):new Intl.NumberFormat(e,t),o.set(r,n))}return n}},{key:"format",value:function(e,t){var i=t||{},n="no-NO"===this.user.locale?"nb-NO":this.user.locale;if(e||0==e){if(e instanceof Date||i.date)return this._getFormat(n,a({},i,{timeZone:"UTC"}),!0).format(r(e));var o=this._getFormat(n,i,!1).format(e);return"currency"===i.style&&(o=this._additionalCurrencyFormat(i,o)),o}return""}},{key:"formatTime",value:function(e){if(null!=e){var t=new Date("1970-01-01T"+e);if(!isNaN(t))return t.toLocaleTimeString(this.user.locale,{timeZone:"UTC",hour:"numeric",minute:"numeric"})}return""}},{key:"parseTime",value:function(e){var t=/\d?\d:\d\d *(am)?(pm)?/i;if(t.test(e)){e=e.match(t)[0]+" UTC";var i=new Date("1970/01/01 "+e);if(!isNaN(i))return i.toISOString().split("T")[1]}return null}},{key:"_additionalCurrencyFormat",value:function(e,t){var i=void 0;if("XXX"===e.currency)if(t.includes("XXX")){var n=t.indexOf("XXX");i=t.substr(0,n)+this.org.currencySymbol+t.substring(n+3)}else i=this.org.currencySymbol+t;else{var o=void 0;"code"===e.currencyDisplay&&(o=-1<t.indexOf("-"))&&(t=t.replace("-",""));var r=o?" -":"";i=t.replace(e.currency,e.currency+r)}return i=this._replaceCharacters(i,160," "),(i=this._replaceCharacters(i,164," ")).trim()}},{key:"_replaceCharacters",value:function(e,t,i){if(-1<e.indexOf(String.fromCharCode(t))){var n=new RegExp(String.fromCharCode(t),"g");return e.replace(n,i)}return e}},{key:"behaviors",get:function(){return[sb.common.core.AppContext]}},{key:"observers",get:function(){return["_localizeObserver(key, value, values)"]}}],[{key:"addLocaleData",value:function(e){e&&(c=e)}},{key:"getLocaleData",value:function(e){return c}}]),h=t)),e("I18n",h),Polymer(h)}}}),System.register("common/core/sb-loading-spinner/LoadingSpinner.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LoadingSpinner",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-loading-spinner",this.properties={show:{type:Boolean,value:!1,observer:"toggle"},isReady:{type:Boolean,value:!1},previousState:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.isReady=!0}},{key:"detached",value:function(){!1!==this.previousState&&i.toggleSpinner(!1)}},{key:"toggle",value:function(e){!0!==this.isReady&&!1===e||e!==this.previousState&&(i.toggleSpinner(e),this.previousState=e)}}]),o=e)),t("LoadingSpinner",o),Polymer(o)}}}),System.register("common/core/sb-page-container/PageContainer.js",["common/core/AppContext.js","common/core/Events.js"],function(e,t){var s,o,r,a,l,u,d,c,h,f,p;return{setters:[function(e){s=e.AppContext},function(e){o=e.Events,r=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i)}a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},0,480,800,1024,1200,l=window.matchMedia("screen and (max-width: 480px)"),u=window.matchMedia("screen and (min-width: 481px) and (max-width: 800px)"),d=window.matchMedia("screen and (min-width: 801px) and (max-width: 1024px)"),c=window.matchMedia("screen and (min-width: 1025px) and (max-width: 1200px)"),h=window.matchMedia("screen and (min-width: 1201px)"),f=0,e("PageContainer",(a(i,[{key:"beforeRegister",value:function(){this.is="sb-page-container",this.properties={route:String,allRoutes:{type:Object,value:function(){return{}},observer:"_allRoutesChanged"},viewport:{type:Object,observer:"_viewportChanged",value:function(){return this._buildViewport(l.matches,u.matches,d.matches,c.matches,h.matches)}}}}},{key:"_buildViewport",value:function(e,t,i,n,o){var r={XS:{},S:{},M:{},L:{},XL:{},current:function(){return this.XS.only?{size:"XS",window:[0,480]}:this.S.only?{size:"S",window:[481,800]}:this.M.only?{size:"M",window:[801,1024]}:this.L.only?{size:"L",window:[1025,1200]}:this.XL.only?{size:"XL",window:[1200,1e4]}:void 0},isMobile:function(){return this.isPhone()||this.isTablet()},isPhone:function(){return s.isPhone},isTablet:function(){return s.isTablet},isDesktop:function(){return s.isDesktop}};return r.XS.only=e&&!t&&!i&&!n&&!o,r.XS.down=r.XS.only,r.XS.up=e||t||i||n||o,r.S.only=!e&&t&&!i&&!n&&!o,r.S.down=(e||t)&&!i&&!n&&!o,r.S.up=!e&&(t||i||n||o),r.M.only=!e&&!t&&i&&!n&&!o,r.M.down=(e||t||i)&&!n&&!o,r.M.up=!e&&!t&&(i||n||o),r.L.only=!e&&!t&&!i&&n&&!o,r.L.down=(e||t||i||n)&&!o,r.L.up=!e&&!t&&!i&&(n||o),r.XL.only=!e&&!t&&!i&&!n&&o,r.XL.down=!0,r.XL.up=r.XL.only,r}},{key:"ready",value:function(){this._setupViewportListeners()}},{key:"renderPage",value:function(e,t,i){if(t.route.comp&&""!=t.route.comp){var n={};n.params=t.params,n.pathParams=t.pathParams;var o=(s=n,"<"+(r=t).route.comp+" ctx='"+JSON.stringify(s)+"'></"+r.route.comp+">");t.route.mod?System.import(t.route.mod).then(function(e){this._updateContent(o)}.bind(this)).catch(function(e){console.log(e),console.log(e.originalErr)}):this._updateContent(o)}else this.$.ajax.url=t.route.view,this.$.ajax.url&&this.$.ajax.go();var r,s}},{key:"_updateContent",value:function(e){this.$.content.innerHTML=e,this._viewportChanged(),Polymer.dom.flush(),Polymer.updateStyles()}},{key:"_allRoutesChanged",value:function(e){this.$.router.init(e)}},{key:"_viewportChanged",value:function(){var e=this.$.content.querySelector("*:first-child");e&&(e.viewport=this.viewport),setTimeout(function(){r(o.VIEWPORT_CHANGED,{viewport:this.viewport})}.bind(this),10)}},{key:"_setupViewportListeners",value:function(){var t=this;function e(e){e.matches&&(t.viewport=t._buildViewport(l.matches,u.matches,d.matches,c.matches,h.matches))}l.addListener(e),u.addListener(e),d.addListener(e),c.addListener(e),h.addListener(e)}}],[{key:"getContainer",value:function(){return document.querySelector("#"+i.domId)}},{key:"getViewport",value:function(){var e=i.getContainer();return e?e.viewport:null}},{key:"isMobile",value:function(){var e=i.getViewport();return e&&e.isMobile()}},{key:"toggleSpinner",value:function(e){f+=!0===e?1:-1;var t=i.getContainer();null!==t&&(t.$.spinner.show=0<f)}}]),p=i)),e("PageContainer",p),p.domId="sbPageContainer",Polymer(p)}}}),System.register("common/core/sb-page-header/PageHeader.js",["common/core/sb-page-container/PageContainer.js","common/core/Events.js"],function(e,t){var i,o,r;return{setters:[function(e){i=e.PageContainer},function(e){o=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}e("PageHeader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"beforeRegister",value:function(){this.is="sb-page-header",this.properties={viewport:{type:Object,observer:"_viewportChanged",value:function(){return i.getViewport()}},showMenu:{type:Boolean,value:function(){return!0}},menuClosed:{type:Boolean,value:function(){return!0}},hideFullTitle:{type:Boolean,value:!1},searchbar:{type:Boolean,observer:"_setSearchbarStyles"},debugMode:Boolean,ept:{type:Number,value:0},bpt:{type:Number,value:0},spt:{type:Number,value:0},showLookupDialog:Boolean}}},{key:"ready",value:function(){this.debugMode=window.sb.mode&&window.sb.mode.debugMode||!1,this.debugMode&&this._setupMetricsServiceListeners()}},{key:"_showFullTitle",value:function(e){this.viewport.isMobile()&&(this.hideFullTitle||Polymer.dom(this).children[1].textContent)&&(this.hideFullTitle=!this.hideFullTitle,this.$.fullTitle.innerText=this.hideFullTitle?Polymer.dom(this).children[1].textContent:"",this.$.fullTitle.style.opacity=this.hideFullTitle?1:0)}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"navigationChanged",value:function(){this._closeMenu()}},{key:"_closeMenu",value:function(){this.toggleClass("open",!1,this.$.buttons),this.toggleClass("autoLaunch",!1,this.$.buttons),setTimeout(function(){this.menuClosed=!0}.bind(this),1)}},{key:"_changeMenu",value:function(e){"Popup"!==Polymer.dom(e).rootTarget.getAttribute("data-target")&&(this.menuClosed=t.changeMenu(e,this.menuClosed,this.$.buttons,"open",this),this.menuClosed&&this.fire("sb-menu-closed"))}},{key:"_viewportChanged",value:function(){this.showMenu=!(this.viewport&&!this.viewport.isMobile()&&this.viewport.M.up),this.showMenu?this.$.buttons.classList.remove("normal"):this.$.buttons.classList.add("normal")}},{key:"_setSearchbarStyles",value:function(){}},{key:"openLookupDialog",value:function(t){var i=this;this.showLookupDialog=!0,Polymer.RenderStatus.afterNextRender(this,function(){var e=i.querySelector("#lookup");e.invoker=t.detail.lookup,e.open(t.detail.searchValue)})}},{key:"closeLookupDialog",value:function(e){this.showLookupDialog=!1}},{key:"openRteDialog",value:function(e){var t=this.$.rte;t.value=e.detail.value,t.rte=e.detail.rte,t.open()}},{key:"openSearchDialog",value:function(e){var t=this.$.search;t.value=e.detail.value,t.quote=e.detail.quote,t.open()}},{key:"allowAutoLaunchPopup",value:function(){this.showMenu&&(this.toggleClass("open",!0,this.$.buttons),this.toggleClass("autoLaunch",!0,this.$.buttons),this.menuClosed=!1)}},{key:"_setupMetricsServiceListeners",value:function(){document.addEventListener("metrics-changed",function(e){var t=e.detail,i=Polymer.dom(this.root).querySelector(".header").querySelector(".sticker");null!=t.ept&&(this.ept=Math.round(t.ept)),null!=t.bpt&&(this.bpt=Math.round(t.bpt)),null!=t.spt&&(this.spt=Math.round(t.spt)),i&&(i.style.display="block",this.ept<=2e3?i.style.backgroundColor="#468847":2e3<this.ept&&this.ept<=3e3?i.style.backgroundColor="#daa520":i.style.backgroundColor="#b72020")}.bind(this))}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[o.AUTO_LAUNCH_POPUP]=this.allowAutoLaunchPopup,e[o.NAVIGATION_CHANGED]=this.navigationChanged,e[o.OPEN_LOOKUP_DIALOG]=this.openLookupDialog,e[o.CLOSE_LOOKUP_DIALOG]=this.closeLookupDialog,e[o.OPEN_RTE_DIALOG]=this.openRteDialog,e[o.OPEN_SEARCH_BAR_DIALOG]=this.openSearchDialog,e[o.VIEWPORT_CHANGED]=this.viewportChanged,e}}],[{key:"changeMenu",value:function(e,t,i,n,o){var r=e.currentTarget.getBoundingClientRect(),s=i.style;return s.top=r.bottom+2+"px",s.right=window.innerWidth-r.right+"px",o.toggleClass(n,t,i),!t}}]),r=t)),e("PageHeader",r),Polymer(r)}}}),System.register("common/core/sb-router/Router.js",[],function(t,e){var i,c,h,o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}c=i=void 0,h=/:[a-z0-9_$]*/g,t("Router",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-router",this.properties={autoHash:{type:Boolean,value:function(){return!1}},route:{type:String,observer:"routeChanged"},router:{type:Object,readOnly:!0,value:function(){return i||(i=new window.Router).init(),i}}}}},{key:"init",value:function(e){var r=this,t=Object.keys(e);if(!c&&t.length){c=e;for(var s=this.router,i=t?t.length:0,n=0;n<i;n++)for(var a=t[n],l=Object.keys(c[a]),o=l?l.length:0,u=function(e){var t=l[e],i=t?t.match(h):null,n=[],o={};i&&(n=i.map(function(e,t){var i=e.substring(1);return o[i]=null,i})),s.on(a+t,function(e,t,i,n){for(var o=JSON.parse(JSON.stringify(n)),r=Array.prototype.slice.call(arguments,4),s=r?r.length:0,a=0;a<s;a++)o[i[a]]=r[a];this.routeHandler(e,t,o)}.bind(r,a,t,n,o))},d=0;d<o;d++)u(d);s.on("/*",function(){console.log("got an unknown route. need to show 404 here")}),s.on("",function(){console.log("Got the <empty> route")})}}},{key:"routeHandler",value:function(e,t,i){var n=window.location.hash.slice(1),o=n.indexOf("?"),r={};0<=o&&n.length>o&&(r=queryString.parse(n.substring(o+1))),this.fire("sb-route-complete",{mod:e,path:t,route:c[e][t],pathParams:i,params:r})}},{key:"routeChanged",value:function(e,t){if(this.autoHash&&e){var i=window.location.hash.slice(1)==this.route;window.location.hash=this.route,i&&this.router.dispatch("on",e)}}}]),o=e)),t("Router",o),Polymer(o)}}}),System.register("common/core/sb-toast/Toast.js",[],function(t,e){var i,o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t("Toast",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-toast",this.properties={messages:{type:Array,notify:!0},type:String}}},{key:"ready",value:function(){this.hasMessages=!1,this.messagesModel=[],this.repeatHandlers={}}},{key:"validation",value:function(){var o=this;if(!this.messages)return this.messagesModel=[],this.hasMessages=!1,void(this.repeatHandlers={});var r={type:"error",class:"slds-theme--error",msgs:[],icon:"sf-icon-error"},s={type:"success",class:"slds-theme--success",msgs:[],icon:"sf-icon-success"},a={type:"warning",class:"slds-theme--warning",msgs:[],icon:"sf-icon-warning"},l={type:"info",class:"",msgs:[],icon:"sf-icon-info"};if("object"===i(this.messages[0]))this.messages.forEach(function(e){var t=e.type,i=e.msg,n=o.decodeHTML(i).split("\n");"error"===t?r.msgs.push(n):"warning"===t?a.msgs.push(n):"success"===t?s.msgs.push(n):l.msgs.push(n)});else if("string"==typeof this.messages[0]){var e=this.messages.map(function(e){return o.decodeHTML(e).split("\n")});"error"===this.type?r.msgs=e:"success"===this.type?s.msgs=e:"warning"===this.type?a.msgs=e:l.msgs=e}this.messages&&0<this.messages.length?(this.removeRepeatedMessages(r,"error"),0<r.msgs.length&&this.push("messagesModel",r),this.removeRepeatedMessages(s,"success"),0<s.msgs.length&&this.push("messagesModel",s),this.removeRepeatedMessages(s,"warning"),0<a.msgs.length&&this.push("messagesModel",a),this.removeRepeatedMessages(l,"info"),0<l.msgs.length&&this.push("messagesModel",l),this.hasMessages=!0):(this.hasMessages=!1,this.messages=void 0)}},{key:"decodeHTML",value:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}},{key:"removeRepeatedMessages",value:function(e,t){if(this.messagesModel)for(var i=0,n=this.messagesModel.length;i<n;i++){var o=this.messagesModel[i];if(t===o.type){var r=this.isMessageRepeated(o,e);r&&(e.msgs=[]),this.toggleRepeatClass(t,r,i)}}}},{key:"isMessageRepeated",value:function(e,t){for(var i=0,n=e.msgs.length;i<n;i++)for(var o=0,r=e.msgs[i].length;o<r;o++)if(void 0!==t.msgs[i]&&e.msgs[i][o]!==t.msgs[i][o])return!1;return!0}},{key:"toggleRepeatClass",value:function(e,t,i){this.removeAnimationListeners(e,i);var n=this.addAnimationListeners(e,i);this.toggleClass("repeat",t,n)}},{key:"removeAnimationListeners",value:function(e,t){var i=e+"_"+t,n=this.repeatHandlers[i];if(n){var o=this.$$("#"+i);o.removeEventListener("animationend",n),o.removeEventListener("webkitAnimationEnd",n)}}},{key:"addAnimationListeners",value:function(e,t){var i=e+"_"+t,n=this.$$("#"+i);if(n){var o=this.repeatHandlers[i]||this.removeRepeatClass.bind(this,n);this.repeatHandlers[i]=o,n.addEventListener("animationend",o),n.addEventListener("webkitAnimationEnd",o)}return n}},{key:"removeRepeatClass",value:function(e){this.toggleClass("repeat",!1,e)}},{key:"closeMessage",value:function(e){for(var t=e.model.__data__.messages.type,i=0,n=0;n<this.messagesModel.length;n++)this.messagesModel[n].type==t&&(delete this.repeatHandlers[t+"_"+i++],this.splice("messagesModel",n,1),n--);0==this.messagesModel.length&&(this.hasMessages=!1,this.messages=void 0)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["validation(messages)"]}}]),o=e)),t("Toast",o),Polymer(o)}}}),System.register("common/core/sf-loading-spinner/LoadingSpinner.js",["quotes/models/DataHandlerBehavior.js"],function(t,e){var i,o;return{setters:[function(e){i=e.DataHandlerBehavior}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LoadingSpinner",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-loading-spinner",this.properties={show:{type:Boolean,value:!1},position:{type:String,value:"fixed"},size:{type:String,value:"large"},message:{type:String,observing:{id:"RootState",path:["spinnerMessage"]},value:null},status:{type:String,observing:{id:"RootState",path:["spinnerStatus"]},value:null},showMessage:{type:Boolean,observing:{id:"RootState",path:["showSpinnerMessage"]},value:!1}}}},{key:"messageIsHidden",value:function(e,t){return!e||!t}},{key:"behaviors",get:function(){return[i]}}]),o=e)),t("LoadingSpinner",o),Polymer(o)}}}),System.register("common/data/cache/Cache.js",[],function(t,e){var s,i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}s={},t("Cache",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,null,[{key:"add",value:function(e,t,i,n,o){if(e&&t&&i){if(n||(n="value"),s[n]||(s[n]={}),!s[n][e]&&(s[n][e]={},o&&"value"==n&&"LineEditor"==e)){var r=document.createEvent("Event");r.initEvent(e+"-cached",!0,!0),document.dispatchEvent(r)}s[n][e][t]=i}}},{key:"get",value:function(e,t,i){return e&&t?(i||(i="value"),s[i]&&s[i][e]?s[i][e][t]:null):null}},{key:"remove",value:function(e,t,i){if(!e||!t||!i)return null;i||(i="value"),s[i]&&s[i][e]&&delete s[i][e][t]}}]),i=e)),t("Cache",i)}}}),System.register("common/data/client/ConnectionClient.js",["common/data/client/RemoteSession.js","common/oauth/OAuth.js"],function(e,t){var i,o,r;return{setters:[function(e){i=e.RemoteSession},function(e){o=e.OAuth}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.prefix=e}e("ConnectionClient",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"getConnection",value:function(){return"undefined"!=typeof Visualforce?Promise.resolve(this.getRemoteConnection()):(new o).getConnection()}},{key:"getRemoteConnection",value:function(e){return new i(window.sb.vfSessionId,e).getConnection()}}]),r=t)),e("ConnectionClient",r)}}}),System.register("common/data/client/RemoteClient.js",["common/data/client/ConnectionClient.js","common/data/client/RestClient.js","perfMetrics/MetricsService.js","common/data/parse/JsonParser.js"],function(e,t){var i,o,r,s,a;return{setters:[function(e){i=e.ConnectionClient},function(e){o=e.RestClient},function(e){r=e.MetricsService},function(e){s=e.JsonParser}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.VF_MAX_INPUT=1e6,this._remoteConnection=(new i).getRemoteConnection(),this._restClient=new o(this._remoteConnection),this.metricsService=e||new r}e("RemoteClient",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"read",value:function(e,t,i){return this.prefix=e,this._remote("read",t,i)}},{key:"load",value:function(e,t,i,n){this.prefix=e;var o=JSON.stringify(n);return!0===this._isPayloadTooLarge([o,i])?this._restClient.load(e,t,i,n):this._remote("load",t,i,o)}},{key:"save",value:function(e,t,i){this.prefix=e;var n="string"==typeof i?i:JSON.stringify(i);return!0===this._isPayloadTooLarge([n,t])?this._restClient.save(e,t,i):this._remote("save",t,n)}},{key:"describe",value:function(e){return this._remoteConnection.describe(e)}},{key:"query",value:function(e,t){return(new i).getRemoteConnection(t).query(e)}},{key:"requestPost",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return this._remoteConnection.requestPost(e,t,i)}},{key:"_remote",value:function(e,t,r,s){var a=this._getAction()+"."+e;return s?new Promise(function(i,n){var o=this.metricsService.startServiceRequest(t);Visualforce.remoting.Manager.invokeAction(a,t,r,s,this.metricsService.canGatherMetrics(),function(e,t){this._callback(e,t,i,n,o)}.bind(this),{escape:!1,timeout:12e4})}.bind(this)):new Promise(function(i,n){var o=this.metricsService.startServiceRequest(t);Visualforce.remoting.Manager.invokeAction(a,t,r,this.metricsService.canGatherMetrics(),function(e,t){this._callback(e,t,i,n,o)}.bind(this),{escape:!1,timeout:12e4})}.bind(this))}},{key:"_getAction",value:function(){return this._getPrefix()+"ServiceRouter"}},{key:"_getPrefix",value:function(){return this.prefix?this.prefix+".":""}},{key:"_callback",value:function(e,t,i,n,o){if(!t.status)return this.metricsService.stopServiceRequest(o),void n(t.message);var r=this._parse(e),s=-1!=Object.keys(r).indexOf("spt")?r.spt:void 0;r=s||0===s?this._parse(r.response):r,this.metricsService.stopServiceRequest(o,s),i(r)}},{key:"_parse",value:function(t){try{return(new s).parse(t)}catch(e){return t}}},{key:"_isPayloadTooLarge",value:function(e){return JSON.stringify(e).length>this.VF_MAX_INPUT}}]),a=t)),e("RemoteClient",a)}}}),System.register("common/data/client/RemoteSession.js",["common/core/AppContext.js"],function(e,t){var o,r;return{setters:[function(e){o=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.sessionId=e,this.version=t||this._getApiVersion()}e("RemoteSession",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"getConnection",value:function(){var e=new jsforce.Connection({sessionId:this.sessionId,version:this.version,instanceUrl:sb.common.core.AppContext.user.inCommunity?sb.common.core.AppContext.org.orgUrl:sb.common.core.AppContext.org.orgInstanceUrl});return e.oik=o.user.oik,e}},{key:"_getApiVersion",value:function(){if("undefined"!=typeof SB&&SB&&void 0!==SB.Constants&&SB.Constants&&void 0!==SB.Constants.apiVersion&&SB.Constants.apiVersion)return SB.Constants.apiVersion;throw new Error("Unable to process request: Could not determine API version")}}]),r=i)),e("RemoteSession",r)}}}),System.register("common/data/client/RestClient.js",["common/oauth/OAuth.js","perfMetrics/MetricsService.js","common/data/parse/JsonParser.js"],function(e,t){var o,r,s,a;return{setters:[function(e){o=e.OAuth},function(e){r=e.MetricsService},function(e){s=e.JsonParser}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.connection=e,this.metricsService=t||new r}e("RestClient",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"read",value:function(e,r,s){return this.prefix=e,new Promise(function(n,o){this._getApex().then(function(e){var t="&reader="+r+"&uid="+s+"&spt="+this.metricsService.canGatherMetrics(),i=this.metricsService.startServiceRequest(t);e.get(this._getEndpoint()+t).then(function(e){this._resolve(this._parse(e),n,i)}.bind(this),function(e){this._reject(o,e.message||e,i)}.bind(this))}.bind(this),function(e){o(e.message||e)})}.bind(this))}},{key:"load",value:function(e,r,s,a){return this.prefix=e,new Promise(function(n,o){this._getApex().then(function(e){var t="&loader="+r+"&uid="+s+"&spt="+this.metricsService.canGatherMetrics(),i=this.metricsService.startServiceRequest(t);e.patch(this._getEndpoint()+t,{context:JSON.stringify(a)}).then(function(e){this._resolve(this._parse(e),n,i)}.bind(this),function(e){this._reject(o,e.message||e,i)}.bind(this))}.bind(this),function(e){o(e.message||e)})}.bind(this))}},{key:"save",value:function(e,o,r){return this.prefix=e,new Promise(function(i,n){this._getApex().then(function(e){var t=this.metricsService.startServiceRequest(o);e.post(this._getEndpoint()+"&spt="+this.metricsService.canGatherMetrics(),{saver:o,model:"string"==typeof r?r:JSON.stringify(r)}).then(function(e){this._resolve(this._parse(e),i,t)}.bind(this),function(e){this._reject(n,e.message||e,t)}.bind(this))}.bind(this),function(e){n(e.message||e)})}.bind(this))}},{key:"describe",value:function(t){return this.getConnection().then(function(e){return e.describe(t)})}},{key:"query",value:function(t){return this.getConnection().then(function(e){return e.query(t)})}},{key:"requestPost",value:function(t,i){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return this.getConnection().then(function(e){return e.requestPost(t,i,n)})}},{key:"streamFileContents",value:function(o,r,s){var a=this;return new Promise(function(i,n){a._getApex().then(function(e){var t=a.metricsService.startServiceRequest(r);e.post(null,{saver:"sobjects",model:"/sobjects/"+o+"/"+r+"/"+s}).then(function(e){a._resolve(a._parse(e),i,t)},function(e){a._reject(n,e.message||e,t)})},function(e){n(e.message||e)})})}},{key:"setConnection",value:function(e){this.connection=e}},{key:"getConnection",value:function(){return this.connection?Promise.resolve(this.connection):"undefined"==typeof window?Promise.reject("Connection not set"):(this.oauth=this.oauth||new o,this._getConnection(this.oauth))}},{key:"_getConnection",value:function(e){return new Promise(function(t,i){e.getConnection().then(function(e){this.connection=e,t(this.connection)}.bind(this),function(e){i(e.message||e)})}.bind(this))}},{key:"_getApex",value:function(){return this.getConnection().then(function(e){return Promise.resolve(e.apex)})}},{key:"_getEndpoint",value:function(){return this._getPrefix()+"/ServiceRouter?"+(void 0===this.connection.oik?"":"oik="+this.connection.oik)}},{key:"_getPrefix",value:function(){return this.prefix?"/"+this.prefix:""}},{key:"_resolve",value:function(e,t,i){var n=-1!=Object.keys(e).indexOf("spt")?e.spt:void 0;this.response=n||0===n?this._parse(e.response):e,this.metricsService.stopServiceRequest(i,n),t(this.response)}},{key:"_reject",value:function(e,t,i){(new r).stopServiceRequest(i),e(this._adjustErrorMessage(t))}},{key:"_adjustErrorMessage",value:function(e){return"expired access/refresh token"===e&&(e+=" - to authorize go to http://localhost:"+location.port+"/common/oauth"),e}},{key:"_parse",value:function(t){try{return(new s).parse(t)}catch(e){return t}}}]),a=i)),e("RestClient",a)}}}),System.register("common/data/client/ServiceClient.js",["common/data/client/RemoteClient.js","common/data/client/RestClient.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.RemoteClient},function(e){o=e.RestClient}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.client="undefined"!=typeof Visualforce?new i:new o}t("ServiceClient",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"read",value:function(e,t,i){return this.client.read(e,t,i)}},{key:"load",value:function(e,t,i,n){return this.client.load(e,t,i,n)}},{key:"save",value:function(e,t,i){return this.client.save(e,t,i)}},{key:"md",value:function(e,t,i){return this.client.load(e,"OAuthExtension.MetadataReader",null,{type:t,items:i})}},{key:"describe",value:function(e,t){return this.client.describe(t)}},{key:"query",value:function(e,t){return this.client.query(e,t)}},{key:"requestPost",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return this.client.requestPost(e,t,i)}},{key:"streamFileContents",value:function(e,t,i){return this.client.streamFileContents(e,t,i)}},{key:"setConnection",value:function(e){"function"==typeof this.client.setConnection&&this.client.setConnection(e)}}]),r=e)),t("ServiceClient",r)}}}),System.register("common/data/format/DataBuilder.js",["common/data/format/JsonFormatter.js"],function(e,t){var r,i;return{setters:[function(e){r=e.JsonFormatter}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.pretty=e,this.data={}}e("DataBuilder",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"addQuote",value:function(e,t,i){return this.addObject(e,t,!0,i,!1)}},{key:"addObject",value:function(e,t,i,n,o){return this.data[e]=null!=t?new r(i,n,this.pretty).format(t,o):t,this}},{key:"addInt",value:function(e,t){try{return t=parseInt(t),isNaN(t)||(this.data[e]=t),this}catch(e){return this}}},{key:"add",value:function(e,t){return this.data[e]=t,this}},{key:"build",value:function(){return this.data}}]),i=t)),e("DataBuilder",i)}}}),System.register("common/data/format/ErrorFormatter.js",[],function(e,t){return{setters:[],execute:function(){e("formatError",function(e){var t=("string"==typeof e?e:e[0]).split("\n")[0].split(":");return 1<t.length?t[0].startsWith("System")?[t.splice(1,t.length-1).join(":")]:[t.join(":")]:t})}}}),System.register("common/data/format/JsonFormatter.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.omitNull=e,this.omitRelationships=t,this.pretty=i,this.formatterOptions=n||{}}e("JsonFormatter",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"format",value:function(e,t){if(void 0!==e){if(null===e)return JSON.stringify(e);var i=this.pretty;"number"!=typeof i&&(i=i?2:null);var n=this,o=JSON.stringify(e,function(e,t){return n._replacer(e,t,this)},i);return!0===t?o:JSON.parse(o)}}},{key:"_replacer",value:function(e,t,i){if(void 0!==t&&"_transient_"!==e&&"ui_original_record"!==e){if(this.formatterOptions.cleanRootProperty===e){this.formatterOptions.cleanObj=i[this.formatterOptions.cleanPathFromRoot[0]];for(var n=1,o=this.formatterOptions.cleanPathFromRoot.length;n<o;n++)this.formatterOptions.cleanObj=this.formatterOptions.cleanObj?this.formatterOptions.cleanObj[this.formatterOptions.cleanPathFromRoot[n]]:void 0}if(this.omitNull&&null===t){var r=i[this.formatterOptions.keepIfDirtyWhenParentContains];if(null==r)return;if(null!=this.formatterOptions.keepIfDirtyAllowList)for(var s in this.formatterOptions.keepIfDirtyAllowList)if(-1!==this.formatterOptions.keepIfDirtyAllowList[s].indexOf(r[s]))return null;return this.formatterOptions.cleanObj&&null!=this.formatterOptions.cleanObj[e]?null:void 0}if(!(this.omitRelationships&&e.endsWith&&e.endsWith("__r")))return"#Error!"===t?this.omitNull?void 0:null:t}}}]),i=o)),e("JsonFormatter",i)}}}),System.register("common/data/minimize/QuoteMinimizer.js",["common/aggregate/quote-line-aggregator/QuoteLineAggregator.js"],function(e,t){var c,i;return{setters:[function(e){c=e.QuoteLineAggregator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.quote=e,this.products=t,this.groupKey=i,this.stripLinesThreshold=n,this.stripLinesMessage=o}e("QuoteMinimizer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(r,[{key:"reduceQuote",value:function(e){if(this.originalLines=this.quote.lineItems,!(this.quote.partialVO=!0)===e)return this.quote.lineItems=[],this.quote;var t=this.stripLinesMessage.replace("{0}",this.quote.record.Id).replace("{1}",this.stripLinesThreshold);console.log(t);var i=new c(this.quote);this.quote.existingProductIds=i.getExistingProductIdsFromLines();var n=i.getSegmentTemplatesByDimensionTypeForGroupKey(this.groupKey);this.quote.segmentTemplatesByDimensionTypeByGroupKey={},this.quote.segmentTemplatesByDimensionTypeByGroupKey[(this.groupKey||-1)+""]=n,this.quote.emptyGroupKeys=i.getKeysOfEmptyGroups(),this.products&&(this.requiredKeys=this._getNecessaryLineKeys());var o=[],r=!0,s=!1,a=void 0;try{for(var l,u=this.quote.lineItems[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value;this.requiredKeys.has(d.key)&&o.push(d)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}return this.quote.lineItems=o,this.quote}},{key:"revertQuote",value:function(){return this.quote.partialVO=!1,this.quote.lineItems=this.originalLines,delete this.quote.existingProductIds,delete this.quote.segmentTemplatesByDimensionTypeByGroupKey,delete this.quote.emptyGroupKeys,this.quote}},{key:"getRequiredKeys",value:function(){return this.requiredKeys}},{key:"_getNecessaryLineKeys",value:function(){var a=this,l="Quote__c"==this.quote.record.attributes.type?"":this.quote.record.attributes.type.slice(0,-8),u=new Set;return this.products.forEach(function(e){if(e.configuration&&e.configuration.lineItemKey)for(var t=a.quote.lineItems.length,i=0;i<t;i++){var n=a.quote.lineItems[i];if(n.key===e.configuration.lineItemKey){a._addLineKeyWithRecursiveCallOnChildrenAndSource(l,u,n);break}}if(e.upgradedAssetId)for(var o=a.quote.lineItems.length,r=0;r<o;r++){var s=a.quote.lineItems[r];if(s.record[l+"UpgradedAsset__c"]===e.upgradedAssetId&&s.record[l+"Existing__c"]){a._addLineKeyWithRecursiveCallOnChildrenAndSource(l,u,s);break}}}),u}},{key:"_addLineKeyWithRecursiveCallOnChildrenAndSource",value:function(n,o,r){var s=this;if(!o.has(r.key)){var a=r.record[n+"Bundle__c"],l=null!=r.sourceLineKey;(a||l)&&this.quote.lineItems.forEach(function(e){var t=a&&e.parentItemKey===r.key,i=l&&e.key===r.sourceLineKey;(t||i)&&s._addLineKeyWithRecursiveCallOnChildrenAndSource(n,o,e)}),o.add(r.key)}}}]),i=r)),e("QuoteMinimizer",i)}}}),System.register("common/data/parse/JsonParser.js",["common/data/cache/Cache.js"],function(t,e){var f,i;return{setters:[function(e){f=e.Cache}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("JsonParser",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"parse",value:function(e){return JSON.parse(e,this._reviver)}},{key:"_reviver",value:function(e,t){if("ui_original_record"!==e)return t;if(!t)return t;var i=this.record,n=t.cacheName,o=t.cacheId,r=t.cachedOriginalRecordPath||[],s=t.cloneRecordIfNoCache,a=r.length;if(!(n&&o&&0<a))return s?JSON.parse(JSON.stringify(i)):null;var l=f.get(n,o.substring(0,15));if(!l)return s?JSON.parse(JSON.stringify(i)):null;for(var u=l[r[0]],d=1;d<a;d++){var c=r[d];try{var h=parseInt(c);c=isNaN(h)?c:h}catch(e){}u=u?u[c]:null}return u||(s?JSON.parse(JSON.stringify(i)):null)}}]),i=e)),t("JsonParser",i)}}}),System.register("common/data/sb-async-service/AsyncService.js",["common/data/cache/Cache.js","common/data/parse/JsonParser.js"],function(e,t){var o,r,s;return{setters:[function(e){o=e.Cache},function(e){r=e.JsonParser}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i)}e("AsyncService",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"beforeRegister",value:function(){this.is="sb-async-service",this.properties={response:{notify:!0},cache:String,uid:String,ignoreCache:{type:Boolean,value:!1},error:{type:Array,notify:!0}}}},{key:"ready",value:function(){this.$.service.addEventListener("response-changed",this.handleServiceResponse.bind(this)),this.$.jobchecker.addEventListener("result-changed",this.handleAsyncResponse.bind(this))}},{key:"setResponse",value:function(e){this.response=e}},{key:"handleServiceResponse",value:function(e){var t=e.detail.value;!0===i.isAsyncResponse(t)?this.pollAsyncJob(t):this.setResponse(t)}},{key:"handleAsyncResponse",value:function(e){var t=i.parseAsyncResponse(e.detail.value);this.swapCache(t),this.setResponse(t)}},{key:"swapCache",value:function(e){if(this.cache&&this.uid){var t=o.get(this.cache,this.uid);delete t.recordId,delete t.jobId,delete t.jobType,o.add(this.cache,this.uid,Object.assign(e,t))}}},{key:"pollAsyncJob",value:function(e){this.$.jobchecker.data={jobId:e.jobId,recordId:e.recordId,jobType:e.jobType}}}],[{key:"isAsyncResponse",value:function(e){return!!(e&&e.recordId&&e.jobId&&e.jobType)}},{key:"parseAsyncResponse",value:function(e){return(new r).parse(e.payload)}}]),s=i)),e("AsyncService",s),Polymer(s)}}}),System.register("common/data/sb-describe/Describe.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Describe",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-describe",this.properties={objects:Array,fields:Array,cache:{type:String,value:"describe"},describe:{type:Object,notify:!0},error:{type:Object,notify:!0},background:{type:Boolean,value:!1}}}},{key:"describeObjects",value:function(){var s=[];this.objects.forEach(function(e){s.push(e)}),this._describe(this.objects).then(function(e){for(var t=null,i={objects:s},n=0,o=e.length;n<o;n++){var r=e[n];r&&((t=t||{})[r.name]=r)}t&&(i.md=t,this.describe=i),this.waiting=!1}.bind(this),function(e){this.waiting=!1,this.error=e||e.message}.bind(this))}},{key:"describeFields",value:function(){var c=[];this.fields.forEach(function(e){c.push(e)});for(var h={},e=0,t=this.fields.length;e<t;e++){var i=this.fields[e].split("."),n=i[0],o=i[1];h[n]=h[n]||{},h[n][o]=!0}this._describe(Object.keys(h)).then(function(e){for(var i=null,n={},t={fields:c},o=[],r=0,s=e.length;r<s;r++){var a=e[r];if(a){i=i||{};for(var l=h[a.name],u=0,d=a.fields.length;u<d;u++)n[a.name+"."+a.fields[u].name]=a.fields[u],l[a.fields[u].name]&&(i[a.name+"."+a.fields[u].name]=a.fields[u],a.fields[u].tableName=a.name,null!=a.fields[u].controllerName&&o.push(a.fields[u]))}}o.forEach(function(e){var t=e.tableName+"."+e.controllerName;e.controllingField=n[t],e.controllingField.controllingPicklist=!0,i[t]=e.controllingField}),i&&(t.md=i,this.describe=t),this.waiting=!1}.bind(this),function(e){this.waiting=!1,this.error=e||e.message}.bind(this))}},{key:"_describe",value:function(e){this.waiting=!0;for(var t=[],i=0,n=e.length;i<n;i++)t.push(this.$.service.describe({sObject:e[i]}));return Promise.all(t)}},{key:"observers",get:function(){return["describeObjects(objects)","describeFields(fields)"]}}]),i=e)),t("Describe",i),Polymer(i)}}}),System.register("common/data/sb-service/Service.js",["common/core/AppContext.js","common/data/client/ServiceClient.js","common/data/cache/Cache.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.AppContext},function(e){o=e.ServiceClient},function(e){r=e.Cache}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Service",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-service",this.properties={reader:String,loader:String,saver:String,uid:String,model:Object,context:Object,mdType:String,mdItems:Array,sObject:String,soql:String,fileType:String,fileId:String,fileContentsField:String,cache:String,waiting:{type:Boolean,notify:!0},response:{type:Object,notify:!0},error:{type:Object,notify:!0},client:{type:Object,value:function(){return new o}},transient:{type:Boolean},background:{type:Boolean,value:!1},ignoreCache:{type:Boolean,value:!1},version:String}}},{key:"read",value:function(e){Polymer.Base.extend(this,e);var t=this._returnPromiseIfCachedResponse();return t||this._response(this.client.read(this.prefix,this.reader,this.uid))}},{key:"load",value:function(e){Polymer.Base.extend(this,e);var t=this._returnPromiseIfCachedResponse();return t||this._response(this.client.load(this.prefix,this.loader,this.uid,this.context))}},{key:"save",value:function(e){if(Polymer.Base.extend(this,e),this.transient)return this._response(Promise.resolve(this.model));var t=this._returnCachedPromise(this.uid);return t||this._response(this.client.save(this.prefix,this.saver,this.model))}},{key:"md",value:function(e){Polymer.Base.extend(this,e);var t=this._returnPromiseIfCachedResponse();return t||this._response(this.client.md(this.prefix,this.mdType,this.mdItems))}},{key:"describe",value:function(e){Polymer.Base.extend(this,e);var t=this._returnPromiseIfCachedResponse(this.sObject);return t||this._response(this.client.describe(this.prefix,this.sObject),this.sObject)}},{key:"streamFileContents",value:function(e){Polymer.Base.extend(this,e);var t=this._returnPromiseIfCachedResponse();return t||this._response(this.client.streamFileContents(this.fileType,this.fileId,this.fileContentsField))}},{key:"query",value:function(e){Polymer.Base.extend(this,e);var t=this._returnPromiseIfCachedResponse();return t||this._response(this.client.query(this.soql,this.version))}},{key:"_readObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._read(e,t)}},{key:"_read",value:function(){this.read().then(function(){},function(e){console.error(e.message||e)})}},{key:"_loadObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this._load(e,t,i)}},{key:"_load",value:function(){this.load().then(function(){},function(e){console.error(e.message||e)})}},{key:"_saveObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._save(e,t)}},{key:"_save",value:function(){this.save().then(function(){},function(e){console.error(e.message||e)})}},{key:"_mdObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._md(e,t)}},{key:"_md",value:function(){this.md().then(function(){},function(e){console.error(e.message||e)})}},{key:"_describe",value:function(){this.describe().then(function(){},function(e){console.error(e.message||e)})}},{key:"_query",value:function(){this.query().then(function(){},function(e){console.error(e.message||e)})}},{key:"_streamFileContentsObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this._streamFileContents(e,t,i,n)}},{key:"_streamFileContents",value:function(){this.streamFileContents().then(function(){},function(e){console.error(e.message||e)})}},{key:"_spinnerObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._spinner(e,t)}},{key:"_spinner",value:function(){this.spinner=this.waiting&&!this.background}},{key:"_returnCachedPromise",value:function(e){var t=r.get(this.cache,e,"promise");return t?(t._services=t._services||[],-1===t._services.indexOf(this)&&t._services.push(this),t):this.transient?Promise.resolve(this.response):null}},{key:"_returnPromiseIfCachedResponse",value:function(e){if(!0===this.ignoreCache)return!1;e=e||this.uid;var t=r.get(this.cache,e);return t?(this.response=t,Promise.resolve(this.response)):this._returnCachedPromise(e)}},{key:"_response",value:function(t,i){return this.waiting=!0,r.add(this.cache,i||this.uid,t,"promise"),t.then(function(e){return null!=e&&(this.response=e,(t._services||[]).forEach(function(e){e.response=this.response}.bind(this)),r.add(this.cache,i||this.uid,this.response,"value",this)),r.remove(this.cache,i||this.uid,"promise"),this.waiting=!1,Promise.resolve(this.response)}.bind(this),function(e){return this.waiting=!1,e&&(this.error=this._createError(e),(t._services||[]).forEach(function(e){e.error=this.error}.bind(this))),r.remove(this.cache,i||this.uid,"promise"),Promise.reject(this.error)}.bind(this))}},{key:"createError",value:function(e){return this._createError(e)}},{key:"_createError",value:function(e){var t,i=e.message||e,n={message:i,errorCode:e.errorCode};if(i.indexOf&&-1!=i.indexOf("ValidationException: [")||i.startsWith&&i.startsWith("[")){var o=i.indexOf("["),r=i.indexOf("]",o)+1;o<r&&(t=i.substring(o,r))}if(t)try{var s=t.replace(/\n/g,"\\n").replace(/\r/g,"\\r"),a=JSON.parse(s);n.validations=a}catch(e){}return n}},{key:"observers",get:function(){return["_readObserver(reader, uid)","_saveObserver(saver, model)","_loadObserver(loader, uid, context)","_mdObserver(mdType, mdItems)","_describe(sObject)","_query(soql)","_streamFileContentsObserver(uid, fileType, fileId, fileContentsField)","_spinnerObserver(waiting, background)"]}},{key:"prefix",get:function(){return i.org.prefix?i.org.prefix:""}}]),s=e)),t("Service",s),Polymer(s)}}}),System.register("common/filter/searcher/Searcher.js",["common/Util.js","common/data/client/ServiceClient.js","common/core/AppContext.js","common/forms/sb-lookup/map/LookupNameMapper.js"],function(e,t){var o,m,i;return{setters:[function(e){e.Util},function(e){o=e.ServiceClient},function(e){e.AppContext},function(e){m=e.LookupNameMapper}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),this.model=e,this.searchFilterData={}}e("Searcher",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(y,[{key:"buildFields",value:function(e){return e}},{key:"getSearchTable",value:function(){return this.model.targetObjectName}},{key:"getGroupKey",value:function(e){return this.model.hasCustomSearchFilters?e.record.Id:e.targetFieldName}},{key:"setDefaultFilterValues",value:function(e,a){var l=this,u={},d=[];if(this.model.hasCustomSearchFilters){var t=!0,i=!1,n=void 0;try{for(var c,o=function(){var n=c.value,e=!0,t=!1,i=void 0;try{for(var o,r=l.model.searchFilters[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var s=o.value;if(s.record.Id===n){u[n]={value:void 0===l.searchFilterData[n]?s.stringValue:l.searchFilterData[n].value,field:void 0===l.searchFilterData[n]?s.targetFieldName?s.targetFieldName:"":l.searchFilterData[n].field,hidden:s.hidden},a&&s.stringValue&&l.isLookupType(a[n].model.type)&&d.push(l.queryLookupFilterName(u[n].value,a[n].model.referenceTo[0]).then(function(e){var t=e.records[0];if(t){var i=new m(t.attributes.type).getNameField();u[n].label=t[i]}}));break}}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}},r=e[Symbol.iterator]();!(t=(c=r.next()).done);t=!0)o()}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}else{var s=!0,h=!1,f=void 0;try{for(var p,v=e[Symbol.iterator]();!(s=(p=v.next()).done);s=!0){var g=p.value;u[g]={value:void 0===this.searchFilterData[g]?a[g].stringValue:this.searchFilterData[g].value,hidden:a[g].hidden},this.searchFilterData[g]&&this.searchFilterData[g].label&&(u[g].label=this.searchFilterData[g].label)}}catch(e){h=!0,f=e}finally{try{!s&&v.return&&v.return()}finally{if(h)throw f}}}return new Promise(function(e){Promise.all(d).then(function(){l.searchFilterData=y.handleDynamicSearchFilters(u,l.dynamicSearchFilters),e(u)})})}},{key:"getFieldSet",value:function(){return this.fieldSet}},{key:"getFilterContext",value:function(){return this.model.hasCustomSearchFilters?this.loadCustomSearchFilterValues(this.model.searchFilters,this.searchFilterData):this.loadStandardSearchFilterValues(this.searchFilterData)}},{key:"loadCustomSearchFilterValues",value:function(e,t){var i={};for(var n in t){var o=!0,r=!1,s=void 0;try{for(var a,l=e[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;!0!==u.hidden&&n===u.record.Id&&void 0!==t[n]&&null!==t[n]&&!0!==this.isBlank(t[n].value)&&(i[u.targetFieldName]=t[n].value)}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}}return i}},{key:"loadStandardSearchFilterValues",value:function(e){var t={};for(var i in e)!0!==this.isBlank(e[i].value)&&(t[i]=e[i].value);return t}},{key:"getAdditionalProperties",value:function(){if(this.dynamicSearchFilters){for(var e=[],t=0,i=this.dynamicSearchFilters.length;t<i;t++)"Default Filter"===this.dynamicSearchFilters[t].type&&e.push(JSON.stringify(this.dynamicSearchFilters[t]));return e}}},{key:"clearFields",value:function(){var e={};for(var t in this.searchFilterData)e[t]=JSON.parse(JSON.stringify(this.searchFilterData[t])),e[t].value="";return this.searchFilterData=e}},{key:"runOnLoad",value:function(e){this.searchFilterData=e}},{key:"isLookupType",value:function(e){return"reference"===e||"id"===e}},{key:"queryLookupFilterName",value:function(e,t){var i=new m(t).getNameField(),n=e?"'"+e+"'":null;return(new o).query(("SELECT Id, "+i+" FROM "+t+" WHERE Id = ").concat(n))}},{key:"hasSearchFilterValues",value:function(){var e=this.getFilterContext();for(var t in e)if(null!=e[t])return!0;return!1}},{key:"isBlank",value:function(e){return null===e||""===e||void 0===e}}],[{key:"handleDynamicSearchFilters",value:function(e,t){if(!t)return e;var i=!0,n=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;"Optional Filter"===a.type&&e[a.targetFieldName]&&(e[a.targetFieldName].value=a.stringValue)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return e}}]),i=y)),e("Searcher",i)}}}),System.register("common/forms/sb-checkbox/Checkbox.js",["common/layout/fields/FieldHider.js"],function(t,e){var i,o;return{setters:[function(e){i=e.FieldHider}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Checkbox",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-checkbox",this.properties={focusOnAttached:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},value:{notify:!0,observer:"_boolify"},hide:{type:Object,observer:"hideShow"}}}},{key:"_boolify",value:function(){"boolean"!=typeof this.value&&(this.value=null!==this.value&&"true"===this.value.toLowerCase())}},{key:"attached",value:function(){this.focusOnAttached&&this.focus()}},{key:"focus",value:function(){this.$.checkbox.focus()}},{key:"blur",value:function(){this.fire("blur")}},{key:"hideShow",value:function(){new i(this.hide,Polymer.Base).applyTo(this.$.checkbox)}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),o=e)),t("Checkbox",o),Polymer(o)}}}),System.register("common/forms/sb-date-range/DateRange.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("DateRange",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-daterange",this.properties={formattedValue:Object}}},{key:"ready",value:function(){this.addEventListener("selected-date-changed",function(){this.fire("selected-date-range-changed",{value:this.formattedValue})}.bind(this))}}]),i=e)),t("DateRange",i),Polymer(i)}}}),System.register("common/forms/sb-datepicker/Datepicker.js",["common/core/AppContext.js","common/core/sb-i18n/I18n.js","common/forms/DateParser.js","common/Util.js","common/core/Events.js"],function(t,e){var s,i,o,r,a,l,u,d,c;return{setters:[function(e){s=e.AppContext},function(e){i=e.I18n},function(e){o=e.DateParser},function(e){r=e.rationalizeDate,l=e.Util},function(e){a=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("Datepicker",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,s),d(e,[{key:"beforeRegister",value:function(){this.is="sb-datepicker",this.properties=Polymer.Base.extend({selectedDate:{type:Date,value:null,observer:"selectedDateChanged"},range:{type:Number,value:30},focusOnAttached:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},i18n:{type:Object,value:function(){return s.properties.i18n.value()}},dateParser:{type:Object,value:function(){return new o}}},s.properties)}},{key:"ready",value:function(){var e=i.getLocaleData();this.isActive=!1,this.weeks=[],this.weekDays=e&&e.date?e.date.calendars.gregory.days.short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.months=e&&e.date?e.date.calendars.gregory.months.long:["January","February","March","April","May","June","July","August","September","October","November","December"],this.year=this.date.getUTCFullYear(),this.month=this.date.getUTCMonth(),this.monthName=this.months[this.month].toUpperCase(),this.day=this.date.getUTCDate()}},{key:"getDate",value:function(e){return"object"!=(void 0===e?"undefined":u(e))?new Date(Date.UTC(this.year,this.month,e)):e.getUTCDate()}},{key:"getMonthDay",value:function(e){return"object"!=(void 0===e?"undefined":u(e))?this.month+"-"+e:e.getUTCMonth()+1+"-"+e.getUTCDate()}},{key:"getClass",value:function(e){"object"!=(void 0===e?"undefined":u(e))&&(e=new Date(Date.UTC(this.year,this.month,e)));var t="";return e.getUTCMonth()!==this.month?t+="notCurrent":(e.getUTCFullYear()===this.date.getUTCFullYear()&&e.getUTCMonth()===this.date.getUTCMonth()&&e.getUTCDate()===this.date.getUTCDate()&&(t+="selected"),e.getUTCFullYear()===this.year&&e.getUTCMonth()===this.month&&e.getUTCDate()===this.date.getUTCDate()&&(t+=" current")),t}},{key:"selectedDateChanged",value:function(e,t){if(this.initialized||this.selectedDate)return""===this.selectedDate&&""!==this.dateFormatted?void(this.dateFormatted=""):void this._selectedDateChanged(t,this.selectedDate,null==this.selectedDate);this._selectedDateChanged(t,new Date,!0,!0),this.focus()}},{key:"_selectedDateChanged",value:function(e,t,i,n){if(this.initialized=!0,this.date=r(t),this.updateVariables(),i||(this.dateFormatted=this.getLocaleDate()),!n){var o=void 0===e;this.fire("selected-date-changed",{value:t,suppressImmediateCalculation:o})}}},{key:"showCalendar",value:function(){this.disabled||this.ensureProperYearInSelectedAndShowCalendar()}},{key:"ensureProperYearInSelectedAndShowCalendar",value:function(){this.year===this.date.getUTCFullYear()&&this.haveEnsured&&this._showCalendar(),this.haveEnsured=!0,this.date.getUTCFullYear();for(var e=[],t=this.year-this.range,i=this.year+this.range+1,n=t;n<i;n++)e.push(n);if(s.isIE()){if(!this.yearsCreated){this.$.years.remove(0);for(var o=0,r=e.length;o<r;o++)this._createOptionElements(this.$.years,e[o]);this.yearsCreated=!0}}else this.years=e;Polymer.RenderStatus.afterNextRender(this,function(){this.yearSelection=this.$.years,this.yearSelection.selectedOptions&&(this.yearSelection.selectedOptions[0].selected=""),this.yearSelection.options[this.range].selected="selected",this._showCalendar()}.bind(this))}},{key:"_createOptionElements",value:function(e,t){var i=document.createElement("option");i.label=t,i.value=t,e.appendChild(i)}},{key:"_showCalendar",value:function(){this.isActive=!0,this.updateCalendar(),this.focus(),this.fire("datepicker-opened",{datepicker:this.$.datePicker,dateContainer:this.$.dateContainer}),document.addEventListener("click",this._clickHandler.bind(this)),l.horizontalBound(this.$.datePicker,5)}},{key:"_clickHandler",value:function(e){var t=this;Polymer.dom(e).path.some(function(e){return e===t})||this.hideCalendar()}},{key:"hideCalendar",value:function(){this.isActive&&(this.isActive=!1,this.focus()),document.removeEventListener("click",this._clickHandler)}},{key:"findToday",value:function(){this.selectedDate=new Date,this.updateYearPicklist(),this.updateVariables(),this.updateCalendar(),this.focus()}},{key:"updateYearPicklist",value:function(){for(var e=this.yearSelection.options,t=0,i=e.length;t<i;t++)e[t].selected=this.year==e[t].text}},{key:"changeYear",value:function(){this.year=parseInt(this.yearSelection.selectedOptions[0].text),this.updateCalendar(),this.focus()}},{key:"decreaseMonth",value:function(){this.month=this.month-1,this.month<0&&(this.month=11,this.year=this.year-1,this.updateYearPicklist()),this.monthName=this.months&&this.months[this.month]?this.months[this.month].toUpperCase():"",this.updateCalendar()}},{key:"increaseMonth",value:function(){this.month=this.month+1,11<this.month&&(this.month=0,this.year=this.year+1,this.updateYearPicklist()),this.monthName=this.months&&this.months[this.month]?this.months[this.month].toUpperCase():"",this.updateCalendar()}},{key:"selectDay",value:function(e){this.selectedDate=e.model?e.model.day:this.date,this.hideCalendar()}},{key:"updateVariables",value:function(){this.year=this.date.getUTCFullYear(),this.month=this.date.getUTCMonth(),this.monthName=this.months&&this.months[this.month]?this.months[this.month].toUpperCase():"",this.day=this.date.getUTCDate()}},{key:"updateDate",value:function(e){this.date.setUTCDate(this.date.getUTCDate()+e),this.updateVariables(),this.updateCalendar()}},{key:"updateCalendar",value:function(){this.weeks=[];for(var e=new Date(Date.UTC(this.year,this.month,1)),t=e.getUTCDay(),i=[],n=0,o=0;o<42;o++){var r=new Date(e);r.setUTCDate(e.getUTCDate()+(o-t)),i[n]=r,n++,(o+1)%7!=0&&o+1!==42||(this.push("weeks",i),i=[],n=0)}}},{key:"validateInput",value:function(){if(!this.noblur){var e=void 0,t=!1,i=this.$.dateInput.value,n=""===i.trim();if(i!==(n?"":this.getLocaleDate())||null===this.selectedDate&&!n){var o=this.dateParser.parse(i,function(e){return e>=this.year-this.range&&e<=this.year+this.range}.bind(this));(t=null==o)?e=this.i18n.l("Invalid Date."):(this.selectedDate=o,this.updateVariables())}var r="object"===u(this.selectedDate)||""!==this.selectedDate.trim();n&&r&&(this.dateFormatted="",this.selectedDate=null),this.invalidInput=t,this.fire("field-change-validated",{error:e}),this.fire("sb-date-blur")}}},{key:"navigate",value:function(e){if(9!==e.keyCode)switch(e.keyCode){case 13:this.isActive?this.selectDay(e):this.validateInput();break;case 27:this.isActive?this.hideCalendar():(this.escaped=!0,this.fire("sb-date-esc",{keyCode:27}));break;case 37:this.updateDate(-1);break;case 38:this.updateDate(-7);break;case 39:this.updateDate(1);break;case 40:this.isActive?this.updateDate(7):this.showCalendar()}else this.hideCalendar()}},{key:"getLocaleDate",value:function(){try{return this.date.toLocaleDateString(this.user.locale,{timeZone:"UTC"})}catch(e){return this.date.toLocaleDateString()}}},{key:"attached",value:function(){this.focusOnAttached&&this.focus()}},{key:"focus",value:function(){this.highlight(),this.$.dateInput.focus()}},{key:"highlight",value:function(){this.dateFormatted&&this.$.dateInput.setSelectionRange(0,this.dateFormatted.length)}},{key:"preventBlur",value:function(){this.noblur=!0}},{key:"allowBlur",value:function(){this.noblur=!1}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"behaviors",get:function(){return[sb.common.core.AppContext,window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[a.PANEL_CLOSED]=this.hideCalendar,e}}]),c=e)),t("Datepicker",c),Polymer(c)}}}),System.register("common/forms/sb-discount/Discount.js",["common/forms/NumberParser.js","quotes/layout/sb-le-table-cell/DiscountConverter.js","quotes/models/UiNotifier.js"],function(t,e){var i,r,o,s,a,l;return{setters:[function(e){i=e.NumberParser},function(e){r=e.getUnitAndDisplayValue,o=e.setDiscountValue,s=e.convertDiscountValue},function(e){a=e.registerComponent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Discount",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-discount",this.properties={model:{type:Object,observer:"_modelChanged"},property:String,focusOnAttached:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},unitChanged:Object,numberParser:{type:Object,value:function(){return new i}},formatter:Object,displayValue:String,original:Object}}},{key:"ready",value:function(){var e=this.$.discount.querySelector(".myinput");e.addEventListener("change",this.checkThenSetDiscountValue.bind(this)),e.addEventListener("focus",this.focused.bind(this)),e.addEventListener("blur",this.deferBlur.bind(this)),e.addEventListener("keydown",this.tabBlur.bind(this,!0));var t=this.$.discountUnits.querySelector(".myselect");t.addEventListener("change",this.convertDiscountValueThenUpdate.bind(this)),t.addEventListener("focus",this.focused.bind(this)),t.addEventListener("blur",this.deferBlur.bind(this)),t.addEventListener("keydown",this.tabBlur.bind(this,!1))}},{key:"attached",value:function(){this.focusOnAttached&&this.focus()}},{key:"focus",value:function(){this.$.discount.focus()}},{key:"focused",value:function(){this.blurred&&clearTimeout(this.blurred)}},{key:"deferBlur",value:function(){this.tabBlurred?this.tabBlurred=!1:this.blurred=setTimeout(function(){this.blurDiscount(!0)}.bind(this),1)}},{key:"tabBlur",value:function(e,t){27===t.keyCode&&this.renderReadOnly?this.resetToOriginal():9===t.keyCode&&(this.tabBlurred=!0,(e&&t.shiftKey||!e&&!t.shiftKey)&&this.blurDiscount(!1,t))}},{key:"blurDiscount",value:function(e,t){e?this._blur(t):setTimeout(function(){this._blur(t)}.bind(this),10)}},{key:"_blur",value:function(e){var t=""!==this.$.discount.value?this.numberParser.parse(this.$.discount.value):null;o(this.model,this.property,t),this.fire("sb-discount-blur"),e&&this.fire("sb-discount-keydown",{keyCode:9,shiftKey:e.shiftKey})}},{key:"checkThenSetDiscountValue",value:function(e){var t=r(this.model,this.property).displayValue,i=""!==e.target.value?this.numberParser.parse(e.target.value):null;t!=i&&(o(this.model,this.property,i),this.fire("sb-discount-change",{value:i}))}},{key:"convertDiscountValueThenUpdate",value:function(e){s(this.model,this.property,e.target.value),this.displayValue=void 0,this.displayValue=this.formatter.format(r(this.model,this.property).displayValue)}},{key:"resetToOriginal",value:function(){this.checkThenSetDiscountValue({target:{value:this.original.label}}),this.convertDiscountValueThenUpdate({target:{value:this.original.unitValue}}),this.checkThenSetDiscountValue({target:{value:this.original.label}}),this.convertDiscountValueThenUpdate({target:{value:this.original.unitValue}}),this.selectUnit(r(this.model,this.property).unit)}},{key:"selectUnit",value:function(e){for(var t=this.$.discountUnits.querySelector(".myselect"),i=t.options,n=0,o=i.length;n<o;n++)if(i[n].value===e){t.selectedIndex=n;break}}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"_runConverterObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._runConverter(e,t)}},{key:"_runConverter",value:function(e,t){var i=r(e,t),n=i.units,o=i.unit;this.$.discountUnits.value=o,this.$.discountUnits.options=n}},{key:"_modelChanged",value:function(){a(this)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_runConverterObserver(model, property)"]}}]),l=e)),t("Discount",l),Polymer(l)}}}),System.register("common/forms/sb-dual-list-box/DualListBox.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("DualListBox",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-dual-list-box",this.properties={options:Array,availableTitle:String,chosenTitle:String,value:{type:Array,notify:!0}}}},{key:"_buildOptions",value:function(){this.value=[],this.chosenOptions=[];var t=[];this._clearSelected(),this.options.forEach(function(e){e.available=!0,t.push(e)}.bind(this)),this.availableOptions=t}},{key:"ready",value:function(){var e=this;Polymer.RenderStatus.afterNextRender(this,function(){e.$.available.addEventListener("change",function(e){this.availableOptionsSelected=e.detail.value}.bind(e)),e.$.chosen.addEventListener("change",function(e){this.chosenOptionsSelected=e.detail.value}.bind(e))})}},{key:"_updateOptions",value:function(e){var t=e.currentTarget.getAttribute("data-index"),i=new Set("right"===t?this.availableOptionsSelected.split(";"):this.chosenOptionsSelected.split(";"));this.availableOptionsSelected="",this.chosenOptionsSelected="";var n=[],o=[];this.options.forEach(function(e){"right"===t?i.has(e.value.toString())||!e.available?(e.available=!1,o.push(e)):n.push(e):i.has(e.value.toString())||e.available?(e.available=!0,n.push(e)):o.push(e)}.bind(this)),this._clearSelected(),this.availableOptions=n,this.chosenOptions=o,this.value=this.chosenOptions}},{key:"_clearSelected",value:function(){this.$.available.value=null,this.$.chosen.value=null}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_buildOptions(options)"]}}]),i=e)),t("DualListBox",i),Polymer(i)}}}),System.register("common/forms/sb-field/Field.js",["common/core/AppContext.js","common/forms/NumberParser.js","common/forms/sb-field/factory/FieldFactory.js","common/forms/DependentPicklistBuilder.js","common/layout/sb-html/Html.js","common/formatter/Formatter.js"],function(t,e){var i,o,s,r,a,l,u,d,c,h,f,p,v;return{setters:[function(e){i=e.AppContext},function(e){o=e.NumberParser},function(e){s=e.fieldFactory},function(e){r=e.DependentPicklistBuilder},function(e){a=e.Html},function(e){l=e.Formatter}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}u=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},d="keyReadOnly",c="keyDownReadOnly",h="blurReadOnly","change",f="hideField",p="refDisplay","applyFocus",t("Field",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),u(e,[{key:"beforeRegister",value:function(){this.is="sb-field",this.properties=Polymer.Base.extend({obj:Object,property:String,model:{type:Object,value:null},md:Object,type:{type:String,computed:"getType(md)"},refObjects:{type:Array,value:[]},editing:{type:Boolean,value:!1},_wasEverEditable:{type:Boolean,computed:"_setWasEverEditable(editing)"},disabled:{type:Boolean,value:!1},hidden:{type:Object,value:!1,observer:"hiddenChanged"},link:Boolean,value:{observer:"_valueChanged"},refDisplay:{type:String,notify:!0},objAndRefObjects:Object,objKey:String,refObjectsKey:String,refTable:{type:String,computed:"computeRefTable(md)"},readOnly:Boolean,renderReadOnly:{type:Boolean,value:!1},formattedValue:Object,originalFormattedValue:String,hideFormattedValue:{type:Boolean,value:!1},focus:{type:Boolean,value:!1,observer:"applyFocus"},index:Number,recordId:{type:String,value:null,observer:"recordIdChanged"},numberParser:{type:Object,value:function(){return new o}},preventNumericAlignment:{type:Boolean,value:!1},signaler:Object,record:Object,tabIndex:Number,factoryData:Object,html:Object},i.properties)}},{key:"ready",value:function(){this.addEventListener("sb-row-focus-signal",this.handleRowFocusSignal.bind(this)),this.addEventListener("sb-field-edit",this.handleFieldEditSignal.bind(this)),this.html=new a(this)}},{key:"attached",value:function(){this._tapHandler=this.linkOrEdit.bind(this),this.querySelector("#formatted").addEventListener("tap",this._tapHandler,{passive:!0})}},{key:"detached",value:function(){this._tapHandler&&this.querySelector("#formatted")&&this.querySelector("#formatted").removeEventListener("tap",this._tapHandler)}},{key:"_createObjObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._createObj(e,t)}},{key:"_createObj",value:function(e,t){if(!this.obj||this.isInternalObject){this.isInternalObject=!0;var i=this.obj?this.obj:{};i[t]=e,this.obj=i}}},{key:"_setObjAndRefObjectsObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.setObjAndRefObjects(e,t,i)}},{key:"setObjAndRefObjects",value:function(e,t,i){this.obj=void 0,this.refObjects=void 0,this.refObjects=e[i],void 0===this.refObjects&&(this.refObjects={}),this.obj=""!==t?e[t]:e}},{key:"_renderObserver",value:function(e,t,i,n,o,r,s,a){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o&&void 0!==r&&void 0!==s&&void 0!==a)return this.render(e,t,i,n,o,r,s,a)}},{key:"render",value:function(e,t,i,n,o,r,s,a){this.rendered=!0,this.isReadOnly()?this.updateTemplateData(e,t,n,a):(this._toggleEditing&&this._unrender(),this._render(e,t,n,a))}},{key:"_render",value:function(e,t,i,n){var o=this;if(!this.template){this.template=document.createElement("template","dom-bind");var r=this.updateTemplateData(e,t,i,n);this.createBaseElement(r.html),this.template.change=this.onChange.bind(this),this.template[d]=function(e){return o.onKeyupReadOnly(o.model,o.obj,o.md,o.html,e)},this.template[c]=this.onKeyDownReadOnly.bind(this),this.template[h]=function(e){return o.onBlurReadOnly(o.model,o.obj,o.md,o.html,e)},this.isReadOnly()||(this.hideFormattedValue=!0),Polymer.dom(this.$.f).appendChild(this.template)}}},{key:"_unrender",value:function(){if(this.template)try{for(var e=Polymer.dom(this.$.f),t=e.childNodes,i=0,n=t.length;i<n;i++)e.removeChild(t[i]);Polymer.dom.flush(),this.template=null}catch(e){return}}},{key:"_setOriginalFormattedValueObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this._setOriginalFormattedValue(e,t,i)}},{key:"_setOriginalFormattedValue",value:function(e,t,i){var n=this.getFormField(e,t,i),o=this.originalFormattedValue&&void 0!==this.originalFormattedValue.value&&this.originalFormattedValue.value!==t;this.originalFormattedValue=this.getFormattedValue(n,t),this.formattedValue&&o&&this.addFormattedDirtyClass(this.isEditable())}},{key:"onChange",value:function(e){this._onChange(e);var t=!!e.detail&&e.detail.suppressImmediateCalculation;this.fire("sb-field-on-change-field",{suppressImmediateCalculation:t})}},{key:"_onChange",value:function(e){if(!this.internal){var t=this.getEventTarget(e),i=void 0!==t.value?t.value:e.detail?e.detail.value:null;this.refDisplay=void 0!==t[p]?t[p]:e.detail&&void 0!==e.detail[p]?e.detail[p]:this.refDisplay,this.isNumericType()?i=i&&0!==i?this.numberParser.parse(i,!1,this.md.scale):null:i instanceof Date&&(i="date"===this.type?l.toApexDate(i):l.toApexDateTime(i)),this.internal=!0,this.obj[this.property]=i,this.domHost&&(this.domHost.value=i),this.internal=!1,this.fireCustomChangeEvents(e)}}},{key:"fireCustomChangeEvents",value:function(e){!this.md||e&&!e.detail||this.fireControllingSelectChangeEvent()}},{key:"fireControllingSelectChangeEvent",value:function(){var e={tableName:this.md.tableName,fieldName:this.md.name,record:this.record},t=new CustomEvent("sb-controlling-select-changed",{bubbles:!1,detail:e});document.dispatchEvent(t)}},{key:"onKeyDownReadOnly",value:function(e){if(this.signaler&&this.isRenderReadOnly()&&9===(e.keyCode||e.detail.keyCode)){var t=e.shiftKey||e.detail.shiftKey;this.signaler.signalNextPreviousEditableTarget(this,!t)}}},{key:"onKeyupReadOnly",value:function(e,t,i,n,o){27===(o.keyCode||o.detail.keyCode)&&this.onBlurReadOnly(e,t,i,n,!1)}},{key:"onBlurReadOnly",value:function(e,t,i,n,o){if(this.isReadOnly()&&!this.template[f]){if(o)this.setPreviouslyFormattedValue(),this.updateTemplateData(e,t,i,n);else{var r={target:{value:this.previouslyFormatted?this.previouslyFormatted.value:this.formattedValue.value}};this.isLookup()&&(r.target[p]=this.previouslyFormatted?this.previouslyFormatted.label:this.formattedValue.label),this._onChange(r),this.updateTemplateData(e,t,i,n)}this.template[f]=!0,this.hideFormattedValue=!1,this.isRenderReadOnly()&&this.enableSignals()}}},{key:"updateTemplateData",value:function(e,t,i,n){var o=t[this.property],r=this.getFormField(e,o,i);if(r.defaultValue&&this.template&&this._onChange({target:{value:r.defaultValue}}),this.formattedValue=this.getFormattedValue(r,o),this.originalFormattedValue=this.originalFormattedValue||this.formattedValue,this.addFormattedValueClasses(r.numeric),this.isReadOnly()&&this.setFormattedDetails(n),this.template)return r.attachTo(this.template,d,c,h,"change",f,this.isRenderReadOnly()),r}},{key:"getFormField",value:function(e,t,i){var n=this.isEditable(!this._toggleEditing),o=this.getSelectOptions(i),r={refDisplay:this.refDisplay,refDisplayName:p,refTable:this.refTable,refObjects:this.refObjects,property:this.property,obj:this.obj,record:this.record};return s(this.type,e,t,n,this.disabled,this.hidden,this.index,this.md,this.i18n,this.isRenderReadOnly(),o,r,this.tabIndex,this.factoryData)}},{key:"getFormattedValue",value:function(e,t){return e.formattedValue||{value:t,label:t}}},{key:"addFormattedValueClasses",value:function(e){var t=this.isEditable();this.toggleClass("editable",t,this.$.formatted),this.toggleClass("numericField",this.segmentedAlignment||!this.preventNumericAlignment&&e,this.$.formatted),this.toggleClass("firstField",0==this.index,this.$.formatted),this.toggleClass("readOnly",this.readOnly,this.$.formatted),this.addFormattedDirtyClass(t);var i=this.isBoolean(),n=!i&&(!1===this.formattedValue.value||this.isNil(this.formattedValue.label)&&!0!==this.formattedValue.value);this.toggleClass("empty",n,this.$.formatted),this.toggleClass("empty",n,this.$.me),this.toggleClass("link",this.link,this.$.formatted),this.toggleClass("link",this.link,this.$.me),this.toggleClass("boolean",i,this.$.formatted)}},{key:"addFormattedDirtyClass",value:function(e){this.isDirty=e&&this.formattedValue.value!==this.originalFormattedValue.value&&!(this.isNil(this.formattedValue.value)&&this.isNil(this.originalFormattedValue.value)),this.toggleClass("dirty",this.isDirty,this.$.formatted)}},{key:"signalRowFocus",value:function(){this.signaler&&(this.signaler.fireSignal("sb-row-focus-signal",!0),setTimeout(function(){this.signaler.disable()}.bind(this),20))}},{key:"enableSignals",value:function(){this.signaler&&this.signaler.enable()}},{key:"handleRowFocusSignal",value:function(e){this.signaler&&(this.signaler.toggleRowFocus(e),this.isEditable()&&this.toggleClass("show",e.detail.focused,this.$.formatted))}},{key:"handleFieldEditSignal",value:function(e){"richtextarea"===this.md.extraTypeInfo?this.signaler.signalNextPreviousEditableTarget(this,e.detail.next):(this.ironList=this.signaler.ironList,this.ironList&&this.ironList.lastVisibleIndex==this.ironList.items.length-1&&(this.ironList.toggleScrollListener(!1),this.scrollListenerDetached=!0),setTimeout(function(){this.scrollListenerDetached&&(this.ironList.toggleScrollListener(!0),this.scrollListenerDetached=!1),this.edit()}.bind(this),0))}},{key:"createBaseElement",value:function(e){var t=this.template.content.ownerDocument.createElement("div");t.innerHTML=e;var i=Polymer.dom(t).firstChild;Polymer.dom(this.template.content).appendChild(i)}},{key:"isNumericType",value:function(){switch(this.type){case"double":case"number":case"currency":case"percent":return!0}return!1}},{key:"getType",value:function(e){return e&&e.type?e.type.toLowerCase():""}},{key:"_valueChanged",value:function(){this.rendered&&void 0===this.value&&this.valueChanged(this.model,this.obj,this.md,this.property,this.html,this.value)}},{key:"_valueChangedObserver",value:function(e,t,i,n,o,r){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o&&void 0!==r)return this.valueChanged(e,t,i,n,o,r)}},{key:"valueChanged",value:function(e,t,i,n,o,r){void 0===r&&this.isBoolean()||(this.internal&&this.template?this.template.value=r:this.obj[n]=r,this.setPreviouslyFormattedValue(),this.updateTemplateData(e,t,i,o))}},{key:"setPreviouslyFormattedValue",value:function(){this.previouslyFormatted=void 0===this.formattedValue?null:JSON.parse(JSON.stringify(this.formattedValue))}},{key:"_disabledChangedObserver",value:function(e,t,i,n,o){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o)return this.disabledChanged(e,t,i,n,o)}},{key:"disabledChanged",value:function(e,t,i,n,o){this.toggleClass("disabled",o,this.$.formatted),this.template&&(this.template.disabled=o),this.isRenderReadOnly()&&this.editing&&this.updateTemplateData(e,t,i,n)}},{key:"hiddenChanged",value:function(){this.template&&(this.template.hide=this.hidden)}},{key:"recordIdChanged",value:function(){this.template&&(this.template.recordId=this.recordId)}},{key:"recordChanged",value:function(e){this.template&&e&&e.path&&"record"!==e.path&&this.template.set(e.path,e.value)}},{key:"computeRefTable",value:function(e){if(void 0!==e)return e.referenceTable?e.referenceTable:e.referenceTo&&0<e.referenceTo.length?e.referenceTo[0]:null}},{key:"linkOrEdit",value:function(){this.link?this.fire("sb-link-tapped",{value:this.value,Id:this.recordId}):this.edit(!0)}},{key:"edit",value:function(e){this.isEditable()&&(this._render(this.model,this.obj,this.md,this.html),this.hideFormattedValue=!this.isRichText(),this.template[f]=!this.hideFormattedValue,this.template._nodes&&this.template._nodes[0].focus&&this.template._nodes[0].focus(),e&&this.invertValueIfInlineBoolean(),this.isRenderReadOnly()&&this.signalRowFocus())}},{key:"getEventTarget",value:function(t){try{return Polymer.dom(t).localTarget||t.target}catch(e){return t.target}}},{key:"isNil",value:function(e){return null==e||""===e||"number"==typeof e&&e+""=="NaN"}},{key:"applyFocus",value:function(){this.template&&(this.template.applyFocus=this.focus)}},{key:"isEditable",value:function(e){return!(!e||!this._wasEverEditable)||!(this.readOnly||this.isRenderReadOnly()&&this.disabled)&&this.editing}},{key:"isReadOnly",value:function(){return this.readOnly||this.isRenderReadOnly()||this.isFormulaHtml()}},{key:"isRenderReadOnly",value:function(){return this.renderReadOnly||this.isRichText()}},{key:"isFormulaHtml",value:function(){return this.md.htmlFormatted&&this.md.calculated}},{key:"setFormattedDetails",value:function(e){e.isDirty=this.isDirty,e.link=!!this.link,e.type=this.type,e.booleanValue=this.isBoolean()?this.obj[this.property]:null,e.value=this.formattedValue.label,this.formattedValue.unit&&(e.value+=" "+this.formattedValue.unit),e.sanitizeAndSetInnerHTML()}},{key:"isBoolean",value:function(){return"boolean"===this.type||"checkbox"===this.type}},{key:"isLookup",value:function(){return"id"===this.type||"reference"===this.type}},{key:"isRichText",value:function(){return"textarea"===this.type&&"richtextarea"===this.md.extraTypeInfo}},{key:"addControlledSelectListener",value:function(e){var t=this;e&&e.controllerName&&document.addEventListener("sb-controlling-select-changed",function(e){return t.controllerSelectHandler(t.model,t.obj,t.md,t.html,e)})}},{key:"controllerSelectHandler",value:function(e,t,i,n,o){var r=o.detail.tableName,s=o.detail.fieldName,a=o.detail.record,l="function"==typeof this.record.equals&&a?this.record.equals(a):this.record===a;r===i.tableName&&i.controllerName===s&&l&&(this.buildSelectOptions(i,!0)||this.updateTemplateData(e,t,i,n))}},{key:"getSelectOptions",value:function(e){return this._selectOptions||this.buildSelectOptions(e),this._selectOptions}},{key:"buildSelectOptions",value:function(e,t){if(!e.controllerName||!this.record)return this._selectOptions=e.picklistValues,!1;var i="function"==typeof this.record.getValue?this.record.getValue(e.controllerName):this.record[e.controllerName];return this._selectOptions=new r(e,i).build(),!!t&&this.clearValueIfNotAnOption(this._selectOptions)}},{key:"clearValueIfNotAnOption",value:function(e){if(null===this.value)return!1;var t=!0;return e.forEach(function(e){e.value==this.value&&(t=!1)}.bind(this)),!!t&&("function"==typeof this.record.setValue?this.record.setValue(this.property,null):this.record[this.property]=null,this.onChange({target:{value:null},detail:!0}),!0)}},{key:"invertValueIfInlineBoolean",value:function(){this.isRenderReadOnly()&&this.isBoolean()&&(this.value=void 0,this.value=!this.obj[this.property],this.internal=!0,this.domHost.value=this.value,this.internal=!1,this.fireCustomChangeEvents(),this.fire("sb-field-on-change-field"))}},{key:"_setWasEverEditable",value:function(){return this._wasEverEditable||this.editing}},{key:"toggleEditing",value:function(e){this.template&&!!e!=!!this.editing&&(this._toggleEditing=!0,this.editing=e,this._toggleEditing=!1)}},{key:"behaviors",get:function(){return[sb.common.core.AppContext,window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_renderObserver(model, obj, property, md, refObjects, editing, renderReadOnly, html)","_setObjAndRefObjectsObserver(objAndRefObjects, objKey, refObjectsKey)","_setOriginalFormattedValueObserver(model, originalValue, md)","addControlledSelectListener(md)","recordChanged(record.*)","_valueChangedObserver(model, obj, md, property, html, value)","_disabledChangedObserver(model, obj, md, html, disabled)","_createObjObserver(value, property)"]}}]),v=e)),t("Field",v),Polymer(v)}}}),System.register("common/forms/sb-input/Input.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Input",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-input",this.properties={value:{type:String,observer:"changed",notify:!0},focusOnAttached:Boolean,inputType:{type:String,value:"text"},renderReadOnly:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},viewport:{type:Object,value:function(){return i.getViewport()}},showClear:{type:Boolean,computed:"_showClear(viewport, inputType, disabled)"},disabled:{type:Boolean,value:!1},focused:{type:Boolean,value:!1}}}},{key:"_hideClearIfEmptyObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.hideClearIfEmpty(e,t,i)}},{key:"hideClearIfEmpty",value:function(){this.showClear&&(this.$$("#clear")?this._hideClearIfEmpty():Polymer.RenderStatus.afterNextRender(this,function(){this._hideClearIfEmpty()}.bind(this)))}},{key:"_hideClearIfEmpty",value:function(){this.toggleClass("hide",this.focused||null==this.value||""===this.value,this.$$("#clear"))}},{key:"attached",value:function(){this.focusOnAttached&&this.focus()}},{key:"focus",value:function(){this.querySelector(".myinput").focus()}},{key:"blur",value:function(){this.fireChangeOnBlur(),this.fire("blur"),this.focused=!1}},{key:"clear",value:function(){this.value=null,this.querySelector(".myinput").blur()}},{key:"highlight",value:function(){if(this.focused=!0,!this.viewport||!this.viewport.isMobile()){var e=this.value?this.value.length:0;this.querySelector(".myinput").setSelectionRange(0,e)}}},{key:"changed",value:function(e,t){void 0!==t?(this.changeOnNextBlur=!1,t!=e&&this.fireChangeEvent(e)):this.changeOnNextBlur=!0}},{key:"fireChangeEvent",value:function(e){this.fire("change",{value:e})}},{key:"fireChangeOnBlur",value:function(){this.changeOnNextBlur&&(this.fireChangeEvent(this.value),this.changeOnNextBlur=!1)}},{key:"propagateEsc",value:function(e){27===e.keyCode&&(this.renderReadOnly&&(this.querySelector(".myinput").value=this.value),this.fire("sb-input-key",{keyCode:27}))}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"_showClear",value:function(){return this.viewport&&this.viewport.isMobile()&&!this.disabled&&"date"!==this.inputType&&"datetime"!==this.inputType}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_hideClearIfEmptyObserver(value, showClear, focused)"]}}]),o=e)),t("Input",o),Polymer(o)}}}),System.register("common/forms/sb-lookup/Lookup.js",["common/core/AppContext.js","common/forms/sb-lookup/map/LookupNameMapper.js","common/core/sb-page-container/PageContainer.js","common/forms/sb-lookup/query/LookupQueryBuilder.js","common/core/Events.js"],function(t,e){var o,i,r,s,a,l,u;return{setters:[function(e){o=e.AppContext},function(e){i=e.LookupNameMapper},function(e){r=e.PageContainer},function(e){s=e.LookupQueryBuilder},function(e){a=e.Events,l=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Lookup",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-lookup",this.properties={tableName:{type:String,observer:"initTableLabel"},limit:{type:Number,value:5},value:{type:String,value:null},label:{type:String,value:null},disabled:{type:Boolean,value:!1},labelName:{type:String,value:"label"},selectedLabel:{type:String,computed:"getSelectedLabel(tableName)"},menuItemLabels:{type:Array,value:null},lookupCallback:{type:Function,value:function(){return this.lookupResultsCallback.bind(this)}},hideInputAndShowPill:{type:Boolean,value:!1},hideCancelIcon:{type:Boolean,value:!0},i18n:{type:Object,value:function(){return o.properties.i18n.value()}},inDialog:{type:Boolean,value:!1},blurDisabled:{type:Boolean,value:!1},focusDisabled:{type:Boolean,value:!1},tableLabel:{type:String,value:""},placeholder:{type:String,value:null},labels:{type:Array,computed:"getLabels(selectedLabel, menuItemLabels)"},searchText:{type:String,computed:"getSearchText(placeholder, tableLabel, i18n)"},viewport:{type:Object,value:function(){return r.getViewport()}},showSearchIcon:{type:Boolean,computed:"showSearch(viewport, inDialog)"},mobile:{type:Boolean,computed:"isMobile(viewport)"},fieldFullName:String,hasFilter:{type:Boolean,value:!1},controllingFields:{type:Array,value:[]},errors:Array,currentRecordFilters:Object,record:{type:Object,value:null},dialogMetadata:Object}}},{key:"ready",value:function(){this.$.object.addEventListener("describe-changed",this.setTableLabel.bind(this)),this.$.typeahead.addEventListener("enter-without-selection",this.handleEnterPressed.bind(this)),this.$.fields.addEventListener("md-changed",this.setCurrentRecordFilters.bind(this))}},{key:"initTableLabel",value:function(){this.tableName&&(this.$.object.objects=[this.tableName])}},{key:"setTableLabel",value:function(e){this.tableLabel=e.detail.value.md[this.tableName].labelPlural}},{key:"setCallback",value:function(){this.lookupCallback=this.customCallback.bind(this)}},{key:"lookupResultsCallback",value:function(i){return new Promise(function(e,t){this.tableName?this.queryLookupResults(i,e,t):e([])}.bind(this))}},{key:"queryLookupResults",value:function(a,l,i){this.errors=null;var n=new s(this.tableName,this.selectedLabel,this.hasFilter,this.fieldFullName,this.limit,this.currentRecordFilters,this.record,!0,this.dialogMetadata).build(a,!1,this.inDialog);this.$.q.query({soql:n,version:o.apiVersionString}).then(function(e){var t=e.records,i=null==a?"":a,n={Id:"",__md__:{class:"search",searchValue:i,clearAfterSelection:!this.inDialog,noFocusAfterSelection:this.inDialog}},o=this.tableLabel;if(!o){var r=this.tableName.split("__");o=r[1<r.length?r.length-2:0]}if(this.isMobile())n[this.selectedLabel]=i?this.i18n.l('"{0}"',[i]):"",t.push(n);else{var s=i?'"{0}" in {1}':" in {1}";n[this.selectedLabel]=this.i18n.l(s,[i,o]),t=[n].concat(t)}this.inDialog&&this.isMobile()?this.domHost.handleSearchResults(this.limit,{records:t,totalSize:e.totalSize}):l(t)}.bind(this),function(e){var t=void 0;t="INVALID_FIELD"===e.errorCode?this.i18n.l("lookupQueryError"):"SOQL Execution Error: "+n+" ("+(e&&e.message?e.message:e)+")",this.errors=[{type:"error",msg:t}],i(t)}.bind(this))}},{key:"_setLabelObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.setLabel(e,t,i)}},{key:"setLabel",value:function(e,t,i){this._setLabel(e,t,i),null!=this.value&&null!=this.selectedLabel&&this.setSelectedItem()}},{key:"_setSelectedItemObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setSelectedItem(e,t)}},{key:"setSelectedItem",value:function(){if(!this.internal&&null!=this.label){var e=this.getLabel(),t={Id:this.value};t[this.selectedLabel]=e,this.$.typeahead.items=this.$.typeahead.items||[t],this.$.typeahead.selectedItem=t,this.setHideInputAndShowPill(this.value),this.focus(),this._handleSelectedItemChanged||(this._handleSelectedItemChanged=this.handleSelectedItemChanged.bind(this),this.$.typeahead.addEventListener("selected-item-changed",this._handleSelectedItemChanged))}}},{key:"handleSelectedItemChanged",value:function(e){if(!e.detail.path&&""!=e.detail.value){var t=e.detail.value.__md__,i=t&&void 0!==t.searchValue?t.searchValue:void 0;void 0===i?(this.setHideInputAndShowPill(e.detail.value.Id),this.focus(),this.internal=!0,this.value=e.detail.value.Id||null,this.label=e.detail.value[this.selectedLabel]||"",this.internal=!1,this._setLabel(),this.fireLookupValueChanged(this.value,this.label,e.detail.value)):this.applySearchValue(i)}}},{key:"applySearchValue",value:function(e){e&&e.detail&&(e=e.detail.value),this.inDialog?(this.domHost.searchValue=e,this.domHost.querySearchResults()):l(a.OPEN_LOOKUP_DIALOG,{lookup:this,searchValue:e})}},{key:"handleEnterPressed",value:function(e){this.currentRecordFilters&&this.applySearchValue(e.detail.value)}},{key:"fireLookupValueChanged",value:function(e,t,i){var n={value:e,obj:i,item:this.record?this.record.item:null};n[this.labelName]=t,this.fire("lookup-value-changed",n)}},{key:"focus",value:function(e){this.isMobile()||(this.hideInputAndShowPill?this.focusDisabled||this.$.container.focus():(this.$.typeahead.focus(e||this.forceSuggest),this.forceSuggest=!1))}},{key:"getLabel",value:function(){this.labelsByValue=this.labelsByValue||{};var e=this._getLabelValueKey(),t=this.labelsByValue[e];return this.value&&!t&&(this.labelsByValue[e]=this.label,t=this.label),t}},{key:"_setLabel",value:function(e,t,i){var n=this._getLabelValueKey();this.labelsByValue=this.labelsByValue||{},this.labelsByValue[n]=this.getDefaultLabelFromRecord(e,t,i)}},{key:"_getLabelValueKey",value:function(){return this.value&&"string"==typeof this.value?this.value.substring(0,15):this.value}},{key:"setHideInputAndShowPill",value:function(e){this.hideInputAndShowPill=!this.isMobile()&&!this.isNil(e)&&!this.clearAfterSelection}},{key:"blurContainer",value:function(){this.hideInputAndShowPill&&!this.blurDisabled&&this.blur()}},{key:"blur",value:function(){this.$.typeahead.setOriginalSelected(),this.fire("sb-type-blur")}},{key:"propagateEscOrHandleDelete",value:function(e){27===e.keyCode?this.$.typeahead.suggest(e):8===e.keyCode&&(this.deletePill(),this.blurDisabled=!!this.previousBlurDisabled)}},{key:"preventBlurOnDelete",value:function(e){this.previousBlurDisabled=this.blurDisabled,8===e.keyCode&&(this.blurDisabled=!0)}},{key:"preventBlur",value:function(){this.previousBlurDisabled=this.blurDisabled,this.blurDisabled=!0}},{key:"deletePill",value:function(){this.disabled||this.$.typeahead.clear(),this.blurDisabled=this.previousBlurDisabled}},{key:"isNil",value:function(e){return null==e||""===e}},{key:"dialogOpened",value:function(){this.blurDisabled=!0,this.focusDisabled=!0}},{key:"dialogClosed",value:function(){this.blurDisabled=!1,this.focusDisabled=!1,this.focus(!0),l(a.CLOSE_LOOKUP_DIALOG,{lookup:this})}},{key:"getDefaultLabelFromRecord",value:function(e,t,i){if(!(i&&i.model&&i.model.attributeMD&&i.model.attributeMD[i.item]))return e;var n=i.model.attributeMD[i.item];return n.value===t&&null!=n.referencedFieldValue?n.referencedFieldValue:e}},{key:"getSelectedLabel",value:function(){return new i(this.tableName).getNameField()}},{key:"getLabels",value:function(){return this.menuItemLabels||[this.selectedLabel]}},{key:"getSearchText",value:function(){return this.placeholder||this.buildSearchText()}},{key:"buildSearchText",value:function(){return this.i18n&&"function"==typeof this.i18n.l?this.i18n.l("Search {0}",[this.tableLabel]):"Search "+this.tableLabel}},{key:"_handleMobileEventsObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.handleMobileEvents(e,t)}},{key:"handleMobileEvents",value:function(){this.isMobile()&&(this.inDialog?(this._clearAndSave=this._clearAndSave||(this.domHost.clearAndSave?this.domHost.clearAndSave.bind(this.domHost):null),this._clearAndSave&&(this.$.typeahead.removeEventListener("sb-type-clear",this._clearAndSave),this.$.typeahead.addEventListener("sb-type-clear",this._clearAndSave))):(this._applySearchValue=this._applySearchValue||this.applySearchValue.bind(this),this.$.typeahead.removeEventListener("sb-type-focus",this._applySearchValue),this.$.typeahead.addEventListener("sb-type-focus",this._applySearchValue)))}},{key:"showSearch",value:function(){return this.isMobile()&&!this.inDialog}},{key:"isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"_initCurrentRecordFiltersObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.initCurrentRecordFilters(e,t,i)}},{key:"initCurrentRecordFilters",value:function(){if(0!==this.controllingFields.length){var e=this.fieldFullName.split(".")[0],t=[],i=!0,n=!1,o=void 0;try{for(var r,s=this.controllingFields[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(e+"."+a)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this.$.fields.fields=t}else this.currentRecordFilters={}}},{key:"setCurrentRecordFilters",value:function(e){var t={},i=!0,n=!1,o=void 0;try{for(var r,s=e.detail.value.fields[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t[a.name]=a.type}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this.currentRecordFilters=t}},{key:"setForceSuggest",value:function(e){if(!this.forceSuggest&&e&&e.path&&"record"!==e.path&&this.hasFilter){var t=this.currentRecordFilters?Object.keys(this.currentRecordFilters):[];if(0!==t.length){var i=e.path.split("."),n=i[i.length-1];-1!==t.indexOf(n)&&(this.forceSuggest=!0)}}}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_setSelectedItemObserver(value, selectedLabel)","_setLabelObserver(label, value, record)","setCallback(customCallback)","_handleMobileEventsObserver(viewport, inDialog)","setForceSuggest(record.*)","_initCurrentRecordFiltersObserver(hasFilter, controllingFields, fieldFullName)"]}}]),u=e)),t("Lookup",u),Polymer(u)}}}),System.register("common/forms/sb-lookup-dialog/LookupDialog.js",["common/layout/tables/TableClassBuilder.js","common/core/AppContext.js","common/core/sb-page-container/PageContainer.js","common/forms/sb-lookup/query/LookupQueryBuilder.js"],function(t,e){var f,i,o,r,s,a,l,u,c,d;return{setters:[function(e){f=e.TableClassBuilder},function(e){i=e.AppContext},function(e){o=e.PageContainer},function(e){r=e.LookupQueryBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},a="CPQ_Lookup",l="CPQ_Lookup_Search",c=(u=["string","picklist","multipicklist"]).concat(["textarea","date","datetime","int","number","currency","percent","double","reference"]),t("LookupDialog",(s(e,[{key:"beforeRegister",value:function(){this.is="sb-lookup-dialog",this.properties={value:{type:String,value:null},label:String,tableName:String,tableLabel:String,fieldLabel:String,labelName:String,selectedLabel:String,searchValue:String,metadata:Object,numResults:Number,results:Object,invoker:{type:Object,observer:"initialize"},isOAuth:{type:Boolean,value:function(){return!!i.org&&i.org.isOAuth}},openSpinner:{type:Boolean,value:!1},recordSpinner:{type:Boolean,value:!1},viewport:{type:Object,value:function(){return o.getViewport()}},isMobile:{type:Boolean,computed:"_isMobile(viewport)"},hideCancel:{type:Boolean,computed:"_hideCancel(isMobile, openSpinner, recordSpinner)"},layoutFields:{type:Array,value:[]},searchFields:{type:Array,value:[]},lookupSearchTypes:{type:Array,value:function(){return u.concat(i.org?i.org.additionalLookupSearchTypes:[])}},maxSearchFields:{type:Number,value:function(){return i.org?i.org.maxLookupSearchFields:1}},fieldSetPrefix:{type:String,value:function(){return i.org.prefix?i.org.prefix+"__":""}},i18n:{type:Object,value:function(){return i.properties.i18n.value()}}}}},{key:"ready",value:function(){this.addEventListener("sb-close-dialog",this.cancel.bind(this)),this.addEventListener("lookup-value-changed",this.setValues.bind(this)),this.$.field.addEventListener("md-changed",this.processListFields.bind(this)),this.addEventListener("sb-link-tapped",this.updateLookup.bind(this)),this.setResultsHeightHandler=this.setResultsHeight.bind(this),window.addEventListener("resize",this.setResultsHeightHandler),this.$$("#list").assignParentResizable({stopResizeNotificationsFor:function(){window.removeEventListener("resize",this.setResultsHeightHandler)}.bind(this)})}},{key:"initialize",value:function(){this.invoker&&(this.labelName=this.invoker.labelName,this.label=this.invoker.label,this.selectedLabel=this.invoker.selectedLabel,this.tableName=this.invoker.tableName,this.fieldLabel=this.invoker.fieldLabel,this.currentRecordFilters=this.invoker.currentRecordFilters,this.controllingFields=this.invoker.controllingFields,this.record=this.invoker.record,this.hasFilter=!(this.currentRecordFilters&&0<Object.keys(this.currentRecordFilters).length&&i.apiVersion<39)&&this.invoker.hasFilter,this.fieldFullName=this.invoker.fieldFullName)}},{key:"open",value:function(e){this.$.dialog.toggle(),this.invoker.dialogOpened(),this.$.lookup.$.typeahead.blurred=!0,this.$.lookup.$.typeahead.hasList=!1,this.$.lookup.$.typeahead.labelValue=e,this.invoker.$.typeahead.$.itemLabel.blur(),this.searchValue=e}},{key:"cancel",value:function(){this.close()}},{key:"saveAndDeferredClose",value:function(){this.syncSelection(),this.deferredClose()}},{key:"save",value:function(){this.syncSelection(),this.close()}},{key:"syncSelection",value:function(){this.invoker.value=void 0,this.invoker.label=this.label,this.invoker.value=this.value}},{key:"clearAndSave",value:function(){this.label="",this.value=null,this.save()}},{key:"close",value:function(){this.$.dialog.toggle(),this.$.lookup.$.typeahead.suggest({}),this.invoker.dialogClosed(),this.reset(),this.clearSelected()}},{key:"deferredClose",value:function(){setTimeout(function(){this.close()}.bind(this),350)}},{key:"reset",value:function(){this.value=null,this.label=null,this.results=null,this.tableLabel=null,this.fieldLabel=null,this.fieldFullName=void 0,this.hasFilter=!1,this.currentRecordFilters=null,this.controllingFields=null,this.record=null,this.tableName=null,this.numResults=0,this.metadata=void 0,this.layoutFields=[],this.searchFields=[],this.$.header.cols=void 0,this.$.header.$.header.destroyGroup(),this.$.fs.response=null,this.$.fs.context=void 0,this.invoker=null,this.errors=null}},{key:"setValues",value:function(e){this.value=e.detail.value,this.label=e.detail[this.labelName]}},{key:"updateLookup",value:function(e){this.label=void 0,this.value=e.detail.Id,this.label=this.getSelectedLabelValueById(e.detail.Id)}},{key:"getSelectedLabelValueById",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.results[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;if(s.Id===e)return s[this.selectedLabel]}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"_getMetadataObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.getMetadata(e,t)}},{key:"getMetadata",value:function(){this.tableName&&(this.openSpinner=!0,this.$.fs.context={fieldSets:[{tableName:this.tableName,name:a},{tableName:this.tableName,name:l}]})}},{key:"initSearchFieldsAndReturnOnesNotInLayout",value:function(e,t){var i=[],n=this.getCpqLookupSearchFields(e);if(!n)return i;this.searchFields=n.names;var o=n.fields,r=!0,s=!1,a=void 0;try{for(var l,u=o[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value;d!==this.tableName+"."+this.selectedLabel&&-1===t.indexOf(d)&&i.push(d)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}return i}},{key:"_processCPQLayoutFieldsObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.processCPQLayoutFields(e,t)}},{key:"processCPQLayoutFields",value:function(e){if(e)if(this.tableLabel=e[0].tableLabel,this.isMobile)this.initMobileMetadata();else{var t=this.getCpqLookupLayoutFields(e);t||(t={fields:[],names:[]},this.warnUserAboutCPQLayoutFieldSet());var i=this.getNameFieldIfOmittedFrom(t.fields);i&&(t.fields=[i.field].concat(t.fields),t.names.push(i.name)),this.layoutFields=t.names;var n=this.initSearchFieldsAndReturnOnesNotInLayout(e,t.fields),o=t.fields.concat(n);this.$.field.fields=o}}},{key:"processListFields",value:function(e){for(var t=e.detail.value.fields,i=[],n=[],o={},r={},s={},a=[],l=0,u=t.length;l<u;l++){var d=t[l],c={type:d.type,link:0===l};-1!==this.layoutFields.indexOf(d.name)&&(i.push(d.name),n.push(d.label)),o[d.name]=d.type,r[d.name]=c,d.scale&&(r[d.name].scale=d.scale),s[d.label.replace(/\W/g,"")]=d.type,"reference"!==d.type&&"id"!==d.type||a.push({name:d.name,table:d.referenceTo[0]})}this.headerClassMap=new f(Object.keys(s),"Th",s,null,!0).build(),this.rowClassMap=new f(i,"Td",o).build();var h=this.sanitizeAdditionalSearchFields(r);this.metadata={fieldNames:i,fieldLabels:n,fieldTypeObjByName:r,fieldsOfTypeLookup:a,additionalSearchFields:h},this.querySearchResults()}},{key:"sanitizeAdditionalSearchFields",value:function(e){var t=0,i=0,n=[],o=!0,r=!1,s=void 0;try{for(var a,l=this.searchFields[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;if(u!==this.selectedLabel){var d=e[u].type;if(-1!==this.lookupSearchTypes.indexOf(d)&&-1!==c.indexOf(d)&&(n.push(u),++t===this.maxSearchFields))break}else i=1}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}return n.length<this.searchFields.length-i&&this.warnUserAboutSanitizedCPQSearchFieldSet(n),n}},{key:"querySearchResults",value:function(){this.recordSpinner=!this.openSpinner;var e=new r(this.tableName,this.selectedLabel,this.hasFilter,this.fieldFullName,101,this.currentRecordFilters,this.record,!1,this.metadata).build(this.searchValue,!0,!0);this.$.query.query({soql:e}).then(this.handleSearchResults.bind(this,100))}},{key:"handleSearchResults",value:function(e,t){this.clearSelected();var i=t.totalSize>e?"+":"",n=Math.min(e,t.totalSize);this.numResults=n+i,this.results=this.getResults(t,e),this.recordSpinner=!1,this.openSpinner=!1,this.isMobile&&(this.$.tbody.style.overflow=null),Polymer.RenderStatus.afterNextRender(this,function(){this.setResultsHeight()}.bind(this))}},{key:"getResults",value:function(e,t){for(var i=e.records,n=e.totalSize,o=this.isMobile&&i.length>n,r=o?i.pop():null;t<n;)i.pop(),n--;return o&&r&&r[this.selectedLabel]&&""!==r[this.selectedLabel]&&(i.push(r),i[n][this.selectedLabel]=r[this.selectedLabel]),i}},{key:"setResultsHeight",value:function(){var e=this.isMobile?document.documentElement.clientHeight:this.$.dialog.$$("#footer").offsetTop,t=e-this.$.tbody.offsetTop,i=t<this.$.tbody.scrollHeight?t+"px":null;this.$.tbody.style.height=i;var n=e-this.$.datatable.offsetTop+"px";this.$.datatable.style.height=n;var o=this.$.spinner.$$("#mask");o.style.height=t+"px",this.isMobile?this.$.tbody.style.overflow="auto":o.style.marginLeft="-24px",Polymer.RenderStatus.afterNextRender(this,function(){this.$$("#list").notifyResize()}.bind(this))}},{key:"getCpqLookupLayoutFields",value:function(e){return this.getCpqLookupFields(e,!1)}},{key:"getCpqLookupSearchFields",value:function(e){return this.getCpqLookupFields(e,!0)}},{key:"getCpqLookupFields",value:function(e,t){var i=[],n=[],o=!0,r=!1,s=void 0;try{for(var a,l=e[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;if(this.validCPQFieldSet(u,t)){var d=u.displayedFields,c=d?d.constructor===Array?d:[d]:[],h=!0,f=!1,p=void 0;try{for(var v,g=c[Symbol.iterator]();!(h=(v=g.next()).done);h=!0){var y=v.value,m=y.field||y;1===m.split(".").length&&(n.push(m),i.push(this.tableName+"."+m))}}catch(e){f=!0,p=e}finally{try{!h&&g.return&&g.return()}finally{if(f)throw p}}return{fields:i,names:n}}}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}return null}},{key:"validCPQFieldSet",value:function(e,t){return!(t||e.label!==a&&e.fullName!==this.fieldSetPrefix+a)||!(!t||e.label!==l&&e.fullName!==this.fieldSetPrefix+l)}},{key:"getNameFieldIfOmittedFrom",value:function(e){if(-1===e.indexOf(this.tableName+"."+this.selectedLabel))return{field:this.tableName+"."+this.selectedLabel,name:this.selectedLabel}}},{key:"warnUserAboutCPQLayoutFieldSet",value:function(){this.errors=[this.i18n.l("FieldSetWarning",[this.tableLabel])]}},{key:"warnUserAboutSanitizedCPQSearchFieldSet",value:function(e){console.warn("The "+this.tableLabel+"."+this.fieldSetPrefix+l+" field set either contains fields of unsupported types or the field set size exceeds the max size ("+this.maxSearchFields+").\nActual: "+e.join(",")+"\nExpect: "+this.searchFields.join(","))}},{key:"initMobileMetadata",value:function(){var e={};e[this.selectedLabel]="lookupItemTd",this.rowClassMap=e,this.metadata={fieldNames:[this.selectedLabel],fieldLabels:[],fieldTypeObjByName:{},fieldsOfTypeLookup:[],additionalSearchFields:[]},this.$.lookup.lookupResultsCallback(this.searchValue)}},{key:"mobileSelection",value:function(e){if(this.isMobile){var t=Polymer.dom(e).localTarget;this.setSelected(t),t.hasAttribute("data-search")?(this.searchValue=t.getAttribute("data-search"),this.querySearchResults()):(this.value=t.getAttribute("data-id"),this.label=t.getAttribute("data-name"),this.saveAndDeferredClose())}}},{key:"getSearchValue",value:function(e){if(e&&!e.Id)return e.__md__.searchValue}},{key:"getNameValue",value:function(e){return e[this.selectedLabel]}},{key:"setSelected",value:function(e){this.selected=e.$.row.$$("sb-table-cell"),this.toggleClass("selectedLookupItem",!0,this.selected)}},{key:"clearSelected",value:function(){this.selected&&this.toggleClass("selectedLookupItem",!1,this.selected)}},{key:"_hideCancel",value:function(){return!this.isMobile||this.openSpinner||this.recordSpinner}},{key:"_isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_getMetadataObserver(tableName, viewport)","_processCPQLayoutFieldsObserver(fieldSets, i18n)"]}}]),d=e)),t("LookupDialog",d),Polymer(d)}}}),System.register("common/forms/sb-multi-lookup/MultiLookup.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,s,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t("MultiLookup",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-multi-lookup",this.properties={tableName:String,objectName:String,hideCancel:Boolean,iconName:String,iconMap:Object,results:Array,selectedItems:{type:Array,value:[]},selectedIdsByItems:{type:Object,value:{}},customCallBack:Function,viewport:{type:Object,value:function(){return i.getViewport()}},isMobile:Boolean}}},{key:"updateTable",value:function(e){this.results=e}},{key:"ready",value:function(){this.$.lookup.addEventListener("lookup-value-changed",function(e){var t=e.detail.obj;this.selectedIdsByItems[t.Id]?this._animateDuplicate(t):this._addItem(t)}.bind(this)),this.viewport&&this.viewport.isMobile()&&this._appendMobileClasses()}},{key:"_addItem",value:function(e){this.selectedIdsByItems[e.Id]=e,this.unshift("selectedItems",e),Polymer.dom.flush(),this.iconName&&this.iconMap&&this.toggleClass(this.iconMap[e[this.iconName]],!0,this.$$(".pill-icon"))}},{key:"_animateDuplicate",value:function(t){for(var i=this,n=Polymer.dom(this.$.selectedContainer).querySelectorAll(".pill"),e=function(e){if(n[e].dataValue==t.Id)return n[e].addEventListener("webkitAnimationEnd",function(){this.toggleClass("invalid-selection",!1,n[e])}.bind(i),!1),i.toggleClass("invalid-selection",!0,n[e]),{v:void 0}},o=0;o<n.length;o++){var r=e(o);if("object"===(void 0===r?"undefined":s(r)))return r.v}}},{key:"_appendMobileClasses",value:function(){this.isMobile=!0,this.toggleClass("mobile",!0,this.$.multilookup),this.toggleClass("mobile",!0,this.$.selectedContainer),this.toggleClass("mobile",!0,this.$.lookupContainer),this.toggleClass("mobile",!0,this.$.resultsTable)}},{key:"removeItem",value:function(e){this.splice("selectedItems",Polymer.dom(e.target).parentNode.dataIndex,1),delete this.selectedIdsByItems[Polymer.dom(e.target).parentNode.dataValue]}},{key:"selectRow",value:function(e){var t=this.results[e.currentTarget.index];this.selectedIdsByItems[t.Id]?this._animateDuplicate(t):this._addItem(t)}},{key:"clear",value:function(){this.selectedItems=[],this.selectedIdsByItems={}}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),o=e)),t("MultiLookup",o),Polymer(o)}}}),System.register("common/forms/sb-pagination/Pagination.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Pagination",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-pagination",this.properties={pageIndex:{type:Number,value:0},pageSize:Number,numItems:Number}}},{key:"next",value:function(){this.pageIndex++,this.firePageEvent("next")}},{key:"previous",value:function(){this.pageIndex--,this.firePageEvent("previous")}},{key:"_setNumberOfPagesObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setNumberOfPages(e,t)}},{key:"setNumberOfPages",value:function(){this.numPages=Math.ceil(this.numItems/this.pageSize)}},{key:"_setPageWindowObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.setPageWindow(e,t,i)}},{key:"setPageWindow",value:function(){var e=this.pageIndex*this.pageSize,t=e+this.pageSize;t>=this.numItems&&(t=this.numItems),this.pageWindow=[e,t]}},{key:"_setNextDisabledObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setNextDisabled(e,t)}},{key:"setNextDisabled",value:function(){this.nextDisabled=this.pageIndex===this.numPages-1}},{key:"setPreviousDisabled",value:function(){this.previousDisabled=0===this.pageIndex}},{key:"setPageNum",value:function(){this.pageNum=this.pageIndex+1}},{key:"firePageEvent",value:function(e){this.fire("pagination-changed",{direction:e,page:this.pageNum,index:this.pageIndex,window:this.pageWindow})}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_setNumberOfPagesObserver(pageSize, numItems)","_setPageWindowObserver(pageIndex, pageSize, numItems)","_setNextDisabledObserver(pageIndex, numPages)","setPreviousDisabled(pageIndex)","setPageNum(pageIndex)"]}}]),i=e)),t("Pagination",i),Polymer(i)}}}),System.register("common/forms/sb-rte/RichTextEditor.js",["common/core/Events.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.Events,o=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("RichTextEditor",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-rte",this.properties={value:{type:String,notify:!0}}}},{key:"attached",value:function(){this.renderReadOnly&&this.focus()}},{key:"focus",value:function(){o(i.OPEN_RTE_DIALOG,{rte:this,value:this.value})}}]),r=e)),t("RichTextEditor",r),Polymer(r)}}}),System.register("common/forms/sb-search-bar/SearchBar.js",["common/core/AppContext.js","common/data/format/DataBuilder.js","common/core/Page.js","products/localization/LocalizeFields.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.AppContext},function(e){o=e.DataBuilder},function(e){r=e.Page},function(e){s=e.LocalizeFields}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SearchBar",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-search-bar",this.properties=Polymer.Base.extend({limit:{type:Number,value:5},value:{type:String,value:"",notify:!0},searchedValue:{type:String,notify:!0},label:{type:Array,value:["DisplayName"]},hideCancelIcon:{type:Boolean,value:!1},quote:Object,searchService:String,actionId:String,searchResultCallback:Function,showResetButton:{type:Boolean,value:!1},placeholder:{type:String,computed:"getPlaceholder(i18n)"},i18n:{type:Object,value:function(){return i.properties.i18n.value()}},searcher:Object},r.properties)}},{key:"ready",value:function(){this.$.typeahead.addEventListener("enter-without-selection",this.search.bind(this)),this.$.typeahead.addEventListener("selected-item-changed",this.handleItemSelected.bind(this)),this.$.typeahead.showAllResults=!0,this.$.typeahead.itemsCallback=this.typeAheadCallback.bind(this),this.localizer=new s(this.fieldPrefix)}},{key:"valueChanged",value:function(){void 0===this.value||""===this.value?(this.fire("sb-type-clear"),this.toggleClass("disabled",!1,this.$.search)):this.toggleClass("disabled",!1===this.isSearchValid(),this.$.search)}},{key:"_realignObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.realign(e,t)}},{key:"realign",value:function(){this.isMobile&&this.toggleClass("shiftRight",!0,this.$.buttons)}},{key:"handleItemSelected",value:function(e){this.value=e.detail.value.Name,void 0!==this.value&&this.fire("sb-search-item-selected",{item:this.getSearchResultRow(e.detail.value.Id),searchValue:this.value})}},{key:"toggleResetButton",value:function(e){!0===this.showResetButton&&this.toggleClass("disabled",!1===e,this.$$("#reset"))}},{key:"reset",value:function(){this.fire("sb-search-reset-clicked")}},{key:"search",value:function(){!1!==this.isSearchValid()?(this.spinner=!0,this.blur(),this.searchedValue=this.value,this.serviceCallout(null).then(function(e){this.fire("sb-search-invoked",{searchModel:e,searchValue:this.value}),this.spinner=!1}.bind(this))):""!==this.value&&void 0!==this.value||this.fire("sb-search-nil-search-invoked")}},{key:"getSearchResultRow",value:function(e){var t=Object.assign({},this.mostRecentResults),i=!0,n=!1,o=void 0;try{for(var r,s=t.results[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;if(a.record.Product2Id===e)return a}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}},{key:"typeAheadCallback",value:function(){return new Promise(function(t){void 0!==this.searchService&&void 0!==this.quote&&!1!==this.isSearchValid()&&this.serviceCallout(this.limit).then(function(e){if(this.mostRecentResults=e,"function"==typeof this.searchResultCallback)return this.searchResultCallback(this.parseResults(e));t(this.parseResults(e))}.bind(this))}.bind(this))}},{key:"getFilterContextFromSearcher",value:function(){return this.searcher?this.searcher.getFilterContext():{}}},{key:"buildContext",value:function(e){return(new o).addObject("filterContext",this.getFilterContextFromSearcher(),void 0,void 0,!0).add("searchContext",this.getSearchContext()).add("resultLimit",e).add("pageNumber",null).add("actionId",this.actionId).addObject("quote",this.quote.record).build()}},{key:"serviceCallout",value:function(e){return new Promise(function(t){this.$.service.client.load(this.prefix,this.searchService,null,this.buildContext(e)).then(function(e){t(this.localizer.localizeSearchModel(e))}.bind(this))}.bind(this))}},{key:"parseResults",value:function(e){var t=[],i=this.getSearchContext();if(null===i)return t;var n=!0,o=!1,r=void 0;try{for(var s,a=e.results[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value.record.Product2,u=new RegExp(i,"i"),d=l.Name.match(u);if(d){var c=l.Name.substring(0,d.index),h=l.Name.substring(d.index,d.index+i.length),f=l.Name.substring(d.index+i.length);l.DisplayName=c+"<b>"+h+"</b>"+f}else l.DisplayName=l.Name;t.push(l)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return t}},{key:"getSearchContext",value:function(){return!0===this.isSearchValid()?this.value:null}},{key:"isSearchValid",value:function(){return void 0!==this.value&&1<this.value.replace(/ /g,"").replace(/\*/g,"").replace(/\?/g,"").replace(/\(/g,"").replace(/\)/g,"").length}},{key:"getPlaceholder",value:function(){return this.i18n&&"function"==typeof this.i18n.l?this.i18n.l("Search Products"):"Search Products"}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["valueChanged(value)","_realignObserver(reposition, isMobile)"]}},{key:"prefix",get:function(){return this.app.org.prefix}},{key:"fieldPrefix",get:function(){return void 0===this.app.org.prefix?"":this.app.org.prefix+"__"}}]),a=e)),t("SearchBar",a),Polymer(a)}}}),System.register("common/forms/sb-search-bar-dialog/SearchBarDialog.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SearchBarDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-search-bar-dialog",this.properties={value:String,cols:{type:Array,value:["DisplayName"]},colsDisplay:{type:Array,value:["DisplayName"]},results:Array}}},{key:"ready",value:function(){this.attachSearchProperties(),this.attachSearchEvents()}},{key:"attachSearchProperties",value:function(){this.$.search.searchResultCallback=this.handleSearchResults.bind(this)}},{key:"attachSearchEvents",value:function(){this.$.search.addEventListener("sb-search-invoked",this.toggle.bind(this)),this.$.search.addEventListener("sb-search-nil-search-invoked",this.updateSearchResults.bind(this))}},{key:"open",value:function(){this.$.search.value=this.value,""===this.value&&(this.results=[]),this.toggle(),this.$.search.$.typeahead.focus()}},{key:"close",value:function(){this.blur(),this.toggle()}},{key:"toggle",value:function(){this.$.dialog.toggle()}},{key:"handleSearchResults",value:function(e){this.results=e}},{key:"updateSearchResults",value:function(){var e=[],t=!0,i=!1,n=void 0;try{for(var o,r=this.results[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;s.Name===this.$.search.value&&e.push(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.results=e}},{key:"mobileSelection",value:function(e){var t=Polymer.dom(e).localTarget,i=t.getAttribute("data-name");this.$.search.value=i;var n=t.getAttribute("data-id");this.fire("sb-search-item-selected",{item:this.$.search.getSearchResultRow(n),searchValue:i}),setTimeout(function(){this.toggle()}.bind(this),350),this.updateSearchResults()}},{key:"clearSearchResults",value:function(){this.results=[]}}]),i=e)),t("SearchBarDialog",i),Polymer(i)}}}),System.register("common/forms/sb-select/Select.js",["common/core/AppContext.js"],function(t,e){var b,i;return{setters:[function(e){b=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Select",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-select",this.properties={value:{type:String,value:""},options:Array,isRequired:{type:Boolean,value:!1},noneLabel:{type:String,value:""},focusOnAttached:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},multiSelect:{type:Boolean,observer:"_multiSelectChanged"},size:Number,_multiple:{type:Boolean,computed:"_setMultiple(multiSelect)"},_options:Array}}},{key:"_multiSelectChanged",value:function(e,t){void 0===t&&e&&this.buildOptions()}},{key:"_buildOptionsObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.buildOptions(e,t)}},{key:"buildOptions",value:function(){if(this.options){for(var e=!0,t=[],i=this._getValues(),n=0,o=this.options.length;n<o;n++){var r=this.options[n],s=-1!==i.indexOf(r.value.toString());e=e&&!s,t.push({value:r.value,label:r.label,selected:s})}if(e&&0<i.length){var a=!0,l=!1,u=void 0;try{for(var d,c=i[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value;t.push({value:h,label:h,selected:!0})}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}e=!1}if((!e||this.multiSelect)&&this.isRequired||(t=[{value:"",label:this.noneLabel,selected:e}].concat(t)),b.isIE()){for(var f=Polymer.dom(this.querySelector(".myselect")),p=f.childNodes,v=0,g=p.length;v<g;v++)f.removeChild(p[v]);for(var y=0,m=t.length;y<m;y++)this._createOptionElements(this.querySelector(".myselect"),t[y])}else this._options=t}}},{key:"_createOptionElements",value:function(e,t){var i=document.createElement("option");i.label=t.label,i.value=t.value,i.selected=t.selected,e.appendChild(i)}},{key:"_setSelectedObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setSelected(e,t)}},{key:"setSelected",value:function(){if(!this.internal)for(var e=this._getValues(),t=0,i=this._options.length;t<i;t++)this._options[t].selected=-1!==e.indexOf(this._options[t].value.toString()),this.querySelector(".myselect").options[t]&&(this.querySelector(".myselect").options[t].selected=-1!==e.indexOf(this.querySelector(".myselect").options[t].value.toString()))}},{key:"change",value:function(){for(var e=this.querySelector(".myselect").options,t=null,i=0,n=e.length;i<n;i++)b.isIE()||(this._options[i].selected=e[i].selected),e[i].selected&&(this.multiSelect&&null!=t?t+=";"+e[i].value:t=e[i].value);this.internal=!0,this.value=t,this.internal=!1,this.fire("change",{value:this.value})}},{key:"attached",value:function(){this.focusOnAttached&&this.focus()}},{key:"focus",value:function(){this.querySelector(".myselect").focus()}},{key:"blur",value:function(){this.fire("blur")}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"_setMultiple",value:function(){return!!this.multiSelect||void 0}},{key:"_getValues",value:function(){return e.getValues(this.value,this.multiSelect)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_buildOptionsObserver(options, isRequired)","_setSelectedObserver(value, _options)"]}}],[{key:"getValues",value:function(e,t){return null!=e&&""!==e?t?e.split(";"):[e.toString()]:[]}}]),i=e)),t("Select",i),Polymer(i)}}}),System.register("common/forms/sb-textarea/Textarea.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Textarea",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-textarea",this.properties={value:{type:String,observer:"changed"},focusOnAttached:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},viewport:{type:Object,value:function(){return i.getViewport()}}}}},{key:"attached",value:function(){this.focusOnAttached&&this.focus()}},{key:"focus",value:function(){this.$.textarea.focus()}},{key:"blur",value:function(){this.fireChangeOnBlur(),this.fire("blur")}},{key:"highlight",value:function(){if(!this.viewport||!this.viewport.isMobile()){var e=this.value?this.value.length:0;this.$.textarea.setSelectionRange(0,e)}}},{key:"changed",value:function(e,t){void 0!==t?(this.changeOnNextBlur=!1,t!=e&&this.fireChangeEvent(e)):this.changeOnNextBlur=!0}},{key:"fireChangeEvent",value:function(e){this.fire("change",{value:e})}},{key:"fireChangeOnBlur",value:function(){this.changeOnNextBlur&&(this.fireChangeEvent(this.value),this.changeOnNextBlur=!1)}},{key:"propagateEsc",value:function(e){27===e.keyCode&&(this.renderReadOnly&&(this.$.textarea.value=this.value),this.fire("sb-textarea-key",{keyCode:27}))}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),o=e)),t("Textarea",o),Polymer(o)}}}),System.register("common/forms/sb-typeahead/Typeahead.js",["common/core/sb-page-container/PageContainer.js","common/layout/sb-html/Html.js"],function(t,e){var i,l,o,y,r;return{setters:[function(e){i=e.PageContainer},function(e){l=e.Html}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},y=new RegExp("[*_%]+","g"),10,t("Typeahead",(o(e,[{key:"beforeRegister",value:function(){this.is="sb-typeahead",this.properties={items:{type:Array,value:[]},itemsCallback:{type:Object},debounceDelay:{type:Number,value:300},selectedItem:{type:Object,notify:!0},itemsList:{type:Array,observer:"itemsListChanged",notify:!0},labels:{type:Array,value:function(){return this.getAttribute("labels")||["label"]}},labelValue:{type:String,notify:!0},value:{type:String},delimiter:{type:String,value:function(){return this.getAttribute("delimiter")||""}},savedLabelValue:{type:String},invalidLabel:{type:Boolean,value:!1},hasList:{type:Boolean,value:!1,observer:"_calculateListPosition"},hasLabel:{type:Boolean,value:!1},hasFilter:Boolean,optionIndex:{type:Number,value:-1},focusOnAttached:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},hideCancelIcon:{type:Boolean,value:!1},clearAfterSelection:{type:Boolean,value:!1},blurDisabled:{type:Boolean,value:!1},focusDisabled:{type:Boolean,value:!1},revertOnEscape:{type:Boolean,value:!1},showSearchIcon:{type:Boolean,value:!1},calculateListPosition:{type:Boolean,value:!1},showListNoSuggestion:{type:Boolean,value:!1},showListOnFocus:{type:Boolean,value:!1},hideInput:{type:Boolean,value:!1},showLeftSearchIcon:{type:Boolean},disjointLabel:Boolean,showAllResults:{type:Boolean,value:!1}},this.observers=["_itemsChangedObserver(items, labels)","_selectedItemChangedObserver(selectedItem, value)","_setStylesObserver(showLeftSearchIcon, hideCancelIcon)"]}},{key:"ready",value:function(){this.$.itemLabel.addEventListener("focus",this._directInputFocus.bind(this)),this.$.itemLabel.addEventListener("blur",this._directInputBlur.bind(this))}},{key:"attached",value:function(){this.isAttached=!0,this.focusOnAttached&&this.focus()}},{key:"_setStylesObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setStyles(e,t)}},{key:"setStyles",value:function(){this.showLeftSearchIcon&&this.toggleClass("leftSearch",!0,this.$.itemLabel),this.hideCancelIcon||this.toggleClass("cancelIcon",!0,this.$.itemLabel)}},{key:"_itemsChangedObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.itemsChanged(e,t)}},{key:"itemsChanged",value:function(){this.items.length&&(this.itemsList=this.updateItemsList())}},{key:"_selectedItemChangedObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.selectedItemChanged(e,t)}},{key:"selectedItemChanged",value:function(){if(this.selectedItem){var e=this.selectedItem.__md__,t=!!e&&e.clearAfterSelection;this.labelValue=this.getSelectedItemValue(),(this.clearAfterSelection||t)&&(this.selectedItem="",this.items=this.itemsList=[]),this.originalSelected||(this.originalSelected=JSON.parse(JSON.stringify(this.selectedItem)))}}},{key:"itemsListChanged",value:function(){Polymer.dom.flush();var e=Polymer.dom(this.$.selector).querySelectorAll(".option");if(e){var t=e.length,i=this.labels.length;if(0<t){this.optionIndex=-1;for(var n=0;n<t;n++){for(var o=this.itemsList[n],r="",s=0;s<i;s++){var a=this.labels[s];r+=(0===s?"":this.delimiter)+o[a]}e[n].innerHTML=l.sanitizeHtmlText(r),Polymer.dom(e[n]).setAttribute("data-label",r)}}}}},{key:"getSelectedItemValue",value:function(){var e=this.value?this.value:"value";return this.selectedItem?this.selectedItem[e]:""}},{key:"clear",value:function(){this.hide(),this.updateItem({},!0),this.fire("sb-type-clear")}},{key:"hide",value:function(){this.hideList(),this.invalidLabel=!1,this.optionIndex=-1}},{key:"cloneItem",value:function(e){for(var t={},i=Object.keys(e),n=i.length,o=0;o<n;o++){var r=i[o];t[r]=e[r]}return t}},{key:"updateItem",value:function(e,t){for(var i=Object.keys(e),n=i.length,o={},r=0;r<n;r++){var s=i[r];o[s]=void 0!==e[s]?e[s]:""}this.selectedItem=o;for(var a="",l=this.labels.length,u=0;u<l;u++){var d=0===u?"":this.delimiter,c=this.selectedItem[this.labels[u]];c&&(a+=d+c)}var h=this.selectedItem.__md__;this.disjointLabel||(this.labelValue=h&&!h.clearAfterSelection&&void 0!==h.searchValue?h.searchValue:a),this.clearSelection(),this.focusOrBlurAfterSelection(this.selectedItem,t)}},{key:"submitItem",value:function(e){var t=e.model.item;this.updateItem(t),this.hide(),this.focusOrBlurAfterSelection(t)}},{key:"focusOrBlurAfterSelection",value:function(e,t){e&&e.__md__&&e.__md__.noFocusAfterSelection?this.$.itemLabel.blur():this.focus(t)}},{key:"selectAdjacentItem",value:function(e){if(this.itemsList){var t=this.itemsList.length;0<=this.optionIndex&&this.optionIndex<t?(this.$.selector.children[this.optionIndex].removeAttribute("selected"),38===e?this.optionIndex=0===this.optionIndex?t-1:this.optionIndex-1:40===e&&(this.optionIndex=this.optionIndex===t-1?0:this.optionIndex+1)):-1===this.optionIndex&&(38===e?this.optionIndex=t-1:40===e&&(this.optionIndex=0)),this.$.selector.children[this.optionIndex].setAttribute("selected","")}}},{key:"updateItemsList",value:function(){if(this.searchLabels||(this.searchLabels=this.labels),!0===this.showAllResults)return this.items;var e=[],t=!1;if(this.showListNoSuggestion||this.labelValue)for(var i=(this.labelValue||"").replace(/\+/g,"\\+").replace(/\\/g,"\\\\").replace(y,".+"),n=new RegExp(i,"i"),o=this.items.length,r=this.searchLabels.length,s=0;s<o;s++){for(var a=this.items[s],l=this.cloneItem(a),u=0;u<r;u++){var d=a[this.searchLabels[u]];d&&(this.showListNoSuggestion||n.test(d))&&(l["_"+this.searchLabels[u]]=d.replace(n,'<span style="font-weight:bold;">$&</span>'),t=!0)}if(t){var c=!0,h=!0,f=!1,p=void 0;try{for(var v,g=this.labels[Symbol.iterator]();!(h=(v=g.next()).done);h=!0)l[v.value]||(c=!1)}catch(e){f=!0,p=e}finally{try{!h&&g.return&&g.return()}finally{if(f)throw p}}c&&e.push(l),t=!1}if(10<=e.length)break}return e}},{key:"suggest",value:function(e){if(this.isAttached)switch(e.keyCode){case 13:if(this.$.itemLabel.blur(),this.hasList){if(-1===this.optionIndex){this.fire("enter-without-selection",{value:this.labelValue}),this.hideList(),this.optionIndex=0;break}this.updateItem(this.itemsList[this.optionIndex]),this.noBlur=!1}else this.fire("enter-without-selection",{value:this.labelValue});this.hide();break;case 27:this.revertOnEscape&&(this.updateItem(this.originalSelected),this.items=void 0,this.hideList(),this.clearSelection(),this.fire("sb-type-blur"));break;case 38:case 40:this.selectAdjacentItem(e.keyCode);break;case 9:case 16:break;default:this.invalidLabel=!1,this.itemsCallback?this.debounce("itemsCallback",function(){this.itemsCallback(this.labelValue).then(function(e){e&&0<e.length?this.showList():this.hideList(),this.items=e}.bind(this),function(e){console.error(e&&e.message?e.message:e),this.items=[]}.bind(this))},this.debounceDelay):(this.showList(),this.itemsList=this.updateItemsList(),0===this.itemsList.length&&(this.labelValue?this.invalidLabel=!0:this.hasLabel=!1,this.hasList=!1))}}},{key:"showList",value:function(){this.blurred?this.hideList():(this.showListNoSuggestion||null!=this.labelValue&&""!==this.labelValue)&&(this.hasList=!0,this.hasLabel=!0)}},{key:"hideList",value:function(){this.hasList=!1,this.hasLabel=!1}},{key:"clearSelection",value:function(){var e=Polymer.dom(this.$.selector).querySelectorAll(".option"),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.toggleAttribute("selected",!1,s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"tabBlur",value:function(e){9===e.keyCode&&(this.hasList=!1),38===e.keyCode&&e.preventDefault(),13===e.keyCode&&this.hasList&&this.preventBlur(),27!==e.keyCode||this.revertOnEscape||setTimeout(function(e){this.labelValue=e}.bind(this,this.labelValue),0)}},{key:"focus",value:function(e){this.focusDisabled||(this.focusing=!0,this.$.itemLabel.focus(),this._showListOnFocus(e),this.focusing=!1)}},{key:"blur",value:function(e,t){!t&&(this.hasList||this.blurDisabled)||(this.hideList(),this.fire("sb-type-blur"),this.setOriginalSelected())}},{key:"setOriginalSelected",value:function(){this.originalSelected=JSON.parse(JSON.stringify(this.selectedItem||{}))}},{key:"preventBlur",value:function(){this.noBlur=!0}},{key:"allowBlur",value:function(){this.noBlur=!1}},{key:"focused",value:function(){this.fire("sb-type-focus",{value:this.labelValue})}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"_calculateListPosition",value:function(){if(this.calculateListPosition&&this.hasList){var e=i.getContainer().getBoundingClientRect().left,t=this.$.itemLabel.getBoundingClientRect().left;this.$.selector.style.left=t-e+"px"}}},{key:"_showListOnFocus",value:function(e){!this.showListOnFocus||this.hideInput||this.hasList||(e||!this.items||0===this.items.length||this.hasFilter?this.suggest({}):this.showList())}},{key:"_directInputFocus",value:function(){this.blurred=!1,this.focusing||this._showListOnFocus()}},{key:"_directInputBlur",value:function(){this.blurred=!0,this.blur(null,!this.noBlur)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),r=e)),t("Typeahead",r),Polymer(r)}}}),System.register("common/layout/data/RecordGrouper.js",[],function(e,t){var h,i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i,n,o,r,s,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.groupField=e,t&&(this.groupedRecordFields=t.constructor!==Array?[t]:t),this.recordPath=i,this.itemProperties=n,this.itemPropertiesByGroup=o,this.groupProperties=r,this.groupCountPath=s,this.groupFieldType=a,this.groupFieldTypePath=l}h="Other",e("RecordGrouper",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(u,[{key:"group",value:function(e){for(var t=[],i={},n=0,o=e.length;n<o;n++){var r=e[n],s=this._get(r,this.recordPath)[this.groupField],a=null==s||""===s;s=a?h:s+"";var l=i[s];l||a||t.push(s),l=l||[],r.groupie=s,r.grouper=null,l.push(r),i[s]=l,this._setProperties(r,this.itemProperties),this._setProperties(r,this.itemPropertiesByGroup,s)}return i[h]&&t.push(h),this._sortItemsByGroup(t,i)}},{key:"_sortItemsByGroup",value:function(e,t){for(var i=[],n=0,o=e.length;n<o;n++){var r=e[n],s=t[r],a=s.length;if(this.groupedRecordFields){for(var l={grouper:r,groupie:null},u=this._get(l,this.recordPath),d=0,c=this.groupedRecordFields.length;d<c;d++)u[this.groupedRecordFields[d]]=r;this.groupCountPath&&(this._get(l,this.groupCountPath.path)[this.groupCountPath.property]="("+a+")"),this.groupFieldType&&this.groupFieldTypePath&&(this._get(l,this.groupFieldTypePath.path)[this.groupFieldTypePath.property]=r!==h?this.groupFieldType:"string"),this._setProperties(l,this.groupProperties),i.push(l)}i=i.concat(s)}return i}},{key:"_get",value:function(e,t){if(!t)return e;for(var i=t.split("."),n=0,o=i.length;n<o;n++)e[i[n]]||(e[i[n]]={}),e=e[i[n]];return e}},{key:"_setProperties",value:function(e,t,i){if(t){if(i){if(!t[i])return;t=t[i]}for(var n in t)e[n]=t[n]}}}]),i=u)),e("RecordGrouper",i)}}}),System.register("common/layout/fields/FieldHider.js",[],function(e,t){var o,r;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.toggle=t,"boolean"==typeof e?this.hide={hidden:e,type:"hide"}:"object"===(void 0===e?"undefined":o(e))?this.hide={hidden:!!e.hidden,type:e.type||"hide"}:this.hide={hidden:!1,type:"hide"}}o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e("FieldHider",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"applyTo",value:function(e){var t=[this.hide];"hide"===this.type?t.push({hidden:!1,type:"invisible"}):t.push({hidden:!1,type:"hide"});var i=!0,n=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;this.toggle.toggleClass(a.type,a.hidden,e)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}},{key:"hidden",get:function(){return this.hide.hidden}},{key:"type",get:function(){return this.hide.type}}]),r=i)),e("FieldHider",r)}}}),System.register("common/layout/fields/FieldSetHandler.js",["common/core/AppContext.js"],function(e,t){var i;return{setters:[function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.fieldSets=e,this.desktopFields={name:t},i&&(this.tabletFields={name:i}),n&&(this.phoneFields={name:n})}e("FieldSetHandler",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"getByViewport",value:function(e){return e&&e.isPhone()?this._getPhoneFieldSet():e&&e.isTablet()?this._getTabletFieldSet():this._getDesktopFieldSet()}},{key:"_getPhoneFieldSet",value:function(){var e=this.phoneFields?this.fieldSets[this.phoneFields.name]:null;return e&&0!==e.length?(this.phoneFields.fields=e,this.phoneFields):this._getTabletFieldSet()}},{key:"_getTabletFieldSet",value:function(){var e=this.tabletFields?this.fieldSets[this.tabletFields.name]:null;return e&&0!==e.length?(this.tabletFields.fields=e,this.tabletFields):this._getDesktopFieldSet()}},{key:"_getDesktopFieldSet",value:function(){return this.desktopFields.fields=this.fieldSets[this.desktopFields.name],this.desktopFields}}]),i=o)),e("FieldSetHandler",i)}}}),System.register("common/layout/sb-actions/Actions.js",["common/core/AppContext.js","common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.AppContext},function(e){o=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Actions",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-actions",this.properties={rowActions:Array,position:{type:String,value:"left"},data:{type:Object,notify:!0},viewport:{type:Object,value:function(){return o.getViewport()}},i18n:{type:Object,value:function(){return i.properties.i18n.value()}}}}},{key:"ready",value:function(){this.isMobile=this._isMobileViewport()}},{key:"shouldDisable",value:function(e){if(this.data&&this.rowActions&&this.rowActions[e])return"Delete"==this.rowActions[e].title&&(this.data.required&&!this.data.addedManually||!!this.data.disabledData&&this.data.disabledData.disabled)}},{key:"_isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"tapEvent",value:function(e){this.rowActions[e.currentTarget.dataIndex].onTapFunction&&!this.shouldDisable(e.currentTarget.dataIndex)&&this.rowActions[e.currentTarget.dataIndex].onTapFunction.bind(this)()}},{key:"_isVisible",value:function(e){return e?"visibilityHidden":""}},{key:"displayTitle",value:function(e,t){return this.shouldDisable(t)?"Disabled":this.i18n.l(e.title)}},{key:"_isDisabled",value:function(e){return this.shouldDisable(e)?"disabled":""}},{key:"disableActions",value:function(){if(this.$$(".sb-action-icon")&&this.rowActions)for(var e=0;e<this.rowActions.length;e++)this.toggleClass("disabled",this.shouldDisable(e),this.$$("#_"+e))}},{key:"_configurationRequired",value:function(e){if(!this.isMobile||this.data.configured)return"";for(var t=0;t<this.rowActions.length;t++)if("Configure"===e&&this.rowActions[t].configurationRequired)return"configurationRequired"}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["disableActions(data.disabledData.disabled)"]}}]),r=e)),t("Actions",r),Polymer(r)}}}),System.register("common/layout/sb-dialog/Dialog.js",["common/core/sb-page-container/PageContainer.js","common/core/AppContext.js","common/core/Events.js"],function(t,e){var i,s,o,r,a,l;return{setters:[function(e){i=e.PageContainer},function(e){s=e.AppContext,a=e.localizeContent},function(e){o=e.Events,r=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Dialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-dialog",this.properties={show:{type:Boolean,value:!1},modal:{type:Boolean,value:!1},hideHeader:{type:Boolean,observer:"_hideHeader"},appendedClass:{type:String},cancelText:{Type:String,value:"Cancel"},closeDialog:{type:String,value:"sb-close-dialog"},hideCloseIcon:{type:Boolean,value:!1},hideCancelButton:{type:Boolean,value:!1},mobile:{type:Boolean,value:function(){if(i.getViewport())return!!i.getViewport().isMobile()}},mobileDropDown:{type:Boolean,value:!1},tapDialog:String,ignoreMaskTap:{type:Boolean,value:!1},largeViewEnabled:Boolean}}},{key:"ready",value:function(){this.appendedClass&&this.$$(".sbDialog").classList.add(this.appendedClass),this.mobile&&(this._appendMobileClasses(),Polymer.dom(this).observeNodes(function(){var e=Polymer.dom(this).querySelectorAll("paper-button"),t=this.$$("#title");if(0===e.length){var i=this.$$("#title");this.toggleClass("no-buttons",!0,i)}else{this.mobileDropDown=1<e.length;var n=this.$$("#mobileButtons"),o=this.$$("#drop-down-button");this.toggleClass("no-buttons",!1,t),this.toggleClass("drop-down-menu",this.mobileDropDown,n),this.toggleClass("single-button",!this.mobileDropDown,n),this.toggleClass("hidden",!this.mobileDropDown,o)}}.bind(this))),this.toggleClass("is-ie",s.isIE(),this.$.footer)}},{key:"_appendMobileClasses",value:function(){this.toggleClass("mobile",!0,this.$$(".sbDialog"));for(var e=Polymer.dom(this).children,t=e.length,i=0;i<t;i++)this.toggleClass("mobile",!0,e[i])}},{key:"toggle",value:function(){this.show=!this.show}},{key:"open",value:function(){this.show=!0}},{key:"close",value:function(){this.show=!1}},{key:"toggleMenu",value:function(){var e=this.$$(".drop-down-menu");e&&e.classList.contains("open")?this.toggleClass("open",!1,e):this.toggleClass("open",!0,e)}},{key:"onCloseDialog",value:function(){r(o.PANEL_CLOSED),this.fire(this.closeDialog)}},{key:"maskTapped",value:function(){this.ignoreMaskTap||this.onCloseDialog()}},{key:"tapEvent",value:function(){this.tapDialog&&this.fire(this.tapDialog)}},{key:"getCancelText",value:function(e){return a(e)}},{key:"_datePickerOpened",value:function(e){var t=e.detail.dateContainer,i=e.detail.datepicker,n=this.$.content;i.style.position="fixed";var o=t.getBoundingClientRect(),r=n.getBoundingClientRect();s.isIE()?(i.style.left=o.left+"px",i.style.top=o.top+o.height+"px"):(i.style.left=o.left-r.left+"px",i.style.top=o.top+o.height-this.$.header.getBoundingClientRect().top+1+"px")}},{key:"_hideHeader",value:function(){this.$.header.setAttribute("hidden","true")}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"datepicker-opened":"_datePickerOpened"}}}]),l=e)),t("Dialog",l),Polymer(l)}}}),System.register("common/layout/sb-div/Div.js",["../../core/AppContext.js"],function(t,e){var i;return{setters:[function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Div",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-div",this.properties={value:String,label:{type:String,computed:"_setLabel(value)"}}}},{key:"_setLabel",value:function(){return this.value}}]),i=e)),t("Div",i),Polymer(i)}}}),System.register("common/layout/sb-field-item/FieldItem.js",["common/relationship/RelationshipFieldManager.js"],function(t,e){var i,o;return{setters:[function(e){i=e.RelationshipFieldManager}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FieldItem",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-field-item",this.properties={value:{notify:!0},item:String,model:Object,md:Object,data:Object}}},{key:"_setFieldDataObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._setFieldData(e,t)}},{key:"_setFieldData",value:function(){this.md=this.model[this.item],this.label=this.md.label,this.helpText=this.md.inlineHelpText,this.$.field.editing=this.md.updateable,this.$.field.md=this.md,this.$.field.property=this.item;var e={};e[this.item]=this.value,this.$.field.obj=e}},{key:"_dataChangedObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._dataChanged(e,t)}},{key:"_dataChanged",value:function(){var e=new i(this.item,this.data);e.hasRelationship()&&(this.display=e.getRelationshipName())}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_setFieldDataObserver(item, model)","_dataChangedObserver(data, item)"]}}]),o=e)),t("FieldItem",o),Polymer(o)}}}),System.register("common/layout/sb-field-table/FieldTable.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FieldTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-field-table",this.properties={numColumns:{type:Number,value:1},data:{type:Object,notify:!0},fieldNames:String,md:Object,disabled:Boolean}}},{key:"_generateColumnsObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.generateColumns(e,t)}},{key:"generateColumns",value:function(){for(var e=[],t=[],i=[],n=this.fieldNames.length,o=0;o<n;o++)o%this.numColumns==0?e.push(this.fieldNames[o]):o%this.numColumns==1?t.push(this.fieldNames[o]):i.push(this.fieldNames[o]);1==this.numColumns?this.columnOneWidth="td1":2==this.numColumns?(this.columnOneWidth="td2",this.columnTwoWidth="td2"):(this.columnOneWidth="td3",this.columnTwoWidth="td3",this.columnThreeWidth="td3"),this.setColumns(e,t,i)}},{key:"setColumns",value:function(e,t,i){0<e.length&&(this.$.firstColumn.model=this.md,this.$.firstColumn.group=e),0<t.length&&(this.$.secondColumn.model=this.md,this.$.secondColumn.group=t),0<i.length&&(this.$.thirdColumn.model=this.md,this.$.thirdColumn.group=i)}},{key:"observers",get:function(){return["_generateColumnsObserver(md, fieldNames)"]}}]),i=e)),t("FieldTable",i),Polymer(i)}}}),System.register("common/layout/sb-filter-item/FilterItem.js",["common/relationship/RelationshipFieldManager.js","common/core/AppContext.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.RelationshipFieldManager},function(e){o=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FilterItem",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-filter-item",this.properties={value:{notify:!0},item:String,model:Object,md:Object,hidden:{type:Boolean,value:!1},label:{type:String,reflectToAttribute:!0},display:String,factoryData:Object}}},{key:"ready",value:function(){this.handleKeyPress(),this.addEventListener("lookup-value-changed",this.handleLabelChange)}},{key:"handleLabelChange",value:function(e){var t={item:this.item.split(".")[0],value:e.detail.refDisplay};this.fire("filter-item-value-changed",t)}},{key:"handleKeyPress",value:function(){this.addEventListener("keypress",function(e){var t=this.item.split(".")[0];this.fire("filter-item-field-keypress",{keyCode:e.keyCode,item:t,itemType:this.model[t].model.type})}.bind(this))}},{key:"clear",value:function(){this.value=null}},{key:"_setMdObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setMd(e,t)}},{key:"setMd",value:function(){var e=o.org.prefix?o.org.prefix+"__":"",t=this.item.split(".")[0];this.md=this.model[t].model,this.factoryData={range:"between"===this.model[t].record[e+"Operator__c"]},this.label=this.model[t].label?this.model[t].label:this.model[t].record.Name,this.md.type&&"boolean"===this.md.type&&"string"==typeof this.value&&this.setValue(this.item,"true"===this.value),this.$.field.editing=!0,this.$.field.property=this.item,this.$.field.md=this.md}},{key:"setHidden",value:function(){var e=this.item;this.data[e]||(e=this.item.split(".")[0]),this.data[e]&&(this.hidden=this.data[e].hidden)}},{key:"_dataChangedObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.dataChanged(e,t)}},{key:"dataChanged",value:function(){var e=this.item.split(".")[0];this.display=this.data[e].label,this.$.field.record=this}},{key:"_displayChangedObserver",value:function(e,t,i,n,o){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o)return this._displayChanged(e,t,i,n,o)}},{key:"_displayChanged",value:function(){var e=this.item.split(".")[0],t=new i(e,this.data).buildRelationship(this.value,this.display,this.md.referenceTo[0]);t&&(this.data[e].label=t.value.Name)}},{key:"getValue",value:function(e){if(this.data[e])return this.data[e].value;for(var t in this.data)if(this.data[t].field===e)return this.data[t].value;return null}},{key:"setValue",value:function(e,t){this.set("data."+e,t)}},{key:"equals",value:function(e){return this.data===e.data}},{key:"observers",get:function(){return["_setMdObserver(item, model)","setHidden(data.*)","_dataChangedObserver(data, item)","_displayChangedObserver(value, display, item, data, md)"]}}]),r=e)),t("FilterItem",r),Polymer(r)}}}),System.register("common/layout/sb-filter-layout/FilterLayout.js",["common/core/Page.js","common/data/format/DataBuilder.js","common/core/sb-page-container/PageContainer.js","common/data/format/ErrorFormatter.js"],function(_export,_context){var Page,DataBuilder,PageContainer,formatError,_createClass,FilterLayout;function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}return{setters:[function(e){Page=e.Page},function(e){DataBuilder=e.DataBuilder},function(e){PageContainer=e.PageContainer},function(e){formatError=e.formatError}],execute:function(){function OSb(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}_createClass=function(e,t,i){return t&&OSb(e.prototype,t),i&&OSb(e,i),e},_export("FilterLayout",FilterLayout=function(_Page){function FilterLayout(){return _classCallCheck(this,FilterLayout),_possibleConstructorReturn(this,(FilterLayout.__proto__||Object.getPrototypeOf(FilterLayout)).apply(this,arguments))}return _inherits(FilterLayout,_Page),_createClass(FilterLayout,[{key:"beforeRegister",value:function(){this.is="sb-filter-layout",this.properties=Polymer.Base.extend({searchModel:{type:Object,notify:!0},error:{type:Array,notify:!0},filterPath:{type:String,value:"searchFilters"},filterKey:String,filterDelegator:Object,searchFilterData:{type:Object,notify:!0},searchFilterModel:{type:Object,notify:!0},groupItems:{type:Array,notify:!0},serviceLoader:String,quote:Object,enterCallback:Object,translationCallback:Object,serviceCallback:Object,spinner:{type:Boolean,notify:!0},sendQuoteRecord:{type:Boolean,value:!1},resultLimit:{type:Number,value:2e3},viewport:{type:Object,value:function(){return PageContainer.getViewport()}},searchContext:String},Page.properties)}},{key:"ready",value:function(){this.mdResponse(),this.handleEnterKeyPressed()}},{key:"handleEnterKeyPressed",value:function(){this.addEventListener("filter-item-field-keypress",function(e){13===e.detail.keyCode&&"function"==typeof this.enterCallback&&"reference"!==e.detail.itemType&&setTimeout(function(){this.enterCallback()}.bind(this),0)}.bind(this))}},{key:"_searchModelReadyObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.searchModelReady(e,t)}},{key:"searchModelReady",value:function searchModelReady(){if(!0!==this.searchModelInitialized){this.searchModelInitialized=!0,void 0===this.filterKey&&(this.filterKey=this.searchModel.hasCustomSearchFilters?"Id":"Name");var properties=this.filterPath.split(".");this.path="this.searchModel";var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=properties[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var property=_step.value;this.path+="."+property}}catch(e){_didIteratorError=!0,_iteratorError=e}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var searchFilters=eval(this.path);if(!1!==Array.isArray(searchFilters)){this.searchFilterModel=FilterLayout.setVisibleDynamicSearchFilters(searchFilters,this.filterDelegator);var allFields=FilterLayout.setSearchFilterFields(this.searchFilterModel,this.getSearchTable());this.fields=this.filterDelegator.buildFields(allFields)}}}},{key:"mdResponse",value:function(){this.$.md.addEventListener("md-changed",function(e){var t=e.detail.value;void 0!==t&&this.setFilterValueMap(t)}.bind(this))}},{key:"setFilterValueMap",value:function(e){if(void 0!==this.searchFilterModel){var t=[],i=[];for(var n in this.searchFilterModel){var o=this.searchFilterModel[n].targetFieldName;t.push(n+".value"),i.push(n),this.searchFilterModel[n].model=e.fieldsByObject[this.getSearchTable()][o]}JSON.stringify(this.groupItems)!==JSON.stringify(t)&&(this.groupItems=t),this.filterDelegator.skipDefaults&&this.searchFilterData||this.filterDelegator.setDefaultFilterValues(i,this.searchFilterModel).then(function(e){this.searchFilterData||(this.searchFilterData=e),this.filterDelegator.searchFilterModel=this.searchFilterModel,this.filterDelegator.groupItems=this.groupItems}.bind(this))}}},{key:"getSearchTable",value:function(){if(void 0!==this.searchModel)return this.filterDelegator.getSearchTable()}},{key:"focusFirstField",value:function(){this.isMobile()||this.$.panel.applyFocusToItem(0)}},{key:"runService",value:function(){if(void 0!==this.serviceLoader&&void 0!==this.quote){this.noSpinner||(this.spinner=!0);var e=FilterLayout.buildSearchModel(this.filterDelegator,this.getSearchContext(),this.actionId,this.resultLimit);this.sendQuoteRecord?e.addObject("quote",this.quote.record):e.addQuote("quote",this.quote);var t=e.build();return this.$.service.client.load(this.prefix,this.serviceLoader,null,t).then(function(e){"function"==typeof this.serviceCallback?this.serviceCallback(e):this.searchModel=this.localizer?this.localizer.localizeSearchModel(e):e,this.spinner=!1}.bind(this)).catch(function(e){this.error=formatError(e),this.spinner=!1}.bind(this))}}},{key:"isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"getSearchContext",value:function(){return void 0===this.searchContext?null:1<this.searchContext.length?this.searchContext:null}},{key:"behaviors",get:function(){return[sb.common.core.Page]}},{key:"observers",get:function(){return["_searchModelReadyObserver(searchModel, filterDelegator)"]}},{key:"prefix",get:function(){return this.app.org.prefix}}],[{key:"setVisibleDynamicSearchFilters",value:function(e,t){var i={},n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=t.getGroupKey(l),d=i[u];i[u]=l,d&&!1===d.hidden&&(i[u].hidden=!1)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}},{key:"setSearchFilterFields",value:function(e,t){var i=[];for(var n in e)i.push(t+"."+e[n].targetFieldName);return i}},{key:"buildSearchModel",value:function(e,t,i,n){var o=(new DataBuilder).addObject("filterContext",e.getFilterContext(),void 0,void 0,!0).add("searchContext",t).add("additional",e.getAdditionalProperties()).add("actionId",i).add("resultLimit",n);if("function"!=typeof e.getFieldSet)return o;var r=e.getFieldSet();return r&&o.addObject("fieldSet",r),o}}]),FilterLayout}(Page)),_export("FilterLayout",FilterLayout),Polymer(FilterLayout)}}}),System.register("common/layout/sb-group/Group.js",["common/core/AppContext.js","common/core/Events.js"],function(t,e){var i,a,o;function u(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}return{setters:[function(e){e.AppContext},function(e){i=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}a="undefined"!=typeof Visualforce,t("Group",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-group",this.properties={item:String,group:Array,data:{type:Object,notify:!0},model:{type:Object,value:null},groupClass:String,itemClass:String,groupDisplay:Object,primaryItems:{type:Array,value:null},numPrimary:{type:Number,value:0},includePrimaryInSecondary:{type:Boolean,value:!1},selected:{type:Boolean,value:!1,observer:"updateSelected"},disabled:{type:Boolean,value:!1,observer:"updateDisabled"},pathPrefix:{type:String,value:""},focusIndex:{type:Number,observer:"updateFocusIndex"},itemClassMap:{type:Object,value:{}},itemEditableMap:Object,columnWidths:{type:Object,value:{}},signaler:{type:Object,observer:"updateSignaler"},noDataPropagation:{type:Boolean,value:!1}}}},{key:"_itemClassMapChanged",value:function(){return!this.template||null!==this.template.itemClassMap&&null===this.itemClassMap||null===this.template.itemClassMap&&null!==this.itemClassMap||Object.keys(this.template.itemClassMap).length!==Object.keys(this.itemClassMap).length}},{key:"_updateItemClasses",value:function(){var s=this;if(this.template&&this.itemClassMap){var a=this.template.itemClassMap,l=this.itemClassMap;new Set(Object.keys(a).concat(Object.keys(l))).forEach(function(e){if(a[e]!==s.itemClassMap[e]){var t=Polymer.dom(s.$.g).querySelector(s.item+"[item='"+e+"']");if(t){if(a&&a[e]){var i,n=a[e].class||a[e];n&&"string"==typeof n&&(i=t.classList).remove.apply(i,u(n.split(" ")))}if(l&&l[e]){var o,r=l[e].class||l[e];r&&"string"==typeof r&&(o=t.classList).add.apply(o,u(r.split(" ")))}}}}),this.template.itemClassMap=l}}},{key:"_updateItemValues",value:function(t){if(this.elements&&t){var i=Object.keys(t);this.elements.forEach(function(e){e.item&&-1<i.indexOf(e.item)&&(e.value=t[e.item])})}}},{key:"_buildGroupObserver",value:function(e,t,i,n,o,r,s){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o&&void 0!==r&&void 0!==s)return this.buildGroup(e,t,i,n,o,r,s)}},{key:"buildGroup",value:function(e,t,i,n,o,r,s){this.initInternalGroupAndPrimaryItems(),this.template?this.template.group===this._group?(this.template.selected=this.selected,this.template.disabled=this.disabled,this.template.data=n,this.template.model=e,this._updateItemValues(n),Polymer.RenderStatus.afterNextRender(this,function(){s&&this.template.columnWidths!=s&&this._updateColumnWidths(),this._itemClassMapChanged()&&this._updateItemClasses()})):a||console.error("Rebuilding a group is no longer supported. Called by "+this.domHost.tagName.toLowerCase()+": old group ["+this.template.group+"], new group ["+this._group+"]"):(this.expanded=!1,this.template=document.createElement("template","dom-bind"),this.template.group=this._group,this.template.selected=this.selected,this.template.disabled=this.disabled,this.template.signaler=this.signaler,this.template.model=e,this.template.data=n,this.template.columnWidths=s,this.template.tabIndex=this.tabIndex,this.template.itemClassMap=this.itemClassMap,this.buildItems(this.template),Polymer.dom(this.$.g).appendChild(this.template),this.noDataPropagation||Polymer.dom(this.$.g).observeNodes(function(e){e.addedNodes[0]&&this.bindElementEvents(Polymer.dom(e.addedNodes[0]).childNodes)}.bind(this)))}},{key:"destroyGroup",value:function(){if(this.template)try{this.elements=null,Polymer.dom(this.$.g).removeChild(this.template),Polymer.dom.flush(),this.template=null,this.group=void 0}catch(e){return}}},{key:"_updateColumnWidths",value:function(){if(this.columnWidths){var e=Polymer.dom(this.$.g).querySelectorAll(this.item);!e||e&&0==e.length?Polymer.RenderStatus.afterNextRender(this,function(){var e=Polymer.dom(this.$.g).querySelectorAll(this.item);this._setColumnWidths(e)}):this._setColumnWidths(e)}}},{key:"_setColumnWidths",value:function(e){for(var t=0,i=e.length;t<i;t++){var n=e[t],o=n.getAttribute("item"),r=this.columnWidths[o];if(null!=r){var s=r.width||r;if(null!=s){var a=r.properties||["minWidth","maxWidth"],l=r.unit||"px",u=!0,d=!1,c=void 0;try{for(var h,f=a[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;n.style[p]=s+l}}catch(e){d=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw c}}}}}}},{key:"_createColumnWidthStyleHtml",value:function(e){var t=' style="',i=e.width||e,n=e.properties||["min-width","max-width"],o=e.unit||"px",r=!0,s=!1,a=void 0;try{for(var l,u=n[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)t+=l.value+":"+i+o+";"}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}return t}},{key:"updateSelected",value:function(){this.template&&(this.template.selected=this.selected)}},{key:"updateDisabled",value:function(){this.template&&(this.template.disabled=this.disabled)}},{key:"updateSignaler",value:function(){this.template&&(this.template.signaler=this.signaler)}},{key:"applyFocusToItem",value:function(e){this.focusIndex=void 0,this.focusIndex=e}},{key:"updateFocusIndex",value:function(){if(this.template&&this.elements&&!(void 0===this.focusIndex||this.focusIndex<0))for(var e=0,t=this.template.group.length;e<t;e++)this.template["focus_"+e]=!1,this.focusIndex===e&&(this.template["focus_"+e]=!0)}},{key:"initInternalGroupAndPrimaryItems",value:function(){if(this._group=this.group,this._primaryItems=void 0,this.primaryItems&&0!==this.primaryItems.length){var t=[].concat(this.primaryItems);if(-1===this.group.indexOf(t[0])&&(t[0]=this.group[0]),1<t.length&&(t=-1===this.group.indexOf(t[1])?[t[0]]:[t[0],t[1]]),this._primaryItems=t,this.includePrimaryInSecondary)return this._group=t.concat(this.group),void this._normalizeWithTemplateGroup();var e=this.group.filter(function(e){return-1===t.indexOf(e)});this._group=t.concat(e),this._normalizeWithTemplateGroup()}}},{key:"buildItems",value:function(e){var a=e.content.ownerDocument,l=a.createElement("div");this.groupClass&&Polymer.dom(l).setAttribute("class",this.groupClass);var u=0<this.numPrimary?this.numPrimary:this._primaryItems?this._primaryItems.length:0;this._group.forEach(function(e,t){var i="<"+this.item+' item="'+e+'" value="{{data.'+e+'}}" model="[[model]]" data="[[data]]" disabled="[[disabled]]" selected="[[selected]]" focus="[[focus_'+t+']]" index="'+t+'"',n=t<u;!n&&this.groupDisplay&&this.groupDisplay[e]?i+=' field-label="'+this.groupDisplay[e]+'"':!n&&this.groupDisplay&&this.groupDisplay[e.split(".")[1]]&&(i+=' field-label="'+this.groupDisplay[e.split(".")[1]]+'"');var o="";this.itemClass&&(o+=this.itemClass+" "),n?(o+=0===t?"primary first":"primary multi",o+=this.selected?" selected":""):0<u&&(o+="secondary"),this.itemClassMap&&this.itemClassMap[e]&&(o+=" "+(this.itemClassMap[e].class||this.itemClassMap[e]),this.itemClassMap[e].style&&(i+=' style="'+this.itemClassMap[e].style+'"')),o&&(i+=' class="'+o+'"');var r=this.columnWidths?this.columnWidths[e]:null;null!=r&&(i+=this._createColumnWidthStyleHtml(r)),null!=this.tabIndex&&(i+=' tab-index="[[tabIndex]]"'),i+=' signaler="[[signaler]]"></'+this.item+">";var s=a.createElement("div");s.innerHTML=i,Polymer.dom(l).appendChild(Polymer.dom(s).firstChild)}.bind(this)),Polymer.dom(e.content).appendChild(l)}},{key:"bindElementEvents",value:function(e){var t=(this.elements=e)?e.length:0;this.updateFocusIndex(),this.propagateValueToParent=this.propagateValueToParent||function(e){this.internal=!0,this.set("data."+e.target.item,e.detail.value),this.childToParentExtension&&this.childToParentExtension({path:"data."+e.target.item,value:e.detail.value}),this.internal=!1}.bind(this);for(var i=0;i<t;i++)e[i].removeEventListener("value-changed",this.propagateValueToParent),e[i].addEventListener("value-changed",this.propagateValueToParent)}},{key:"propagateFromParentToChild",value:function(e){this.internal||"data"!==e.path&&(this.propagateFromParentToChildOverride?this.propagateFromParentToChildOverride(e):this._propagateFromParentToChild(e))}},{key:"_propagateFromParentToChild",value:function(e){for(var t=this.elements,i=t?t.length:0,n=e.path.split("."),o=this.pathPrefix+n[n.length-1],r=0;r<i;r++)if(t[r].item===o)return void(t[r].value=e.value)}},{key:"_handlePrimaryEventsObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.handlePrimaryEvents(e,t)}},{key:"handlePrimaryEvents",value:function(){this.primaryEventsResistered||(this.addEventListener("group-selected",function(e){for(var t=Polymer.dom(this.root).querySelectorAll(this.item+".primary"),i=0,n=t.length;i<n;i++)this.toggleClass("selected",e.detail.selected,t[i])}.bind(this)),this.addEventListener("group-expanded",function(e){var t=e.detail.path.filter(function(e){var t=Polymer.dom(e);return(t.node.tagName?t.node.tagName.toLowerCase():"")===this.item&&t.classList.contains("primary")}.bind(this));if(t&&0!==t.length){this.toggleClass("initial",!1,t[0]),this.expanded=!this.expanded,this.domHost&&(this.domHost.expanded=!this.domHost.expanded);for(var i=Polymer.dom(this.root).querySelectorAll(this.item),n=0,o=i.length;n<o;n++){var r=i[n].$$("sb-field");r&&(r.renderReadOnly=!1),this.toggleClass("expanded",this.expanded,i[n])}this.fire("expanded-changed",{expanded:this.expanded})}}.bind(this)),this.primaryEventsResistered=!0)}},{key:"navigationChanged",value:function(){this.fire("group-selected",{selected:!1},{bubbles:!1})}},{key:"overridePropagateFromParentToChild",value:function(e){"function"==typeof e&&(this.propagateFromParentToChildOverride=e)}},{key:"setFromChildToParentExtension",value:function(e){"function"==typeof e&&(this.childToParentExtension=e)}},{key:"toggleItemClass",value:function(e){var t=e.path.split(".");if(1!==t.length){var i=t[1],n=!0,o=!1,r=void 0;try{for(var s,a=this.elements[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(l.item===i){for(var u=0,d=e.value.length;u<d;u++)l.toggleClass(e.value[u].class,e.value[u].value);return}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"_toggleEditableObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.toggleEditable(e,t)}},{key:"toggleEditable",value:function(t,e){t&&e&&e.map(function(e){null!=t[e.item]&&(e.editable=t[e.item])})}},{key:"_normalizeWithTemplateGroup",value:function(){if(this.template&&this.template.group&&this.template.group.length===this._group.length){for(var e=0,t=this._group.length;e<t;e++)if(this.template.group[e]!==this._group[e])return;this._group=this.template.group}}},{key:"_datePickerOpened",value:function(e){var t=e.detail.dateContainer,i=e.detail.datepicker;i.style.position="absolute";var n=i.offsetParent.getBoundingClientRect(),o=t.getBoundingClientRect();i.style.left=-n.left+o.left+"px",i.style.top=o.bottom-n.top+"px",o.left+i.offsetWidth>window.innerWidth&&(i.style.left="",i.style.right=n.right-o.right+17+"px")}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[i.NAVIGATION_CHANGED]=this.navigationChanged,e}},{key:"observers",get:function(){return["_buildGroupObserver(model, item, group, data, primaryItems, itemClassMap, columnWidths)","_handlePrimaryEventsObserver(template, _primaryItems)","propagateFromParentToChild(data.*)","toggleItemClass(itemClassMap.*)","_toggleEditableObserver(itemEditableMap, elements)"]}},{key:"listeners",get:function(){return{"datepicker-opened":"_datePickerOpened"}}}]),o=e)),t("Group",o),Polymer(o)}}}),System.register("common/layout/sb-html/Html.js",["common/layout/tables/ImageCellSizer.js","common/core/sb-page-container/PageContainer.js"],function(e,t){var o,r,s,a;return{setters:[function(e){o=e.DEFAULT_WIDTH,r=e.DEFAULT_HEIGHT},function(e){s=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),e&&(this.$=e.$,this.$$=Polymer.dom(e.root).querySelector.bind(Polymer.dom(e)),this.viewport=s.getViewport())}"iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTQ0NzJFMzhEQjQwMTFFMEJENkNCN0I0QjBBMDU3MzYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUQyN0E5N0NEQjQzMTFFMEJENkNCN0I0QjBBMDU3MzYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBNDQ3MkUzNkRCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBNDQ3MkUzN0RCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnhkEREAAACaSURBVHjaYvz//z8DCKxdu1YLSJkBMRsDYfALiE8FBwdfA3EYQYYADZgPNeAUVAEhwAZTDzQokXHNmjUJQI49iMNAIoBafpAJSNgA8REG8gBInw3IEE4g/k6mISB9nEwMVACjhowaQqwhX4CYh0z9IH1fQIbMAuJpwMzkRGLmswfpA+mHFQUhQE4dEOuSYM5lIG4F5v6VAAEGAGkRMGla548DAAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAAA30lEQVQ4je3OMU4CYRiE4ZnPZckmdDaewYR2KxISz+AB+G28gDHEws6ohBYKCrb2GCZU25rY2tpYQcRd5BsKbbRZWUp8+3kyxHfFMBz7iikPFKMirVlaQ3nzInsGAALAfHCeNVSmFHNQZRUCMRaVUsyb/Wngy+iqdzR/7Sb9aagc/6q4O8tceIwO3986JGbbAl+HMDOiE8Xrz8TgyzqIyZcOJgZ4nf1PbGfhH9kHJCKxcLJVZ+zGFoWF0X0CYfxx2zvZBlgNQhfCmO4TAkBxH04lXINs/1mRnsxwE19mDxtbAk/8Q+6dmAAAAABJRU5ErkJggg==","iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUY4QjA4OTVEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUY4QjA4OTZEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFNjFGRUE4QURCRjMxMUUwODNDMkIzNjIyREUzQkMyOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjhCMDg5NERCRjcxMUUwODNDMkIzNjIyREUzQkMyOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpLVrhgAAAEoSURBVHjanJS9aoRAFIXnjjqykCcJpE21sJBXMA+QgIWFCoKFVbrgX2EhpEiTOqAPEUi1bSBPsrCwzeQe0SK77rp64ShX5nx3frxDWmuBaNv2ll/3LCWm48DaOo7zi4QAYcBHD9j2A6ZCDeMZ9ExN0zxxskEiZkZf/EvyY836FssCvjUgK9Z+IQS+lZzrStNUH3+bBcnzXJumKcqy/AcyrwUURaENwxBQFEU0OZPjKaOyZVlCKXUCGIVkWdZVHKZcVZWGGZAwDGms6AkkSRKSUgqsva7rDmDbtvB9n84tdXQ5cRwTIKgOgOd5dGm/zp5OEAQdyHVdmtr0i0d8DWCA7Fg3C/9Y+HaAvLPeuJkeZjbfBj74h6vgkZMX1t0Mzg/rlbv/80+AAQCVIVhcOwWhjQAAAABJRU5ErkJggg==","iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAABCUlEQVQ4jZ3UsUrDUBgF4HN+Y2KhTyK4dioUfAYfoDeLLyDayU1sRdcOHZLZxxA6dRV8ECm0acj/O9RiSGNu0jOf8907XC7xm+zVXWrOAc8shCdWcCfntoru0i8AIABk0zg12oDGFWg7HwJjeOhHk8Tx++12HOX5KJokzjuuJJvGqRo+AtFiaMSyK7C/EJZCDIOgsJ5AN6cgYrpRsCeAdhpuZ7EdYacAVag1Uh5ePCT0ItWTmoBapHplH1CLlIttgFqkbtAE/IuUhz6gEWkLAEBAYq1kv025GhX2aVgLVRcwzLfP4+suQP7iRjDMqbrYfwUzd2OGR5BXh5KBII5e+F/MPkXwFN6n7z9GMnsCPVgwRwAAAABJRU5ErkJggg==",e("Html",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"sanitizeAndSetInnerHTML",value:function(){if(this.isNil()){var e=!this.link&&!this.isMobile();this.$.me.innerHTML=e?'<img id="blank" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="width:50%; height:17px"/>':""}else{if(null!=this.booleanValue){var t=this.booleanValue?"iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUY4QjA4OTVEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUY4QjA4OTZEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFNjFGRUE4QURCRjMxMUUwODNDMkIzNjIyREUzQkMyOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjhCMDg5NERCRjcxMUUwODNDMkIzNjIyREUzQkMyOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpLVrhgAAAEoSURBVHjanJS9aoRAFIXnjjqykCcJpE21sJBXMA+QgIWFCoKFVbrgX2EhpEiTOqAPEUi1bSBPsrCwzeQe0SK77rp64ShX5nx3frxDWmuBaNv2ll/3LCWm48DaOo7zi4QAYcBHD9j2A6ZCDeMZ9ExN0zxxskEiZkZf/EvyY836FssCvjUgK9Z+IQS+lZzrStNUH3+bBcnzXJumKcqy/AcyrwUURaENwxBQFEU0OZPjKaOyZVlCKXUCGIVkWdZVHKZcVZWGGZAwDGms6AkkSRKSUgqsva7rDmDbtvB9n84tdXQ5cRwTIKgOgOd5dGm/zp5OEAQdyHVdmtr0i0d8DWCA7Fg3C/9Y+HaAvLPeuJkeZjbfBj74h6vgkZMX1t0Mzg/rlbv/80+AAQCVIVhcOwWhjQAAAABJRU5ErkJggg==":"iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTQ0NzJFMzhEQjQwMTFFMEJENkNCN0I0QjBBMDU3MzYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUQyN0E5N0NEQjQzMTFFMEJENkNCN0I0QjBBMDU3MzYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBNDQ3MkUzNkRCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBNDQ3MkUzN0RCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnhkEREAAACaSURBVHjaYvz//z8DCKxdu1YLSJkBMRsDYfALiE8FBwdfA3EYQYYADZgPNeAUVAEhwAZTDzQokXHNmjUJQI49iMNAIoBafpAJSNgA8REG8gBInw3IEE4g/k6mISB9nEwMVACjhowaQqwhX4CYh0z9IH1fQIbMAuJpwMzkRGLmswfpA+mHFQUhQE4dEOuSYM5lIG4F5v6VAAEGAGkRMGla548DAAAAAElFTkSuQmCC";return this.isDirty&&(t=this.booleanValue?"iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAABCUlEQVQ4jZ3UsUrDUBgF4HN+Y2KhTyK4dioUfAYfoDeLLyDayU1sRdcOHZLZxxA6dRV8ECm0acj/O9RiSGNu0jOf8907XC7xm+zVXWrOAc8shCdWcCfntoru0i8AIABk0zg12oDGFWg7HwJjeOhHk8Tx++12HOX5KJokzjuuJJvGqRo+AtFiaMSyK7C/EJZCDIOgsJ5AN6cgYrpRsCeAdhpuZ7EdYacAVag1Uh5ePCT0ItWTmoBapHplH1CLlIttgFqkbtAE/IuUhz6gEWkLAEBAYq1kv025GhX2aVgLVRcwzLfP4+suQP7iRjDMqbrYfwUzd2OGR5BXh5KBII5e+F/MPkXwFN6n7z9GMnsCPVgwRwAAAABJRU5ErkJggg==":"iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAAA30lEQVQ4je3OMU4CYRiE4ZnPZckmdDaewYR2KxISz+AB+G28gDHEws6ohBYKCrb2GCZU25rY2tpYQcRd5BsKbbRZWUp8+3kyxHfFMBz7iikPFKMirVlaQ3nzInsGAALAfHCeNVSmFHNQZRUCMRaVUsyb/Wngy+iqdzR/7Sb9aagc/6q4O8tceIwO3986JGbbAl+HMDOiE8Xrz8TgyzqIyZcOJgZ4nf1PbGfhH9kHJCKxcLJVZ+zGFoWF0X0CYfxx2zvZBlgNQhfCmO4TAkBxH04lXINs/1mRnsxwE19mDxtbAk/8Q+6dmAAAAABJRU5ErkJggg=="),void(this.$.me.innerHTML='<img id="checkbox" src="data:image/png;base64,'+t+'"/>')}"string"!==this.type&&"textarea"!==this.type||!i.containsMarkup(this.value)?(this.$.formatted.style.padding="2px 0",this.$.me.textContent=(this.value+"").trim()):(this.$.formatted.style.padding="2px 0",this.$.me.innerHTML=i.sanitizeHtmlText((this.value+"").trim())),this.handleDefaultSizeIfImage()}}},{key:"handleDefaultSizeIfImage",value:function(){var e=this.$$("#me img:not([style*=width])");e&&(e=this.$$("#me img:not([width])")),e&&Polymer.dom(e).setAttribute("width",o);var t=this.$$("#me img:not([style*=height])");t&&(t=this.$$("#me img:not([height])")),t&&Polymer.dom(t).setAttribute("height",r)}},{key:"isNil",value:function(){return(null==this.value||""===(this.value+"").trim())&&null==this.booleanValue}},{key:"isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"clearTabIndex",value:function(){this._tabindex=this.tabindex,this.tabindex=void 0}},{key:"restoreTabIndex",value:function(){this.tabindex=this._tabindex}}],[{key:"containsMarkup",value:function(e){return/(<[a-z][\s\S]*>)|(&[^\s]*;)/.test(e)}},{key:"sanitizeHtmlText",value:function(e){return e?sanitizeHtml(e,{allowedTags:sanitizeHtml.defaults.allowedTags.concat(["div","img","span","sub","sup","u","s","h1","h2","h3"]),allowedAttributes:{div:["style","class"],img:["src","height","width","alt","border","align","style"],a:["href","name","target","title"],span:["style"],p:["style"],li:["style"],em:["style"],u:["style"],s:["style"],sub:["style"],sup:["style"],strong:["style"]},parser:{decodeEntities:!1}}):e}}]),a=i)),e("Html",a)}}}),System.register("common/layout/sb-lookup-layout/LookupLayout.js",["common/layout/fields/FieldSetHandler.js","common/layout/tables/ImageCellSizer.js","common/layout/tables/TableClassBuilder.js","common/layout/data/RecordGrouper.js","common/core/sb-page-container/PageContainer.js","common/core/AppContext.js"],function(t,e){var i,p,o,f,r,s,a;return{setters:[function(e){i=e.FieldSetHandler},function(e){p=e.ImageCellSizer},function(e){o=e.TableClassBuilder},function(e){f=e.RecordGrouper},function(e){r=e.PageContainer},function(e){s=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}100,t("LookupLayout",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-lookup-layout",this.properties={selectedRows:{type:Object,value:{},notify:!0},searchModel:Object,totalCount:{type:String,notify:!0},hasTotalCount:{notify:!0},maxSelectAll:Number,selectionIdDataPath:String,parentAttributesPath:String,additionalFields:Array,fieldPrefix:{type:String,value:""},groupByField:String,groupByFieldType:String,viewport:{type:Object,value:function(){return r.getViewport()}},i18n:{type:Object,value:function(){return s.properties.i18n.value()}},primaryMobileCols:Array,_primaryMobileColumns:{type:Array,computed:"_getPrimaryMobileCols(primaryMobileCols, fieldSet)"},rowsByGrouper:Object,groups:Array,viewResultsIndexById:Object,viewResultsIds:Object,headerSelectionDisabled:{type:Boolean,computed:"_isDisableHeaderSelection(viewResults)"},headerSelectionTooltip:{type:String,computed:"_getHeaderSelectionTooltip(headerSelectionDisabled)"},mobileRowDetails:{type:Object,value:{}},keyPressed:{Type:Object,value:{}},lastClickedIndex:{Type:Number},noResultsMessage:String,_hasViewResults:{type:Boolean,computed:"_computeHasViewResults(_viewResults)"}}}},{key:"ready",value:function(){this._setupKeyPressListeners(),this.handleAllRowsSelected(),this.handleOneRowSelected(),this.handleMetaDataResponse(),this.addEventListener("sb-mobile-row-expanded",this.expandMobileRow.bind(this)),this.addEventListener("sb-mobile-row-selected",this.selectMobileRow.bind(this)),this.addEventListener("sb-row-group-tapped",this.expandRowEventHandler.bind(this)),this.scrollTarget=this.$.tbody}},{key:"_setupKeyPressListeners",value:function(){window.addEventListener("keydown",function(e){this.keyPressed[e.keyCode]=!0}.bind(this)),window.addEventListener("keyup",function(e){delete this.keyPressed[e.keyCode]}.bind(this))}},{key:"_computeHasViewResults",value:function(e){return e&&0<e.length}},{key:"handleMetaDataResponse",value:function(){this.$.md.addEventListener("md-changed",function(e){this.initRecordKeysFieldLabelsAndTypeMap(e.detail.value.fields)}.bind(this))}},{key:"initFieldMetadata",value:function(){this.deSelectAll(),this.fieldMetadataInitialized||(this.$.md.object=this.searchModel.targetObjectName,this.fieldSetHandler=new i(this.searchModel,"resultFieldNames","resultFieldNamesTablet","resultFieldNamesPhone"),this.setFieldMetadata(),this.fieldMetadataInitialized=!0)}},{key:"setFieldMetadata",value:function(){if(this.fieldSet=this.fieldSetHandler.getByViewport(this.viewport),this.$.md.name===this.fieldSet.name)return!1;this.$.md.fields=void 0,this.$.md.name=this.fieldSet.name;var e=this.fieldSet.fields;Array.isArray(this.additionalFields)&&(e=this.fieldSet.fields.concat(this.additionalFields)),this.groupByField&&-1===e.indexOf(this.groupByField)&&(e=[this.groupByField].concat(e)),this.$.md.fields=e}},{key:"initRecordKeysFieldLabelsAndTypeMap",value:function(e){var s=[],a=[],l={},u={},d={},c={},h={},f={};e.forEach(function(e,t){if(this.groupByField!==e.name||(this.groupByFieldType=e.type,-1!==this.fieldSet.fields.indexOf(e.name))){var i="UnitPrice"===e.name?e.name:this.fieldPrefix+e.name;s.push(i),a.push(e.label),l[i]=e.label,"currency"===(u[i]=e).type.toLowerCase()&&(u[i].CurrencyIsoCode=this.currencyIsoCode);var n=e.type;if(!this.isMobileViewport()){var o=new p(e).getImageWidth(20);if(o){var r={width:o,properties:["width"]};h[i]=r,f[t]=r}}d[e.label.replace(/\W/g,"")]=n,c[i]=n}}.bind(this)),void 0===this.groupByFieldType&&(this.groupByFieldType=null),this.headerClassMap=new o(Object.keys(d),"Th",d,null,!0).build(),this.rowClassMap=new o(s,"Td",c).build(),this.columnWidths=h,this.labelWidths=f,this.mdMap=u,this.recordKeys=s,this.fieldLabels=a,this.fieldLabelMap=l}},{key:"handleAllRowsSelected",value:function(){this.addEventListener("header-selection-changed",function(e){this.selectAllClicked=!0;var t=e.detail.selected;this.toggleRowSelections(t),this.selectAllClicked=!1}.bind(this))}},{key:"toggleRowSelections",value:function(e,t,i){var n=[],o=Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row");if(o&&0<o.length){var r=!0,s=!1,a=void 0;try{for(var l,u=o[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value,c=d.get("rowData."+this.selectionIdDataPath);n.push(c),i&&(d.index<i.start||d.index>i.end)||null!=t&&(d.grouper||d.groupie&&d.groupie!==t)||this._isValidViewResultId(c)&&(d.selected=e)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}}var h=null!=t?this.rowsByGrouper[t]:this.viewResults;if(null!=h){i||(i={start:0,end:h.length-1});for(var f=i.start;f<=i.end;f++){var p=h[f],v=this.get("record."+this.selectionIdDataPath,p);if(-1===n.indexOf(v)){var g=void 0===this.parentAttributesPath?void 0:this.get("record."+this.parentAttributesPath,p);this.selectOneRow(e,v,p.record,g,p.grouper)}}}}},{key:"handleOneRowSelected",value:function(){this.addEventListener("selection-changed",function(e){document.getSelection().removeAllRanges(),this.selectAllClicked||this.handleRangeSelection(e);var t=e.detail.selected,i=e.detail.Id,n=e.detail.group,o=e.detail.autoSelectGroupRows;this.selectOneRow(t,i,e.detail.rowData,e.detail.attributes,n),null!=n&&o&&this.toggleRowSelections(t,n)}.bind(this))}},{key:"handleRangeSelection",value:function(e){if(this.keyPressed[16]&&null!=this.lastClickedIndex&&!this.internal&&!this.groupByFieldType){this.internal=!0;var t=Math.min(this.lastClickedIndex,e.detail.index),i=Math.max(this.lastClickedIndex,e.detail.index);this.toggleRowSelections(e.detail.selected,null,{start:t,end:i}),this.internal=!1}Polymer.dom(e).rootTarget._selectedChangeByParent||(this.lastClickedIndex=e.detail.index)}},{key:"selectOneRow",value:function(e,t,i,n,o){e&&(null===this.selectedRows&&(this.selectedRows={}),this.selectedRows[t]={record:{Id:t,attributes:n,UnitPrice:i.UnitPrice},index:this.viewResultsIndexById[t],invalid:null!=o}),!e&&this.selectedRows&&delete this.selectedRows[t]}},{key:"deSelectAll",value:function(){this.$.header&&(this.$.header.selected=void 0,this.$.header.selected=!1)}},{key:"_setViewResultsObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.setViewResults(e,t,i)}},{key:"setViewResults",value:function(){this.selectedRows={},this.viewResultsIds=null,this.viewResultsIndexById=null;var e=this.getViewResults(this.searchModel.results);if(this.hasGroupedField=!!this.groupByField,this.isMobileViewport()&&this._resetMobileDetails(),this.hasGroupedField)if(this.viewResults&&(e=JSON.parse(JSON.stringify(this.getViewResults(this.searchModel.results)))),this.isMobileViewport())this.viewResults=e;else{var t=[this.fieldSet.fields[0],"Id"],i="record."+this.searchModel.targetObjectName,n={path:"record._transient_."+this.searchModel.targetObjectName+"."+t[0],property:"suffix"},o={path:"record._transient_."+this.searchModel.targetObjectName+"."+t[0]+".md",property:"type"};e=new f(this.groupByField,t,i,{hidden:!0},{},{hidden:!1},n,this.groupByFieldType,o).group(e),this.rowsByGrouper={},this.groups=[],this.viewResultsIds=[];var r=0,s=!0,a=!(this.viewResultsIndexById={}),l=void 0;try{for(var u,d=e[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var c=u.value;this._indexViewResult(c,r++),c.grouper?(this.rowsByGrouper[c.grouper]=[],this.groups.push(c)):this.rowsByGrouper[c.groupie]&&this.rowsByGrouper[c.groupie].push(c)}}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}if(this.viewResults=e,this.expandedGroupState={},this.viewResults.length===this.searchModel.results.length+1){var h=this.viewResults[0].grouper;this.expandRowEventHandler({path:[{index:0}],detail:{group:h}})}}else this.viewResults=e}},{key:"getViewResults",value:function(e){var t=this.org.prefix?this.org.prefix+"__":"",i=[],n=!0,o=!1,r=void 0;try{for(var s,a=(e||[])[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u={record:{}};for(var d in l.record)"UnitPrice"===d&&l.record.Product2&&l.record.Product2[t+"HidePriceInSearchResults__c"]?u.record[d]="":u.record[d]=l.record[d];i.push(u)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}},{key:"setDisplayResults",value:function(){this.isMobileViewport()||!this.groupByField?this._viewResults=this.viewResults:this._viewResults=this.groups}},{key:"isSelected",value:function(e){if(!this.selectedRows)return!1;var t=this.get(this.selectionIdDataPath,e);return!!this.selectedRows[t]}},{key:"isExpanded",value:function(e,t){return!(!e||!t||!t[e])}},{key:"isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"updateTotalCount",value:function(){null!==this.searchModel.totalCount&&(this.totalCount=this.searchModel.totalCount),this.hasTotalCount=0<this.totalCount}},{key:"_getPrimaryMobileCols",value:function(){var e=[].concat(this.primaryMobileCols);if(e&&0<e.length&&this.fieldSet.name.endsWith("Phone")){var t=e[0].split("."),i=1<t.length?t[0]+".":"";e[0]=i+this.fieldSet.fields[0]}return e}},{key:"expandMobileRow",value:function(e){var t=this.$$("#list");this._setMobileExpandDetails(t,e.detail),t.notifyResize()}},{key:"selectMobileRow",value:function(e){var t=this.$$("#list");this._setMobileSelectedDetails(t,e.detail)}},{key:"_setMobileExpandDetails",value:function(e,t){var i=t.index,n=t.id,o=t.expanded,r=t.path;this._setMobileDetails(e,i,n,"expanded",o,r)}},{key:"_setMobileSelectedDetails",value:function(e,t){var i=t.index,n=t.id,o=t.selected;this._setMobileDetails(e,i,n,"selected",o)}},{key:"_setMobileDetails",value:function(e,t,i,n,o,r){var s=e._computeVidx(t)%e._physicalCount;this.mobileRowDetails[s]||(this.mobileRowDetails[s]={});var a=this.mobileRowDetails[s];r&&(a.path=r),a.ids||(a.ids={}),a.ids[i]||(a.ids[i]={}),a.ids[i][n]=o}},{key:"expandRowEventHandler",value:function(e){var t=e.detail.group,i=(e.path||Polymer.dom(e).path)[0].index+1,n=this.expandedGroupState[t]=!this.expandedGroupState[t];this._expandRow(n,t,this.rowsByGrouper,i)}},{key:"_expandRow",value:function(e,t,i,n){var o=null,r=this.$$("#list"),s=i[t]||[];if(e){var a=[n,0].concat(s);this._viewResults.splice.apply(this._viewResults,a),this._notifySplice(this._viewResults,"_viewResults",n,a.length-1,[])}else r._scrollPosition=Math.ceil(r._scrollPosition),o=r.firstVisibleIndex,this.splice("_viewResults",n,s.length);Polymer.RenderStatus.afterNextRender(this,this._adjustScrollAfterExpandRow.bind(this,r,o))}},{key:"_adjustScrollAfterExpandRow",value:function(e,t){null!=t?e.scrollToIndex(t):e._updateScrollerSize(!0)}},{key:"indexViewResults",value:function(){if(null==this.viewResultsIds){this.viewResultsIds=[];var e=0,t=!0,i=!(this.viewResultsIndexById={}),n=void 0;try{for(var o,r=this.viewResults[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this._indexViewResult(s,e++)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}}},{key:"_indexViewResult",value:function(e,t){var i=this.get("record."+this.selectionIdDataPath,e);this.viewResultsIds.push(i),this.viewResultsIndexById[i]=t}},{key:"_isValidViewResultId",value:function(e){return-1!==this.viewResultsIds.indexOf(e)}},{key:"_getMaxResultsToSelectAll",value:function(){return this.maxSelectAll||100}},{key:"_isDisableHeaderSelection",value:function(){return this.viewResults.length>this._getMaxResultsToSelectAll()}},{key:"_getHeaderSelectionTooltip",value:function(){if(this.headerSelectionDisabled)return this.i18n.l("Reduce search results to fewer than {0} to enable select all",[this._getMaxResultsToSelectAll()])}},{key:"_getExpandedDetails",value:function(e,t){return this._getMobileDetails(e,t,"expanded",!0)}},{key:"_getSelectedDetails",value:function(e,t){return this._getMobileDetails(e,t,"selected")}},{key:"_getMobileDetails",value:function(e,t,i,n){if(!this.isMobileViewport())return null;var o=this.$$("#list"),r=o._computeVidx(t)%o._physicalCount,s=this.mobileRowDetails[r]||null;if(!s)return null;var a=this.get(this.selectionIdDataPath,e),l=!(!s.ids[a]||!s.ids[a][i]),u={};return u[i]=l,n&&(u.path=s.path),u}},{key:"_resetMobileDetails",value:function(){for(var e in this.mobileRowDetails){var t=this.mobileRowDetails[e];for(var i in t.ids)t.ids[i]={}}}},{key:"_scrollHandler",value:function(){this.isMobileViewport()&&(this.expandDisabled=!0,this._enabledExpand&&clearTimeout(this._enabledExpand),this._enabledExpand=setTimeout(function(){this.expandDisabled=!1}.bind(this),200))}},{key:"test_scrollToTarget",value:function(e){if(e){var t=e.index;null==t&&(t=this._findRowIndex(e)),t<0||this.$$("#list").scrollToIndex(t)}}},{key:"_findRowIndex",value:function(e){if(!e)return-1;var t=Object.keys(e),i=t.length;if(0===i)return-1;for(var n=0,o=this.viewResults.length;n<o;n++){for(var r=this.viewResults[n].record,s=!0,a=0;a<i;a++)s=s&&r[t[a]]===e[t[a]];if(s)return n}return-1}},{key:"behaviors",get:function(){return[sb.common.core.AppContext,window.CommonBehaviors.DeviceBehavior,Polymer.IronScrollTargetBehavior]}},{key:"observers",get:function(){return["_setViewResultsObserver(searchModel, fieldSet, groupByFieldType)","initFieldMetadata(searchModel)","updateTotalCount(searchModel.totalCount)","setDisplayResults(viewResults)","indexViewResults(viewResults)"]}}]),a=e)),t("LookupLayout",a),Polymer(a)}}}),System.register("common/layout/sb-popup/Popup.js",["common/core/Events.js"],function(t,e){var o,r,i;return{setters:[function(e){o=e.Events,r=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Popup",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-popup",this.properties={url:String,messenger:Object,channel:{type:String,value:"sbQQ"},responseMessage:{type:Object,notify:!0},closePopup:{type:String,value:"sb-close-popup"},autoLaunched:{type:Boolean,value:!1},redirectOnCancelOrClose:{type:Boolean,value:!1,observer:"_appendLargeClass"}}}},{key:"ready",value:function(){this.addEventListener("sb-close-dialog",this.close.bind(this))}},{key:"open",value:function(){Polymer.RenderStatus.afterNextRender(this,this._open)}},{key:"_open",value:function(){this._initRpc(),this._sendMessage(),this._handleAutoLaunch(),this.$.dialog.toggle()}},{key:"close",value:function(){this._close(this._getRedirectDetails(!1))}},{key:"_close",value:function(e){this.rpc&&this.rpc.destroy(),this.$.dialog.toggle();var t=this.$.dialog.$$("#content").querySelector("#easyXDM_"+this.channel+"_provider"),i={redirect:e};t&&t.remove(),this.responseMessage&&(i.featureOptionIds=this.responseMessage.featureOptionIds,i.dynamicOptions=this.responseMessage.dynamicOptions),r(o.NAVIGATION_CHANGED),this.fire(this.closePopup,i)}},{key:"_initRpc",value:function(){this.url&&(this.rpc=new easyXDM.Rpc({remote:this.url,container:this.$.dialog.$$("#content"),channel:this.channel},{remote:{postMessage:{}},local:{postMessage:this._receiveMessage.bind(this)}}))}},{key:"_sendMessage",value:function(){var e={};this.messenger&&"function"==typeof this.messenger.getRequest&&(e=this.messenger.getRequest()),e.redirect=this._getRedirectDetails(this.autoLaunched),this.rpc.postMessage(JSON.stringify(e))}},{key:"_handleAutoLaunch",value:function(){this.autoLaunched&&r(o.AUTO_LAUNCH_POPUP)}},{key:"_receiveMessage",value:function(i){this.debounce("_receiveMessage",function(){if(this.messenger&&"function"==typeof this.messenger.getResponse)if(i){var e=JSON.parse(i);this._logReceivedMessage(e),this.responseMessage=this.messenger.getResponse(e);var t=e.redirect?e.redirect:this._getRedirectDetails(this.autoLaunched);this._close(t)}else this.close();else this.close()}.bind(this),100)}},{key:"_logReceivedMessage",value:function(e){console.log("RPC Received Message:"),console.log(e)}},{key:"_getRedirectDetails",value:function(e){return{auto:this.redirectOnCancelOrClose||!!e,save:!!e}}},{key:"_appendLargeClass",value:function(){this.toggleClass("largeView",this.redirectOnCancelOrClose,Polymer.dom(this.$$("sb-dialog").root).querySelector(".sbDialog"))}}]),i=e)),t("Popup",i),Polymer(i)}}}),System.register("common/layout/sb-row-drawer/RowDrawer.js",["common/signal/RowFocusSignaler.js","common/core/AppContext.js"],function(t,e){var o,i;return{setters:[function(e){o=e.RowFocusSignaler},function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("RowDrawer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-row-drawer",this.properties={item:String,fieldNames:Array,richTextFields:Array,model:{type:Object,notify:!0},highlightOnFocus:{type:Boolean,value:!1},listMode:{type:Boolean,value:!1}}}},{key:"_generateColumnsObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.generateColumns(e,t,i)}},{key:"generateColumns",value:function(){for(var e=[],t=[],i=[],n=this.fieldNames.length,o=this.fieldNames.slice(0),r=void 0,s=0;s<n;s++)-1===this.richTextFields.indexOf(o[s])&&(this.listMode?e.push(o[s]):s%3==0?e.push(o[s]):s%3==1?t.push(o[s]):i.push(o[s]));r=this.listMode?[this.richTextFields,e]:(this.columnWidth="drawer",[this.richTextFields,e,t,i]),this.setColumns(r)}},{key:"setColumns",value:function(e){var t=[this.$$("#rteColumn"),this.$$("#firstColumn")];this.listMode||t.push(this.$$("#secondColumn"),this.$$("#thirdColumn"));for(var i=0;i<t.length;i++)0<e[i].length&&(t[i].destroyGroup(),t[i].model=this.model,t[i].itemClass="drawerCell",t[i].group=e[i])}},{key:"_highlightOnFocusObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._highlightOnFocus(e,t)}},{key:"_highlightOnFocus",value:function(e,t){var i=["rteColumn","firstColumn"];this.listMode||i.push("secondColumn","thirdColumn"),this.signaler=new o(this,i,t),this.signaler.signalOnFocus("sb-row-focus-signal",!e)}},{key:"_getGroupListClass",value:function(e){return this.listMode?"listMode":""}},{key:"_getRTEGroupListClass",value:function(e){return this.listMode?"rteListMode":""}},{key:"observers",get:function(){return["_generateColumnsObserver(fieldNames, model, richTextFields)","_highlightOnFocusObserver(highlightOnFocus, item)"]}}]),i=e)),t("RowDrawer",i),Polymer(i)}}}),System.register("common/layout/sb-side-panel/SidePanel.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SidePanel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-side-panel",this.properties={renderHeader:{type:Boolean,value:!0},icon:String,arrows:String,sideText:String,rightSideButton:Boolean}}},{key:"closeDrawer",value:function(){this.fire("x-clicked")}},{key:"keyCheck",value:function(e){13==e.keyCode&&this.fire("enter-keypress")}},{key:"toggleDrawer",value:function(){this.fire("side-toggle-clicked")}},{key:"setIcon",value:function(){"open"===this.isOpen?this.icon="sf-icon-left":(this.icon="sf-icon-right",this.arrows="closedArrows")}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["setIcon(isOpen)"]}}]),i=e)),t("SidePanel",i),Polymer(i)}}}),System.register("common/layout/sb-swipe-container/SwipeContainer.js",["common/core/sb-page-container/PageContainer.js","../../core/AppContext.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer},function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SwipeContainer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-swipe-container",this.listeners={"expanded-changed":"onGroupExpanded"},this.properties={disableSwipe:{type:Boolean,value:!1},preventSwipe:{type:Boolean,value:!1},isRequiredRowNotSelected:{type:Boolean,value:!1},groupExpanded:{type:Boolean,value:!1,observer:"_expansionChanged"},swipeHeader:Object,swipeMenu:Object,swipeItems:{type:Array,value:[]},swipeItemWidth:{type:Number,value:58},viewport:{type:Object,value:function(){return i.getViewport()}},variant:String}}},{key:"_preventSwipe",value:function(){this.preventSwipe=this.isRequiredRowNotSelected||this.groupExpanded}},{key:"onGroupExpanded",value:function(e){this.groupExpanded=e.detail.expanded,this._preventSwipe()}},{key:"attached",value:function(){if(!this.viewport||!this.viewport.isMobile()||this.disableSwipe)return this.style.minWidth="100%",void(this.style.position="static");Polymer.dom(this.$.content).observeNodes(function(e){for(var t=0;t<e.addedNodes.length;t++)this._findSwipeHeaderAndMenu(e.addedNodes[t])}.bind(this))}},{key:"_expansionChanged",value:function(e){"ui3qle"===this.variant&&this._preventSwipe()}},{key:"_findSwipeHeaderAndMenu",value:function(e){e.nodeType!==Node.TEXT_NODE&&e.nodeType!==Node.COMMENT_NODE&&("swipe-header"!==e.id||this._initSwipeHeader(e))}},{key:"_initSwipeHeader",value:function(e){var t=(this.swipeHeader=e).style;if(this.viewport&&!this.viewport.isMobile())return t.maxWidth="100%",void(t.display="table");"ui3qle"!==this.variant&&(t.maxWidth="50%",t.position="relative"),this.listen(e,"track","_onTrack"),this.setScrollDirection("y",e)}},{key:"_closeMenuWhenTapped",value:function(e,t){e.addEventListener("tap",function(){t._animate(100,1,t.swipeHeader)})}},{key:"_initSwipeMenu",value:function(e){if(e.style.maxWidth="50%",this._closeMenuWhenTapped(e,this),this.swipeItems&&this.swipeItems.length)for(var t=0;t<this.swipeItems.length;t++){var i=this.swipeItems[t];i.style.position="",i.style.width="0px"}var n=[],o=[];(this.swipeMenu=e).children[0].shadowRoot?(Polymer.dom(e.children[0].shadowRoot).flush(),"SB-ACTIONS"===e.children[0].nodeName?(Polymer.dom(e.children[0].shadowRoot).flush(),n=e.children[0].shadowRoot.children):"SB-CUSTOM-ACTION"===e.children[0].nodeName&&(n=e.children)):"SB-ACTIONS"===e.children[0].nodeName||"SF-LINE-ACTIONS"===e.children[0].nodeName?(Polymer.dom(e.children[0]).flush(),n=e.children[0].children):"SB-CUSTOM-ACTION"===e.children[1].nodeName&&(Polymer.dom(e.children[1]).flush(),n=e.children);for(var r=0,s=n.length;r<s;r++){var a=n[r];this._isValidSwipeMenuItem(a)&&o.push(a)}this.swipeItems=o;var l=this.swipeItemWidth*this.swipeItems.length;e.style.width=l+"px";for(var u=0,d=this.swipeItems.length;u<d;u++){var c=this.swipeItems[u];this.toggleClass("swipe-menu-item",!0,c);var h=(200-20*(d-1))*d;this.style.transition="transform "+h+"ms ease-out",this._setSwipeItemStyles(c.style,h,l)}}},{key:"_setSwipeItemStyles",value:function(e,t,i){e.transition="transform "+t+"ms ease-out",e.webkitBackfaceVisibility="hidden",e.borderRadius=0,e.position="absolute",e.left=0,e.height="100%",e.width="57px"}},{key:"_onTrack",value:function(e){if(!this.swipeMenu){var t=this.querySelector("#swipe-menu");t&&this._initSwipeMenu(t)}if(!this.preventSwipe&&this.swipeItems.length){var i=e.currentTarget,n=e.detail;"track"===n.state&&this._trackMove(n,i)}}},{key:"_trackMove",value:function(e,t){this._animate(e.dx,e.dy,t)}},{key:"_animate",value:function(e,t,i){var n=0<e?1:-1;if(-1==n&&Math.abs(t)<20&&e<-60){this.fire("row-swiped",{isOpen:!0});var o=parseFloat(getComputedStyle(this.swipeItems[0]).width),r=o.toPrecision(5)*this.swipeItems.length*n;this.style.transform="translate3d("+r+"px, 0, 0)",this.style.webkitBackfaceVisibility="hidden";for(var s=this.swipeItems.length-1;0<=s;s--){var a=s*o.toPrecision(5);this.swipeItems[s].style.width=o.toPrecision(5)+"px",this.swipeItems[s].style.transform="translate3d("+a+"px, 0, 0)"}}else if(1==n&&Math.abs(t)<20&&25<e)for(this.fire("row-swiped",{isOpen:!1}),this.style.transform="translate3d(0%, 0, 0)",this.style.webkitBackfaceVisibility="hidden",s=0;s<this.swipeItems.length;s++)this.swipeItems[s].style.transform="translate3d(0%, 0, 0)"}},{key:"_isValidSwipeMenuItem",value:function(e){if("ui3qle"===this.variant)return"button"===e.nodeName.toLowerCase();if(("span"===e.nodeName.toLowerCase()||e.$$&&e.$$("span"))&&!e.classList.contains("ignore-in-mobile")){if(e.$$&&e.$$("span")){var t=e.$$("span");if(("removeFromFavBtn"===t.id||"addToFavBtn"===t.id)&&"none"===t.style.display)return!1}if(!e.classList.contains("visibilityHidden"))return!0;e.style.display="none"}return!1}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_preventSwipe(isRequiredRowNotSelected)"]}}]),o=e)),t("SwipeContainer",o),Polymer(o)}}}),System.register("common/layout/sb-table-cell/TableCell.js",["common/relationship/RelationshipFieldManager.js","common/layout/fields/FieldHider.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.RelationshipFieldManager},function(e){o=e.FieldHider}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("TableCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-table-cell",this.properties={item:String,disabled:Boolean,hide:Object,value:{notify:!0},data:{type:Object,value:null},model:{type:Object,value:null}}}},{key:"_buildCellObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this.buildCell(e,t,i,n)}},{key:"buildCell",value:function(){this.setDisabled(),this.setHidden(),this.setRecordId(),this.setSuffix(),this.model&&this.model[this.item]&&this.model[this.item].type?this.setFieldMetadataFromModel():this.md=this.md||{type:"string"}}},{key:"setDisabled",value:function(){this.disabled=!(!this.data||!this.data.disabled)}},{key:"setHidden",value:function(){var e=!!this.data&&this.data.hidden;this.hide=new o(e).hide}},{key:"setRecordId",value:function(){this.recordId=this.data?this.data.Id:null}},{key:"setSuffix",value:function(){this.data&&this.data._transient_&&null!=this.get(["data","_transient_",this.item,"suffix"])?this.suffix=this.get(["data","_transient_",this.item,"suffix"]):this.suffix=void 0}},{key:"overrideWidth",value:function(){this.data&&this.data.fullWidthItem&&this.classList.contains(this.data.fullWidthItem)?this.style.width="100%":"100%"==this.style.width&&(this.style.width=null)}},{key:"setFieldMetadataFromModel",value:function(){var e=this.model[this.item];this.data&&this.data._transient_&&null!=this.get(["data","_transient_",this.item,"md"])&&(e=this.get(["data","_transient_",this.item,"md"])),this.$.field.link=!!e.link,this.$.field.readOnly=!0,this.md=e}},{key:"_dataChangedObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.dataChanged(e,t)}},{key:"dataChanged",value:function(){var e=new i(this.item,this.data);e.hasRelationship()&&(this.display=e.getRelationshipName())}},{key:"observers",get:function(){return["_buildCellObserver(item, value, model, data)","setDisabled(data.disabled)","setRecordId(data.Id)","overrideWidth(data.fullWidthItem)","_dataChangedObserver(data, item)"]}}]),r=e)),t("TableCell",r),Polymer(r)}}}),System.register("common/layout/sb-table-cell-select/TableCellSelect.js",["common/layout/fields/FieldHider.js"],function(t,e){var i,o;return{setters:[function(e){i=e.FieldHider}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("TableCellSelect",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-table-cell-select",this.properties={item:String,isRadio:{type:Boolean,computed:"_isRadio(item)"},value:{notify:!0},data:{type:Object,observer:"init"}}}},{key:"init",value:function(){if(this._attached)return this._setDisabled(),void this._setHidden();Polymer.dom(this.$.s).observeNodes(function(){this._setDisabled(),this._setHidden(),this._attached=!0}.bind(this))}},{key:"_isRadio",value:function(){return"radio"===this.item}},{key:"_setDisabled",value:function(){this.disabled=!(!this.data||!this.data.disabled)}},{key:"_setHidden",value:function(){var e=!!this.data&&this.data.hidden;new i(e,Polymer.Base).applyTo(this.$$("#"+this.item))}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),o=e)),t("TableCellSelect",o),Polymer(o)}}}),System.register("common/layout/sb-table-header/TableHeader.js",["common/core/sb-page-container/PageContainer.js","common/layout/fields/FieldHider.js","common/core/Events.js"],function(t,e){var i,r,o,s;return{setters:[function(e){i=e.PageContainer},function(e){r=e.FieldHider},function(e){o=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("TableHeader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-table-header",this.properties={cols:Array,selectable:Boolean,selectionType:{type:String,value:"checkbox"},selected:{type:Boolean,value:!1,notify:!0},selectionDisabled:{type:Boolean,value:!1},selectionTooltip:String,headerClassMap:{type:Object,value:{}},columnWidths:{type:Object,value:null},viewport:{type:Object,value:function(){return i.getViewport()}},headerActions:Array,hideHiddenSelectable:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.isMobile=this._isMobileViewport()}},{key:"_isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"_buildLabelsObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.buildLabels(e,t,i)}},{key:"buildLabels",value:function(){var t={},i=[],n=0;this.cols.forEach(function(e){e&&(i.push(n),t[n++]=e)}),this.$.header.data=void 0,this.$.header.itemClassMap=this.headerClassMap,this.$.header.columnWidths=this.columnWidths,this.$.header.group||(this.$.header.group=i),this.$.header.data=t}},{key:"_setSelectableObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setSelectable(e,t)}},{key:"setSelectable",value:function(){this.selectable&&(this.registeredDataChangedHandler||(this.registeredDataChangedHandler=!0,Polymer.RenderStatus.afterNextRender(this,this.registerSelectionChangedHandler.bind(this))))}},{key:"registerSelectionChangedHandler",value:function(){this.$.selection.addEventListener("data-changed",this.selectionChangedHandler.bind(this))}},{key:"selectionChangedHandler",value:function(e){"template"!==Polymer.dom(e).rootTarget.nodeName.toLowerCase()&&(this.internal=!0,this.selected=void 0!==e.detail.value[this.selectionType]?e.detail.value[this.selectionType]:e.detail.value,this.internal=!1,this.fire("header-selection-changed",{selected:this.selected}))}},{key:"_setSelectedObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.setSelected(e,t,i)}},{key:"setSelected",value:function(){if(!this.internal){var e="radio"===this.selectionType?"radio":"checkbox";this.$.selection.group||(this.$.selection.group=[e]);var t={disabled:this.selectionDisabled},i=this.selected;t[e]=i;var n=new r(!this.selectable).hide;n.type="invisible",t.hidden=n,this.$.selection.data=t;var o=!!this.hideHiddenSelectable&&!this.selectable;this.toggleClass("hidden",o,this.$.selection)}}},{key:"_showHeaderActions",value:function(e){if(!this.headerActions||0===this.headerActions.length)return!1;for(var t=0,i=this.headerActions.length;t<i;t++)if(this.headerActions[t].position==e&&!this.headerActions[t].hidden)return!0;return!1}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[o.VIEWPORT_CHANGED]=this.viewportChanged,e}},{key:"observers",get:function(){return["_buildLabelsObserver(cols, headerClassMap, columnWidths)","_setSelectableObserver(selectable, selectionType)","_setSelectedObserver(selected, selectable, selectionType)"]}}]),s=e)),t("TableHeader",s),Polymer(s)}}}),System.register("common/layout/sb-table-row/TableRow.js",["common/core/sb-page-container/PageContainer.js","common/layout/fields/FieldHider.js","common/signal/RowFocusSignaler.js","common/core/Events.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.PageContainer},function(e){o=e.FieldHider},function(e){r=e.RowFocusSignaler},function(e){s=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("TableRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-table-row",this.listeners={"row-swiped":"onRowSwiped"},this.properties={cell:String,cols:Array,colsDisplay:Object,rowActions:Array,routeSource:String,rowData:{type:Object,notify:!0},model:{type:Object,value:null},requiresModel:{type:Boolean,value:!1},selectable:{type:Boolean,value:!1},selected:{type:Boolean,value:!1,notify:!0},selectionType:{type:String,value:"checkbox"},disabledData:{type:Object,value:{disabled:!1,constrained:!1}},selectionIdDataPath:{type:String,value:"Id"},parentIdDataPath:{type:String,value:"Parent"},parentAttributesPath:String,primaryMobileCols:{type:Array,value:[]},repeatPrimaryMobileCols:{type:Boolean,value:!1},viewport:{type:Object,value:function(){return i.getViewport()}},isMobile:{type:Boolean,value:!1,computed:"setIsMobile(viewport)"},actionId:{type:String,computed:"setActionId(isMobile)"},grouper:String,grouperExpanded:Boolean,groupie:String,ignoreViewportChange:Boolean,rowClassMap:{type:Object,value:{}},editFirstWhenSelected:{type:String,value:""},index:{type:Number,reflectToAttribute:!0},disableSwipe:{type:Boolean,value:!1},expanded:{type:Boolean,value:!1,observer:"_broadcastMobileExpanded"},expandDisabled:{type:Boolean,value:!1},rowSwiped:{type:Boolean,value:!1},hideSelection:{type:Object,value:null},selectionClass:{type:String,value:null},leftClass:{type:String,value:"",computed:"setLeftClass(routeSource, rowData, selected)"},highlightRowOnFocus:{type:Boolean,observer:"_highlightRowOnFocus"},deferGrouping:{type:Boolean,value:!1},selectionOnLoad:{type:Boolean,value:!1},columnWidths:{type:Object,value:null},forceColumnWidths:{type:Boolean,value:!1},mobileExpandedDetails:{type:Object,value:null,observer:"expandMobileRow"},mobileSelectedDetails:{type:Object,value:null,observer:"selectMobileRow"},disableSelectionTabFocus:{type:Boolean,value:!1},disableAllFields:Boolean,hasTogglePlaceholder:Boolean,hasToggle:Boolean,togglePlaceholder:{type:Boolean,computed:"_hasTogglePlaceholder(hasTogglePlaceholder, hasToggle)"}}}},{key:"onRowSwiped",value:function(e){this.rowSwiped=e.detail.isOpen}},{key:"setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"setActionId",value:function(e){return e?"swipe-menu":""}},{key:"_buildRowObserver",value:function(e,t,i,n,o,r,s,a,l,u){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o&&void 0!==r&&void 0!==s&&void 0!==a&&void 0!==l&&void 0!==u)return this.buildRow(e,t,i,n,o,r,s,a,l,u)}},{key:"buildRow",value:function(){this.requiresModel&&!this.model||(this.$.row.item=void 0,this.$.row.groupDisplay=void 0,this.setPrimaryMobileColumnsIfMobileViewport(),this.setFullWidthIfGroupRow(),this.$.row.columnWidths=this.forceColumnWidths?this._cloneColumnWidths():this.columnWidths,this.$.row.itemClassMap=this.rowClassMap,this.$.row.groupDisplay=this.colsDisplay,this.$.row.group||(this.$.row.group=this.cols),this.$.row.item=this.cell)}},{key:"_setSelectableObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setSelectable(e,t)}},{key:"setSelectable",value:function(){this.selectable&&(this.registeredDataChangedHandler||(this.registeredDataChangedHandler=!0,this.selectionOnLoad?this.registerSelectionChangedHandler():Polymer.RenderStatus.afterNextRender(this,this.registerSelectionChangedHandler.bind(this))))}},{key:"registerSelectionChangedHandler",value:function(){this.$.selection.addEventListener("data-changed",this.selectionChangedHandler.bind(this))}},{key:"selectionChangedHandler",value:function(e){if(!Polymer.dom(e).rootTarget||"template"!==Polymer.dom(e).rootTarget.nodeName.toLowerCase()){var t=this.selected;this.internal=!0,this.selected=void 0!==e.detail.value[this.selectionType]?e.detail.value[this.selectionType]:e.detail.value,this.$.row.selected=this.selected,this.internal=!1;var i=t!==this.selected,n="data.checkbox"===e.detail.path||"data.radio"==e.detail.path;this.editFirstWhenSelected&&this.selected&&i&&this.editFirst(),this.selectionOnLoad&&this._selectedChangeByParent?Polymer.RenderStatus.afterNextRender(this,this.fireSetSelectionEvent.bind(this,i,n)):this.fireSetSelectionEvent(i,n)}}},{key:"_disableAllTableFieldsObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.disableAllTableFields(e,t)}},{key:"disableAllTableFields",value:function(e,t){if(t&&e){var i={};Object.keys(e).map(function(e){return i["record."+e]=!1}),this.$.row.itemEditableMap=i}}},{key:"editFirst",value:function(){var e=this.$.row.$$(this.cell).$$(this.editFirstWhenSelected);e&&"function"==typeof e.edit&&e.edit()}},{key:"fireSetSelectionEvent",value:function(e,t){this.fire("selection-changed",{selected:this.selected,selectionType:this.selectionType,Id:this.get("rowData."+this.selectionIdDataPath),bundleId:this.get("rowData."+this.parentIdDataPath),attributes:void 0===this.parentAttributesPath?void 0:this.get("rowData."+this.parentAttributesPath),group:this.grouper,changed:e,path:t,index:this.index,rowData:this.rowData,autoSelectGroupRows:!this._selectedChangeByParent})}},{key:"_setSelectedObserver",value:function(e,t,i,n,o,r,s,a){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o&&void 0!==r&&void 0!==s&&void 0!==a)return this.setSelected(e,t,i,n,o,r,s,a)}},{key:"setSelected",value:function(){this.selectable&&!this.internal&&(this._selectedChangeByParent=!0,this._setSelected(this.selected),this._selectedChangeByParent=!1)}},{key:"_setSelected",value:function(e){this.disabledData.constrained&&!0===e&&(this.internal=!0,this.$.row.fire("group-selected",{selected:!1}),e=!1,this.internal=!1);var t=new o("Configurator"===this.routeSource&&this.hasDeleteAction()).hide;if(null!=this.hideSelection){var i=new o(this.hideSelection).hide;Polymer.Base.extend(t,i)}this.disableSelectionTabFocus&&(this.$.selection.tabIndex="-1"),this.selectionData={hidden:t},this.selectionData[this.selectionType]=e,this.selectionData.disabled=this.disabledData.disabled||this.disabledData.constrained,this.$.selection.data=this.selectionData,void 0===this.$.selection.group&&(this.$.selection.group=[this.selectionType]),this.toggleClass("td",this.selectable&&!t.hidden||"invisible"===t.type,this.$.selectionContainer),this.toggleClass("innerTd",this.selectable&&!t.hidden||"invisible"===t.type,this.$.selection),this.toggleClass("selection",this.selectable&&!t.hidden||"invisible"===t.type,this.$.selection),this.selectionClass&&this.toggleClass(this.selectionClass,!0,this.$.selection)}},{key:"select",value:function(e){if(void 0===this.selectionData||!0!==this.selectionData.disabled){var t=Polymer.dom(e).rootTarget;"sb-group"===(t&&t.tagName?t.tagName.toLowerCase():"")&&this._setSelected(!this.selected),this._broadcastGroupSelected(this.selected),this._broadcastMobileSelected()}}},{key:"_broadcastGroupSelected",value:function(e){this._groupSelected=e,this.$.row.fire("group-selected",{selected:e,selectionDisabled:this.selectionDisabled,tableRow:this})}},{key:"expand",value:function(e){this.expandDisabled||this.rowSwiped||(this.expandPath=e.detail&&e.detail.preventer?Polymer.dom(e.detail.preventer).path:Polymer.dom(e).path,this.$.row.fire("group-expanded",{path:this.expandPath}))}},{key:"setPrimaryMobileColumnsIfMobileViewport",value:function(){this.$.row.numPrimary=this.primaryMobileCols.length,this.$.row.primaryItems=this.isMobileViewport()?this.primaryMobileCols:null,this.$.row.includePrimaryInSecondary=!!this.isMobileViewport()&&this.repeatPrimaryMobileCols}},{key:"expandMobileRow",value:function(){this.isMobileViewport()&&this.mobileExpandedDetails&&this.mobileExpandedDetails.expanded!==this.expanded&&(this.internalExpand=!0,this.$.row.fire("group-expanded",{path:this.mobileExpandedDetails.path}),this.internalExpand=!1)}},{key:"selectMobileRow",value:function(){if(this.isMobileViewport()&&this.mobileSelectedDetails){var e=this.mobileSelectedDetails.selected;e===this.selected&&e===this._groupSelected||this._broadcastGroupSelected(e)}}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport,this.ignoreViewportChange||this.setPrimaryMobileColumnsIfMobileViewport()}},{key:"_setGrouperObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setGrouper(e,t)}},{key:"setGrouper",value:function(){var e=!this.isMobileViewport()&&!!this.grouper;this.toggleClass("groupTr",e,this),this.toggleClass("groupTd",e,this.$.row),this.toggleClass("groupExpandTd",e,this.$.rowDiv),this.setGrouperToggle(e)}},{key:"setGrouperToggle",value:function(e){this._toggleGroupHandler=this._toggleGroupHandler||this.toggleGroupEventHandler.bind(this),this.$.rowDiv.removeEventListener("tap",this._toggleGroupHandler),e&&this.$.rowDiv.addEventListener("tap",this._toggleGroupHandler)}},{key:"toggleGroupEventHandler",value:function(e){this.$.row.toggleClass("expanded"),this.toggleClass("expanded"),this.fire("sb-row-group-tapped",{group:this.grouper})}},{key:"_setGrouperClassesObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.setGrouperClasses(e,t,i)}},{key:"setGrouperClasses",value:function(e){this.toggleClass("expanded",e,this.$.row),this.toggleClass("expanded",e,this)}},{key:"toggleRowDrawer",value:function(){this.set("rowData._transient_.optionDrawerExpanded",!this.rowData._transient_.optionDrawerExpanded),this.set("rowData._transient_.drawerIconClass",this.rowData._transient_.optionDrawerExpanded?"sf-icon-chevrondown":"sf-icon-chevronright")}},{key:"isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"displayRowActions",value:function(e){if(!e)return!0;if(!this.rowActions||0===this.rowActions.length)return!1;for(var t=0,i=this.rowActions.length;t<i;t++)if(this.rowActions[t].position==e&&!this.rowActions[t].hidden)return!0;return!1}},{key:"hasDeleteAction",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.rowActions[Symbol.iterator]();!(e=(n=o.next()).done);e=!0)return"Delete"===n.value.title}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"setFullWidthIfGroupRow",value:function(){this._isGrouperRow()&&(this.rowData.fullWidthItem="firstInnerTd")}},{key:"_configurationRequired",value:function(){return!("Configurator"!==this.routeSource||!this.rowData.configurationRequired||!this.selected||this.rowData.configured)}},{key:"setLeftClass",value:function(){if(this._configurationRequired()&&!this.rowData.added)return"left"}},{key:"_hasTogglePlaceholder",value:function(){return this.hasTogglePlaceholder&&!this.hasToggle}},{key:"_highlightRowOnFocus",value:function(){this.signaler=this.signaler||new r(this,"row",this.cell,"swipe-header"),this.signaler.signalOnFocus("sb-row-focus-signal",!this.highlightRowOnFocus)}},{key:"_isGrouperRow",value:function(){return!this.isMobileViewport()&&!!this.grouper}},{key:"_cloneColumnWidths",value:function(){if(!this.columnWidths)return null;if(!this._isGrouperRow())return JSON.parse(JSON.stringify(this.columnWidths));if(null==this.columnWidths[this.cols[0]])return null;var e=JSON.parse(JSON.stringify(this.columnWidths)),t=e[this.cols[0]];return t.width=100,t.unit="%",e}},{key:"_broadcastMobileExpanded",value:function(){!this.internalExpand&&this.domHost&&this.isMobileViewport()&&this.expandPath&&this.domHost.fire("sb-mobile-row-expanded",{expanded:this.expanded,path:[].concat(this.expandPath),index:this.index,id:this.get("rowData."+this.selectionIdDataPath)})}},{key:"_broadcastMobileSelected",value:function(){this.domHost&&this.isMobileViewport()&&this.domHost.fire("sb-mobile-row-selected",{selected:this.selected,index:this.index,id:this.get("rowData."+this.selectionIdDataPath)})}},{key:"notify",value:function(e){if(this.rowData){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value,a=this.get("rowData."+s);this.notifyPath("rowData."+s,a,!0)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[s.VIEWPORT_CHANGED]=this.viewportChanged,e}},{key:"observers",get:function(){return["_buildRowObserver(cell, cols, colsDisplay, rowData, model, primaryMobileCols, repeatPrimaryMobileCols, requiresModel, rowClassMap, columnWidths)","_setSelectableObserver(selectable, selectionOnLoad)","_setSelectedObserver(selected, selectable, selectionType, rowActions, routeSource, disabledData, hideSelection, selectionClass)","_setGrouperObserver(rowData, grouper)","_setGrouperClassesObserver(grouperExpanded, rowData, grouper)","_disableAllTableFieldsObserver(rowData.record, disableAllFields)"]}}]),a=e)),t("TableRow",a),Polymer(a)}}}),System.register("common/layout/sb-tabs/Tabs.js",["common/core/sb-page-container/PageContainer.js","common/core/Events.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.PageContainer},function(e){o=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Tabs",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-tabs",this.properties={tabs:Array,pageComponent:{type:String,value:null},pageData:{type:Object,value:{}},commonData:{type:Object,value:{}},selectedTabIndex:{type:Number,value:0},selectedPageIndex:{type:Number,value:0},tabsClass:{type:String,value:"horizontal layout center-justified"},usePagination:{type:Boolean,value:!1},paginationClass:{type:String,value:"horizontal layout center-justified"},viewport:{type:Object,observer:"_viewportChanged",value:function(){return i.getViewport()}},tabLimit:{type:Number,value:0},rendered:{type:Boolean,value:!1},overflowTab:Object,overflowTabClass:String,overflowTabMenuClass:String,menuMaskClass:String,bindingData:{type:Object,value:{}},bind:{type:Array,value:[]},attributes:{type:Array,value:[]},hideTabs:{type:Boolean,value:!1},contentContainerClass:String,tabContainerClass:String,pageElements:{type:Array,value:[]},overflowTabMenuDisabled:{type:Boolean,value:!1},overflowTabMenuLabelDisabled:{type:Boolean,value:!1}}}},{key:"_renderObserver",value:function(e,t,i,n,o,r,s){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o&&void 0!==r&&void 0!==s)return this.render(e,t,i,n,o,r,s)}},{key:"render",value:function(){this._enforceValidTabSelected(),this._buildTabs(),Polymer.dom(this.$.paperTabs).observeNodes(function(){this.rendered=!0,!this.tabs||this.tabs.length<=0||this._viewportChanged()}.bind(this))}},{key:"destroyTabs",value:function(){if(this.template)try{for(var e=Polymer.dom(this.$.pages),t=e.childNodes,i=0,n=t.length;i<n;i++)e.removeChild(t[i]);Polymer.dom.flush(),this.template=null,this.selectedTabIndex=0}catch(e){return}}},{key:"_enforceValidTabSelected",value:function(){(isNaN(this.selectedPageIndex)||this.tabs&&this.tabs.length<=this.selectedPageIndex||this.selectedPageIndex<0||this.selectedPageIndex%1!=0)&&(this.selectedPageIndex=0)}},{key:"_buildTabs",value:function(){this.template?this._initTemplateData(this.template):(this.template=document.createElement("template","dom-bind"),this._buildPages(this.template),this._initTemplateData(this.template),Polymer.dom(this.$.pages).appendChild(this.template),Polymer.dom.flush(),Polymer.dom(this.$.pages).observeNodes(function(e){for(var t=0,i=e.addedNodes.length;t<i;t++)this.pageElements=this.pageElements.concat(Polymer.dom(e.addedNodes[t]).childNodes);this.bindElementEvents(this.pageElements)}.bind(this)))}},{key:"setPageElements",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=(e||[])[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.pageElements.push(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"_initTemplateData",value:function(e){for(var t in e.pageData=this.pageData,e.commonData=this.commonData,this.bindingData)e[t]=this.bindingData[t];this.templateBindData(e)}},{key:"_buildPages",value:function(f){var p=f.content.ownerDocument;this._bind=[],this.tabs.forEach(function(e,t){var i=e.pageComponent||this.pageComponent;if(i){var n=p.createElement("div"),o=p.createElement(i);for(var r in Polymer.dom(o).setAttribute("name",e.name),Polymer.dom(o).setAttribute("label",e.label),Polymer.dom(o).setAttribute("tab-index",t),Polymer.dom(o).setAttribute("key",e.key),Polymer.dom(o).setAttribute("page-data","[[pageData."+e.name+"]]"),Polymer.dom(o).setAttribute("common-data","[[commonData]]"),this.bindingData)Polymer.dom(o).setAttribute(Polymer.CaseMap.camelToDashCase(r),"{{"+r+"}}");var s=e.attributes||this.attributes||{},a=!0,l=!1,u=void 0;try{for(var d,c=s[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value;Polymer.dom(o).setAttribute(h.name,h.value)}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}this.usePagination&&this.set("tabs."+t+".disabled",!0),this.appendBindData(e,o),Polymer.dom(n).appendChild(o),Polymer.dom(f.content).appendChild(n)}}.bind(this))}},{key:"appendBindData",value:function(e,t){var i=e.bind||this.bind;if(i){this._bind=this._bind.concat(i.filter(function(e){return this._bind.indexOf(e)<0}.bind(this)));var n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;Polymer.dom(t).setAttribute(Polymer.CaseMap.camelToDashCase(l),"{{"+l+"}}"),this._addComplexObserverEffect("updateData("+l+")")}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"templateBindData",value:function(e){this.requiresTemplateBindData=this._bind&&0<this._bind.length;var t=!0,i=!1,n=void 0;try{for(var o,r=this._bind[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;(this.__data__[s]&&this.__data__[s]!==this[s]||void 0===this[s])&&(this[s]=this.__data__[s]),void 0!==this[s]&&(this.requiresTemplateBindData=!1,e[s]=this[s])}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"displayPage",value:function(e){var t=Polymer.dom(this.$.paperTabs).querySelectorAll("paper-tab")[e];return null!=t&&"overflowTab"===t.id&&0!=e?this.selectedPageIndex:(this.selectedPageIndex=+e,e)}},{key:"setPaginationListener",value:function(){this.usePagination&&this.addEventListener("pagination-changed",this.changeTab.bind(this))}},{key:"changeTab",value:function(e){this._changeTab(e.detail.index)}},{key:"_changeTab",value:function(e){var t=Polymer.dom(this.$.paperTabs).node,i=Polymer.dom(t.querySelector("#overflowTab")).node,n=this.tabLimit,o=this.tabs.length;this.selectedTabIndex=e,this._ensureOverflowTabMenuDisabled(i),this._ensureOverflowSelection(),this.selectedTabIndex>=n&&n<o-1?(this._displayOverflowTabName(i,this.tabs[this.selectedTabIndex].label),t.selected=t.getElementsByTagName("paper-tab").length-1,this.usePagination&&(this.$$("#pagination").pageIndex=e,this.overflowTabMenuDisabled=!1,this.overflowTabMenuLabelDisabled=!1)):n<o-2&&this._displayOverflowTabName(i,this.tabs[n].label)}},{key:"_ensureOverflowTabMenuDisabled",value:function(e){for(var t=!0,i=this.tabLimit,n=this.tabs.length;i<n;i++)if(!this.tabs[i].disabled){t=!1;break}if(this.overflowTabMenuDisabled=t,this.overflowTabMenuDisabled)this.overflowTabMenuLabelDisabled=!0;else{var o=Polymer.dom(e).firstChild.textContent,r=this._getTabIndexByLabel(o);0<=r&&(this.overflowTabMenuLabelDisabled=this.tabs[r].disabled)}}},{key:"_ensureOverflowSelection",value:function(){for(var e=Polymer.dom(this.root).querySelectorAll("li"),t=0,i=e.length;t<i;t++){var n=this.selectedPageIndex===t&&e[t].classList.contains("overflow"),o=this.tabs[t].className.replace(" selected","");n&&(o+=" selected"),this.set("tabs."+t+".className",o)}}},{key:"closeMenu",value:function(e){var t=this.selectedPageIndex;this.overflowTabMenuClass="",!(this.menuMaskClass="")!==e&&t<this.tabLimit&&(this.selectedTabIndex=t)}},{key:"updateData",value:function(e){this.template&&e&&e.path&&this.template.set(e.path,e.value)}},{key:"selectTab",value:function(e){var t=parseInt(e.currentTarget.id);if(!Number.isInteger(t)||!this.tabs[t].disabled){var i=Polymer.dom(this.$.paperTabs.querySelector("#overflowTab")).node,n=this.tabLimit;if(Number.isInteger(t)){if(this.selectedPageIndex=t,this._deselectPreviouslySelectedTab(),Polymer.dom(this.$.pages).node.selected=t,this.set("tabs."+t+".className","overflow selected"),this.overflowTab=this.tabs[t],this.tabs[t].iconId){var o=this.$$("#"+this.tabs[t].iconId+"-overflow");this.toggleClass("hideIconClass",!1,o)}this._displayOverflowTabName(i,e.currentTarget.textContent),this.overflowTabClass="overflowTab",this.closeMenu(!0)}else this.tabs.length-1>n&&(this._deselectPreviouslySelectedTab(),this._displayOverflowTabName(i,this.tabs[n].label),this._ensureOverflowTabMenuDisabled(i))}}},{key:"_handleEvent",value:function(e){var t=e.currentTarget.getAttribute("data-tap-event"),i=e.currentTarget.getAttribute("id"),n=null!=t?t:"tab-"+Polymer.CaseMap.camelToDashCase(i);this.fire(n+"-tapped",{event:t,Id:i})}},{key:"showMenu",value:function(){this.overflowTabMenuClass="showOverflowTabMenu",this.menuMaskClass="showMenuMask"}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"_displayOverflowTabName",value:function(e,t){Polymer.dom(e).firstChild.textContent=t,this.overflowTabClass="overflowTab"}},{key:"_handleOverFlow",value:function(){var e=Polymer.dom(this.$.paperTabs).node,t=this.selectedPageIndex,i=Polymer.dom(e.querySelector("#overflowTab")).node,n=Polymer.dom(this.$$("#pagination")).node,o=this.tabLimit,r=this.tabs.length,s=void 0,a=void 0;this.overflowTabClass="";for(var l=0;l<r;l++){if(s="noOverflow",(a=o)<=l&&o<r-1&&(l===r-1&&(o<=t&&(a=t),this.overflowTab=this.tabs[a],this._displayOverflowTabName(i,this.tabs[a].label)),s="overflow"),o<=r&&(s+=" widthWithOverflow"),this.tabs[l].iconId){var u=this.$$("#"+this.tabs[l].iconId),d=!("noOverflow"==s||"overflow"==s&&o<=l&&l!=r-1);if(this.toggleClass("hideIconClass",d,u),"overflow"==s&&l===t){var c=this.$$("#"+this.tabs[l].iconId+"-overflow");this.toggleClass("hideIconClass",!1,c)}}this.tabs[l].disabled&&(s+=" disabled"),this.set("tabs."+l+".className",l===t?s+" iron-selected":s)}t<o||r-1===o&&t===o?(this.selectedTabIndex=t,this.set("tabs."+t+".className",this.tabs[t].className.replace(" selected",""))):o<=t&&(e.selected=r,this.overflowTabClass="overflowTab",this.set("tabs."+t+".className","overflow selected")),this.usePagination&&null!=n&&(n.pageIndex=t),this._ensureOverflowTabMenuDisabled(i)}},{key:"_handleSelectedChangedObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._handleSelectedChanged(e,t)}},{key:"_handleSelectedChanged",value:function(){this._enforceValidTabSelected(),this.fire("selected-page-changed",this.selectedPageIndex),this.fireTabSelected()}},{key:"fireTabSelected",value:function(){this.pageElements.length>this.selectedPageIndex&&this.pageElements[this.selectedPageIndex].fire("sb-tab-selected")}},{key:"_deselectPreviouslySelectedTab",value:function(){var e=parseInt(Polymer.dom(this.$.overflowTabMenu.querySelector(".selected")).node.id);Number.isInteger(e)&&this.set("tabs."+e+".className",this.tabs[e].className.replace(" selected",""))}},{key:"_viewportChanged",value:function(){this.rendered&&(this.viewport&&this.viewport.XL.up?this.tabLimit=7:this.viewport&&this.viewport.L.up?this.tabLimit=5:this.viewport&&this.viewport.M.up?this.tabLimit=4:this.viewport&&this.viewport.S.up?this.tabLimit=3:this.viewport&&this.viewport.XS.up&&(this.tabLimit=2),this._handleOverFlow())}},{key:"bindElementEvents",value:function(i){var n=i?i.length:0;if(0!=n){for(var e in this.fireTabSelected(),this.bindingData){for(var t=Polymer.CaseMap.camelToDashCase(e),o=0;o<n;o++)i[o].addEventListener(t+"-changed",function(e){e.detail.path&&this.domHost.set(e.detail.path,e.detail.value)}.bind(this));this.domHost.addEventListener(t+"-changed",function(e){if(e.detail.path)for(var t=0;t<n;t++)i[t].set(e.detail.path,e.detail.value)}.bind(this))}var r=!0,s=!1,a=void 0;try{for(var l,u=this._bind[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)for(var d=l.value,c=Polymer.CaseMap.camelToDashCase(d),h=0;h<n;h++)i[h].addEventListener(c+"-changed",function(e){e.detail.path&&this.domHost.set(e.detail.path,e.detail.value)}.bind(this))}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}this.requiresTemplateBindData&&this.templateBindData(this.template)}}},{key:"_propertyChanged",value:function(e,t){this.template&&-1!==this._bind.indexOf(e.split(".")[0])&&this.template.set(e,t)}},{key:"contentFilteredHandler",value:function(e,t){if(null!=e){var i=this._getTabIndexByLabel(e);i<0||(this.set("tabs."+i+".disabled",!t||this.usePagination),this.tabs[i]._disabled=!t,this._changeToNextEnabledTabQueued&&clearTimeout(this._changeToNextEnabledTabQueued),this._changeToNextEnabledTabQueued=setTimeout(this._changeToNextEnabledTab.bind(this),1))}}},{key:"_getTabIndexByLabel",value:function(e){for(var t=0,i=this.tabs.length;t<i;t++)if(this.tabs[t].label===e)return t;return-1}},{key:"_changeToNextEnabledTab",value:function(){var e=this._getNextEnabledPageIndex();this._changeTab(e)}},{key:"_getNextEnabledPageIndex",value:function(){for(var e=this.selectedPageIndex,t=this.tabs.length;e<t;e++)if(!this.tabs[e]._disabled)return e;for(var i=0,n=this.selectedPageIndex;i<n;i++)if(!this.tabs[i]._disabled)return i;return this.selectedPageIndex}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[o.VIEWPORT_CHANGED]=this.viewportChanged,e}},{key:"observers",get:function(){return["_renderObserver(tabs, pageComponent, pageData, commonData, bindingData, bind, attributes)","setPaginationListener(usePagination)","updateData(pageData.*)","updateData(commonData.*)","_handleSelectedChangedObserver(selectedPageIndex, pageElements)"]}}]),r=e)),t("Tabs",r),Polymer(r)}}}),System.register("common/layout/table-layout-builder/TableLayoutBuilder.js",["common/layout/tables/ImageCellSizer.js","common/Util.js"],function(e,t){var v,g,i;return{setters:[function(e){v=e.ImageCellSizer},function(e){g=e.Util}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,i,n,o,r,s,a,l,u,d,c){var h=12<arguments.length&&void 0!==arguments[12]&&arguments[12];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),this.parentElWidth=e,this.md=i,this.columns=t,this.actionsOnTheLeft=n,this.hasSelection=o,this.hasStandardDrawer=r,this.columnMetadata=s,this.columnConstants=a,this.isColumnResizingEnabled=l,this.fieldsetName=u,this.newColumnMdSizesMap=d,this.dimensionType=c,this.isResetAction=h}e("TableLayoutBuilder",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(f,[{key:"build",value:function(){this.layout={},this.availableWidth=this._getAvailableWidth();var e=this.totalColsWidth=0,t=this.columns.length,i=this.availableWidth/t,n=[],o=this._buildLayoutWithColumnSizing(g.deepClone(this.columns));if(t===o.length){for(var r=0;r<t;r++){var s=o[r],a=150,l=new v(this.md[s],0).getImageWidth(25);150<l?(a=l,n.push(s)):150<i&&(a=Math.ceil(i*this._getMultiplier(s))),e+=this.layout[s]=a}if(this.totalColsWidth+=e,150<i)for(var u=e-this.availableWidth,d=t-n.length,c=0,h=this.totalColsWidth=0;h<t;h++){var f=o[h],p=-1!==n.indexOf(f)?this.layout[f]:Math.ceil(this.layout[f]-u/d);c+=p,h==t-1&&(p-=c-this.availableWidth),this.layout[f]=p,this.totalColsWidth+=p}}return this.layout}},{key:"_buildLayoutWithColumnSizing",value:function(e){var t=this;if(this.isColumnResizingEnabled&&!this.isResetAction){var i={};this.columnMetadata&&0<this.columnMetadata.length&&null==this.newColumnMdSizesMap?this.columnMetadata.forEach(function(e){e[t.columnConstants.FieldSetMasterDetail][t.columnConstants.FieldSet]===t.fieldsetName&&(i[e[t.columnConstants.FieldName]]=e[t.columnConstants.FieldColumnSize])}):null!=this.newColumnMdSizesMap&&this.newColumnMdSizesMap[this.dimensionType]&&(i=g.deepClone(this.newColumnMdSizesMap[this.dimensionType])),0<Object.keys(i).length&&(e.forEach(function(e){i[e]?(t.layout[e]=i[e],t.totalColsWidth+=i[e]):(t.layout[e]=150,t.totalColsWidth+=150)}),e=e.filter(function(e){return!i[e]}))}return e}},{key:"_getAvailableWidth",value:function(){return this.parentElWidth-this._getStaticColsWidth()-12}},{key:"getTotalWidth",value:function(){return this.totalColsWidth+this._getStaticColsWidth()+10}},{key:"_getStaticColsWidth",value:function(){var e=135;return this.hasSelection&&(e+=30),this.hasStandardDrawer&&(e+=40),e}},{key:"getLeftOffset",value:function(){var e=40;return this.actionsOnTheLeft&&(e+=95),this.hasSelection&&(e+=30),e}},{key:"_getMultiplier",value:function(e){switch((this.md[e]?this.md[e].type:"currency").toUpperCase()){case"STRING":return 1.5;case"BOOLEAN":return 1;case"DATE":return 1.3;case"DOUBLE":case"CURRENCY":case"PERCENT":case"NUMBER":return 1.6;case"PICKLIST":case"MULTIPICKLIST":return 1.4;case"REFERENCE":case"TEXTAREA":default:return 1.6}}}]),i=f)),e("TableLayoutBuilder",i)}}}),System.register("common/layout/tables/ImageCellSizer.js",[],function(e,t){var o,r;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.metadata=e,this.labelMultiplier=null!=t?t:9}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},e("DEFAULT_WIDTH",60),e("DEFAULT_WIDTH",60),e("DEFAULT_HEIGHT",60),e("DEFAULT_HEIGHT",60),e("ImageCellSizer",(o(i,[{key:"getImageWidth",value:function(e){var t=this._getImageWidth(e,0);if(null!=t){for(var i=-1;i=Math.max(i,t.width),null!=(t=this._getImageWidth(e,t.end)););return this.hasInvalidWidth&&this._warnInvalidWidthParameter(),i}}},{key:"_getImageWidth",value:function(e,t){if(this.metadata){var i=this._getImageFunctionStart(t);if(-1!==i){var n=this._getImageFunctionEnd(i),o=this.metadata.calculatedFormula.substring(i,n).split(","),r=this._getWidthFromImageFunctionArgs(o);e=null!=e?e:0;var s=this.metadata.label.length*this.labelMultiplier;return{width:Math.max(r,s)+e,end:n}}}}},{key:"_getImageFunctionStart",value:function(e){return this.metadata.calculatedFormula?this.metadata.calculatedFormula.toLowerCase().indexOf("image(",e):-1}},{key:"_getImageFunctionEnd",value:function(e){var t=this.metadata.calculatedFormula?this.metadata.calculatedFormula.toLowerCase():null;if(!t)return-1;for(var i=0,n=0,o=e,r=t.length;o<r;o++)if("("===t.substring(o,o+1)?i++:")"===t.substring(o,o+1)&&n++,0<i&&i===n)return o;return-1}},{key:"_getWidthFromImageFunctionArgs",value:function(e){if(e.length<=3)return 60;var t=void 0;try{t=parseInt(e[3].trim())}catch(e){return this.hasInvalidWidth=!0,60}return isNaN(t)?(this.hasInvalidWidth=!0,60):t}},{key:"_warnInvalidWidthParameter",value:function(){console.warn('May not have properly sized the column to fit the image specified by this formula: "'+this.metadata.calculatedFormula+"\"\nREASON: At least one of the formula's IMAGE function(s) has its width parameter (4th argument) defined from a field.\nSOLUTION: All of the formula's IMAGE function(s) should have its width parameter either omitted or hardcoded to a number.")}}]),r=i)),e("ImageCellSizer",r)}}}),System.register("common/layout/tables/RowFieldSelector.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.row=e,this.fields=t,this.rowIndex=i,this.rowIndexAttribute=n||"index"}e("RowFieldSelector",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(s,[{key:"selectFirstEditableField",value:function(){var e=this._selectEditableFields();return this._selectNextEditableField(e,0)}},{key:"selectLastEditableField",value:function(){var e=this._selectEditableFields();return this._selectPreviousEditableField(e,e.length-1)}},{key:"selectNextEditableField",value:function(e){var t=this._selectEditableFields(),i=t.indexOf(e),n=0<=i?i+1:-1;return this._selectNextEditableField(t,n)}},{key:"selectPreviousEditableField",value:function(e){var t=this._selectEditableFields(),i=t.indexOf(e),n=0<=i?i-1:-1;return this._selectPreviousEditableField(t,n)}},{key:"_selectEditableFields",value:function(){return this.fields.filter(function(e){return e.isEditable()})||[]}},{key:"_selectNextEditableField",value:function(e,t){return 0<=t&&t<e.length?e[t]:this._selectFirstEditableNextRow()}},{key:"_selectPreviousEditableField",value:function(e,t){return 0<=t&&t<e.length?e[t]:this._selectLastEditablePreviousRow()}},{key:"_selectFirstEditableNextRow",value:function(){var e=this._selectRowByIndex(this.rowIndex+1),t=e?e.selector:null;if(t)return t.selectFirstEditableField()}},{key:"_selectLastEditablePreviousRow",value:function(){var e=this._selectRowByIndex(this.rowIndex-1),t=e?e.selector:null;if(t)return t.selectLastEditableField()}},{key:"selectFirstEditableField",value:function(){var e=this._selectEditableFields();return this._selectNextEditableField(e,0)}},{key:"selectLastEditableField",value:function(){var e=this._selectEditableFields();return this._selectPreviousEditableField(e,e.length-1)}},{key:"_selectRowByIndex",value:function(e){return s._selectTableRowByIndex(this.row.domHost,this.row.tagName.toLowerCase(),this.rowIndexAttribute,e)}}],[{key:"selectFirstEditableFieldInFirstRow",value:function(e,t,i){var n=s._selectTableRowByIndex(e,t,i,0),o=n?n.selector:null;if(o)return o.selectFirstEditableField()}},{key:"selectLastEditableFieldInLastRow",value:function(e,t,i,n){var o=s._selectTableRowByIndex(e,t,n,i-1),r=o?o.selector:null;if(r)return r.selectLastEditableField()}},{key:"_selectTableRowByIndex",value:function(e,t,i,n){return e.$$(t+"["+i+'="'+n+'"]')}}]),i=s)),e("RowFieldSelector",i)}}}),System.register("common/layout/tables/TableClassBuilder.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.columns=e,this.firstLastClassSuffix=t,this.typeByColumnMap=i,this.allColumnClasses=n||[],this.useColumnsIndexAsKey=o||!1}e("TableClassBuilder",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(r,[{key:"build",value:function(){var e={};return this._appendTypeClass(e),this._appendFirstAndLastColumnClasses(e),this._appendAllColumnClasses(e),this._addWidthStyles(e),e}},{key:"_appendTypeClass",value:function(e){if(this.typeByColumnMap){var t=!1,i=0,n=!0,o=!1,r=void 0;try{for(var s,a=this.columns[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=this.typeByColumnMap[l],d=this._isNumericType(u),c=this._isBooleanType(u),h=this.useColumnsIndexAsKey?i++:l;d?this._appendClass(e,h,"numericCell"):c?this._appendClass(e,h,"checkboxCell"):t&&this._appendClass(e,h,"afterNumericCell"),t=d}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"_appendFirstAndLastColumnClasses",value:function(e){var t="firstInner"+this.firstLastClassSuffix,i="lastInner"+this.firstLastClassSuffix,n="secondInner"+this.firstLastClassSuffix;this._appendClass(e,this.useColumnsIndexAsKey?0:this.columns[0],t),this._appendClass(e,this.useColumnsIndexAsKey?this.columns.length-1:this.columns[this.columns.length-1],i),1<this.columns.length&&this._appendClass(e,this.useColumnsIndexAsKey?1:this.columns[1],n)}},{key:"_appendAllColumnClasses",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.columns[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value,a=!0,l=!1,u=void 0;try{for(var d,c=this.allColumnClasses[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value;this._appendClass(e,s,h)}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"_addWidthStyles",value:function(e){var t=0,i=!0,n=!1,o=void 0;try{for(var r,s=this.columns[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=this.typeByColumnMap[a].split(":");2===l.length&&this._setWidthStyle(e,this.useColumnsIndexAsKey?t:a,l[1]),t++}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}},{key:"_isNumericType",value:function(e){return"double"===(e=e.split(":")[0])||"number"===e||"currency"===e||"percent"===e}},{key:"_isBooleanType",value:function(e){return"boolean"===(e=e.split(":")[0])||"checkbox"===e}},{key:"_appendClass",value:function(e,t,i){e[t]||(e[t]={});var n=e[t].class;e[t].class=n?n+" "+i:i}},{key:"_setWidthStyle",value:function(e,t,i){e[t]||(e[t]={}),e[t].style="width:"+i+"px"}}]),i=r)),e("TableClassBuilder",i)}}}),System.register("common/rules/operators/OpContains.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e}e("OpContains",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){if(null==e||null==t)return!1;var i=String(e).toLowerCase(),n=String(t).toLowerCase();return-1!==i.indexOf(n)}}]),i=t)),e("OpContains",i)}}}),System.register("common/rules/operators/OpEndsWith.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e}e("OpEndsWith",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){if(null==e||null==t)return!1;var i=String(e).toLowerCase(),n=String(t).toLowerCase();return-1!==i.indexOf(n,i.length-n.length)}}]),i=t)),e("OpEndsWith",i)}}}),System.register("common/rules/operators/OpEquals.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e,this.testValueCache={},this.fieldValueCache={}}e("OpEquals",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){if(null==e||null==t)return e==t;if(e instanceof Date)return e.getTime()===new Date(t).getTime();if("boolean"==typeof e)return e===("true"===String(t).toLowerCase());if("string"!=typeof e||"string"!=typeof t)return("number"==typeof e||e instanceof Number)&&e.valueOf()==t;var i=t.toLowerCase(),n=e.toLowerCase();return null==this.testValueCache[i]&&(this.testValueCache[i]=this.valueFor(i)),null==this.fieldValueCache[n]&&(this.fieldValueCache[n]=this.valueFor(n)),this.testValueCache[i].equals(this.fieldValueCache[n])}},{key:"valueFor",value:function(e){return-1<e.indexOf(",")&&0!=e.indexOf('"')&&e.lastIndexOf('"')!=e.length-1?{valueType:"Multi",valueSet:e.split(",").map(function(e){return e.trim()}),equals:function(e){return"Multi"!==e.valueType?-1!=this.valueSet.indexOf(e.value):e.valueSet.some(function(e){return-1!=this.valueSet.indexOf(e)},this)}}:{valueType:"Single",value:e,equals:function(e){return this.value===e.value}}}}]),i=t)),e("OpEquals",i)}}}),System.register("common/rules/operators/OpGreaterThan.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e}e("OpGreaterThan",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){if(null==e||null==t)return!1;if("number"==typeof e||e instanceof Number)return e.valueOf()>t;if(e instanceof Date)return e>new Date(t);if("string"!=typeof e)return!1;var i=Date.parse(e),n=Date.parse(t);return i==i&&n==n?n<i:e.toLowerCase()>t.toLowerCase()}}]),i=t)),e("OpGreaterThan",i)}}}),System.register("common/rules/operators/OpGreaterThanEquals.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e}e("OpGreaterThanEquals",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){if(null==e||null==t)return!1;if("number"==typeof e||e instanceof Number)return e.valueOf()>=t;if(e instanceof Date)return e>=new Date(t);if("string"!=typeof e)return!1;var i=Date.parse(e),n=Date.parse(t);return i==i&&n==n?n<=i:t<=e}}]),i=t)),e("OpGreaterThanEquals",i)}}}),System.register("common/rules/operators/OpLessThan.js",["common/rules/operators/OpGreaterThanEquals.js"],function(e,t){var i,o;return{setters:[function(e){i=e.OpGreaterThanEquals}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e,this.gte=new i}e("OpLessThan",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){return null!=e&&null!=t&&("number"==typeof e||"string"==typeof e||e instanceof Date||e instanceof Number)&&!this.gte.evaluate(e,t)}}]),o=t)),e("OpLessThan",o)}}}),System.register("common/rules/operators/OpLessThanEquals.js",["common/rules/operators/OpGreaterThan.js"],function(e,t){var i,o;return{setters:[function(e){i=e.OpGreaterThan}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e,this.gt=new i}e("OpLessThanEquals",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){return null!=e&&null!=t&&("number"==typeof e||"string"==typeof e||e instanceof Date||e instanceof Number)&&!this.gt.evaluate(e,t)}}]),o=t)),e("OpLessThanEquals",o)}}}),System.register("common/rules/operators/OpNotEquals.js",["common/rules/operators/OpEquals.js"],function(e,t){var i,o;return{setters:[function(e){i=e.OpEquals}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e,this.equals=new i}e("OpNotEquals",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){return!this.equals.evaluate(e,t)}}]),o=t)),e("OpNotEquals",o)}}}),System.register("common/rules/operators/OpStartsWith.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e}e("OpStartsWith",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){return null!=e&&null!=t&&0===String(e).toLowerCase().indexOf(String(t).toLowerCase())}}]),i=t)),e("OpStartsWith",i)}}}),System.register("common/rules/operators/OperatorsUtils.js",["common/rules/operators/OpEquals.js","common/rules/operators/OpNotEquals.js","common/rules/operators/OpLessThan.js","common/rules/operators/OpLessThanEquals.js","common/rules/operators/OpGreaterThan.js","common/rules/operators/OpGreaterThanEquals.js","common/rules/operators/OpStartsWith.js","common/rules/operators/OpEndsWith.js","common/rules/operators/OpContains.js"],function(e,t){var i,o,r,s,a,l,u,d,c,h;return{setters:[function(e){i=e.OpEquals},function(e){o=e.OpNotEquals},function(e){r=e.OpLessThan},function(e){s=e.OpLessThanEquals},function(e){a=e.OpGreaterThan},function(e){l=e.OpGreaterThanEquals},function(e){u=e.OpStartsWith},function(e){d=e.OpEndsWith},function(e){c=e.OpContains}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.key=e,this.OP_EQ="equals",this.OP_NEQ="not equals",this.OP_LT="less than",this.OP_LTE="less or equals",this.OP_GT="greater than",this.OP_GTE="greater or equals",this.OP_SW="starts with",this.OP_EW="ends with",this.OP_CONT="contains"}e("OperatorsUtils",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"getInstance",value:function(){switch(this.key){case this.OP_EQ:return new i(this.key);case this.OP_NEQ:return new o(this.key);case this.OP_LT:return new r(this.key);case this.OP_LTE:return new s(this.key);case this.OP_GT:return new a(this.key);case this.OP_GTE:return new l(this.key);case this.OP_SW:return new u(this.key);case this.OP_EW:return new d(this.key);case this.OP_CONT:return new c(this.key);default:return null}}},{key:"getInverseInstance",value:function(){switch(this.key){case this.OP_EQ:return new i(this.key);case this.OP_NEQ:return new o(this.key);case this.OP_LT:return new a(this.key);case this.OP_LTE:return new l(this.key);case this.OP_GT:return new r(this.key);case this.OP_GTE:return new s(this.key);case this.OP_SW:return new u(this.key);case this.OP_EW:return new d(this.key);case this.OP_CONT:return new c(this.key);default:return null}}}]),h=t)),e("OperatorsUtils",h)}}}),System.register("common/services/sb-field-md/FieldMetadata.js",["common/core/AppContext.js"],function(t,e){var i,o;return{setters:[function(e){i=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FieldMetadata",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-field-md",this.properties={fields:Array,object:String,md:{type:Object,notify:!0},error:{type:String,notify:!0},background:{type:Boolean,value:!1},doNotFixObjectName:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.$.describe.addEventListener("describe-changed",function(e){for(var t=e.detail.value.md,i=e.detail.value.fields,n=[],o={},r=0,s=i.length;r<s;r++)if(t[i[r]]){var a=i[r].split(".")[0],l=i[r].split(".")[1];o[a]||(o[a]={}),n.push(t[i[r]]),o[a][l]=t[i[r]]}this.md={fields:n,fieldsByObject:o}}.bind(this)),this.$.describe.addEventListener("error-changed",function(e){this.error=e.detail.value}.bind(this))}},{key:"initFieldSetDescribe",value:function(){var i=[];this.fields.forEach(function(e){var t=e.split(".");2===t.length?i.push(this.buildFieldList(t[0],t[1])):i.push(this.buildFieldList(this.object,e))}.bind(this)),this.$.describe.fields=i}},{key:"buildFieldList",value:function(e,t){return this.doNotFixObjectName||!e.endsWith("__c")||e.startsWith(this.prefix)?e+"."+t:this.prefix+e+"."+t}},{key:"prefix",get:function(){return i.org.prefix?i.org.prefix+"__":""}},{key:"observers",get:function(){return["initFieldSetDescribe(fields)"]}}]),o=e)),t("FieldMetadata",o),Polymer(o)}}}),System.register("common/services/sb-job-checker/JobChecker.js",["quotes/models/SafeClientCache.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.put,o=e.clear}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}"Completed","Failed","Aborted",t("JobChecker",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-job-checker",this.properties={spinner:{type:Boolean,value:!1},useSpinner:{type:Boolean,value:!0},data:Object,status:String,result:{type:Object,notify:!0},error:{type:String,notify:!0},asyncNumList:{type:Array,value:[]},firstStatusTime:Number,lastStatusTime:Number}}},{key:"_useSpinner",value:function(){return this.spinner&&this.useSpinner}},{key:"ready",value:function(){this.firstStatusTime=Date.now(),this.lastStatusTime=Date.now(),this._setLoadingSpinner(!1),this.$.service.addEventListener("response-changed",function(e){this._checkStatus(e)}.bind(this)),this.$.service.addEventListener("error-changed",function(e){this.error=e.detail.value,this._setLoadingSpinner(!1)}.bind(this))}},{key:"_setLoadingSpinner",value:function(e){this.spinner=e,i("RootState","showSpinnerMessage",e),!1===e&&o("RootState","spinnerStatus"),this.$.loadingSpinner.show=this._useSpinner()}},{key:"_ping",value:function(e){this._setLoadingSpinner(!0),this.$.service.background=!0,this.$.service.model=void 0,this.$.service.model=e}},{key:"_checkStatus",value:function(e){var t=e.detail.value;if(null!=t){var i=t.job.Id||t.jobId;if(this._setJobStatus(t.job.Status),this._isFinished())if(this._isFailure())this.error={message:t.job.ExtendedStatus},this._setLoadingSpinner(!1);else{if(null!=t.payload){this.result=t;for(var n=0;n<this.asyncNumList.length;n++)this.cancelAsync(this.asyncNumList[n])}this._getStatusMessages(),this._setLoadingSpinner(!1),null!=t.payload&&this.fire("job-completed")}else{this.lastStatusTime=Date.now(),this.data.jobId=i,this._getStatusMessages();var o=this.async(function(){this._ping(this.data)}.bind(this),1e3);this.asyncNumList.push(o)}}}},{key:"_setJobStatus",value:function(e){this.status=e;var t=this._convertJobStatus(e);i("RootState","spinnerStatus",t)}},{key:"_convertJobStatus",value:function(e){return{Queued:"Waiting",Holding:"Waiting",Aborted:"Cancelled"}[e]||e}},{key:"_getStatusMessages",value:function(){var e=Date.now()-this.lastStatusTime;console.log("Record Id: "+this.data.recordId+" Job Type: "+this.data.jobType+" [Job Id: "+this.data.jobId+" - Status:"+this.status+"] Time : "+(this.lastStatusTime-this.firstStatusTime)+" [Wait Time: "+e+"]")}},{key:"_isFailure",value:function(){return this.status&&("Aborted"==this.status||"Failed"==this.status)}},{key:"_isFinished",value:function(){return this.status&&("Completed"==this.status||this._isFailure())}},{key:"observers",get:function(){return["_ping(data)"]}}]),r=e)),t("JobChecker",r),Polymer(r)}}}),System.register("common/services/sb-line-editor-read/LineEditorReader.js",["common/data/cache/Cache.js","common/data/client/ConnectionClient.js","common/core/AppContext.js"],function(t,e){var o,n,i,r;function s(e,t){var i=o.get("LineEditor",e,"promise");return i||function(t,i){var e=new n(i).getConnection().then(function(e){return new window.SB.QuoteDAO(i,e)}).then(function(e){return e.loadEditorModel(t)});return o.add("LineEditor",t,e,"promise"),e}(e,t)}function a(e){return e.substring(0,15)}return{setters:[function(e){o=e.Cache},function(e){n=e.ConnectionClient},function(e){i=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LineEditorReader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-line-editor-read",this.properties={quoteId:String,background:{type:Boolean,value:!1},lineEditorModel:{type:Object,notify:!0},error:{type:Array,notify:!0}}}},{key:"_updateObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._update(e,t)}},{key:"update",value:function(e){e&&this.clearCache(),this._update(this.quoteId)}},{key:"_update",value:function(e){var t=this;this.$.loadingSpinner.show=!0;var i=a(e),n=o.get("LineEditor",i);n?this.async(function(){t.lineEditorModel=n,t.$.loadingSpinner.show=!1}):s(i,this.prefix).then(function(e){"Incomplete"===e?t._retryUpdateLater(i):(t.cache(i,e),t.lineEditorModel=e,t._setIsLastReadQuoteUnopened(),t.$.loadingSpinner.show=!1,t.startingPolling=null)}).catch(function(e){this.$.loadingSpinner.show=!1,this.fire("toggle-page-loaded",{pageLoaded:!0}),this.error=[e.message||e]}.bind(this))}},{key:"clearCache",value:function(){var e=a(this.quoteId);this._clearedLineEditor=o.get("LineEditor",e),o.remove("LineEditor",e,"promise"),o.remove("LineEditor",e,"value")}},{key:"restoreCache",value:function(){if(this._clearedLineEditor){var e=a(this.quoteId);this.cache(e,this._clearedLineEditor),this._clearedLineEditor=null}}},{key:"cache",value:function(e,t){o.add("LineEditor",a(e),t,"value",this)}},{key:"_setIsLastReadQuoteUnopened",value:function(){this.isLastReadQuoteUnopened=this.lineEditorModel.quote.record[this.lineEditorModel.settings.developerPrefix+"Unopened__c"],this.lineEditorModel.quote.record[this.lineEditorModel.settings.developerPrefix+"Unopened__c"]=!1}},{key:"_retryUpdateLater",value:function(e){var t=this;this.startedPolling=this.startedPolling||Date.now();var i=Date.now()-this.startedPolling;this.async(function(){console.log("Reading Quote Id: "+e+" [Wait Time: "+i+"]"),t.update(!0)},1e3)}},{key:"observers",get:function(){return["_updateObserver(quoteId, background)"]}},{key:"prefix",get:function(){return i.org.prefix?i.org.prefix:""}}]),r=e)),t("LineEditorReader",r),Polymer(r)}}}),System.register("common/services/sb-product-rules-quote-line-adder/ProductRulesQuoteLineAdder.js",["common/data/format/DataBuilder.js","common/data/minimize/QuoteMinimizer.js","common/aggregate/quote-aggregator/QuoteAggregator.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.DataBuilder},function(e){o=e.QuoteMinimizer},function(e){e.QuoteAggregator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductRulesQuoteLineAdder",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-rules-quote-line-adder",this.properties={quote:Object,productIds:Array,groupKey:{type:Number,value:-1},response:{type:Object,notify:!0},linesAddedByRules:{type:Object,notify:!0}}}},{key:"ready",value:function(){this.$.service.addEventListener("response-changed",function(e){this.linesAddedByRules=e.detail.value}.bind(this)),this.$.service.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message])}.bind(this))}},{key:"_addLinesObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.addLines(e,t)}},{key:"addLines",value:function(){var e=new i;e.add("productIds",this.productIds),null!=this.quote.targetGroupKey&&0<=this.quote.targetGroupKey&&e.add("groupKey",this.quote.targetGroupKey);var t=new o(this.quote,this.productIds,this.quote.targetGroupKey);this.quote=t.reduceQuote(!1),e.addQuote("quote",this.quote),this.$.service.model=e.build(),this.quote=t.revertQuote()}},{key:"observers",get:function(){return["_addLinesObserver(quote, productIds)"]}}]),r=e)),t("ProductRulesQuoteLineAdder",r),Polymer(r)}}}),System.register("common/services/sb-search-model-load/SearchModelLoader.js",["common/data/format/DataBuilder.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js"],function(t,e){var o,r,i;return{setters:[function(e){o=e.DataBuilder},function(e){r=e.QuoteLineAggregator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SearchModelLoader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-search-model-load",this.properties={quote:Object,sendQuoteRecord:{type:Boolean,value:!1},lineAggregationMethod:{type:String,value:null},processId:{type:String,value:null},actionId:{type:String,value:null},searchModel:{type:Object,notify:!0},filters:{type:Array},fieldSet:{type:String},error:{type:Array,notify:!0}}}},{key:"ready",value:function(){this.$.service.addEventListener("response-changed",function(e){this.searchModel=e.detail.value}.bind(this)),this.$.service.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"_loadObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.load(e,t,i)}},{key:"load",value:function(){this.$.service.uid=null;var e=(new o).add("processId",this.processId).add("actionId",this.actionId).add("filters",this.filters).add("fieldSet",this.fieldSet);if(this.sendQuoteRecord?e.addObject("quote",this.quote.record):e.addQuote("quote",this.quote),this.lineAggregationMethod){var t=new r(this.quote);if(t[this.lineAggregationMethod]){var i=t[this.lineAggregationMethod]();i&&e.addObject("aggregateLineData",i,void 0,void 0,!0)}}this.$.service.context=e.build()}},{key:"observers",get:function(){return["_loadObserver(quote, processId, actionId)"]}}]),i=e)),t("SearchModelLoader",i),Polymer(i)}}}),System.register("common/services/sb-search-model-select/SearchModelSelector.js",["common/data/format/DataBuilder.js"],function(t,e){var i,o;return{setters:[function(e){i=e.DataBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SearchModelSelector",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-search-model-select",this.properties={quote:Object,sendQuoteRecord:{type:Boolean,value:!1},stripQuoteLines:{type:Boolean,value:!1},selectedProducts:{type:Object,notify:!0},selectedProductList:Array,error:{type:Array,notify:!0},result:{type:Object,notify:!0},targetGroupKey:{type:Number,value:null},quoteProcess:{type:String,value:null},saver:String,background:{type:Boolean,value:!0},useCache:{type:Boolean,value:!0},usesClientCalculator:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.$.service.addEventListener("response-changed",function(e){this.result=e.detail.value}.bind(this)),this.$.service.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"_invokeSaverObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.invokeSaver(e,t)}},{key:"invokeSaver",value:function(){var e=[];for(var t in this.selectedProducts)e.push(this.selectedProducts[t]);this.selectedProductList=e}},{key:"_invokeSaver",value:function(){!0===this.useCache&&(this.$.service.uid=this.quote.record.Id.substring(0,15));var e=this.quote.lineItems,t=(new i).addObject("products",this.selectedProductList).add("targetGroupKey",this.targetGroupKey).addObject("quoteProcess",this.quoteProcess);this.sendQuoteRecord?t.addObject("quoteRecord",this.quote.record):(this.stripQuoteLines&&this.usesClientCalculator&&(this.quote.lineItems=[],this.quote.partialVO=0!=e.length),t.addQuote("quote",this.quote)),this.$.service.model=t.build(),this.quote.lineItems=e,this.quote.partialVO=!1}},{key:"observers",get:function(){return["_invokeSaverObserver(selectedProducts, quote)","_invokeSaver(selectedProductList)"]}}]),o=e)),t("SearchModelSelector",o),Polymer(o)}}}),System.register("products/config/message/ProductMessenger.js",["products/config/viewmodel/ProductViewModel.js","common/layout/fields/FieldSetHandler.js","common/core/sb-page-container/PageContainer.js"],function(e,t){var i,s,S,o;return{setters:[function(e){i=e.ProductViewModel},function(e){s=e.FieldSetHandler},function(e){S=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.quote=e,this.product=t,this.prefix=i,this.extender=o,this.currencyIsoCode=n,this.dynamicOptions=[],this.featureOptionIds=[],this.product&&!this.product.initialized&&this._initializeProduct(this.product),this.fieldSetHandler=new s(this.product.optionFieldSets,"OptionConfiguration","OptionConfigurationTablet","OptionConfigurationPhone"),this.defaultOptionPaths=["selected","record."+this.prefix+"Quantity__c"],this.additionalOptionPaths=[]}e("ProductMessenger",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(r,[{key:"getRequest",value:function(){var e={quote:this.quote.record};return this.product&&(e.product={configuredProductId:this.product.configuration.configuredProductId,lineItemId:this.product.configuration.lineItemId,lineKey:this.product.configuration.lineItemKey,configurationAttributes:this._createConfigAttributesMap(),optionConfigurations:this._createFeatureOptionsMap(),configurationData:{}},e.products=[],this._appendReadOnlyProperties(e,this.product.configuration)),e}},{key:"getResponse",value:function(e){if(e){var t=[];if(this.dynamicOptions=[],this.featureOptionIds=[],e.products)for(var i=0,n=e.products.length;i<n;i++)t.push(this._cloneProduct(i));this._extendResponseQuote(e.quote),this._extendResponseProduct(this.product,e.product);var o={quote:this.quote,product:this.product,products:this._extendResponseProducts(e.products,t),optionNotifications:this._getResponseOptionPaths()};return 0<this.dynamicOptions.length&&0<this.featureOptionIds.length&&(o.dynamicOptions=this.dynamicOptions,o.featureOptionIds=this.featureOptionIds),o}}},{key:"_appendReadOnlyProperties",value:function(e,t){e.readOnly={};var i=this._getMatchingQuoteLine(t);i&&(e.readOnly.line=i.record)}},{key:"_getMatchingQuoteLine",value:function(t){if(null==t||null==t.lineItemKey)return null;var e=this.quote.lineItems.filter(function(e){return e.key===t.lineItemKey}.bind(this));return 1===e.length?e[0]:null}},{key:"_createConfigAttributesMap",value:function(){for(var e={},t=0,i=this.product.configurationAttributes.length;t<i;t++)e[this.product.configurationAttributes[t].targetFieldName]=null;return this.extender.extend(e,this.product.configuration.configurationData),e}},{key:"_createFeatureOptionsMap",value:function(){for(var e={},t=this.product.features,i=0,n=t.length;i<n;i++){var o=t[i].record.Name;e[o]=[];var r=t[i]._transient_.optionConfigurations;delete t[i]._transient_.changedExternally,"Add"===t[i].optionSelectionMethod?this._mixInUnselectedOptionsToAdd(e[o],t[i].record.Id,r):r&&this._pushOptionConfigurations(e[o],r,"Click"===t[i].optionSelectionMethod)}return e}},{key:"_pushOptionConfigurations",value:function(e,t,i){for(var n=0,o=t.length;n<o;n++){var r=i?void 0:t[n].index;e.push(this._createPseudoOptionConfiguration(t[n],r))}i||e.push({productId:null,Quantity:1,configurationData:{}})}},{key:"_createPseudoOptionConfiguration",value:function(e,t){var i={optionId:e.record.Id,selected:e.selected,ProductCode:e.record[this.prefix+"ProductCode__c"],ProductName:e.record[this.prefix+"ProductName__c"],Quantity:e.record[this.prefix+"Quantity__c"],configurationData:{}};return void 0!==t&&(i.index=t),this._appendReadOnlyProperties(i,e),i}},{key:"_mixInUnselectedOptionsToAdd",value:function(n,o,r){var s=this;this.product.options.forEach(function(t){if((t.record[s.prefix+"Feature__c"]||"Other")===o){var e=r.filter(function(e){return e.record.Id===t.record.Id});if(e.length)for(var i=0;i<e.length;i++)n.push(s._createPseudoOptionConfiguration(e[i],e[i].index||i));else t.selected=!1,n.push(s._createPseudoOptionConfiguration(t,0))}})}},{key:"_extendResponseQuote",value:function(e){null!=e&&this.extender.extend(this.quote.record,this._sanitizeObject(e))}},{key:"_extendResponseProduct",value:function(e,t,i){t&&(this._extendResponseConfigurationData(e,t.configurationData),this._extendResponseConfigurationAttributes(e,t.configurationAttributes),this._extendResponseOptionConfigurations(e,t.optionConfigurations,i))}},{key:"_extendResponseConfigurationData",value:function(e,t){null!=t&&this.extender.extend(e.configuration.externalConfigurationData,this._sanitizeObject(t))}},{key:"_extendResponseConfigurationAttributes",value:function(e,t){null!=t&&this.extender.extend(e.configuration.configurationData,this._sanitizeObject(t))}},{key:"_extendResponseOptionConfigurations",value:function(i,e,n){var o=this,r=void 0,s={};for(var t in e){var a=e[t],l=!0,u=!1,d=void 0;try{for(var c,h=a[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var f=c.value,p=f.optionId;p?(s[p]=s[p]||[],s[p].push(f)):f.productId&&this._createDynamicOption(f,t)}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}}var v=i.options,g=!0,y=!1,m=void 0;try{for(var b,_=function(){var t=b.value,e=s[t.record.Id];if(!e)return"continue";e.forEach(function(e){r||null==e.configurationData||(r=o.fieldSetHandler.getByViewport(S.getViewport()).fields),o._extendResponseOptionConfiguration(i,t,e,r,n)})},C=v[Symbol.iterator]();!(g=(b=C.next()).done);g=!0)_()}catch(e){y=!0,m=e}finally{try{!g&&C.return&&C.return()}finally{if(y)throw m}}}},{key:"_createDynamicOption",value:function(e,t){var i=this.product.features.find(function(e){return e.record.Name===t});this.featureOptionIds.push(i.record.Id+":"+e.productId),this.dynamicOptions.push({productId:e.productId,featureId:i.record.Id,Quantity:isNaN(e.Quantity)?1:e.Quantity,configurationData:e.configurationData})}},{key:"_extendResponseOptionConfiguration",value:function(e,t,i,n,o){o&&(t.parentProductKey=o);var r=t.record[this.prefix+"Feature__c"]||"Other",s=e.features.find(function(e){return e.record.Id===r});"Click"===s.optionSelectionMethod?this._setOptionDataForClickFeature(t,i,n):this._setOptionDataForNonClickFeature(t,i,n,s)}},{key:"_setOptionDataForClickFeature",value:function(e,t,i){null!=t.selected&&(e.selected=t.selected),this._extendQuantityAndConfigurationDataToOption(e,t,i)}},{key:"_setOptionDataForNonClickFeature",value:function(e,t,i,n){var o=n._transient_.optionConfigurations.find(function(e){return e.record.Id===t.optionId&&e.index===t.index});if(t.selected)if(o)this._extendQuantityAndConfigurationDataToOption(o,t,i);else{var r=this._createOptionConfigurationFromOption(e,t.index);this._extendQuantityAndConfigurationDataToOption(r,t,i),n._transient_.optionConfigurations.push(r),n._transient_.changedExternally=!0}else!t.selected&&o&&(o.selected=!1,n._transient_.changedExternally=!0)}},{key:"_createOptionConfigurationFromOption",value:function(e,t){var i=JSON.parse(JSON.stringify(e));return i.index=t,i.addedManually=!0,i.selected=!0,i.configured=!1,i}},{key:"_extendQuantityAndConfigurationDataToOption",value:function(e,t,i){null!=t.Quantity&&e.selected&&(e.record[this.prefix+"Quantity__c"]=t.Quantity),null!=t.configurationData&&this._extendConfigurationDataToOption(e,t,i)}},{key:"_extendConfigurationDataToOption",value:function(e,t,i){var n=this._sanitizeObject(t.configurationData),o={};for(var r in n){var s=n[r];if(-1!==i.indexOf(r)){e.record[r]=s;var a="record."+r;-1===this.additionalOptionPaths.indexOf(a)&&this.additionalOptionPaths.push(a)}else o[r]=s}e.externalConfigurationData=e.externalConfigurationData||{},this.extender.extend(e.externalConfigurationData,o)}},{key:"_extendResponseProducts",value:function(e,t){if(!e||0===e.length)return[];for(var i=[],n=0,o=e.length;n<o;n++){var r=t[n];this._extendResponseProduct(r,e[n],r.productKey),this._resetFeatureOptionConfiguration(r),i.push(r)}return i}},{key:"_cloneProduct",value:function(e){var t=JSON.parse(JSON.stringify(this.product));return t.productKey=this._buildProductKey(this.product.record.Id,e),this._enableSaveToLineEditor(t),t}},{key:"_buildProductKey",value:function(e,t){var i=(t<10?"00":t<100?"0":"")+t;return e.substring(0,15)+i}},{key:"_enableSaveToLineEditor",value:function(e){e.configuration.lineItemKey=null,delete e.configuration.lineItemId}},{key:"_resetFeatureOptionConfiguration",value:function(e){var t=e.features||[],i=!0,n=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done);i=!0)r.value._transient_.optionConfigurations=[]}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this._initializeProduct(e)}},{key:"_initializeProduct",value:function(e){var t=this.prefix.endsWith("__")?this.prefix.substring(0,this.prefix.length-2):this.prefix;new i(this.quote.record.Id,e,t,this.quote.record.CurrencyIsoCode)}},{key:"_getResponseOptionPaths",value:function(){var e=this.defaultOptionPaths.concat(this.additionalOptionPaths);return this.additionalOptionPaths=[],e}},{key:"_sanitizeObject",value:function(e){return JSON.parse(JSON.stringify(e,function(e,t){return e.endsWith("__c")&&t instanceof Object?JSON.stringify(t):t}))}}]),o=r)),e("ProductMessenger",o)}}}),System.register("products/config/search/ConfiguratorSearch.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.searchFilters=e,this.prefix=t,this.fieldTypes=i}e("ConfiguratorSearch",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"containsFeature",value:function(e){var t=this.searchFilters[this.prefix+"Feature__c"];return null==t||-1!==e.record.Name.toLowerCase().indexOf(t.toLowerCase())||void 0!==e.untranslatedRecord&&-1!==e.untranslatedRecord.Name.toLowerCase().indexOf(t.toLowerCase())}},{key:"hasVisibleOptions",value:function(e,t){if(0<e.length){for(var i=0,n=e.length;i<n;i++){if(!e[i].hidden)return!0;if(t&&t[e[i].record.Id])return!0}return!1}return!this.hasFilterValues()}},{key:"allOptionsHiddenByRule",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;if(!1===s.hiddenByRule||null==s.hiddenByRule)return!1}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return!0}},{key:"hasRequiredConfigAttributes",value:function(e,t){var i=t.configAttributesByFeatureId[e.record.Id];if(i){var n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)if(s.value.required)return!0}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}return!1}},{key:"hasConfigAttributes",value:function(e,t){return!!t.configAttributesByFeatureId[e.record.Id]}},{key:"setOptionVisibility",value:function(e){var o=this;for(var t in this.searchFilters)""===this.searchFilters[t]&&(this.searchFilters[t]=null);for(var r=JSON.parse(JSON.stringify(e)),i=function(n,e){if(void 0===r[n].record[o.prefix+"UnitPrice__c"])return r[n].hidden=!0,"continue";if(r[n].isUpgrade)return"continue";var t=Object.keys(o.searchFilters).some(function(e){var t=o.searchFilters[e],i=r[n].record[e];return null!=t&&e!==o.prefix+"Feature__c"&&(null==i||("number"==typeof i?o.checkNumber(t,i):"multipicklist"===o.fieldTypes[e]?o.checkMultiPicklist(t,i):o.checkDefault(t,String(i),r[n].untranslatedRecord,e)))});r[n].hidden=r[n].hiddenByRule||t},n=0,s=r.length;n<s;n++)i(n);return r}},{key:"hasFilterValues",value:function(){for(var e in this.searchFilters)if(null!==this.searchFilters[e])return!0;return!1}},{key:"checkDefault",value:function(e,t,i,n){return!(-1!==t.toLowerCase().indexOf(e.toLowerCase())||i&&i[n]&&-1!==i[n].toLowerCase().indexOf(e.toLowerCase()))}},{key:"checkNumber",value:function(e,t){var i=Number(e);return!(!Number.isNaN(i)&&""!==e)||t!==i}},{key:"checkMultiPicklist",value:function(e,t){var i=this,n=e.split(";"),o=t.split(";");return n.every(function(t){return o.every(function(e){return i.checkDefault(t,e)})})}}]),i=o)),e("ConfiguratorSearch",i)}}}),System.register("products/config/viewmodel/ProductViewModel.js",["products/localization/LocalizeFields.js","common/relationship/RelationshipFieldManager.js"],function(e,t){var C,u,i;return{setters:[function(e){C=e.LocalizeFields},function(e){u=e.RelationshipFieldManager}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.init(t,e,i,n,o)}e("ProductViewModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(r,[{key:"init",value:function(e,t,i,n,o){this.product=e||this.product,this.qId=t||this.qId,this.prefix=i?i+"__":this.prefix||"",this.currencyIsoCode=n||this.currencyIsoCode,this.featureLookupId=o||this.featureLookupId,this.optionsById={},this.optionIndexById={},this.optionsByFeatureId={},this.featuresWithOptionsOrConfigAttr=[],this.featureIdsWithOptionsOrConfigAttr={},this.featureIdsWithSelectionMethodAdd={},this.featureIdsWithSelectionMethodClick={},this.featureIdsWIthSelectionMethodDynamic={},this.configAttributesByFeatureId={},this.configurationAttributeValueMap={},this.configurationAttributeModelMap={},this.configurationAttributeTargetFieldMap={},this.configurationAttributeApplyToOptionMap={},this.attributeValueMap={},this.productRulesActions={},this.originalDataByOptionIds={},this.optionDataByOptionIds={},this.featureIdByOptionId={},this.productOptionConfigurationsMap={},this.initializeProduct(),this.product.initialized=!0}},{key:"getFeature",value:function(t){return void 0!==t&&"null"!==t||(t=null),this.product.features.find(function(e){return e.record.Id===t})}},{key:"getOption",value:function(e){return this.optionsById[e]}},{key:"getOptionsByFeatureId",value:function(e){if(null!==e&&"null"!==e||(e="Other"),this.isOptionLookupViewModel()){var i=[];return this.optionsByFeatureId[e].forEach(function(e){var t=JSON.parse(JSON.stringify(e));t.selected=!1,i.push(t)}),i}var t=this.getFeature(e),n=!0,o=!1,r=void 0;try{for(var s,a=t._transient_.optionConfigurations[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;this.isClickFeature(t)||(l.selected=!0)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return t._transient_.optionConfigurations}},{key:"getFeatureByOptionId",value:function(e){var t=this.featureIdByOptionId[e];return this.getFeature(t)}},{key:"maxOptionsMet",value:function(e){var t=this.prefix+"MaxOptionCount__c";return e._transient_.optionConfigurations.length>=e.record[t]}},{key:"setOptionSelected",value:function(e,t){var i=this.optionsById[e];this.featureIdsWithSelectionMethodClick[this.featureIdByOptionId[e]]&&!i.record[this.prefix+"Required__c"]&&(i.selected=t)}},{key:"setConfigurationAttributesToOptions",value:function(e){for(var t in this.configurationAttributeApplyToOptionMap)e.record[t]=this.product.configuration.configurationData[t]}},{key:"getOptionLayout",value:function(){var e=this.prefix+"OptionLayout__c";return this.product.record[e]||"Sections"}},{key:"getTabFeaturesMap",value:function(){var n=this,o=this.product.featureCategoryLabels,e=this.featuresWithOptionsOrConfigAttr.filter(function(e){return void 0===e.record[n.prefix+"Category__c"]}),r={};return this.featuresWithOptionsOrConfigAttr.length===e.length?this.featuresWithOptionsOrConfigAttr.forEach(function(e){r[e.record.Name]=[e]}):(this.product.featureCategories.forEach(function(i){n.featuresWithOptionsOrConfigAttr.forEach(function(e){var t=e.record[n.prefix+"Category__c"];void 0!==t&&t===o[i]&&(void 0!==r[i]?r[i].push(e):r[i]=[e])})}),0!==e.length&&(r.Other=r.Other||[],r.Other=r.Other.concat(e))),r}},{key:"checkAtLeastOneFeatureHasCategory",value:function(){var t=this;return!!this.featuresWithOptionsOrConfigAttr.find(function(e){return null!=e.record[t.prefix+"Category__c"]&&"Other"!==e.record[t.prefix+"Category__c"]})}},{key:"isAppliedImmediately",value:function(e){var t=this.prefix+"AppliedImmediately__c";return this.getOption(e).record[t]}},{key:"initializeProduct",value:function(){var n=this;this.localizer=new C(this.prefix),this.product=this.localizer.localizeProduct(this.product),this.product.configuration.configurationEntered=!0;var o=this.prefix+"Feature__c",e=[];this.featureLookupId||(this.initConfigAttributesById(),this.initConfigurationAttributeMap());var t=!0,i=!1,r=void 0;try{for(var s,a=this.product.options[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){var l=s.value;this.initOptionInfo(l,e)}}catch(e){i=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw r}}this.buildOptionConfigurationMap();var u=!0,d=!1,c=void 0;try{for(var h,f=this.product.features[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;p.optionSelectionMethod=this.getOptionSelectionMethod(p),p._transient_||(p._transient_={}),this.initFeatureOptionConfigurations(p),this.addFeaturesWithOptionsOrConfigAttr(p)}}catch(e){d=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw c}}var v=!0,g=!1,y=void 0;try{for(var m,b=function(){var t=m.value,e=n.getFeature(t.record[o]||"Other"),i=void 0;"radio"===t.selectionType&&t.hidden&&e.visibleSelected&&(t.selected=!1),n.isAddFeature(e)&&((i=e._transient_.optionConfigurations.find(function(e){return e.record.Id===t.record.Id}))?(i.added=!0,void 0!==t.configured&&(i.configured=t.configured),n.setOptionDisabledData(i)):e._transient_.optionConfigurations.push(t),t.added=!0),n.setOptionDisabledData(t)},_=e[Symbol.iterator]();!(v=(m=_.next()).done);v=!0)b()}catch(e){g=!0,y=e}finally{try{!v&&_.return&&_.return()}finally{if(g)throw y}}}},{key:"initOptionInfo",value:function(e,t){var i=this.prefix+"Feature__c",n=this.prefix+"Quantity__c",o=this.prefix+"MinQuantity__c",r=this.prefix+"Selected__c",s=this.prefix+"Required__c",a=this.prefix+"UnitPrice__c",l=this.prefix+"ProductName__c",u=e.record[i]||"Other";this.setConfigurationAttributesToOptions(e),e.valueChanged=!1,e.record[a]=null==e.record[a]?void 0:e.record[a],e.hidden=e.hiddenByRule&&e.hidden||void 0===e.record[a],e.removed=e.removed||!1===e.selected&&e.record[r],e.selected=void 0===e.selected?e.record[r]&&!e.removed||e.record[s]:e.selected,e.name=e.record[l],e._transient_||(e._transient_={}),e.selected?null!=t&&t.push(e):this.setOptionDisabledData(e),!0===e.isUpgrade&&(e.hidden=!0),e.record[i]||this.product.mappedFeaturelessOptions||(this.product.features.push(this.createOtherOptionsFeature(this.product.virtualFeatureTitle)),this.product.mappedFeaturelessOptions=!0),void 0===e.record[n]&&(e.recordHasQuantity=!1,e.record[n]=void 0===e.record[o]?1:e.record[o]),e.record[s]&&(e.required=!0),this.product._transient_&&this.product._transient_.attributeSet&&this.product._transient_.attributeSet.attributeItemIdsByOptionId[e.record.Id]&&(this.product._transient_.hasAttributeItems=!0,this.addAttributeItems(e,this.product._transient_.attributeSet)),this.optionsById[e.record.Id]=e,this.featureIdByOptionId[e.record.Id]=u,this.addToOptionByFeatureId(u,e),this.originalDataByOptionIds[e.record.Id]={unitPrice:e.record[this.prefix+"UnitPrice__c"],discountAmount:e.record[this.prefix+"DiscountAmount__c"],discountRate:e.record[this.prefix+"Discount__c"],quantity:e.record[n]}}},{key:"createOtherOptionsFeature",value:function(e){return{addOptionButtonLabel:"Add Option",addOptionDialogTitle:"Add Option",instructionsText:null,record:{Id:"Other",Name:e},searchFilters:null}}},{key:"addAttributeItems",value:function(e,t){var i=!0,n=!(e._transient_.attributeItems={}),o=void 0;try{for(var r,s=t.attributeItemIdsByOptionId[e.record.Id][Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=t.attributeItemById[a].targetFieldName;e._transient_.attributeItems[l]=e.record[l]}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}e._transient_.optionDrawerExpanded=!1,e._transient_.drawerIconClass="sf-icon-chevronright"}},{key:"getOptionSelectionMethod",value:function(e){return null!=e.record[this.prefix+"OptionSelectionMethod__c"]?e.record[this.prefix+"OptionSelectionMethod__c"]:null!=this.product.record[this.prefix+"OptionSelectionMethod__c"]?this.product.record[this.prefix+"OptionSelectionMethod__c"]:"Click"}},{key:"setOptionDisabledData",value:function(e,t){e.disabledData=e.disabledData||{disabled:!!e.record[this.prefix+"Required__c"]&&!e.added||!!e.record[this.prefix+"System__c"],constrained:!1},t&&(this.optionsById[e.record.Id].disabledData={disabled:!1,constrained:!1},e.disabledData.disabled=!1)}},{key:"initFeatureOptionConfigurations",value:function(e){if(null==e._transient_.optionConfigurations&&(e._transient_.optionConfigurations=[]),null!=this.optionsByFeatureId[e.record.Id]){var t=1===e.record[this.prefix+"MaxOptionCount__c"],i=0===e._transient_.optionConfigurations.length,n=e.record.Id||"Other",o=[],r=!0,s=!1,a=void 0;try{for(var l,u=this.optionsByFeatureId[n][Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value;d.index=0,e.visibleSelected=e.visibleSelected||!d.hidden&&d.selected,d.selectionType=t?"radio":"checkbox",d.record[this.prefix+"ConfiguredSKU__c"]=this.product.record.Id;var c=d.record[this.prefix+"UnitPrice__c"];void 0===d.listPrice&&""!==c&&null!=c&&(d.listPrice=c),this.isDynamicFeature(e)&&!e._transient_.changedExternally&&(d.selected=!0,d.added=!0),this.featureLookupId?d._transient_.rowActions=[]:(null!=d._transient_.rowActions&&0!==d._transient_.rowActions.length&&!e._transient_.changedExternally||this.initOptionActions(d,!this.isClickFeature(e)),this.initReconfiguredOption(d,e,i,o))}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}0<o.length&&this.sortAndAddOptionConfigs(e,o)}}},{key:"buildOptionConfigurationMap",value:function(){if(this.product.features[0])if(null==this.product.features[0]._transient_||null==this.product.features[0]._transient_.optionConfigurations){var e=!0,t=!1,i=void 0;try{for(var n,o=this.product.configuration.optionConfigurations[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value,s=r.optionId;this.productOptionConfigurationsMap[s]=this.productOptionConfigurationsMap[s]||[],this.productOptionConfigurationsMap[s].push(r)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}else this._syncOptionConfigurations()}},{key:"initOptionActions",value:function(e,t){var i=[];t&&i.push(this.createOptionAction("sf-icon-delete","Delete","left",!0,!1,!1,"delete-tapped")),this.addOptionConfigurationAction(e,i),e._transient_.rowActions=i}},{key:"addOptionConfigurationAction",value:function(e,t){var i=e.configurable?e.configurationRequired:void 0;t.push(this.createOptionAction("sf-icon-custom_apps","Configure","left",!1,!1,!1,"configure-tapped",i))}},{key:"createOptionAction",value:function(e,t,i,n,o,r,s,a){return{icon:e,title:t,position:i,mobileDisabled:n,hidden:o,invisible:r,configurationRequired:a,onTapFunction:function(){this.fire(s,{Id:this.data.record.Id,index:this.index})}}}},{key:"addToOptionByFeatureId",value:function(e,t){this.optionsByFeatureId[e]=this.optionsByFeatureId[e]||[],this.optionsByFeatureId[e].push(t)}},{key:"initConfigAttributesById",value:function(){for(var e=this.product.configurationAttributes,t=e.length,i=0;i<t;i++)null===e[i].featureId?this.configAttributesByFeatureId.featureless?this.configAttributesByFeatureId.featureless.push(e[i]):this.configAttributesByFeatureId.featureless=[e[i]]:this.configAttributesByFeatureId[e[i].featureId]?this.configAttributesByFeatureId[e[i].featureId].push(e[i]):this.configAttributesByFeatureId[e[i].featureId]=[e[i]]}},{key:"initConfigurationAttributeMap",value:function(){for(var e=this.product.configurationAttributes,t=e.length,i=this.product.configuration.configurationData,n=0;n<t;n++){var o=e[n].targetFieldName;this.attributeValueMap[e[n].targetFieldName]="";var r=new u(o,i).getRelationshipName(),s=i[o];this.configurationAttributeValueMap[e[n].myId]=void 0!==s?s:null;var a=this.product.productKey||this.product.record.Id;this.configurationAttributeModelMap[e[n].myId]={targetFieldName:e[n].targetFieldName,value:s,required:e[n].required,hidden:e[n].hidden,myId:e[n].myId,bundleId:a,autoSelect:e[n].autoSelect,shownValues:e[n].shownValues,hiddenValues:e[n].hiddenValues,referencedFieldValue:r};var l=this.configurationAttributeTargetFieldMap[e[n].targetFieldName]||[];l.push(e[n].myId),this.configurationAttributeTargetFieldMap[e[n].targetFieldName]=l,!0===e[n].applyToProductOptions&&void 0===this.configurationAttributeApplyToOptionMap[e[n].targetFieldName]&&(this.configurationAttributeApplyToOptionMap[e[n].targetFieldName]=!0)}}},{key:"initReconfiguredOption",value:function(e,t,i,n){var o=this.productOptionConfigurationsMap[e.record.Id];if(!o||e.removed)return i&&this.isClickFeature(t)?t._transient_.optionConfigurations.push(e):void 0;if(this.isAddFeature(t))this.cloneOptionAndSyncConfiguration(e,n);else{var r=o[0];this.syncOptionToConfigData(e),this.setPropertiesWithConfig(e,r),i&&(this.isClickFeature(t)?t._transient_.optionConfigurations.push(e):n.push(e))}}},{key:"cloneOptionAndSyncConfiguration",value:function(e,t){for(var i=this.productOptionConfigurationsMap[e.record.Id],n={},o=0;o<i.length;o++){var r=i[o],s=JSON.parse(JSON.stringify(e));s._transient_.rowActions=e._transient_.rowActions,!0===n[s.record.Id]?s.required=!1:n[s.record.Id]=!0,s.index=o,this.syncOptionToConfigData(s),this.setPropertiesWithConfig(s,r),t.push(s)}}},{key:"syncOptionToConfigData",value:function(e){var t=this.getProductOptionConfigurationData(e.record.Id,e.index);if(void 0!==t)for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}},{key:"getProductOptionConfigurationData",value:function(e,t){return void 0===this.productOptionConfigurationsMap[e][t]&&this.buildOptionConfigurationMap(),this.productOptionConfigurationsMap[e][t]}},{key:"setPropertiesWithConfig",value:function(e,t){var i=e.untranslatedRecord&&0<Object.keys(e.untranslatedRecord).length;for(var n in t.optionData)if("attributes"!==n){if(i&&void 0!==e.untranslatedRecord[n]&&e.untranslatedRecord[n]===t.optionData[n])continue;e.record[n]=t.optionData[n]}e.dynamicOptionKey=t.dynamicOptionKey,e.selected=!1!==e.selected}},{key:"getHasUpgradeOptions",value:function(e){if("Other"!==e.record.Id)return e.containsUpgrades;for(var t=0;t<e._transient_.optionConfigurations.length;t++)if(!0===e._transient_.optionConfigurations[t].isUpgrade)return!0;return!1}},{key:"sortAndAddOptionConfigs",value:function(e,t){var i=this,n=void 0,o=!0,r=!1,s=void 0;try{for(var a,l=function(){var t=a.value;t&&(i.isAddFeature(e)&&(t.added=!0,n=!!e._transient_.optionConfigurations.filter(function(e){return e.record.Id===t.record.Id})),i.setOptionDisabledData(t,n),e._transient_.optionConfigurations.push(t))},u=t[Symbol.iterator]();!(o=(a=u.next()).done);o=!0)l()}catch(e){r=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(r)throw s}}}},{key:"createConstraintsHoverMessages",value:function(e){this.optionConstraintsByConstrained=e;var t=!0,i=!1,n=void 0;try{for(var o,r=this.product.options[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.createConstraintHoverMessage(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"createConstraintHoverMessage",value:function(e){if(this.optionConstraintsByConstrained[e.record.Id]){var s=this.optionConstraintsByConstrained[e.record.Id],a={Requires:[],Excludes:[]},t=[];if(s.ungroupedConstraints.forEach(function(e){var t="Dependency"===e.type?"Requires":"Excludes",i="Dependency"===e.type?"or ":"and ",n=a[t].length?i:t+": ",o=this.optionsById[e.option].record[this.prefix+"ProductName__c"];a[t].push(n+o)}.bind(this)),Object.keys(s.groups).forEach(function(e,t){var i=s.groups[e],n="Dependency"===i.type?"Requires":"Excludes",o=a[n].length?0==t&&s.ungroupedConstraints[0]?"and ":"or ":n+": ",r="";i.options.forEach(function(e,t){var i=this.optionsById[e].record[this.prefix+"ProductName__c"];r+=(o=0===t?o:" and ")+i}.bind(this)),a[n].push(r)}.bind(this)),a.Requires.length){var i=!0,n=!1,o=void 0;try{for(var r,l=a.Requires[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value;t.push(u)}}catch(e){n=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw o}}}if(a.Excludes.length){var d=!0,c=!1,h=void 0;try{for(var f,p=a.Excludes[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var v=f.value;t.push(v)}}catch(e){c=!0,h=e}finally{try{!d&&p.return&&p.return()}finally{if(c)throw h}}}e.constraintMessage=t}}},{key:"optionSystemOrRequired",value:function(e){var t=this.optionsById[e];return t.record[this.prefix+"System__c"]||t.record[this.prefix+"Required__c"]}},{key:"isOptionLookupViewModel",value:function(){return!!this.featureLookupId}},{key:"isClickFeature",value:function(e){return"Click"===e.optionSelectionMethod}},{key:"isAddFeature",value:function(e){return"Add"===e.optionSelectionMethod}},{key:"isDynamicFeature",value:function(e){return"Dynamic"===e.optionSelectionMethod}},{key:"addFeaturesWithOptionsOrConfigAttr",value:function(e){(this.optionsByFeatureId[e.record.Id]||this.configAttributesByFeatureId[e.record.Id]||this.isDynamicFeature(e))&&(this.featuresWithOptionsOrConfigAttr.push(e),this.featureIdsWithOptionsOrConfigAttr[e.record.Id]=e,this.isClickFeature(e)?this.featureIdsWithSelectionMethodClick[e.record.Id]=!0:this.isAddFeature(e)?this.featureIdsWithSelectionMethodAdd[e.record.Id]=!0:this.isDynamicFeature(e)&&(this.featureIdsWIthSelectionMethodDynamic[e.record.Id]=!0))}},{key:"_syncOptionConfigurations",value:function(){var e=this._getPreviouslyConfiguredBundle();if(null!==e){var t=e.optionData.Id||e.optionId,i=this.getFeatureByOptionId(t),n=!0,o=!1,r=void 0;try{for(var s,a=i._transient_.optionConfigurations[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(l.record.Id===t&&l.index===e.index)return l.optionConfigurations=e.optionConfigurations,l.configurationData=e.configurationData,void delete e.tag}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"_getPreviouslyConfiguredBundle",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.product.configuration.optionConfigurations[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;if("saved"===r.tag)return r}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}return null}}]),i=r)),e("ProductViewModel",i)}}}),System.register("products/resources/optionConstraints/OptionConstraintsHandler.js",[],function(e,t){var o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.product=e,this.prefix=t,this.messages={},this.setOptionConstraints()}e("OptionConstraintsHandler",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"setOptionConstraints",value:function(){var s=this;if(!this.product.constraints)return null;var a=this.prefix+"Type__c",l=this.prefix+"ConstrainedOption__c",u=this.prefix+"ConstrainingOption__c",d=this.prefix+"OptionConstraintGroup__c",c={byConstraining:{},byConstrained:{},constrainingByConstrained:{}};this.product.constraints.forEach(function(e){var t=e.record[a],i=e.record[l],n=e.record[u],o=e.record[d]?e.record[d].split(", "):null;s.setByConstraining(c,t,i,n),s.setByConstrained(c,t,i,n,o),"Exclusion"!==t||o||(s.setByConstraining(c,t,n,i),s.setByConstrained(c,t,n,i));var r=c.constrainingByConstrained[i]||[];r.push(s.getOption(n)),c.constrainingByConstrained[i]=r}),this.optionConstraints=c}},{key:"handleOptionConstraints",value:function(r,e){var s=this;if(this.optionConstraints&&this.optionConstraints.byConstraining[r]){var a=[],l=e||this.getOption(r).added;return this.getOption(r).selected=e,this.optionConstraints.byConstraining[r].forEach(function(e){var t=s.optionIsConstrained(e,r,l),i=s.getOption(e.option),n=i.selected,o=i._transient_&&i._transient_.rendered;a.push({optionId:e.option,disabledState:t,selected:n,rendered:o})}),a}}},{key:"getUnrenderedConstraining",value:function(e){return(this.optionConstraints.constrainingByConstrained[e]||[]).filter(function(e){return!e._transient_||!e._transient_.rendered})}},{key:"optionIsConstrained",value:function(e,t,i){var n=e.type,o=this.optionConstraints.byConstrained[e.option],r=0<Object.keys(o.groups).length,s=this.isConstrainedByUngrouped(o);return!!s.constrained||(r?this.isConstrainedByGrouped(o.groups):this.getUnaffectedDisabledState(t,i,"Dependency"===n,s.requiredConditionMet))}},{key:"isConstrainedByUngrouped",value:function(e){for(var t=!1,i=!1,n=!1,o=e.ungroupedConstraints,r=o?o.length:-1,s=0;!t&&s<r;){var a=this.getOption(o[s].option),l=o[s].type;"Exclusion"===l?t=this.isSelected(a):"Dependency"!==l||n||(i=!(n=this.isSelected(a))),s++}return{constrained:t||i,requiredConditionMet:n}}},{key:"isConstrainedByGrouped",value:function(e){for(var t=!1,i=!0,n=!1,o=Object.keys(e).length,r=0;r<o;){var s=!1,a=e[Object.keys(e)[r]],l=a.type,u=a.options,d=u.length,c=0;if("Dependency"===l&&i&&!n){for(;!s&&c<d;){var h=this.getOption(u[c]);(s=!this.isSelected(h))||c!==d-1||(i=!1),c++}t=i}if("Exclusion"===l&&!n){for(;!s&&c<d;){var f=this.getOption(u[c]);(s=!this.isSelected(f))||c!==d-1||(n=!0),c++}t=n}r++}return t}},{key:"getOption",value:function(t){return this.product.options.find(function(e){return e.record.Id===t})}},{key:"isSelected",value:function(e){return e&&(e.selected||e.added||!!e.priorOptionExists)}},{key:"getUnaffectedDisabledState",value:function(e,t,i,n){return i?!n&&!(t||this.getOption(e).priorOptionExists):t||!!this.getOption(e).priorOptionExists}},{key:"optionShouldBeDisabled",value:function(t){var e,i,n,o,r=this.optionConstraints.byConstrained[t],s=void 0;if(!r)return!1;if(e=1<=r.ungroupedConstraints.length,i=1<=Object.keys(r.groups).length,e)s=r.ungroupedConstraints[0].option;else{if(!i)return!1;s=r.groups[Object.keys(r.groups)[0]].options[0]}return n=this.isSelected(this.getOption(s)),o=this.optionConstraints.byConstraining[s].find(function(e){return e.option===t}),this.optionIsConstrained(o,s,n)}},{key:"setByConstraining",value:function(e,t,i,n){e.byConstraining[n]=e.byConstraining[n]||[],e.byConstraining[n].push({type:t,option:i})}},{key:"setByConstrained",value:function(e,t,i,n,o){e.byConstrained[i]=e.byConstrained[i]||{ungroupedConstraints:[],groups:{}},o?this.setConstrainedForGroups(e,t,i,n,o):this.setConstrainedForUngrouped(e,t,i,n)}},{key:"setConstrainedForGroups",value:function(e,t,i,n,o){var r=!0,s=!1,a=void 0;try{for(var l,u=o[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value;e.byConstrained[i].groups[d]=e.byConstrained[i].groups[d]||{type:t,options:[]},e.byConstrained[i].groups[d].options.push(n)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}}},{key:"setConstrainedForUngrouped",value:function(e,t,i,n){e.byConstrained[i].ungroupedConstraints.push({type:t,option:n})}},{key:"getConstrainingByConstrained",value:function(){return Object.values(this.optionConstraints.constrainingByConstrained)}}]),o=i)),e("OptionConstraintsHandler",o)}}}),System.register("products/resources/optionUpgrades/OptionUpgradeHandler.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.prefix=e,this.options=t,this.option=i}e("OptionUpgradeHandler",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"isSourceLine",value:function(){return null!=this.option.priorBundledQuantity}},{key:"getLine",value:function(){return this.option}},{key:"getLines",value:function(){return this.options}},{key:"getSourceOrUpgrade",value:function(e,t){for(var i=0;i<this.options.length;i++){var n=e||this.options[i],o=t||this.options[i];if(o.sourceProductIds&&-1!=o.sourceProductIds.indexOf(n.record[this.prefix+"OptionalSKU__c"]))return this.options[i]}}},{key:"setSourceAndUpgrade",value:function(e,t){this.sourceOption=e,this.upgradeOption=t}},{key:"getSourceIdField",value:function(){return this.prefix+"OptionalSKU__c"}},{key:"getUpgradeConversionRateField",value:function(){return this.prefix+"UpgradeConversionRate__c"}},{key:"getSourceCurrentQuantityField",value:function(e){return e.selected?e.record[this.prefix+"Quantity__c"]:0}},{key:"getUpgradeCurrentQuantityField",value:function(e){return e.selected?e.record[this.prefix+"Quantity__c"]:0}},{key:"getSourcePriorQuantity",value:function(e){return e.priorBundledQuantity}},{key:"didSourceQuantityChange",value:function(e,t,i){return i.selected&&(e||!t.selected)}},{key:"didUpgradeQuantityChange",value:function(e,t){return t.selected&&!e}},{key:"isSelected",value:function(e){return e.selected}},{key:"setUpdatedQuantity",value:function(e,t,i,n){e.selected&&(e.record[this.prefix+"Quantity__c"]=i),t.selected&&(t.record[this.prefix+"Quantity__c"]=n)}},{key:"getSourceOption",value:function(){return this.sourceOption}},{key:"getUpgradeOption",value:function(){return this.upgradeOption}},{key:"setUpgradedAssetId",value:function(){var e=this.getSourceOrUpgrade(null,this.option);this.option.upgradedAssetId=e.upgradedAssetId}}]),i=o)),e("OptionUpgradeHandler",i)}}}),System.register("products/resources/reconfigure/ProductReconfigurer.js",["../model/nestedOptions/NestedOptionsModel.js"],function(t,e){var v,i;return{setters:[function(e){v=e.NestedOptionsModel}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductReconfigurer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"reconfigure",value:function(e,t){var i={};if(t?e.configuration=t:e.nestedOptionModel=e.nestedOptionModel||new v(e.configuration,!0),e.configuration.optionConfigurations.length){this.buildOptionConfiguration(e,e.configuration.optionConfigurations,i);var n=!0,o=!1,r=void 0;try{for(var s,a=e.options[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;this._addSelectedDataToOption(i[l.record.Id],l)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}else{var u=!0,d=!1,c=void 0;try{for(var h,f=e.options[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;p.configuration&&delete p.configuration}}catch(e){d=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw c}}}}},{key:"buildOptionConfiguration",value:function(e,t,i){for(var n={},o=0;o<t.length;o++){var r=t[o];!0!==n[r.optionId]&&(r.isSegmented&&(n[r.optionId]=!0),i[r.optionId]=this.buildStrippedOptionData(e,r,o))}}},{key:"buildStrippedOptionData",value:function(e,t,i){if(0===t.optionConfigurations.length){var n=this.newConfiguration(t.optionId,t.optionData,t.isDynamicOption,i);return n.configured=t.configured,"Amendment"===e.quoteType&&(n.upgradedAssetId=t.upgradedAssetId,n.priorBundledQuantity=t.priorBundledQuantity),n}var o=0<t.optionConfigurations.length;return{optionId:t.optionId,optionData:t.optionData,optionConfigurations:o,index:i}}},{key:"newConfiguration",value:function(e,t,i,n){return{optionId:e,optionData:t,isDynamicOption:i,index:n}}},{key:"_addSelectedDataToOption",value:function(e,t){e?(t.isDynamicOption=e.isDynamicOption,t.priorBundledQuantity=e.priorBundledQuantity,t.configured=t.configured||!0===e.configured||e.optionConfigurations):t.selected=!0===t.selected}}]),i=e)),t("ProductReconfigurer",i)}}}),System.register("products/resources/rules/RuleProcessor.js",["common/core/AppContext.js","../model/nestedOptions/NestedOptionsModel.js"],function(e,t){var o,r;return{setters:[function(e){o=e.AppContext},function(e){e.NestedOptionsModel}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.prefix=o.org.prefix?o.org.prefix+"__":"",this.data=e,this.product=t,this.validationMessages=[],this.productRulesActions={},this.optionDataByOptionIdAndIndex={}}e("RuleProcessor",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"getValidationMessages",value:function(){return this.validationMessages}},{key:"getProductRulesActions",value:function(){return this.productRulesActions}},{key:"getOptionDataByOptionIdAndIndex",value:function(){return this.optionDataByOptionIdAndIndex}},{key:"init",value:function(e){this.initValidationMessages(),this.product&&(this.initProductRulesActions(),this.initDescendantTree(e),this.initOptionDataByOptionIdAndIndex())}},{key:"initValidationMessages",value:function(){if(this.data.validationMessages){var e=!0,t=!1,i=void 0;try{for(var n,o=this.data.validationMessages[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;this.validationMessages.push(r)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}else{var s=!0,a=!1,l=void 0;try{for(var u,d=this.data.configuredProducts[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var c=u.value,h=!0,f=!1,p=void 0;try{for(var v,g=c.configuration.validationMessages[Symbol.iterator]();!(h=(v=g.next()).done);h=!0)r=v.value,this.validationMessages.push(r)}catch(e){f=!0,p=e}finally{try{!h&&g.return&&g.return()}finally{if(f)throw p}}}}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}}}},{key:"initProductRulesActions",value:function(e){var t={},i={},n={},o={},r={},s={},a={},l={},u={},d=!0,c=!1,h=void 0;try{for(var f,p=this.data.optionConfigurations[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var v=f.value;t[v.optionData.Id||v.optionId]=!0}}catch(e){c=!0,h=e}finally{try{!d&&p.return&&p.return()}finally{if(c)throw h}}if(null!=this.data.disabledOptionIds){var g=!0,y=!1,m=void 0;try{for(var b,_=this.data.disabledOptionIds[Symbol.iterator]();!(g=(b=_.next()).done);g=!0)i[b.value]=!0}catch(e){y=!0,m=e}finally{try{!g&&_.return&&_.return()}finally{if(y)throw m}}}if(null!=this.data.hiddenOptionIds){var C=!0,S=!1,k=void 0;try{for(var O,E=this.data.hiddenOptionIds[Symbol.iterator]();!(C=(O=E.next()).done);C=!0)n[O.value]=!0}catch(e){S=!0,k=e}finally{try{!C&&E.return&&E.return()}finally{if(S)throw k}}}if(e)return this.assignProductRules(t,i,n);var I=!0,w=!1,M=void 0;try{for(var L,D=this.product.options[Symbol.iterator]();!(I=(L=D.next()).done);I=!0){var T=L.value;this.optionNotInPricebook(T)||(this.handleProductActions(n,T,s,a,"hiddenByRule"),this.handleProductActions(i,T,l,u,"disabled"),this.handleProductActions(t,T,r,o,"selected"))}}catch(e){w=!0,M=e}finally{try{!I&&D.return&&D.return()}finally{if(w)throw M}}this.productRulesActions={showOptions:s,hideOptions:a,selectOptions:o,deselectOptions:r,enableOptions:l,disableOptions:u}}},{key:"initOptionDataByOptionIdAndIndex",value:function(){for(var e=this.data.optionConfigurations,t=0;t<e.length;t++){var i=e[t];void 0===this.optionDataByOptionIdAndIndex[i.optionId]&&(this.optionDataByOptionIdAndIndex[i.optionId]={}),this.optionDataByOptionIdAndIndex[i.optionId][i.index]={optionData:i.optionData,listPrice:i.listPrice}}}},{key:"handleProductActions",value:function(e,t,i,n,o){return"disabled"===o?e[t.record.Id]&&t.disabledData&&!t.disabledData.disabled?n[t.record.Id]=!0:!e[t.record.Id]&&t.disabledData&&t.disabledData.disabled?i[t.record.Id]=!0:void 0:e[t.record.Id]&&!t[o]?n[t.record.Id]=!0:!e[t.record.Id]&&t[o]?i[t.record.Id]=!0:void 0}},{key:"assignProductRules",value:function(e,t,i){this.prefix;var n=this.product.rulesProcessed=!0,o=!1,r=void 0;try{for(var s,a=this.product.options[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;this.optionNotInPricebook(l)||(l.selected=l.selectedByRule=!!e[l.record.Id],t[l.record.Id]&&(l.disabledData={disabled:!0,constrained:!1}),i[l.record.Id]&&(l.hidden=!0,l.hiddenByRule=!0))}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}},{key:"initDescendantTree",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.product.nestedOptionModel;if(e)for(var t={},i=0;i<this.data.optionConfigurations.length;i++){var n=this.data.optionConfigurations[i];t[n.optionId]=void 0===t[n.optionId]?0:t[n.optionId]+1;var o={optionId:this.data.optionId,index:this.data.index||0},r={optionId:n.optionId,index:t[n.optionId]};n.index=t[n.optionId],e.handleDescendantRules([o,r],n.optionConfigurations,n.hiddenOptionIds,n.disabledOptionIds,n.changedByProductActions)}else console.log&&console.warn("Skipped descendant level rules",this.product)}},{key:"optionNotInPricebook",value:function(e){return void 0===e.record[this.prefix+"UnitPrice__c"]||null==e.record[this.prefix+"UnitPrice__c"]}}]),r=i)),e("RuleProcessor",r)}}}),System.register("products/resources/sb-product-alert/ProductAlert.js",["common/core/AppContext.js"],function(t,e){var i,o;return{setters:[function(e){i=e.localizeContent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductAlert",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-alert",this.properties={alerts:Array,continueCB:Object,cancelCB:Object,displayContinueButton:{type:Boolean,value:!1},cancelText:{type:String,value:i("lbl_close")}}}},{key:"ready",value:function(){this.$.dialog.addEventListener("sb-close-dialog",this._onCancel.bind(this))}},{key:"init",value:function(){this.$.dialog.toggle()}},{key:"onRevise",value:function(){this.$.dialog.toggle()}},{key:"toggle",value:function(){this.$.dialog.toggle()}},{key:"onContinue",value:function(){"function"==typeof this.continueCB&&this.continueCB()}},{key:"_onCancel",value:function(){"function"==typeof this.cancelCB&&this.cancelCB(),this.$.dialog.toggle()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["init(alerts)"]}}]),o=e)),t("ProductAlert",o),Polymer(o)}}}),System.register("products/resources/tree/ConfigTree.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.root=e,this.idProperties=["optionId","index","tag"],this.buildSubtree(this.root)}e("ConfigTree",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"buildSubtree",value:function(e){var t=this,i={};this._buildNode(e),e.getChildren(e).forEach(function(e){i[e.optionId]=i[e.optionId]||e.index||0,void 0!==e.index&&i[e.optionId]!==e.index||(e.index=i[e.optionId],i[e.optionId]++),t.buildSubtree(e)})}},{key:"getFromPath",value:function(e){for(var t=this.root,i=0,n=e.length;i<n;i++){var o=this._buildId(e[i]);t=this._findOnLevel(o,t)}return t}},{key:"_buildNode",value:function(e){e.nodeId=this._buildId(e),e.getChildren=function(){return this.optionConfigurations}.bind(e)}},{key:"_buildId",value:function(e){var t="",i=!0,n=!1,o=void 0;try{for(var r,s=this.idProperties[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;("tag"!==a||"tag"===a&&null!=e[a])&&(t+="_"+e[a])}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"_findOnLevel",value:function(e,t){var i=e.constructor===String?e:this._buildId(e);return(t=t||this.root).getChildren().find(function(e){return e.nodeId===i})}}]),i=t)),e("ConfigTree",i)}}}),System.register("quotes/dialogs/sb-clone-to-group-dialog/CloneToGroupDialog.js",["common/core/AppContext.js","common/core/Page.js"],function(t,e){var o,i,r;return{setters:[function(e){o=e.AppContext},function(e){i=e.Page}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("CloneToGroupDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-clone-to-group-dialog",this.properties=Polymer.Base.extend({quoteModel:Object},i.properties)}},{key:"ready",value:function(){var e=this;Polymer.RenderStatus.afterNextRender(this,function(){e.addEventListener("sb-cancel-clone-to-group",e.onCancel)})}},{key:"open",value:function(){this.lineGroups=this.quoteModel.lineGroups,this.$.dialog.toggle();for(var e=[],t=0,i=this.lineGroups.length;t<i;t++)e.push({value:this.lineGroups[t].groupKey,label:this.lineGroups[t].groupVO.record.Name,selected:!1});this.groups=e,this.isMobile||(this.availableGroupTitle=o.properties.i18n.value().l("Available Groups"),this.chosenGroupTitle=o.properties.i18n.value().l("Selected Groups"))}},{key:"onSave",value:function(){this.isMobile?(this.selectedGroups=this._getSelectedGroups(),this.fire("sb-clone-to-group-selected",this.selectedGroups),this.groups=void 0):this.fire("sb-clone-to-group-selected",this.selectedGroups),this.$.dialog.toggle()}},{key:"onCancel",value:function(){this.$.dialog.toggle(),this.isMobile&&(this.groups=void 0)}},{key:"_getSelectedGroups",value:function(){for(var e=[],t=0,i=this.groups.length;t<i;t++)this.groups[t].selected&&e.push(this.groups[t]);return e}},{key:"toggleSelectedClass",value:function(e){var t=e.currentTarget,i=t.classList.contains("backgroundContainer"),n=t.dataIndex;this.set("groups."+n+".selected",!i),this.toggleClass("backgroundContainer",!i,t)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),r=e)),t("CloneToGroupDialog",r),Polymer(r)}}}),System.register("quotes/dialogs/sb-custom-segment-dialog/CustomSegmentDialog.js",["quotes/models/LineModel.js","quotes/models/DragDropModel.js","common/layout/tables/TableClassBuilder.js","common/core/sb-page-container/PageContainer.js","common/core/AppContext.js","common/core/Events.js"],function(t,e){var l,d,i,s,o,r;function a(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}return{setters:[function(e){l=e.LineModel},function(e){e.DragDropModel},function(e){d=e.TableClassBuilder},function(e){i=e.PageContainer},function(e){s=e.AppContext},function(e){o=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}410,180," visibilityHidden",t("CustomSegmentDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-custom-segment-dialog",this.properties={dataLineModels:Array,lineModels:{type:Array},groupModel:{type:Object},deletedLineKeys:{type:Array,value:[]},errors:{type:Array,value:[],notify:!0},viewport:{type:Object,value:function(){return i.getViewport()}},headerActions:Array,headerSelected:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.isMobile=this._isMobileViewport()}},{key:"_findTableRowValidTarget",value:function(e){return e?this._ifParentIsValidTarget(e)?e:e.parentNode?this._findTableRowValidTarget(e.parentNode):null:null}},{key:"_ifParentIsValidTarget",value:function(e){return!!e.parentElement&&"swipe-header"==e.parentElement.id&&(this.targetRowElement=e.parentElement.parentElement,!0)}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport;var t=this.dragDrop?this.dragDrop.segmentRows:null;if(t)if(this._isMobileViewport()||!s.isDesktop)for(var i=0,n=t.length;i<n;i++)t[i].removeEventListener("track",this.onTrack.bind(this));else for(var o=0,r=t.length;o<r;o++)t[o].addEventListener("track",this.onTrack.bind(this));return this.viewport&&this.viewport.isMobile()}},{key:"_dataChanged",value:function(){if(this.dataLineModels){this.groupModel=this.dataLineModels[0].groupModel,this.editorModel=this.groupModel.quoteModel.editorModel;var e=[],t=void 0,i=this.dataLineModels.length,n={};for(t=0;t<i;t++){var o=this.dataLineModels[t],r=JSON.parse(JSON.stringify(o.lineVO)),s=new l(r,this.groupModel);s.selected=!1,n[s.lineVO.record[this.constants.START_DATE_FIELD]]=s}var a=Object.keys(n).sort();for(t=0;t<i;t++)e.push(n[a[t]]);this.lineModels=e}}},{key:"_lineModelChanged",value:function(){this.lineModels&&0<this.lineModels.length&&(this.deletedLineKeys=[],this.errors=[],this._buildDialog())}},{key:"_handleCustomSegmentsResponseChanged",value:function(e){e.partialVO&&(e=this._combinePartialQuoteWithFullQuote(e)),this.fire("segmented-changed",{quoteVO:e}),this.resetData()}},{key:"_combinePartialQuoteWithFullQuote",value:function(e){var n=this,t=this.groupModel.quoteModel.quoteVO,o=new Map,r=new Map;e.lineItems.forEach(function(e){r.set(e.key,e);var t=e.record[n.constants.SEGMENT_KEY_FIELD];if(t&&n._sentMDQKeys.has(t)){var i=o.get(t)||[];o.set(t,[].concat(a(i),[e]))}});var s=[];return t.lineItems.forEach(function(e){var t=e.record[n.constants.SEGMENT_KEY_FIELD],i=e.dimensionType;t&&n._sentMDQKeys.has(t)&&i&&"custom"===i.toLowerCase()?1==e.record[n.constants.SEGMENT_INDEX_FIELD]&&(s=[].concat(a(s),a(o.get(t)))):r.has(e.key)?s.push(r.get(e.key)):s.push(e)}),e.lineItems=s,e.partialVO=!1,e}},{key:"_handleErrorResponseChanged",value:function(){var e=this.errors||[];this.set("errors",e.push(this.errorResponse))}},{key:"_onAddByLine",value:function(e){this._onAddByIndex(e.detail.index)}},{key:"_onAdd",value:function(e){this.$.dialog.toggleMenu();var t=this.lineModels.length-1;this._onAddByIndex(t)}},{key:"_onAddByIndex",value:function(e){var t=this.lineModels[e],i=JSON.parse(JSON.stringify(t.lineVO));i.record={},i.record[this.constants.SEGMENT_LABEL_FIELD]="",i.record[this.constants.START_DATE_FIELD]=null,i.record[this.constants.END_DATE_FIELD]=null;var n=new l(i,this.groupModel);n.lineVO.record.Id=null,n.lineVO.key=null,n.selected=!1,this.splice("lineModels",e+1,0,n),this.headerSelected=!1,this.$.segmentGroup.addEventListener("dom-change",function(e){var t=this.$.segmentRows.querySelectorAll("#segmentRow");null===t[t.length-1].model.lineVO.key&&t[t.length-1].$.row.click()}.bind(this))}},{key:"_onDeleteByLine",value:function(e){this._onDeleteLineData(e.detail.index),this.headerSelected=!1}},{key:"_onDelete",value:function(){var e=void 0;for(e=this.lineModels.length-1;0<e;e--)this.lineModels[e].selected&&this._onDeleteLineData(e);this.$.dialog.toggleMenu(),this.headerSelected=!1}},{key:"_onDeleteLineData",value:function(e){var t=this.lineModels[e];null!=t.lineVO.key&&this.deletedLineKeys.push(t.lineVO.key),this.splice("lineModels",e,1)}},{key:"_onSave",value:function(){this._resetProperties(),this.$.dialog.toggleMenu(),this._validateCustomSegmentLabels(),this._validateCustomSegmentDates();var e=[];if(this.hasInvalidSegmentDates&&e.push(this.customLabels.msg_invalid_custom_segment_dates),this.hasInvalidSegmentLabels&&e.push(this.customLabels.msg_invalid_custom_segment_labels),this.hasNonConsecutiveDates&&e.push(this.customLabels.msg_nonsequential_custom_segment_dates),this.hasOverlappingSegments&&e.push(this.customLabels.msg_overlapping_custom_segment_dates),this.hasInvalidDateFormat&&e.push(this.customLabels.msg_invalid_date_format),this.set("errors",[]),this.set("errors",e),0==e.length){var t=this._getCustomSegmentUpdates();t.updateCustomSegments=!0;var i={quote:this._createQuoteWithoutUnaffectedLines(this.groupModel.groupKey),updateCustomSegments:t.updateCustomSegments,updatedLineKeys:t.updatedLineKeys,deletedLineKeys:this.deletedLineKeys,startDates:t.startDates,endDates:t.endDates,segmentLabels:t.segmentLabels};this.$.UpdateCustomSegmentsService.model=i}}},{key:"_createQuoteWithoutUnaffectedLines",value:function(t){var i=this,e=this.groupModel.quoteModel.quoteVO;if(!this.editorModel.data.settings.usesClientCalculator)return e;e=JSON.parse(JSON.stringify(e));var n=new Set,o=new Set,r=new Set;e.lineItems.forEach(function(e){e.parentGroupKey==t&&e.dimensionType==i.constants.TYPE_CUSTOM_DIMENSION&&(n.add(e.key),r.add(e.record[i.constants.SEGMENT_KEY_FIELD]),e.record.Id&&o.add(e.record.Id))}),this._sentMDQKeys=r,e.lineItems.forEach(function(e){var t=e.record[i.constants.SOURCE_FIELD];t&&o.has(t)&&n.add(e.key)});var s=[];return e.lineItems.forEach(function(e){n.has(e.key)&&s.push(e)}),e.lineItems=s,e.partialVO=!0,e}},{key:"_onCancel",value:function(){this.errors=void 0,this.groupModel=void 0,this.deletedLineKeys=[],this._resetProperties(),this.$.dialog.toggle()}},{key:"_toggleAllCheckBoxes",value:function(){if(this.lineModels){var e=void 0;for(e=this.lineModels.length-1;0<e;e--)this.set("lineModels."+e+".selected",this.headerSelected)}}},{key:"resetData",value:function(){this.errors=void 0,this.deletedLineKeys=[],this._sentMDQKeys=void 0}},{key:"_isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"_buildDialog",value:function(){this._buildFieldsMD(),this._toggleAllCheckBoxes(),this._buildRowData(),this._buildHeaderActions()}},{key:"_buildFieldsMD",value:function(){for(var e=this.quoteLineMD,t=[this.constants.SEGMENT_LABEL_FIELD,this.constants.START_DATE_FIELD,this.constants.END_DATE_FIELD],i=[],n=0;n<t.length;n++)i.push(e[t[n]]);this.fields=t,this.fieldsMD=i}},{key:"_buildRowData",value:function(){for(var e=[],t=[],i={},n={},o={},r=this.fields.length,s=0;s<r;s++){this.fields[s];var a=this.fieldsMD[s],l=a.name;e.push(l);var u=a.label;t.push(u),i[l]=a.label,n[a.label.replace(/\W/g,"")]=a.type,o[l]=a.type}this.headerClassMap=new d(Object.keys(n),"Th",n,null,!0).build(),this.rowClassMap=new d(e,"Td",o).build(),this.recordKeys=e,this.fieldLabels=t,this.fieldLabelMap=i}},{key:"_buildHeaderActions",value:function(){var e={icon:"sf-icon-delete",position:"right",hidden:!1,invisible:!0};this.headerActions=[e,e]}},{key:"_buildRowActions",value:function(e){var t=[],i={icon:"sb-icon-plus",title:this.customLabels.lbl_add_segment,position:"right",hidden:!1,invisible:this.groupModel.quoteModel.isAmendmentOrChangeQuote,onTapFunction:function(){this.fire("add-tapped",{index:this.index})}},n={icon:"sf-icon-delete",title:this.customLabels.lbl_delete_custom_segments,position:"right",hidden:!1,invisible:0==e||this.groupModel.quoteModel.isAmendmentOrChangeQuote,onTapFunction:function(){this.fire("delete-tapped",{index:this.index})}};return t.push(i),t.push(n),t}},{key:"_hideSelection",value:function(e){return 0===e?{hidden:!0,type:"invisible"}:null}},{key:"_updateData",value:function(e){for(var t=this.lineModels.length,i=0;i<t;i++)for(var n=Object.keys(e),o=0;o<n.length;o++){var r=n[o],s=e[r],a="lineModels."+i+"."+r;this.set(a,s)}}},{key:"_updateSegmentTable",value:function(){this._updateData({selected:!1})}},{key:"_getCustomSegmentUpdates",value:function(){for(var e={updatedLineKeys:[],startDates:[],endDates:[],segmentLabels:[]},t=this.lineModels.length,i=0;i<t;i++){var n=this.lineModels[i].lineVO,o=this.lineModels[i].lineVO.record;e.updatedLineKeys.push(n.key),e.segmentLabels.push(o[this.constants.SEGMENT_LABEL_FIELD]),e.startDates.push(o[this.constants.START_DATE_FIELD]),e.endDates.push(o[this.constants.END_DATE_FIELD])}return e}},{key:"_validateCustomSegmentLabels",value:function(){this.hasInvalidSegmentLabels=!1;for(var e={},t=this.lineModels.length,i=0;i<t;i++){var n=this.lineModels[i].lineVO.record[this.constants.SEGMENT_LABEL_FIELD];if(null==n||""===n.trim())return void(this.hasInvalidSegmentLabels=!0);if(e[n])return void(this.hasInvalidSegmentLabels=!0);e[n]=!0}}},{key:"_validateCustomSegmentDates",value:function(){for(var e=this.lineModels.length,t=0;t<e;t++){var i=this.lineModels[t].lineVO,n=i.record[this.constants.START_DATE_FIELD],o=i.record[this.constants.END_DATE_FIELD],r=new Date(n),s=new Date(o);if(null==n||null==o)return void(this.hasInvalidDateFormat=!0);if(s<r)return void(this.hasInvalidSegmentDates=!0);if(0<=t-1){var a=this.lineModels[t-1].lineVO,l=new Date(a.record[this.constants.END_DATE_FIELD]),u=Date.parse(new Date(l.getFullYear(),l.getMonth(),l.getDate()+1)),d=Date.parse(new Date(r.getFullYear(),r.getMonth(),r.getDate()));if(this.editorModel.data.settings.allowsNonConsecutiveCustomSegments){if(r<=l)return void(this.hasOverlappingSegments=!0)}else if(u!=d)return void(this.hasNonConsecutiveDates=!0)}}}},{key:"_resetProperties",value:function(){this.set("errors",[]),this.headerSelected=!1,this.hasInvalidSegmentLabels=!1,this.hasInvalidSegmentDates=!1,this.hasNonConsecutiveDates=!1,this.hasOverlappingSegments=!1,this.hasInvalidDateFormat=!1}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[o.VIEWPORT_CHANGED]=this.viewportChanged,e}},{key:"listeners",get:function(){return{"sb-cancel-custom-segment":"_onCancel","add-tapped":"_onAddByLine","delete-tapped":"_onDeleteByLine"}}},{key:"observers",get:function(){return["_dataChanged(dataLineModels)","_lineModelChanged(lineModels)","_handleCustomSegmentsResponseChanged(updateCustomSegmentsResponse)","_handleErrorResponseChanged(errorResponse)","_toggleAllCheckBoxes(headerSelected)"]}},{key:"constants",get:function(){return this.editorModel.constants}},{key:"quoteLineMD",get:function(){return this.editorModel.md.fieldsMap[this.constants.QUOTE_LINE]}},{key:"customLabels",get:function(){return this.editorModel.data.customLabels}}]),r=e)),t("CustomSegmentDialog",r),Polymer(r)}}}),System.register("quotes/dialogs/sb-discount-schedule-dialog/DiscountScheduleDialog.js",["common/layout/tables/TableClassBuilder.js","quotes/models/DiscountTierModel.js","quotes/models/DiscountTiersValidator.js","common/data/cache/Cache.js","common/core/sb-page-container/PageContainer.js","common/core/Events.js"],function(t,e){var i,a,r,o,c,h,s;return{setters:[function(e){i=e.TableClassBuilder},function(e){a=e.DiscountTierModel},function(e){r=e.DiscountTiersValidator},function(e){e.Cache},function(e){o=e.PageContainer},function(e){c=e.Events,h=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("DiscountScheduleDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-discount-schedule-dialog",this.properties={discountSchedule:{type:Object},discountUnit:{type:String},lineModel:Object,schedule:{type:Object,notify:!0},error:{type:Object,notify:!0},model:{type:Object,value:{}},viewport:{type:Object,value:function(){return o.getViewport()}},isMobile:{type:Boolean,value:!1},dialogTapped:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.addEventListener("sb-cancel-ds",this.onCancel),this.addEventListener("data-changed",function(e){e.detail&&e.detail.path=="data."+this.discountUnitField&&this.discountUnit!=e.detail.value&&(this.discountUnit=e.detail.value,this._calculateDiscountAmounts(this.discountTiers),this.buildRowData())}.bind(this)),this._handleDialogTap(),this._handleDialogMouseEvents()}},{key:"_createErrorHandler",value:function(){this.error&&(this.errors=this.error.validations?this.error.validations:[this.error.message])}},{key:"_retrieveSchedule",value:function(e){e&&(this.showSpinner=!0,this.context={currencyCode:this.editorModel.quoteModel.quoteVO.record.CurrencyIsoCode,fieldSetName:"DiscountScheduleModal"},this.$.loadDiscountScheduleService.uid=void 0,this.$.loadDiscountScheduleService.context=this.context,this.$.loadDiscountScheduleService.uid=e,this.$.loadDiscountScheduleService.spinner=!1)}},{key:"_buildDialog",value:function(){if(this.schedule){this._setConstants(this.constants),this.discountTiers=void 0,this.currencyCode=this.editorModel.quoteModel.quoteVO.record.CurrencyIsoCode,this.editable=!!this.schedule[this.overrideBehaviorField],this.savedTiers=[],this.discountSchedule=JSON.parse(JSON.stringify(this.schedule)),this.data=this.discountSchedule,this.discountSchedule[this.discountUnitField]=this.discountSchedule[this.usePriceForAmountField]?"Price":this.discountSchedule[this.discountUnitField],this._setDSFields(),this.showRevertBtn=!!this.discountSchedule[this.originalScheduleField],this.discountUnit=this.discountSchedule[this.usePriceForAmountField]?"Price":this.discountSchedule[this.discountUnitField],this.buildRowData();var e=this.buildTiers();this._calculateDiscountAmounts(e),this.buildFieldData(),this.discountTiers=e,this._createActions(),this._toggleEditableClasses(),this.isMobile&&this._buildTabData(),this.showSpinner=!1}}},{key:"_discountScheduleResponseChanged",value:function(){var e=this.discountScheduleResponse.Id;if(this.lineModel.lineVO.record[this.discountScheduleField]=e,this.lineModel.lineVO.record[this.segmentKeyField])for(var t=this.lineModel.segments,i=0,n=t.length;i<n;i++)t[i].lineVO.record[this.discountScheduleField]=e;"save"===this.action?this.onCancel():(this.schedule=this.discountScheduleResponse,this.showRevertBtn=this.discountScheduleResponse[this.originalScheduleField]),this.domHost.onFlagCalculate()}},{key:"_discountScheduleChanged",value:function(e){e.path=="discountSchedule."+this.discountUnitField&&(this.discountUnit=e.value,this._calculateDiscountAmounts(this.discountTiers),this.buildRowData())}},{key:"buildTiers",value:function(){var t=[],e=this._retrieveRecords();return this.previousLowerBound=void 0,e.forEach(function(e){if(null!=e[this.lowerBoundField]){if("Percent"==this.discountUnit&&this.previousLowerBound!=e[this.lowerBoundField])this.previousLowerBound=e[this.lowerBoundField];else if("Percent"==this.discountUnit||e.CurrencyIsoCode!=this.currencyCode)return;t.push(new a(e,this.discountSchedule))}else t.push(new a(e,this.discountSchedule))}.bind(this)),t}},{key:"buildFieldData",value:function(){if(!this.fieldNames){var e=this.editorModel.md.fieldsMap[this.discountScheduleField];e[this.discountUnitField].required=!0,this.fieldTableData=e,this.fieldNames=["Name",this.discountUnitField]}}},{key:"buildRowData",value:function(){this.fieldsArray&&h(c.DELETE_GROUPS);var e=this.editorModel.data.discountScheduleModalFieldNames,o=this.editorModel.md.fieldsMap[this.tierField],r=[],s={},a={},l={},t=this.editorModel.data.customLabels.lbl_price,u={};e.forEach(function(e){u[e]="template."+e}.bind(this)),"Price"===this.discountUnit&&(u[t]="template."+t,o[t]=JSON.parse(JSON.stringify(o[this.discountAmountField])),o[t].label=t+"("+(this.currencyCode||this.editorModel.data.currencySymbol)+")",o[t].name=t),this.fieldsArray=Object.keys(u);var d=[];this.fieldsArray.forEach(function(e){if(this._isFieldShown(e)){var t,i=o[e],n=i.name;"currency"===i.type&&(i.scale=this._getPriceScale()),e===this.numberField?t="#":e===this.discountAmountField?(t=i.label.replace("{0}",this.currencyCode||this.editorModel.data.currencySymbol),i.label=t):t=i.label,d.push(u[e]),r.push(t),s[n]=i.label,a[i.label.replace(/\W/g,"")]=i.type,l[u[e]]=i.type}}.bind(this)),this.set("model.fieldsMD",o),this.isMobile||(this.set("model.selected",!1),this.set("model.headerClassMap",new i(Object.keys(a),"Th",a,null,!0).build()),this.set("model.fieldLabels",r)),this.set("model.rowClassMap",new i(d,"Td",l).build()),this.set("model.fieldLabelMap",s),this.set("model.recordKeys",d)}},{key:"onRevert",value:function(){this._retrieveSchedule(this.discountSchedule[this.originalScheduleField])}},{key:"onAddLine",value:function(e){var t=this._createBlankTierRecord(),i=new a(t,this.discountSchedule);i.rowActions=this._createRowActions(),e.detail&&void 0!==e.detail.index?this.splice("discountTiers",e.detail.index+1,0,i):this.push("discountTiers",i),this._renumberLines(this.discountTiers,!0)}},{key:"onDeleteLines",value:function(e){if(e.detail&&e.detail.index)this.splice("discountTiers",e.detail.index,1);else{for(var t=0,i=this.discountTiers.length;t<i&&this.discountTiers[t];t++)this.discountTiers[t].selected&&(this.splice("discountTiers",t,1),t--);this.set("model.selected",!1)}this._selectCheckboxes(!1),this._renumberLines(this.discountTiers,!0)}},{key:"onSave",value:function(e){if(this.errors=void 0,this.tiers=this._processForSaving(),this.tiers){this.errors=void 0,this.action=e.currentTarget.attributes.id.value;var t=void 0;this.discountSchedule[this.userDefinedField]&&this.lineModel.lineVO.record.Id===this.discountSchedule[this.quoteLineField]?(t={discountScheduleJSON:JSON.stringify(this.discountSchedule),tiersJSON:JSON.stringify(this.tiers),ignoreValidate:!0,context:JSON.stringify(this.context)},this.$.discountScheduleUpdaterService.uid=this.discountSchedule.Id,this.$.discountScheduleUpdaterService.model=t):(this.discountSchedule[this.quoteLineField]=this.lineModel.lineVO.record.Id,this.discountSchedule[this.userDefinedField]=!0,this.discountSchedule[this.originalScheduleField]=this.discountSchedule.Id,t={discountScheduleJSON:JSON.stringify(this.discountSchedule),tiersJSON:JSON.stringify(this.tiers),ignoreValidate:!0,context:JSON.stringify(this.context)},this.$.discountScheduleClonerService.model=t)}}},{key:"onCancel",value:function(){h(c.DELETE_GROUPS),this.dialogTapped=!1,this.dialogOverlapping=!1,this.set("model.fieldsEditable",!1),this.errors=void 0,this.schedule=void 0,this.discountSchedule=void 0,this.discountTiers=void 0,this.discountScheduleId=void 0,this.$.dialog.close()}},{key:"_processForSaving",value:function(){var e=this._sortTiers(this.savedTiers),t=this._sortTiers(this.discountTiers);if(!e||!t)return null;var i=e.concat(t);this._renumberLines(i,!1),this.set("discountTiers",t),this._updateActions(),this._calculateDiscountAmounts(i),this._createTiers(i);var n=new r(this.discountSchedule,this.editorModel).validate(i);if(0<n.size)return this._createError(n),null;var o=[];return i.forEach(function(e){e.tiers.forEach(function(e){o.push(e)}.bind(this))}.bind(this)),this.discountSchedule[this.tiersField].records=o,this.discountSchedule[this.tiersField].totalSize=o.length,"Price"===this.discountUnit?(this.discountSchedule[this.discountUnitField]="amount",this.discountSchedule[this.usePriceForAmountField]=!0):this.discountSchedule[this.usePriceForAmountField]=!1,o}},{key:"_setConstants",value:function(e){this.discountAmountField=e.DISCOUNT_AMOUNT_FIELD,this.discountScheduleField=e.DISCOUNT_SCHEDULE_FIELD,this.discountRateField=e.ADDITIONAL_DISCOUNT_RATE_FIELD,this.discountUnitField=e.DISCOUNT_UNIT_FIELD,this.lowerBoundField=e.LOWER_BOUND_FIELD,this.numberField=e.NUMBER_FIELD,this.originalScheduleField=e.ORIGINAL_SCHEDULE_FIELD,this.overrideBehaviorField=e.OVERRIDE_BEHAVIOR_FIELD,this.quantityField=e.QUANTITY_FIELD,this.quoteLineField=e.QUOTE_LINE,this.segmentKeyField=e.SEGMENT_KEY_FIELD,this.specialPriceField=e.SPECIAL_PRICE_FIELD,this.tierField=e.DISCOUNT_TIER_FIELD,this.tiersField=e.DISCOUNT_TIERS_FIELD,this.upperBoundField=e.UPPER_BOUND_FIELD,this.usePriceForAmountField=e.USE_PRICE_FOR_AMOUNT_FIELD,this.userDefinedField=e.USER_DEFINED_FIELD}},{key:"_createError",value:function(e){for(var t=[],i=0,n=this.discountTiers.length;i<n;i++){var o=this.discountTiers[i].template[this.numberField];e&&e.get(o)&&t.push(e.get(o))}0<t.length&&(this.errors=t)}},{key:"_createActions",value:function(){if(this.discountTiers){for(var e=[],t=0,i=this.discountTiers.length;t<i;t++){var n=this._createRowActions(t);this.set("discountTiers."+t+".rowActions",n)}e.push({icon:"sb-icon-plus",position:"right",hidden:!0,invisible:!0}),e.push({icon:"sf-icon-delete",position:"right",hidden:!0,invisible:!0}),this.isMobile||this.set("model.headerActions",e)}}},{key:"_createRowActions",value:function(){return[{icon:"sb-icon-plus",title:"Add",position:"right",invisible:!1,hidden:!1,onTapFunction:function(){this.fire("add-tapped",{index:this.index})}},{icon:"sf-icon-delete",title:"Delete",position:"right",invisible:0==(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1),hidden:!1,onTapFunction:function(){this.fire("delete-tapped",{index:this.index})}}]}},{key:"_retrieveVisibleRecords",value:function(e){var o=[],r=this.lineModel.lineVO.record[this.quantityField];if(e.forEach(function(e){var t=e[this.lowerBoundField],i=e[this.upperBoundField],n=this.discountSchedule[this.userDefinedField];if(!i)return t<=r||n?o.push(e):o;t<=r&&i<=r?this.savedTiers.push(new a(e,this.discountSchedule)):t<=r&&r<i?o.push(e):n&&r<t&&o.push(e)}.bind(this)),0==o.length&&0<e.length){var t=e.length-1,i=e[0][this.lowerBoundField],n=e[t][this.upperBoundField],s=this._createBlankTierRecord();r<i?s[this.numberField]=1:n<=r&&(s[this.numberField]=e[t][this.numberField]+1,s[this.lowerBoundField]=n),o.push(s)}return o}},{key:"_retrieveRecords",value:function(){var e=[];if(this.discountSchedule[this.tiersField])e=this.discountSchedule[this.tiersField].records,"Current Tier Only"===this.discountSchedule[this.overrideBehaviorField]?(e=this._retrieveVisibleRecords(e),0<this.savedTiers.length&&(this.editorModel.disabledDiscountTier=e[0][this.numberField])):this.editorModel.disabledDiscountTier=void 0;else{var t=this._createBlankTierRecord();t[this.numberField]=1,e.push(t)}return e}},{key:"_calculateDiscountAmounts",value:function(e){if(e){var i=this.lineModel.lineVO.record[this.specialPriceField];e.forEach(function(e){var t=e.template;"Price"===this.discountUnit?(t.Price=t.Price||0===t.Price?t.Price:i-t[this.discountAmountField],t[this.discountAmountField]=i-t.Price):(t[this.discountRateField]=t[this.discountRateField]||0,t[this.discountAmountField]=t[this.discountAmountField]||0),t[this.constants.UPPER_BOUND_FIELD]||0==t[this.constants.UPPER_BOUND_FIELD]||(t[this.constants.UPPER_BOUND_FIELD]=null)}.bind(this))}}},{key:"_renumberLines",value:function(e,t){for(var i="Current Tier Only"===this.discountSchedule[this.overrideBehaviorField]&&0<this.savedTiers.length?e[0].template[this.numberField]:1,n=0,o=e.length;n<o;n++)e[n].template[this.numberField]!=i&&(t?this.set("discountTiers."+n+".template."+this.numberField,i):e[n].template[this.numberField]=i),i++}},{key:"_sortTiers",value:function(e){var i=[],n={},o=[];return e.forEach(function(e){var t=e.template[this.lowerBoundField];if(n[t])return this.errors=[this.editorModel.data.customLabels.msg_identical_lower_bounds],null;i.push(t),n[t]=e}.bind(this)),i.sort(function(e,t){return e-t}),i.forEach(function(e){var t=n[e];o.push(t)}.bind(this)),o}},{key:"_createTiers",value:function(e){var i=this.editorModel.data.settings.currencyIsoCodes;e.forEach(function(t){t.tiers=[],i?i.forEach(function(e){if(e==this.currencyCode)return t.template.CurrencyIsoCode=e,void t.tiers.push(t.template);"Percent"!==this.discountUnit&&t.tiers.push(this._createMultiCurrencyRecord(t.template,e))}.bind(this)):t.tiers.push(t.template)}.bind(this))}},{key:"_selectCheckboxes",value:function(e){if(this.discountTiers)for(var t=1,i=this.discountTiers.length;t<i;t++)this.discountTiers[t]&&this.set("discountTiers."+t+".selected",e)}},{key:"_createMultiCurrencyRecord",value:function(e,t){var i=JSON.parse(JSON.stringify(e));return i.CurrencyIsoCode=t,i[this.discountAmountField]=0,i[this.discountRateField]=i[this.discountRateField]||0,delete i.Price,i}},{key:"_createBlankTierRecord",value:function(){var t={};return this.fieldsArray.forEach(function(e){t[e]=null,t.CurrencyIsoCode=this.currencyCode,t[this.discountAmountField]=0,t[this.discountRateField]=0}.bind(this)),t}},{key:"_handleIconAction",value:function(e){var t=e.detail.event.type,i=e.detail.model;switch(this.lineModel=this.editorModel.quoteModel.lineModelsByKey[i.serviceModel.keys[0]],this.discountScheduleId=i.serviceModel.scheduleId,t){case"mouseenter":this.isMobile||this.dialogTapped||(this._toggleDialogClasses(!0),this.$.dialog.open());break;case"mouseleave":this.debounce("closeDialog",function(){this.isMobile||this.dialogTapped||this.dialogOverlapping||this.onCancel()}.bind(this),1);break;case"tap":this._openDialog()}}},{key:"_openDialog",value:function(){this.dialogTapped||(this.dialogTapped=!0,this.$.dialog.open(),this._toggleDialogClasses(!1))}},{key:"_toggleDialogClasses",value:function(e){var t=Polymer.dom(this.$.dialog.root),i=t.querySelector(".sbDialog");this.toggleClass("boxShadow",e,i),this.toggleClass("noMarginBottom",e,t.querySelector("#content"))}},{key:"_handleDialogTap",value:function(){this.addEventListener("sb-tap-ds",function(){!this.isMobile&&this.dialogOverlapping&&this._openDialog()}.bind(this))}},{key:"_handleDialogMouseEvents",value:function(){if(!this.isMobile){var e=Polymer.dom(this.$.dialog.root).querySelector(".sbDialog");e.addEventListener("mouseenter",function(){this.dialogTapped||(this.dialogOverlapping=!0)}.bind(this)),e.addEventListener("mouseleave",function(){!this.dialogTapped&&this.dialogOverlapping&&this.onCancel()}.bind(this))}}},{key:"_toggleEditableClasses",value:function(){this.set("model.fieldsEditable",this.editable&&this.dialogTapped),this.discountTiers&&(this._setDisabled(),this._updateActions())}},{key:"_updateActions",value:function(){for(var e=0,t=this.discountTiers.length;e<t;e++){var i=this.discountTiers[e].rowActions;if(i)for(var n=0,o=i.length;n<o;n++){var r=0==e&&"sf-icon-delete"==i[n].icon;this.set("discountTiers."+e+".rowActions."+n+".hidden",!this.model.fieldsEditable),this.set("discountTiers."+e+".rowActions."+n+".invisible",r)}}if(!this.isMobile&&this.model.headerActions)for(var s=0,a=this.model.headerActions.length;s<a;s++)this.set("model.headerActions."+s+".hidden",!this.model.fieldsEditable)}},{key:"_setDisabled",value:function(){for(var e=0,t=this.discountTiers.length;e<t;e++)this.set("discountTiers."+e+".disabled",!this.model.fieldsEditable)}},{key:"_setDSFields",value:function(){var e=this.editorModel.quoteModel.quoteVO;this.discountSchedule[this.constants.QUOTE]=e.record.Id;var t=void 0;e.record[this.constants.ACCOUNT_FIELD]?t=e.record[this.constants.ACCOUNT_FIELD].Id:e.record[this.constants.OPPORTUNITY_FIELD]&&(t=e.record[this.constants.OPPORTUNITY_FIELD].AccountId),this.discountSchedule[this.constants.ACCOUNT_ID_FIELD]=t}},{key:"_isFieldShown",value:function(e){return!("Percent"===this.discountUnit&&e===this.discountAmountField||"Amount"===this.discountUnit&&e===this.discountRateField||"Price"===this.discountUnit&&(e===this.discountRateField||e===this.discountAmountField))}},{key:"_buildTabData",value:function(){var e=[],t=["Details","Tiers"];if(this.tabs!==e){for(var i=0,n=t.length;i<n;i++){var o=t[i],r="t"+i,s=void 0,a=void 0;"Details"===o?(s=["data","fieldNames","md","numColumns","disabled"],a="sb-field-table"):"Tiers"===o&&(s=["discountTiers","model","editorModel"],a="sb-ds-tiers"),e.push({name:r,label:o,bind:s,pageComponent:a})}this.tabs=e}}},{key:"_getPriceScale",value:function(){var e=this.discountSchedule[this.constants.PRICE_SCALE_FIELD];return null!=e?e:this.editorModel.data.settings.priceScale}},{key:"viewportChanged",value:function(){this.isMobile=!(!this.viewport||!this.viewport.isMobile())}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[c.SCHEDULE_ACTION]=this._handleIconAction,e[c.VIEWPORT_CHANGED]=this.viewportChanged,e}},{key:"observers",get:function(){return["_retrieveSchedule(discountScheduleId)","_buildDialog(schedule)","_discountScheduleResponseChanged(discountScheduleResponse)","_discountScheduleChanged(discountSchedule.*)","_createErrorHandler(error)","_toggleEditableClasses(dialogTapped)","_selectCheckboxes(model.selected)"]}},{key:"constants",get:function(){return this.editorModel.constants}},{key:"listeners",get:function(){return{"delete-tapped":"onDeleteLines","add-tapped":"onAddLine"}}}]),s=e)),t("DiscountScheduleDialog",s),Polymer(s)}}}),System.register("quotes/dialogs/sb-favorite-dialog/FavoriteDialog.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FavoriteDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-favorite-dialog",this.properties={favName:String}}},{key:"ready",value:function(){this.addEventListener("sb-cancel-fav",this.onCancel)}},{key:"onSave",value:function(){if(""!=this.favName&&void 0!==this.favName){var e=[];if(this.favoritedGroup)for(var t=this.groupLines.length,i=0;i<t;i++)this.groupLines[i].component||e.push(this.groupLines[i].lineVO.key);else e.push(this.favoritedLine[0]);this.fire("sb-favorite-saved",{keys:e,name:this.favName,groupKey:this.favoritedGroup}),this.favoritedGroup=this.favoritedLine=this.groupLines=null,this.favName="",this.$.dialog.toggle()}else this.errors=["Favorite name cannot be left blank."]}},{key:"onCancel",value:function(){this.favoritedGroup=this.favoritedLine=this.groupLines=null,this.favName="",this.$.dialog.toggle()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),i=e)),t("FavoriteDialog",i),Polymer(i)}}}),System.register("quotes/dialogs/sb-pricebook-dialog/PricebookDialog.js",["common/data/format/DataBuilder.js","common/core/Events.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.DataBuilder},function(e){o=e.Events,r=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("PricebookDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-pricebook-dialog",this.properties={pricebooks:Array,selectedPricebook:String,error:{type:Object,observer:"_onError"}}}},{key:"ready",value:function(){this.$.select.addEventListener("change",function(e){e.detail&&(this.selectedPricebook=e.detail.value)}.bind(this)),this.$.dialog.addEventListener("sb-close-dialog",this.onCancel.bind(this))}},{key:"_onError",value:function(){this.error&&r(o.GENERIC_ERROR,{errorMessage:this.error.message||this.error})}},{key:"open",value:function(){this.$.pricebookLoaderService.addEventListener("response-changed",function(e){var t=[],i=e.detail.value,n=i.length;if(!1!==i.success){for(var o=0;o<n;o++)t.push({value:i[o].Id,label:i[o].Name,selected:!1});t[0].selected=!0,this.selectedPricebook=t[0].value,this.$.select.value=this.selectedPricebook,this.$.select.isRequired=!0,this.pricebooks=t,this.$.dialog.toggle()}else this.error=i.error}.bind(this)),this.$.pricebookLoaderService.uid="",this.$.pricebookLoaderService.context=""}},{key:"onSave",value:function(){this.$.pricebookSaverService.addEventListener("response-changed",function(e){this.fire("pricebook-saved",e.detail.value)}.bind(this)),this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_ID_FIELD]=this.selectedPricebook,this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_LOOKUP_ID_FIELD]=this.selectedPricebook,this.$.pricebookSaverService.model=(new i).add("pricebookId",this.selectedPricebook).add("quoteId",this.editorModel.quoteModel.quoteVO.record.Id).add("oppId",this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.OPPORTUNITY_ID_FIELD]).build(),this.$.dialog.toggle()}},{key:"onCancel",value:function(){this.fire("le-action-tapped",{customAction:{eventHandlerName:"onCancel"}})}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),s=e)),t("PricebookDialog",s),Polymer(s)}}}),System.register("quotes/dialogs/sb-pricing-guidance-dialog/PricingGuidanceDialog.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("PricingGuidanceDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-pricing-guidance-dialog",this.properties={lineVO:Object,isPricingRecommendationAvailable:Boolean,pricingGuidanceArray:Array,isPricingGuidanceAvailable:Boolean,isMobileDevice:Boolean,quoteLineObjectArray:Array}}},{key:"ready",value:function(){this.addEventListener("sb-cancel-fav",this.onCancel)}},{key:"onAcceptPricingGuidance",value:function(){this.fire("sb-accept-pricing-guidance",{lineVO:this.lineVO,headerValues:this.headerValues,lineItemValues:this.lineItemValues}),this.$.dialog.toggle()}},{key:"onCancel",value:function(){this.$.dialog.toggle(),this.properties.lineVO={},this.properties.isPricingRecommendationAvailable=!1,this.properties.pricingGuidanceArray=[],this.properties.isPricingGuidanceAvailable=!1,this.properties.isMobileDevice=!1,this.properties.quoteLineObjectArray=[]}},{key:"getPricingGuidanceValue",value:function(e,t){return e[t]}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),i=e)),t("PricingGuidanceDialog",i),Polymer(i)}}}),System.register("quotes/layout/sb-cse-table-cell/CSETableCell.js",["quotes/models/Constants.js","common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){e.Constants},function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("CSETableCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-cse-table-cell",this.properties={item:String,disabled:Boolean,hidden:Boolean,value:{notify:!0},data:{type:Object,value:null},model:{type:Object,value:null},render:{type:Boolean,value:!1},index:Number,viewport:{type:Object,value:function(){return i.getViewport()}}}}},{key:"_buildCellObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this.buildCell(e,t,i,n)}},{key:"buildCell",value:function(){for(var e=[this.constants.SEGMENT_LABEL_FIELD,this.constants.START_DATE_FIELD,this.constants.END_DATE_FIELD],t=this.model.groupModel.editorModel.md.fieldsMap[this.constants.QUOTE_LINE],i=[],n=0;n<e.length;n++){var o=t[e[n]];i[e[n]]=o}this.editing=!0,this.viewport&&this.viewport.isMobile()&&(this.render=!0,0===this.index&&(this.editing=!1)),this.disabled=!1,this.md=i[this.item]}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_buildCellObserver(item, value, model, data)"]}},{key:"constants",get:function(){return this.model.groupModel.editorModel.constants}}]),o=e)),t("CSETableCell",o),Polymer(o)}}}),System.register("quotes/layout/sb-custom-action/CustomAction.js",["common/core/sb-page-container/PageContainer.js","common/core/AppContext.js","common/core/Events.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.PageContainer},function(e){e.AppContext},function(e){o=e.Events,r=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("CustomAction",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-custom-action",this.properties={customAction:Object,model:Object,actionHidden:Boolean,viewport:{type:Object,value:function(){return i.getViewport()}},button:{type:Boolean,value:null},span:{type:Boolean,value:null},groupAction:{type:Boolean,value:!1},allOptional:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.customAction&&this.customAction.isSeparator&&(this.button=!1,this.span=!0),this.addEventListener("paper-dropdown-close",function(e){this.$$("#menuButton")&&this.$$("#menuButton").close()}),this.horizontalAlign||(this.horizontalAlign=this.span?"left":"right"),this.horizontalOffset=this.span?18:0,this.verticalOffset=this.span?-30:0}},{key:"triggerCustomAction",value:function(e){if("showDSModal"!==this.customAction.eventHandlerName)"tap"===e.type&&("onQuickSave"===this.customAction.eventHandlerName&&r(o.TOGGLE_QUICKSAVE,{enable:!1}),this.fire("le-action-tapped",{customAction:this.customAction,model:this.model}),this.fire("paper-dropdown-close"));else{if(this.classList.contains("swipe-menu-item")&&"tap"!==e.type)return;r(o.SCHEDULE_ACTION,{event:e,model:this.model})}}},{key:"_showAction",value:function(e,t){return!e.isHidden(t)}},{key:"_getLabel",value:function(e,t){return(!e.icon||t&&(t.isMobile()||t.S.down))&&"Line"!==e.renderLocation?e.label:null}},{key:"_hasMenu",value:function(e,t,i,n){return!i&&!n||e.hasMenu&&!(t&&(t.isMobile()||t.S.down))}},{key:"_hasMenuButton",value:function(e,t,i,n){return this._hasMenu(e,t,i,n)&&!n}},{key:"_getButtonClass",value:function(e,t,i,n,o){return(o?"groupButton ":"")+(e.icon&&!this._getLabel(e,t)?e.icon:"")+(e.first?"":" notFirst")+(e.last&&!this._hasMenu(e,t,i,n)?"":" notLast")+(e.primary?" primary":"")}},{key:"_getMenuClass",value:function(e,t,i){return!t&&i?"mobileGroupMenu":(i?"groupMenu ":"")+(e.last?"":"notLast")}},{key:"_toggleQuoteButton",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.allOptional=e,this._toggleButton()}},{key:"_toggleLineButton",value:function(){this._toggleButton()}},{key:"_toggleButton",value:function(){this.viewport&&this.viewport.isMobile()&&!this.model.favorite&&"removeFromFavBtn"===this.customAction.caClass&&this.style.transform&&this.parentElement.parentElement._initSwipeMenu(this.parentElement),this._setButtonClassAndLabel()}},{key:"_setButtonClassAndLabel",value:function(){this.viewport&&this.viewport.isMobile()&&this.model.favorite&&"removeFromFavBtn"===this.customAction.caClass&&this.parentElement&&(Polymer.dom(this.parentElement).flush(),this.parentElement.parentElement._initSwipeMenu(this.parentElement))}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport,this._setButtonClassAndLabel()}},{key:"toggleQuickSaveButton",value:function(e){"onQuickSave"===this.customAction.eventHandlerName&&(this.$$("#mainButton").disabled=!e.detail.enable)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[o.VIEWPORT_CHANGED]=this.viewportChanged,e[o.TOGGLE_QUICKSAVE]=this.toggleQuickSaveButton,e}},{key:"observers",get:function(){return["_toggleQuoteButton(model.allOptional)","_toggleLineButton(model.favorite)"]}}]),s=e)),t("CustomAction",s),Polymer(s)}}}),System.register("quotes/layout/sb-ds-table-cell/DSTableCell.js",["quotes/models/Constants.js","common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){e.Constants},function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("DSTableCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-ds-table-cell",this.properties={item:String,disabled:Boolean,hidden:Boolean,value:{notify:!0},data:{type:Object,value:null},model:{type:Object,value:null},index:Number,viewport:{type:Object,value:function(){return i.getViewport()}}}}},{key:"_buildCellObserver",value:function(e,t,i,n,o){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o)return this.buildCell(e,t,i,n,o)}},{key:"buildCell",value:function(){var e=this.model.md.fieldsMap[this.constants.DISCOUNT_TIER_FIELD],t=this.item.replace("template.","");void 0===this.value&&(this.value=""),this.handleOriginalValues(),this.editing=this.isEditable(t,e);var i=e[t];i.CurrencyIsoCode=this.model.quoteModel.quoteVO.record.CurrencyIsoCode,this.md=i}},{key:"isEditable",value:function(e,t){return e!==this.constants.NUMBER_FIELD&&(e!==this.constants.LOWER_BOUND_FIELD||this.data.template[this.constants.NUMBER_FIELD]!==this.model.disabledDiscountTier)&&(0!==this.index||!this.viewport||!this.viewport.isMobile())&&t[e].updateable}},{key:"handleOriginalValues",value:function(){!this.data.original&&this.data.template&&(this.data.original={},this.data.original.template=JSON.parse(JSON.stringify(this.data.template))),this.data.original&&(this.$.field.originalValue=this.get("data.original."+this.item))}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_buildCellObserver(item, model, data, index, viewport)"]}},{key:"constants",get:function(){return this.model.constants}}]),o=e)),t("DSTableCell",o),Polymer(o)}}}),System.register("quotes/layout/sb-ds-tiers/DSTiers.js",["common/core/Events.js"],function(t,e){var i,o;return{setters:[function(e){i=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("DSTiers",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-ds-tiers",this.properties={discountTiers:{type:Array,notify:!0},model:{type:Object,notify:!0}}}},{key:"_hideSelection",value:function(e){return 0===e&&this.model.fieldsEditable?{hidden:!0,type:"invisible"}:null}},{key:"_deleteGroups",value:function(){this.$.header.$.header.destroyGroup(),Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row").forEach(function(e){e.cols=void 0,e.$.row.destroyGroup()}.bind(this))}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[i.DELETE_GROUPS]=this._deleteGroups,e}}]),o=e)),t("DSTiers",o),Polymer(o)}}}),System.register("quotes/layout/sb-field-set-table/FieldSetTable.js",["common/core/sb-page-container/PageContainer.js","common/core/Events.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.PageContainer},function(e){o=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FieldSetTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-field-set-table",this.properties={editorModel:Object,data:{type:Object,notify:!0},numColumns:{type:Number,value:1},objectName:String,viewport:{type:Object,value:function(){return i.getViewport()}},model:Object,itemEditableMap:{type:Object,default:{}}}}},{key:"_generateColumnsObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this.generateColumns(e,t,i,n)}},{key:"generateColumns",value:function(){this.isMobile=this.viewport&&this.viewport.isMobile();var e=[],t=void 0,i=[],n=[],o=[];if(this.objectName==this.editorModel.constants.QUOTE_LINE_GROUP){for(var r=this.editorModel.fieldsetMap.groupFieldNames.slice(),s=0,a=r.length;s<a;s++)this.isMobile||this.editorModel.constants.DESCRIPTION_FIELD!=r[s]&&"Name"!=r[s]||(r.splice(s,1),s--);t=(e=r).length}else this.objectName==this.editorModel.data.quoteObjectName&&(e=this.editorModel.fieldsetMap.quoteFieldNames,t=this.editorModel.fieldsetMap.quoteFieldNames.length);for(var l=0;l<t;l++)l%this.numColumns==0?i.push(e[l]):l%this.numColumns==1?n.push(e[l]):o.push(e[l]);1==this.numColumns?this.columnOneWidth="td1":2==this.numColumns?(this.columnOneWidth="td2",this.columnTwoWidth="td2"):(this.columnOneWidth="td3",this.columnTwoWidth="td3",this.columnThreeWidth="td3"),this.setColumns(i,n,o)}},{key:"setColumns",value:function(e,t,i){0<e.length&&(this.$.firstColumn.model=this.model,this.$.firstColumn.group||(this.$.firstColumn.group=e)),0<t.length&&(this.$.secondColumn.model=this.model,this.$.secondColumn.group||(this.$.secondColumn.group=t)),0<i.length&&(this.$.thirdColumn.model=this.model,this.$.thirdColumn.group||(this.$.thirdColumn.group=i))}},{key:"modelChanged",value:function(e){this.objectName&&this.editorModel&&this.objectName!==this.editorModel.data.quoteObjectName||"GroupModel"===this.model.modelType||("model.quoteVO.fieldVisibility"===e.path?this._visibilityChanged():"model.quoteVO.fieldEditability"===e.path?this._editabilityChanged():"model"===e.path&&null!=this.model.quoteVO&&null!=this.model.quoteVO.fieldVisibility&&0<Object.keys(this.model.quoteVO.fieldVisibility).length&&this._visibilityChanged())}},{key:"_visibilityChanged",value:function(){if(this.model.setHiddenFromPSPClass){var e=this.model.setHiddenFromPSPClass();e&&(this.itemClassMap=e)}}},{key:"_editabilityChanged",value:function(){var e=this.model.editorModel.fieldsetMap.quoteFieldNames;if(e&&this.model.quoteVO.fieldEditability&&0!=Object.keys(this.model.quoteVO.fieldEditability).length){var t={},i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;this.model.quoteVO.fieldEditability.hasOwnProperty(a)&&(t[a]=null==this.model.quoteVO.fieldEditability[a]||this.model.quoteVO.fieldEditability[a])}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this.itemEditableMap=t}}},{key:"behaviors",get:function(){return[window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[o.VIEWPORT_CHANGED]=this.generateColumns,e}},{key:"observers",get:function(){return["_generateColumnsObserver(editorModel, objectName, viewport, model)","modelChanged(model.*)"]}}]),r=e)),t("FieldSetTable",r),Polymer(r)}}}),System.register("quotes/layout/sb-field-set-table-item/FieldSetTableItem.js",["common/core/sb-page-container/PageContainer.js","common/relationship/RelationshipFieldManager.js","common/core/AppContext.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.PageContainer},function(e){o=e.RelationshipFieldManager},function(e){r=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FieldSetTableItem",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-field-set-table-item",this.properties={value:{notify:!0},item:String,model:Object,md:Object,data:Object,display:String,viewport:{type:Object,value:function(){return i.getViewport()}},calculateImmediately:{type:Object,value:function(){return r.org.calculateImmediately}},renderReadOnly:{value:!1,type:Boolean},type:String,itemClassMap:{type:Object},editable:{type:Boolean,observer:"_editableChanged"}}}},{key:"attached",value:function(){this.renderReadOnly}},{key:"_datePickerOpened",value:function(e){if(!this.renderReadOnly){var t=e.detail.dateContainer,i=Polymer.dom(t).querySelector("input"),n=e.detail.datepicker,o=e.detail.datepicker.offsetHeight,r=e.detail.datepicker.offsetWidth,s=window.innerHeight,a=window.innerWidth,l=t.getBoundingClientRect(),u=s-l.bottom-o,d=a-l.left-r;n.style.position="fixed",n.style.left=d<0?i.getBoundingClientRect().right-r+"px":l.left+"px",n.style.top=u<0?l.top-o+"px":l.bottom+"px"}}},{key:"_setFieldDataObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this._setFieldData(e,t,i)}},{key:"_setFieldData",value:function(){this.md=this.model.getFieldMD(this.item),this.isMobile=this.viewport&&this.viewport.isMobile(),this.label=null==this.value&&"richtextarea"===this.md.extraTypeInfo&&this.isMobile?null:this.md.label,this.helpText=this.md.inlineHelpText,this.data.CurrencyIsoCode&&(this.md.CurrencyIsoCode=this.data.CurrencyIsoCode),this.$.field.editing=this._isEditable(),this.$.field.disabled=this._isDisabled(),this.$.field.md=this.md,this.$.field.property=this.item;var e={};e[this.item]=this.value,this.$.field.obj=e}},{key:"_isEditable",value:function(){return!!this.md.updateable&&(null!=this.model.quoteVO.fieldEditability&&null!=this.model.quoteVO.fieldEditability[this.item]?this.model.quoteVO.fieldEditability[this.item]:!!this.md.updateable)}},{key:"_isDisabled",value:function(){var e=this.model.quoteVO.fieldEditability;return this.md.updateable&&"boolean"===this.md.type&&null!=e&&null!=e[this.item]?!e[this.item]:!this.md.updateable}},{key:"_valueChangedObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._valueChanged(e,t)}},{key:"_valueChanged",value:function(){this._updateLookupDisplayValue(),this.$.field.value=this.value,this.data&&this.item&&(this.data[this.item]=this.value)}},{key:"_updateLookupDisplayValue",value:function(){if(this.data){var e=new o(this.item,this.data);e.hasRelationship()&&(this.display=e.getRelationshipName())}}},{key:"_handleFieldValueChanged",value:function(e){var t=!!e.detail&&e.detail.suppressImmediateCalculation;this.calculateImmediately&&!t&&this.fire("calculate-immediately")}},{key:"_displayChangedObserver",value:function(e,t,i,n,o){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o)return this._displayChanged(e,t,i,n,o)}},{key:"_displayChanged",value:function(){new o(this.item,this.data).addRelationshipName(this.value,this.display,this.md.referenceTo[0])}},{key:"_updateOriginalValueObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._updateOriginalValue(e,t)}},{key:"_updateOriginalValue",value:function(){if(this.type){this.model[this.type]._transient_=this.model[this.type]._transient_||{},this.model[this.type]._transient_.original=this.model[this.type]._transient_.original||JSON.parse(JSON.stringify(this.model[this.type].record));var e=this.get("model."+this.type+"._transient_.original");this.$.field.originalValue=e[this.item]}}},{key:"_editableChanged",value:function(){this.md.updateable&&this.$.field.toggleEditing(this.editable)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"datepicker-opened":"_datePickerOpened","sb-field-on-change-field":"_handleFieldValueChanged"}}},{key:"observers",get:function(){return["_setFieldDataObserver(item, model, data)","_displayChangedObserver(value, display, item, data, md)","_valueChangedObserver(value, md)","_updateOriginalValueObserver(model, item)"]}}]),s=e)),t("FieldSetTableItem",s),Polymer(s)}}}),System.register("quotes/layout/sb-le-drawer/LEDrawer.js",["common/signal/RowFocusSignaler.js","common/core/AppContext.js"],function(t,e){var i,o;return{setters:[function(e){e.RowFocusSignaler},function(e){i=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LEDrawer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-drawer",this.properties={lineModel:{type:Object,notify:!0},fieldNames:Array,richTextFields:Array,dataIndex:{type:Number,reflectToAttribute:!0}}}},{key:"_initObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.init(e,t)}},{key:"init",value:function(){this._visibilityChanged(),this._editabilityChanged();var e=[],t=!0,i=!1,n=void 0;try{for(var o,r=this.fieldNames[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this._isRichTextField(s)&&e.push(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.richTextFields=e}},{key:"_isRichTextField",value:function(e){return"richtextarea"===this.lineModel.getFieldMD(e).extraTypeInfo}},{key:"_lineRecordChanged",value:function(e){"lineModel.lineVO.fieldVisibility"===e.path?this._visibilityChanged():"lineModel.lineVO.fieldEditability"===e.path&&this._editabilityChanged()}},{key:"_visibilityChanged",value:function(){this.lineModel.setItemClassMap(),this.itemClassMap=this.lineModel.itemClassMap}},{key:"_editabilityChanged",value:function(){if(this.fieldNames&&this.lineModel.lineVO.fieldEditability&&0!=Object.keys(this.lineModel.lineVO.fieldEditability).length){var e={},t=!0,i=!1,n=void 0;try{for(var o,r=this.fieldNames[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.lineModel.lineVO.fieldEditability.hasOwnProperty(s)&&(e[s]=this.lineModel.isEditable(s))}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.itemEditableMap=e}}},{key:"_showLineMultiActions",value:function(e){return(e.actionsOnTheLeft?"actionsOnTheLeft ":"")+(e.data.settings.multiLineDeleteEnabled?"multiDeleteEnabled":"")}},{key:"_isListMode",value:function(){return!!i.isCompactModeEnabled}},{key:"observers",get:function(){return["_initObserver(fieldNames, lineModel)","_lineRecordChanged(lineModel.*)"]}}]),o=e)),t("LEDrawer",o),Polymer(o)}}}),System.register("quotes/layout/sb-le-footer/LEFooter.js",["common/core/Events.js"],function(t,e){var i,o;return{setters:[function(e){i=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LEFooter",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-footer",this.properties={quoteModel:Object,quoteTotal:{type:Number},quoteTotalMd:Object,editorModel:{type:Object}}}},{key:"colWidthsChanged",value:function(){this._setTotalWidth()}},{key:"_setTotalWidth",value:function(){if(this.showQuoteTotal){var e=this.quoteModel.editorModel;if(this.toggleClass("largeQuote",e.largeQuoteExperienceEnabled,this.$.container),this.labelClass=e.deviceContext.isMobile?"hidden":"",!e.layout||e.deviceContext.isMobile||e.largeQuoteExperienceEnabled)return;this.totalWidth=this.quoteModel.editorModel.layout.totalWidth+"px"}}},{key:"_showQuoteTotal",value:function(){this.grouped=this.quoteModel.grouped?"grouped":"",this.showQuoteTotal="doNotDisplay"!=this.settings.lineEditorTotalsField&&this.quoteVO.lineItems&&0<this.quoteVO.lineItems.length,this._setQuoteTotal()}},{key:"_setQuoteTotal",value:function(){var e=void 0,t=void 0,i=this.quoteModel.editorModel.constants,n=this.settings.lineEditorTotalsField;e=n&&"Default"!=n?(t=this.settings.isMultiCurrencyOrg?this.quoteVO.currencyDecimalScale:this.quoteFields[n]?this.quoteFields[n].scale:0,this.quoteVO.record[n]||0):(t=this.settings.isMultiCurrencyOrg?this.quoteVO.currencyDecimalScale:this.quoteVO.applyAdditionalDiscountLast?this.quoteFields[i.CUSTOMER_AMOUNT_FIELD].scale:this.quoteFields[i.NET_AMOUNT_FIELD].scale,this.quoteVO.applyAdditionalDiscountLast?this.quoteVO.customerTotal:this.quoteVO.netTotal),this.quoteTotalMd||(this.quoteTotalMd={type:"currency",scale:t,CurrencyIsoCode:this.quoteVO.record.CurrencyIsoCode}),this.quoteTotal=e.toFixed(t)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[i.COL_WIDTHS_CHANGED]=this.colWidthsChanged,e}},{key:"observers",get:function(){return["_showQuoteTotal(quoteModel.quoteVO.*)","_setTotalWidth(quoteModel.editorModel.layout)"]}},{key:"settings",get:function(){return this.quoteModel.editorModel.data.settings}},{key:"quoteFields",get:function(){return this.quoteModel.editorModel.md.fieldsMap[this.settings.developerPrefix+"Quote__c"]}},{key:"quoteVO",get:function(){return this.quoteModel.quoteVO}}]),o=e)),t("LEFooter",o),Polymer(o)}}}),System.register("quotes/layout/sb-le-group/LEGroup.js",["common/core/sb-page-container/PageContainer.js","quotes/models/DragDropModel.js","common/core/AppContext.js","common/core/Events.js"],function(t,e){var i,o,r,s,a,l;return{setters:[function(e){i=e.PageContainer},function(e){o=e.DragDropModel},function(e){r=e.AppContext},function(e){s=e.Events,a=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}8,150,t("LEGroup",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-group",this.properties={groupModel:{type:Object,notify:!0,observer:"_groupModelChanged"},groupClass:{type:String},subtotal:Number,subtotalMd:Object,value:{notify:!0,observer:"_descriptionChanged"},descriptionMd:Object,groupLevelTabs:{type:Array,value:[]},isMobile:{type:Boolean,value:!1},editorModel:{type:Object,notify:!0},viewport:{type:Object,value:function(){return i.getViewport()}},favorited:Boolean,i18n:{type:Object,value:function(){return r.properties.i18n.value()}}}}},{key:"ready",value:function(){this.groupExpanded=!1,this.showSpinner=!1}},{key:"_updateColumnWidths",value:function(){!this.groupHasSegmentedProducts&&r.isColumnResizingEnabled&&a(s.MDQ_LINE_DELETED)}},{key:"_createDragDropModel",value:function(){var e=new Set(["sb-droppable-mdqRows","sb-droppable-emptyTable","sb-droppable-emptyMDQTable","sb-droppable-emptyMDQSegmentTab","sb-droppable-sidePanelGroups","emptyTableMessage"]);this.dragDrop=new o(this,this.editorModel.data.settings.bundleKeptTogether,"sf-le-table-row",e,this.dragFunc.bind(this),this.trackFunc.bind(this),this.dropFunc.bind(this),8,150)}},{key:"_groupModelChanged",value:function(){this.editorModel=this.groupModel.quoteModel.editorModel,this._updateTableProperties(),this._updatePageData(this._getTabs(this.groupModel)),this._setIsButton(),this.isMobile=!!this.viewport&&this.viewport.isMobile(),(this.isMobile||this.editorModel.largeQuoteExperienceEnabled)&&(this.set("groupModel.groupExpanded",this.groupExpanded),this.buildGroupTabs()),this.viewport&&!this.viewport.isMobile()&&(this.set("groupModel.groupExpanded",!0),this._setTotalWidth()),this.containerClass=this.editorModel.largeQuoteExperienceEnabled?"largeQuote":""}},{key:"_setIsButton",value:function(){this.isButton=!this.viewport||this.viewport.isDesktop()&&this.viewport.M.up}},{key:"_setTotalWidth",value:function(){this.editorModel.layout&&!this.editorModel.deviceContext.isMobile&&(this.totalWidth=this.editorModel.layout.totalWidth+2+"px")}},{key:"colWidthsChanged",value:function(){this._setTotalWidth()}},{key:"_linesChanged",value:function(){this._updateTableProperties();var e=this._getTabs(this.groupModel);e.length!==this.tabs.length&&this._updatePageData(e)}},{key:"_updateTableProperties",value:function(){this.groupHasStandardProducts=this.groupModel._groupHasStandardProducts(),this.groupHasSegmentedProducts=this.groupModel._groupHasSegmentedProducts(),this.groupedAndHasNoLineItems=this.groupModel.quoteModel.grouped&&!this._groupHasLineItems(),this.groupHasBothProducts=this._groupHasBothProducts(),this._showSubtotal(),this._setGroupDescription()}},{key:"_segmentedPrimaryMobileColsChanged",value:function(){this._updatePageData(this._getTabs(this.groupModel))}},{key:"_updatePageData",value:function(e){this.$$("#leGroupTabs")&&this.$$("#leGroupTabs").destroyTabs(),this.tabs=e,this.groupMDQTabs||(this.groupMDQTabs=e)}},{key:"_getTabs",value:function(e){for(var t=[],i=e.dimensions,n=0,o=i.length;n<o;n++){var r=i[n];if(e.hasVisibleSegmentedLines[r]){var s="t"+n,a={name:s,key:r,label:e.quoteModel.quoteVO.localizedDimensionNames[r],bind:["groupModel"]};"Custom"==r&&(a.iconId=s+"-"+e.groupKey,a.iconClass="sb-icon-pencil",a.iconEvent="cseDialog"),t.push(a)}}return t}},{key:"_handleCSEDialogTapped",value:function(e){this.fire("cse-tapped",{dialog:"cseDialog",groupModelKey:this.groupModel.groupKey})}},{key:"_groupHasBothProducts",value:function(){return this.groupModel._groupHasStandardProducts()&&this.groupModel._groupHasSegmentedProducts()}},{key:"_groupHasLineItems",value:function(){return this.groupModel._groupHasStandardProducts()||this.groupModel._groupHasSegmentedProducts()}},{key:"_groupRecordChanged",value:function(e){e.path=="groupModel.groupVO.record."+this.editorModel.constants.OPTIONAL_FIELD&&a(s.TOGGLE_OPTIONAL_CLICKED,{toggleOptionalBoolean:e.value,groupKey:this.groupModel.groupKey});var t=this.groupModel.groupVO.record;this.favorited=!(!t||!t[this.editorModel.constants.FAVORITE_ID_FIELD])}},{key:"_setGroupDescription",value:function(){this.groupModel.groupVO.record&&(this.value=this.groupModel.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD],this.groupModel&&this.editorModel.md&&this.editorModel.constants&&this._getDescriptionMd(),this.value||(this.value=r.properties.i18n.value().l("Click to edit description")))}},{key:"_descriptionChanged",value:function(){var e=r.properties.i18n.value().l("Click to edit description");this.value!==e&&(this.groupModel.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD]=this.value)}},{key:"_getDescriptionMd",value:function(){var e=this.editorModel.md.fieldsMap[this.groupModel.groupObjectName];this.descriptionMd=e[this.editorModel.constants.DESCRIPTION_FIELD]}},{key:"_getSegmentKeys",value:function(){return Object.keys(this.groupModel.segmentedLinesBySegmentKey)}},{key:"triggerCustomAction",value:function(e){this.fire("le-action-tapped",{customAction:{eventHandlerName:e.currentTarget.attributes.eventHandlerName.value},model:this.groupModel})}},{key:"showGroupNameEditor",value:function(e){this.isMobile||(e.stopPropagation(),this.toggleClass("hidden",!0,this.$$("#groupHeaderName")),this.toggleClass("hidden",!1,this.$$("#groupNameInput")),this.$$("#groupNameInput").focus(),this.$$("#groupNameInput").setSelectionRange(0,this.groupModel.groupVO.record.Name.length))}},{key:"checkInputValue",value:function(e){e.stopPropagation(),""!=e.target.value&&this.set("groupModel.groupVO.record.Name",e.target.value),this.toggleClass("hidden",!1,this.$$("#groupHeaderName")),this.toggleClass("hidden",!0,this.$$("#groupNameInput"))}},{key:"closeGroupNameEditor",value:function(e){e.stopPropagation(),"13"==e.keyCode&&this.$$("#groupNameInput").blur()}},{key:"_showSubtotal",value:function(){if(this.groupModel.groupVO.record){var e=this.groupModel.quoteModel.editorModel.data.settings;this.groupModel.quoteModel.grouped&&"doNotDisplay"!=e.lineEditorGroupSubtotalsField&&(0<this.groupModel.segmentedLines.length&&this.groupModel._groupHasStandardProducts()||this.viewport&&this.viewport.isMobile()||this.groupModel.editorModel.largeQuoteExperienceEnabled)?(this._getSubtotal(),this.showSubtotal=!0):this.showSubtotal=!1}}},{key:"_getSubtotal",value:function(){if(this.groupModel.quoteModel.grouped){var e=this.groupModel.quoteModel.editorModel,t=e.data.settings,i=void 0,n=void 0,o=t.lineEditorGroupSubtotalsField;n="Default"==o||null==o?(i=t.isMultiCurrencyOrg?this.groupModel.quoteModel.quoteVO.currencyDecimalScale:e.md.fieldsMap[t.developerPrefix+"QuoteLineGroup__c"][e.constants.NET_TOTAL_FIELD].scale,this.groupModel.groupVO.record[e.constants.NET_TOTAL_FIELD]||0):(i=t.isMultiCurrencyOrg?this.groupModel.quoteModel.quoteVO.currencyDecimalScale:e.md.fieldsMap[t.developerPrefix+"QuoteLineGroup__c"][o].scale,this.groupModel.groupVO.record[t.lineEditorGroupSubtotalsField]||0),this.subtotalMd||(this.subtotalMd={type:"currency",scale:i,CurrencyIsoCode:this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode}),this.subtotal=n}}},{key:"_toggleGrouping",value:function(){this.notifyPath("groupModel.quoteModel.grouped",this.groupModel.quoteModel.grouped),this.set("groupClass",this.groupModel.quoteModel.grouped?"group":"virtualGroup")}},{key:"buildGroupTabs",value:function(){if(this.editorModel){var e=[];0<this.editorModel.fieldsetMap.groupFieldNames.length&&this._groupHasLineItems()&&!this.editorModel.largeQuoteExperienceEnabled&&e.push("details"),this.groupModel._groupHasSegmentedProducts()&&e.push("segmented"),this.groupModel._groupHasStandardProducts()&&e.push("standard");var t=[];if(this.groupModel.groupMDQTabs=this.tabs,this._renderTabs(e)){this.$$("#groupTabs")&&this.$$("#groupTabs").destroyTabs();for(var i=0,n=e.length;i<n;i++){var o="t"+i,r=e[i];t.push({name:o,label:r})}this.groupLevelTabs=void 0,this.bind=["groupModel","editorModel"],this.groupMDQTabs=this.groupModel.groupMDQTabs,this.selectedTabIndex=0,this.hideTabs=1==t.length,this.groupLevelTabs=t}}}},{key:"_renderTabs",value:function(e){if(this.groupLevelTabs.length!==e.length)return!0;if(this.groupModel.groupMDQTabs&&this.groupMDQTabs.length!==this.groupModel.groupMDQTabs.length)return!0;for(var t=0,i=this.groupLevelTabs.length;t<i;t++)if(this.groupLevelTabs[t].label!==e[t])return!0;return!1}},{key:"expandGroup",value:function(e){var t=this;e.target.hasAttribute("triggersExpandGroup")&&this.isMobile&&!this.showSpinner&&(this.$$("#mobileGroupTabs")||(this.showSpinner=!0),Polymer.RenderStatus.afterNextRender(this,function(){t.set("groupModel.groupExpanded",!t.groupModel.groupExpanded),t.groupExpanded=t.groupModel.groupExpanded,Polymer.RenderStatus.afterNextRender(t,function(){t.showSpinner=!1})}))}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport,this._setIsButton(),this.viewport&&this.viewport.isMobile()?this.isMobile=!0:this.isMobile=!1}},{key:"renderNewTab",value:function(e){e.detail.groupKey===this.groupModel.groupKey&&(this._updatePageData(this._getTabs(this.groupModel)),(this.isMobile||this.editorModel.largeQuoteExperienceEnabled)&&this.buildGroupTabs())}},{key:"_setUpgradeQuantity",value:function(e){var t=this,i=e.detail.sourceIndex,n=e.detail.upgradeIndex,o=e.detail.sourceLineVO,r=e.detail.upgradeLineVO;this.debounce("Handle user input for automatic upgrade asset quantity changed",function(){o.invalidQuantity?t._notifyQuantityChanged(i,n,o,!0):r.invalidQuantity?t._notifyQuantityChanged(n,i,r,!0):t._notifyQuantityChanged(i,n),o.invalidQuantity=null,r.invalidQuantity=null},10)}},{key:"_notifyQuantityChanged",value:function(e,t,i,n){var o=void 0,r=void 0;this.groupModel.standardLines[e].internalUpdate=!0,this.groupModel.standardLines[t].internalUpdate=!0,n&&(o=i.invalidQuantity,r=i.validQuantity,i.record[this.editorModel.constants.QUANTITY_FIELD]=i.invalidQuantity,this.notifyPath("groupModel.standardLines."+e+".lineVO.record."+this.editorModel.constants.QUANTITY_FIELD,this.groupModel.standardLines[e].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]),i.record[this.editorModel.constants.QUANTITY_FIELD]=i.validQuantity),this.notifyPath("groupModel.standardLines."+e+".lineVO.record."+this.editorModel.constants.QUANTITY_FIELD,this.groupModel.standardLines[e].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]),this.groupModel.standardLines[e].internalUpdate=!1,this.notifyPath("groupModel.standardLines."+t+".lineVO.record."+this.editorModel.constants.QUANTITY_FIELD,this.groupModel.standardLines[t].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]),this.groupModel.standardLines[t].internalUpdate=!1,this.fire("validate-quantity-changed",{invalidQuantity:o,validQuantity:r})}},{key:"addSegmentedLineToEmptyTable",value:function(e){var t=e.lineVO.record[this.groupModel.constants.SEGMENT_KEY_FIELD],i=this.groupModel.quoteModel.quoteVO.multiSegmentKeys?this.groupModel.quoteModel.quoteVO.multiSegmentKeys[t]:null;this.groupModel.hasVisibleSegmentedLines||(this.groupModel.hasVisibleSegmentedLines={}),this.groupModel.setDimensionProperties(i),this.groupModel.segmentedLines.push(e),this.groupModel.groupVO.multiSegmentColumns[i]=e.editorModel.data.quote.multiSegmentColumns[i],this.groupModel.groupVO.localizedMultiSegmentColumns[i]=e.editorModel.data.quote.localizedMultiSegmentColumns[i],this.groupModel.colWidth[i]=e.groupModel.colWidth[i],e.groupModel=this.groupModel,e.lineVO.parentGroupKey=this.groupModel.groupKey;for(var n=0,o=e.segments.length;n<o;n++)e.segments[n].lineVO.parentGroupKey=this.groupModel.groupKey;this.groupModel.segmentedLinesBySegmentKey[t]=e,this.push("groupModel.segmentedLinesByDimension."+i,e),this._updatePageData(this._getTabs(this.groupModel))}},{key:"addSegmentedLineToExistingTab",value:function(e){var t=e.lineVO.record[this.groupModel.constants.SEGMENT_KEY_FIELD],i=this.groupModel.quoteModel.quoteVO.multiSegmentKeys?this.groupModel.quoteModel.quoteVO.multiSegmentKeys[t]:null;this.groupModel.segmentedLines.push(e),e.groupModel=this.groupModel,e.lineVO.parentGroupKey=this.groupModel.groupKey;for(var n=0,o=e.segments.length;n<o;n++)e.segments[n].lineVO.parentGroupKey=this.groupModel.groupKey;this.groupModel.segmentedLinesBySegmentKey[t]=e,this.push("groupModel.segmentedLinesByDimension."+i,e)}},{key:"removeSegmentedLine",value:function(e){var t=e.lineVO,i=t.record,n=(t.key,i[this.groupModel.constants.SEGMENT_KEY_FIELD]),o=(i[this.groupModel.constants.SEGMENT_LABEL_FIELD],this.groupModel.quoteVO.multiSegmentKeys?this.groupModel.quoteVO.multiSegmentKeys[n]:null);this.groupModel.segmentedLines.splice(this.groupModel.segmentedLines.indexOf(e),1),delete this.groupModel.segmentedLinesBySegmentKey[n],this.splice("groupModel.segmentedLinesByDimension."+o,this.groupModel.segmentedLinesByDimension[o].indexOf(e),1),0===this.groupModel.segmentedLinesByDimension[o].length&&(this.groupModel.removeDimensionProperties(o),delete this.groupModel.groupVO.localizedMultiSegmentColumns[o],delete this.groupModel.groupVO.multiSegmentColumns[o],this.$$("#leGroupTabs").destroyTabs(),this._updatePageData(this._getTabs(this.groupModel)))}},{key:"_onTrack",value:function(e){this.dragDrop._onTrack(e)}},{key:"dragFunc",value:function(e){this.dragDrop.ghost=this.dragDrop.lineEditor.$.ghost,this.linesByParentKey=this.editorModel.quoteModel.linesByParentItemKey,this.indexByGroupKey=this.groupModel.quoteModel.indexByGroupKey,this.lineModelsByKey=this.groupModel.quoteModel.lineModelsByKey,this.dragDrop.dragLineModel=[],this.dragDrop.dragGroupModel=e.lineModel.groupModel,this.dragDrop.dragKey=e.lineModel.lineVO.key,this.dragDrop.dragLineModel=e.lineModel,this.dragDrop.segment=e.domHost.dimension,this.dragDrop.dragIndex=this.groupModel.segmentedLinesByDimension[this.dragDrop.segment].indexOf(e.lineModel),this.set("groupModel.segmentedLinesByDimension."+this.dragDrop.segment+"."+this.dragDrop.dragIndex+".hidden",!0)}},{key:"trackFunc",value:function(e){var t=this.dragDrop;if(e=t._findTableRowValidTarget(e))switch("placeholder"===e.id&&(e="before"===e.getAttribute("ref")?e.previousElementSibling:e.nextElementSibling),t.targetClass){case"sb-droppable-mdqRows":if(t._updateMDQTableRowHoverOverObject(t.sourceElement,e),!t.hoverOver)return;t.targetHost=t.hoverOver.comp.domHost,t.usePlaceholder=!0,t.enableHighLight=!1;break;case"sb-droppable-emptyTable":case"sb-droppable-sidePanelGroups":t.keepBundleTogether&&t.sourceElement.lineModel.hasParent?t.hoverOver=null:t.hoverOver={comp:e},t.usePlaceholder=!1,t.enableHighLight=!0}}},{key:"dropFunc",value:function(e,t,i,n){this.dragDrop.dropKey=null,this.dragDrop.dropIndex=null,this.dragDrop.dropGroupModel=null;var o=this.dragDrop.segment,r=void 0,s=this.dragDrop.dragLineModel;if(this.set("groupModel.segmentedLinesByDimension."+o+"."+this.dragDrop.dragIndex+".hidden",!1),t){switch(e.lineModel.subscriptionScopeEditable&&(this.dragDrop.dragGroupModel._updateSegmentedSubscriptionScopeEditable(e.lineModel),e.domHost.fieldNames=e.domHost._getFields(),e.domHost._setColumnWidths()),i){case"sb-droppable-mdqRows":var a=t.lineModel.groupModel;r=t.domHost.domHost.domHost,t.domHost,this.dragDrop.dropGroupModel=a,s.subscriptionScopeEditable&&(this.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable=!0);var l=a.segmentedLinesByDimension[o].indexOf(t.lineModel);n?l=0<=l?l:0:++l,s.groupModel=a,s.lineVO.parentGroupKey=a.groupKey,s.segments.forEach(function(e){e.lineVO.parentGroupKey=a.groupKey,e.groupModel=a}.bind(this)),this.removeSegmentedLine(this.dragDrop.dragLineModel);var u=s.lineVO.record[this.groupModel.constants.SEGMENT_KEY_FIELD];this.groupModel.segmentedLinesBySegmentKey[u]=s,this.groupModel.segmentedLines.splice(l,0,s),r.splice("groupModel.segmentedLinesByDimension."+o,l,0,s);break;case"sb-droppable-emptyTable":case"emptyTableMessage":r=Polymer.dom(t).getOwnerRoot().host,this.dragDrop.dropGroupModel=r.groupModel,s.subscriptionScopeEditable&&(this.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable=!0),this.removeSegmentedLine(this.dragDrop.dragLineModel),r.addSegmentedLineToEmptyTable(s);break;case"sb-droppable-sidePanelGroups":var d="Group"+t.getAttribute("id");r=this.dragDrop._findParentCustomElement(t,"groupContainer","id").querySelector("#"+d),this.dragDrop.dropGroupModel=r.groupModel,s.subscriptionScopeEditable&&(this.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable=!0),this.removeSegmentedLine(this.dragDrop.dragLineModel),this.dragDrop.dropGroupModel.dimensions.includes(this.dragDrop.segment)?r.addSegmentedLineToExistingTab(s):r.addSegmentedLineToEmptyTable(s)}if("sb-droppable-mdqRows"===i){var c=r.groupModel.segmentedLinesByDimension[o];t.domHost.notifyPath("groupModel.segmentedLinesByDimension."+o,c.slice()),t.domHost.notifyPath("lineModels",c.slice())}this.fire("renumber-lines"),this.editorModel.data.settings.usesClientCalculator&&this.editorModel.quoteModel.renumberIndexes(!0);var h=e.domHost,f=t.domHost;h&&"SF-SEGMENTED-TABLE"===h.tagName&&h._prepareUIData(),f&&"SF-SEGMENTED-TABLE"===f.tagName&&h!==f&&f._prepareUIData()}}},{key:"_groupCustomActionsChanged",value:function(e){for(var t=e?e.length:0,i=0;i<t;i++)this.notifyPath("editorModel.groupCustomActions."+i+".children")}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[s.COL_WIDTHS_CHANGED]=this.colWidthsChanged,e[s.RENDER_NEW_TAB]=this.renderNewTab,e[s.VIEWPORT_CHANGED]=this.viewportChanged,e}},{key:"observers",get:function(){return["_groupRecordChanged(groupModel.groupVO.record.*)","_toggleGrouping(groupModel.groupVO)","_segmentedPrimaryMobileColsChanged(groupModel.editorModel.segmentedPrimaryMobileCols)","_linesChanged(groupModel.standardLines.splices)","_linesChanged(groupModel.segmentedLinesByDimension.*)","_createDragDropModel(editorModel)","_groupCustomActionsChanged(groupModel.editorModel.groupCustomActions)","_showSubtotal(groupModel.groupVO.record.*)","_updateColumnWidths(groupHasSegmentedProducts)"]}},{key:"listeners",get:function(){return{"cseDialog-tapped":"_handleCSEDialogTapped","segmented-changed":"_customSegmentedUpdated","upgrade-asset-quantity-changed":"_setUpgradeQuantity"}}}]),l=e)),t("LEGroup",l),Polymer(l)}}}),System.register("quotes/layout/sb-le-group-layout/LEGroupLayout.js",["common/core/AppContext.js","quotes/models/DragDropModel.js","common/layout/table-layout-builder/TableLayoutBuilder.js","common/core/Events.js","quotes/column-sizing-dao/ColumnSizingDao.js","quotes/models/ClientCache.js","common/data/cache/Cache.js"],function(t,e){var f,i,s,g,a,l,u,o,d,y,r,c,m,h;return{setters:[function(e){f=e.AppContext},function(e){i=e.DragDropModel,s=e.removeTopBottomBorderClass},function(e){g=e.TableLayoutBuilder},function(e){a=e.Events,l=e.fireEvent},function(e){u=e.saveColumnObjects,o=e.resetColumnSizes},function(e){d=e.put,y=e.get,r=e.del},function(e){c=e.Cache}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}8,150,m="Standard",t("LEGroupLayout",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-group-layout",this.properties={noHeader:{type:Boolean,value:!1},layoutLink:String,layoutWidth:Number,layoutLeft:{type:String,value:"24px"},drawerState:String,lastSelectedGroup:Object,selectedGroupKey:{type:Number,notify:!0},editorModel:Object}}},{key:"ready",value:function(){Polymer.RenderStatus.afterNextRender(this,function(){this._resize=function(){this.debounce("resize",function(e){var t=this;this.buildLayout(),Polymer.RenderStatus.afterNextRender(this,function(){l(a.COL_WIDTHS_CHANGED,{layout:t.editorModel.layout,groupKey:t.selectedGroupKey})})},200)}.bind(this),window.addEventListener("resize",this._resize)})}},{key:"detached",value:function(){window.removeEventListener("resize",this._resize)}},{key:"_spliceObserver",value:function(e){e&&0!=e.indexSplices[0].addedCount&&(this.addedIndex=e.indexSplices[0].index,this.addedKey=e.indexSplices[0].object[this.addedIndex].groupVO.key,this.observersAttached||this._attachObservers())}},{key:"sizeAdjusted",value:function(t){var e=this;if(t.detail&&t.detail.field&&t.detail.fieldsWidth&&t.detail.fieldSet){var i=t.detail.fieldSet,n=t.detail.field,o=t.detail.dimension?t.detail.dimension:m;if(this.editorModel&&this.editorModel.quoteModel&&this.editorModel.quoteModel.lineGroups){this.editorModel.quoteModel.lineGroups.forEach(function(e){e.colWidth&&e.colWidth[o]&&e.colWidth[o][n]&&(e.colWidth[o][n]=t.detail.fieldsWidth,d("columnSizes",[],e.colWidth))});var r={fieldSetName:i,columnSizes:y("columnSizes")[o],shouldBeDefault:!1,objectType:this.editorModel.constants.QUOTE_LINE};u(r,t.detail.field),this.buildLayout(),Polymer.RenderStatus.afterNextRender(this,function(){l(a.COL_WIDTHS_CHANGED,{layout:e.editorModel.layout})})}}}},{key:"resetToDefault",value:function(e){var t=this;if(this.editorModel&&this.editorModel.layout&&e.detail&&e.detail.fieldSet){r("columnSizes");var i=c.get("LineEditor",this.editorModel.quoteModel.quoteVO.record.Id.substring(0,15));i&&i.columnMetadata&&(i.columnMetadata=[]),this.editorModel.columnMetadata=[];var n={fieldSetName:e.detail.fieldSet,shouldBeDefault:!1,objectType:this.editorModel.constants.QUOTE_LINE};o(n),this.buildLayout(null,!0),Polymer.RenderStatus.afterNextRender(this,function(){l(a.COL_WIDTHS_CHANGED,{layout:t.editorModel.layout})})}}},{key:"getGroupClass",value:function(e){if(this.editorModel){var t="";return this.selectedGroupKey!=e&&(t+="hiddenGroup"),this.editorModel.largeQuoteExperienceEnabled&&(t+=" largeQuote"),t}}},{key:"getContainerClass",value:function(){return this.editorModel.largeQuoteExperienceEnabled?"largeQuote":""}},{key:"toggle",value:function(){var e=this;"open"==this.drawerState?this.closePanel():this.openPanel(),Polymer.RenderStatus.afterNextRender(this,function(){l(a.GROUP_PANEL_TOGGLED,{drawerState:e.drawerState,groupKey:e.selectedGroupKey})})}},{key:"openPanel",value:function(){this.isMobile?this.$.drawerPanel.style.display="block":(this.$.drawerPanel.style.left="0px",this.$.mainPanel.style.paddingLeft="280px"),this.drawerState="open"}},{key:"closePanel",value:function(){this.isMobile?this.$.drawerPanel.style.display="none":this.$.drawerPanel.style.left="-256px",this.$.mainPanel.style.paddingLeft=!this.isMobile&&this.rightSideButton?"24px":"0px",this.drawerState="closed"}},{key:"groupPanelCreated",value:function(){this.isMobile||this.debounce("resize",function(e){var t=this;this.buildLayout(),Polymer.RenderStatus.afterNextRender(this,function(){l(a.COL_WIDTHS_CHANGED,{layout:t.editorModel.layout})})},50)}},{key:"groupAdded",value:function(e){this.navTo(e)}},{key:"groupDeleted",value:function(e){this.navTo(e)}},{key:"pageResized",value:function(e){e.detail.isFullScreenToggleEvent&&(this.buildLayout(),l(a.COL_WIDTHS_CHANGED,{layout:this.editorModel.layout,groupKey:this.selectedGroupKey}))}},{key:"resizeColumnsOnLineItemDelete",value:function(){this.buildLayout(),l(a.COL_WIDTHS_CHANGED,{layout:this.editorModel.layout})}},{key:"_hasSegmentedProduct",value:function(e){return void 0!==e.find(function(e){return e._groupHasSegmentedProducts()})}},{key:"_groupModelsAreChangedObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this._groupModelsAreChanged(e,t,i)}},{key:"_groupModelsAreChanged",value:function(){var e=this;this.drawerState?"closed"==this.drawerState&&(this.$.mainPanel.style.paddingLeft=!this.isMobile&&this.rightSideButton?"24px":"0px"):this.closePanel(),this.buildLayout(),Polymer.RenderStatus.afterNextRender(this,function(){e.observersAttached||e._attachObservers()})}},{key:"buildLayout",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!this.isMobile){var n=e?e.detail.group:null,o={},r=this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName],s=this.editorModel.actionsOnTheLeft,a=this.editorModel.data.settings.multiLineDeleteEnabled,l=0<this.editorModel.quoteModel.quoteVO.lineItems.length,u=0<this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length,d=this.editorModel.columnMetadata,c=this.editorModel.constants.COLUMN_METADATA,h=f.isColumnResizingEnabled;o.totalWidth=l?this._getMaxTableWidth(this._getAvailableWidth(),r,s,a,u,d,c,h,i):this._getAvailableWidth(),n?n.colWidth=this._calculateGroupWidth(o,r,s,a,n,u,d,c,h,i):(this.editorModel.quoteModel.lineGroups.forEach(function(e){e.colWidth=t._calculateGroupWidth(o,r,s,a,e,u,d,c,h,i)}),this.set("editorModel.layout",o))}}},{key:"_getAvailableWidth",value:function(){var e=document.getElementById("sbPageContainer");if(e){var t=Polymer.dom(e.root).querySelector("sb-line-editor").clientWidth;return this.editorModel.quoteModel.grouped&&(t-=32,1<this.editorModel.quoteModel.lineGroups.length&&(t-=24,this.drawerState&&"open"==this.drawerState&&(t-=256))),t}}},{key:"_getMaxTableWidth",value:function(e,t,i,n,o,r,s,a,l){var u=y("columnSizes");this.tableLayoutBuilder=new g(e,this._getQuoteStandardFields(),t,i,n,o,r,s,a,this.fieldSetName,u,m,l),this.tableLayoutBuilder.build();var d=this.tableLayoutBuilder.getTotalWidth(),c=this._hasSegmentedProduct(this.groupModels)?this.editorModel.quoteModel.quoteVO.multiSegmentColumns:[],h=this._getQuoteSegmentedFields();for(var f in c)if(c.hasOwnProperty(f)){var p=h.concat(c[f]).concat("total");this.tableLayoutBuilder=new g(e,p,t,i,n,o,r,s,a,this.fieldSetName,u,f,l),this.tableLayoutBuilder.build();var v=this.tableLayoutBuilder.getTotalWidth();d<v&&(d=v)}return d}},{key:"_calculateGroupWidth",value:function(e,t,i,n,o,r,s,a,l,u){var d=y("columnSizes"),c=o.groupKey,h=o.quoteModel.grouped?o.groupVO.multiSegmentColumns:o.quoteModel.quoteVO.multiSegmentColumns,f={};for(var p in this._hasSegmentedProduct(this.groupModels)||(h=[]),this.tableLayoutBuilder=new g(e.totalWidth,this._getGroupStandardFields(c),t,i,n,r,s,a,l,this.fieldSetName,d,m,u),e.leftOffset=this.tableLayoutBuilder.getLeftOffset(),f.Standard=this.tableLayoutBuilder.build(),this._updateMaxWidth(e,this.tableLayoutBuilder.getTotalWidth()),h)h.hasOwnProperty(p)&&(this.tableLayoutBuilder=new g(e.totalWidth,this._getSegmentedFieldNames(o,h[p]),t,i,n,!1,s,a,l,this.fieldSetName,d,p,u),f[p]=this.tableLayoutBuilder.build(),this._updateMaxWidth(e,this.tableLayoutBuilder.getTotalWidth()));return f}},{key:"_updateMaxWidth",value:function(e,t){t>e.totalWidth&&(e.totalWidth=t)}},{key:"_getQuoteStandardFields",value:function(){for(var e=!1,t=this.editorModel.quoteModel.lineGroups,i=0,n=t.length;i<n;i++)if(t[i].standardSubscriptionScopeEditable){e=!0;break}return this._getStandardFields(e)}},{key:"_getGroupStandardFields",value:function(e){var t=this.editorModel.quoteModel.groupsByKey[e];return this._getStandardFields(t.standardSubscriptionScopeEditable)}},{key:"_getStandardFields",value:function(e){var t="lineFieldNames";this._updateFieldSetName(t);var i=this.editorModel.fieldsetMap[t];return e&&(i=[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(i)),i}},{key:"_getQuoteSegmentedFields",value:function(){for(var e=!1,t=this.editorModel.quoteModel.lineGroups,i="multiSegmentLineSummaryFieldNames",n=0,o=t.length;n<o;n++)if(t[n].segmentedSubscriptionScopeEditable){e=!0;break}this._updateFieldSetName(i);var r=this.editorModel.data[i];return e?[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(r):r}},{key:"_getSegmentedFieldNames",value:function(e,t){var i="multiSegmentLineSummaryFieldNames";this._updateFieldSetName(i);for(var n=this.editorModel.data[i],o=e.segmentedSubscriptionScopeEditable?[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(n):n.slice(),r=0,s=t.length;r<s;r++)o.push(t[r].replace(/\W/g,""));return o.push("total"),o}},{key:"_updateFieldSetName",value:function(e){this.editorModel.fieldSetNames&&this.editorModel.fieldSetNames[e]?this.fieldSetName=this.editorModel.fieldSetNames[e]:this.fieldSetName=null}},{key:"_attachObservers",value:function(){(this.rightSideButton||this.isMobile)&&(this.observersAttached=!0,this._observeNodes=Polymer.dom(this.$$("#groups")).observeNodes(function(e){var t=e.addedNodes.filter(function(e){return"SB-LE-GROUP"===e.nodeName&&e.groupModel.groupVO.key==this.addedKey}.bind(this)),i=e.removedNodes.filter(function(e){return"SB-LE-GROUP"===e.nodeName});t[0]!==i[0]&&(this.processNewGroups(t),this.processRemovedGroups(i))}.bind(this)))}},{key:"processNewGroups",value:function(e){if(this.addedKey&&0<e.length){var t=this.addedKey;this.isMobile&&this.closePanel(),this.toggleSelectedAndScroll(t),Polymer.dom(this.$$("#groups")).unobserveNodes(this._observeNodes),this.observersAttached=!1,this.addedKey=null}}},{key:"processRemovedGroups",value:function(e){this.lastSelectedGroup&&1==e.length&&(this.toggleClass("selected-tab",!1,this.lastSelectedGroup),this.lastSelectedGroup=void 0,Polymer.dom(this.$$("#groups")).unobserveNodes(this._observeNodes),this.observersAttached=!1)}},{key:"toggleSelectedAndScroll",value:function(e){var t=this.$$("#_"+e);this.lastSelectedGroup&&this.toggleClass("selected-tab",!1,this.lastSelectedGroup),"open"==this.drawerState&&(this.toggleClass("selected-tab",!0,t),this.lastSelectedGroup=t),this.$$("#Group_"+e)&&(this._scrollIntoView(this.$$("#Group_"+e)),this.$$("#_"+e).scrollIntoView(!1))}},{key:"_scrollIntoView",value:function(e){this.$$("#mainPanel").scrollTop=this.isMobile?e.offsetTop:e.offsetTop-15}},{key:"navTo",value:function(n){var o=this;if(n.stopPropagation(),this.isMobile){var r=n.target.querySelector(".loadingSpinner");r.toggleClass("invisible",!1)}Polymer.RenderStatus.afterNextRender(this,function(){var e=n.detail.groupKey||Polymer.dom(n).rootTarget.id.split("_")[1];if(o.toggleSelectedAndScroll(e),o.editorModel.largeQuoteExperienceEnabled){var t=o.selectedGroupKey,i=parseInt(e);o.set("selectedGroupKey",i),i!=t&&l(a.GROUP_TOGGLED,{groupKey:o.selectedGroupKey})}o.isMobile&&(Polymer.RenderStatus.afterNextRender(o,function(){r.toggleClass("invisible",!0)}),o.toggle())})}},{key:"_createDragDropModel",value:function(){if(this.editorModel){var e=new Set(["sb-droppable-sidePanelGroups"]);this.dragDrop=new i(this,this.editorModel.data.settings.bundleKeptTogether,"div",e,this.dragFunc.bind(this),this.trackFunc.bind(this),this.dropFunc.bind(this),8,150)}}},{key:"onTrack",value:function(e){this.isMobile||!f.isDesktop||this.editorModel.largeQuoteExperienceEnabled||this.dragDrop._onTrack(e)}},{key:"dragFunc",value:function(e){var t=this.dragDrop;t.ghost=this.dragDrop.lineEditor.$.ghost,t.dragIndex=e.dataIndex,t.dragGroupModel=this.groupModels[t.dragIndex],this.$$("#groupLayout"),this.toggleAttribute("hidden",!0,this.$.sbDroppableSidePanelGroups.querySelectorAll(".nav-item")[t.dragIndex])}},{key:"trackFunc",value:function(e){var t=this.dragDrop;(e=this.dragDrop._findSidePanelGroupValidTarget(e))?("placeholder"===e.id&&(e="before"===e.ref?e.previousElementSibling:e.nextElementSibling),t.hoverOver={comp:e,phLoc:"both"},t.targetHost=this,t.highlightableElements=[],t.highlightableElements.push(t.hoverOver.comp),t.usePlaceholder=!0,t.enableHighLight=!1):t.hoverOver=null}},{key:"dropFunc",value:function(e,t,i,n){var o=this.dragDrop;if(this.toggleAttribute("hidden",!1,this.$.sbDroppableSidePanelGroups.querySelectorAll(".nav-item")[o.dragIndex]),t){var r=this.$.sbDroppableSidePanelGroups.querySelectorAll(".nav-item").length-1;o.dropIndex=t.dataIndex,n?o.dropIndex=0<=o.dropIndex?o.dropIndex:0:++o.dropIndex,s(t),this.splice("groupModels",o.dragIndex,1),o.dropIndex<r?this.splice("groupModels",o.dropIndex,0,o.dragGroupModel):this.push("groupModels",o.dragGroupModel),o.lineEditor.renumber(),this.editorModel.data.settings.usesClientCalculator&&o.lineEditor.editorModel.quoteModel.renumberIndexes(!0)}}},{key:"computeDrawerPanelClass",value:function(e){return e?"open":""}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[a.TOGGLE_PANEL_CLICKED]=this.toggle,e[a.CLOSE_GROUP_PANEL]=this.closePanel,e[a.GROUP_PANEL_CREATED]=this.groupPanelCreated,e[a.BUILD_LAYOUT]=this.buildLayout,e[a.GROUP_ADDED]=this.groupAdded,e[a.GROUP_DELETED]=this.groupDeleted,e[a.PAGE_RESIZED]=this.pageResized,e[a.RESET_COL_SIZES]=this.resetToDefault,e[a.MDQ_LINE_DELETED]=this.resizeColumnsOnLineItemDelete,e}},{key:"listeners",get:function(){return{"side-toggle-clicked":"toggle","sf-col-size-adjusted":"sizeAdjusted","sf-reset-col-sizes":"resetToDefault"}}},{key:"observers",get:function(){return["_groupModelsAreChangedObserver(editorModel, groupModels, rightSideButton)","_spliceObserver(groupModels.splices)","_createDragDropModel(groupModels)"]}},{key:"isMobile",get:function(){return this.editorModel.deviceContext.isMobile}}]),h=e)),t("LEGroupLayout",h),Polymer(h)}}}),System.register("quotes/layout/sb-le-summary-row/LESummaryRow.js",["common/core/Events.js"],function(t,e){var i,o;return{setters:[function(e){i=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LESummaryRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-summary-row",this.properties={model:{type:Object,observer:"_modelChanged"},fieldNames:Array,summaries:Object}}},{key:"_modelChanged",value:function(e){this.toggleClass("largeQuote",e.editorModel.largeQuoteExperienceEnabled,this.$.container)}},{key:"_colWidthsChanged",value:function(e){this.notifyPath("model")}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[i.COL_WIDTHS_CHANGED]=this._colWidthsChanged,e}}]),o=e)),t("LESummaryRow",o),Polymer(o)}}}),System.register("quotes/layout/sb-le-table-cell/DiscountConverter.js",["quotes/models/UiNotifier.js"],function(e,t){var u;function d(e){var t=e.getField(e.constants.REGULAR_PRICE_FIELD),i=void 0,n=void 0;return n=e.getField(e.constants.ADDITIONAL_DISCOUNT_RATE_FIELD)?(i=t*(e.getField(e.constants.ADDITIONAL_DISCOUNT_RATE_FIELD)/100),1):e.lineVO.targetCustomerAmount?(i=t-e.lineVO.targetCustomerAmount,1):e.lineVO.targetCustomerTotal?(i=t-e.lineVO.targetCustomerTotal/c(e),1):e.getField(e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)?(i=e.getField(e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD),e.lineVO.amountDiscountProrated?e.getField(e.constants.PRORATE_MULTIPLIER_FIELD):1):(i=0,1),i*n}function c(e){var t=e.lineVO.record,i=t[e.constants.QUANTITY_FIELD],n=t[e.constants.PRIOR_QUANTITY_FIELD],o=t[e.constants.EXISTING_FIELD]?i-n:i;return"Block"!=t[e.constants.PRICING_METHOD_FIELD]&&"Slab"!=t[e.constants.DISCOUNT_SCHEDULE_TYPE_FIELD]||!t[e.constants.EXISTING_FIELD]||null==n||i-n!=0?"Block"==t[e.constants.PRICING_METHOD_FIELD]||"Slab"==t[e.constants.DISCOUNT_SCHEDULE_TYPE_FIELD]?1:t[e.constants.EXISTING_FIELD]&&e.dynamicSubscription&&0!=t[e.constants.LIST_PRICE_FIELD]&&0==o?i:"Amendment"==e.groupModel.quoteModel.quoteVO.record[e.constants.TYPE_FIELD]&&!e.subscription&&o<0?0:o:0}return{setters:[function(e){u=e.setThenNotify}],execute:function(){function a(e,t){if(l(e,t)){var i=e.editorModel.data.additionalDiscountUnitOptions;return null!==e.lineVO.targetCustomerAmount&&void 0!==e.lineVO.targetCustomerAmount?{units:i,unit:"UnitOverride",displayValue:e.getLineVOProperty("targetCustomerAmount")}:null!==e.lineVO.targetCustomerTotal&&void 0!==e.lineVO.targetCustomerTotal?{units:i,unit:"TotalOverride",displayValue:e.getLineVOProperty("targetCustomerTotal")}:null!=e.getField(e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)?{units:i,unit:"Amount",displayValue:e.getField(e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)}:null!=e.getField(e.constants.ADDITIONAL_DISCOUNT_RATE_FIELD)?{units:i,unit:"Percent",displayValue:e.getField(e.constants.ADDITIONAL_DISCOUNT_RATE_FIELD)}:{units:i,unit:e.editorModel.data.defaultAdditionalDiscountUnit.replace(/ /g,""),displayValue:null}}var n=e.editorModel.data.markupUnitOptions;return null!=e.getField(e.constants.MARKUP_AMOUNT_FIELD)?{units:n,unit:"Amount",displayValue:e.getField(e.constants.MARKUP_AMOUNT_FIELD)}:null!=e.getField(e.constants.MARKUP_RATE_FIELD)?{units:n,unit:"Percent",displayValue:e.getField(e.constants.MARKUP_RATE_FIELD)}:{units:n,unit:e.editorModel.data.defaultMarkupUnit.replace(/ /g,""),displayValue:null}}function r(o,e,r){var t=a(o,e).displayValue;if(r){var s=o.lineVO.record,i=l(o,e)?function(){function e(){s[o.constants.ADDITIONAL_DISCOUNT_RATE_FIELD]=null,s[o.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD]=null,!o.lineVO.targetCustomerAmount&&0!==o.lineVO.targetCustomerAmount||(o.lineVO.targetCustomerAmount=null),!o.lineVO.targetCustomerTotal&&0!==o.lineVO.targetCustomerTotal||(o.lineVO.targetCustomerTotal=null)}var t=s[o.constants.REGULAR_PRICE_FIELD];if(null!=t){var i=d(o);if(e(),"Percent"==r)return s[o.constants.ADDITIONAL_DISCOUNT_RATE_FIELD]=i/t*100;if("Amount"!=r)return"UnitOverride"==r?o.lineVO.targetCustomerAmount=t-i:"TotalOverride"==r?o.lineVO.targetCustomerTotal=(t-i)*c(o):void 0;var n=o.lineVO.amountDiscountProrated?s[o.constants.PRORATE_MULTIPLIER_FIELD]:1;return s[o.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD]=i/n}e()}():function(){var e=s[o.constants.UNIT_COST_FIELD];if("Percent"===r){var t=s[o.constants.MARKUP_AMOUNT_FIELD];return null==t&&(t=0),s[o.constants.MARKUP_AMOUNT_FIELD]=null,s[o.constants.MARKUP_RATE_FIELD]=null!=e?t/e*100:null}var i=s[o.constants.MARKUP_RATE_FIELD];return null==i&&(i=0),s[o.constants.MARKUP_RATE_FIELD]=null,s[o.constants.MARKUP_AMOUNT_FIELD]=null!=e?e*(i/100):null}();return{unit:r,displayValue:isNaN(i)?isNaN(t)?null:t:i}}}function l(e,t){return t===e.constants.ADDITIONAL_DISCOUNT_FIELD}e("getUnitAndDisplayValue",a),e("updateUnitIfAmountInactive",function(e,t){var i=a(e,t),n=i.units;if(i.unit,i.displayValue,e.getField(e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)&&!n.some(function(e){return"Amount"===e.value})){var o=e.getField(e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)&&n.some(function(e){return"Percent"===e.value})?"Percent":n[0].value;r(e,t,o)}}),e("setDiscountValue",function(e,t,i){var n=a(e,t),o=n.unit,r=n.displayValue,s=e.lineVO.record;r=l(e,t)?("Percent"===o?s[e.constants.ADDITIONAL_DISCOUNT_RATE_FIELD]=i:"Amount"===o?s[e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD]=i:"UnitOverride"===o?e.lineVO.targetCustomerAmount=i:"TotalOverride"===o&&(e.lineVO.targetCustomerTotal=i),d(e)/(e.lineVO.amountDiscountProrated?s[e.constants.PRORATE_MULTIPLIER_FIELD]:1)):("Percent"===o?s[e.constants.MARKUP_RATE_FIELD]=i:"Amount"===o&&(s[e.constants.MARKUP_AMOUNT_FIELD]=i),s[e.constants.MARKUP_AMOUNT_FIELD]||(s[e.constants.UNIT_COST_FIELD]?s[e.constants.UNIT_COST_FIELD]*i/100:null)),u(e,["lineVO","record",e.constants.ADDITIONAL_DISCOUNT_FIELD],isNaN(r)?0:r)}),e("convertDiscountValue",r),e("isAdditionalDiscountField",l)}}}),System.register("quotes/layout/sb-le-table-cell/LETableCell.js",["../sb-le-table-cell/Localizer.js","../../../common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js","../sb-le-table-cell/QuoteLineUpgradeHandler.js","common/core/AppContext.js","common/core/sb-page-container/PageContainer.js","common/relationship/RelationshipFieldManager.js","quotes/layout/sb-le-table-cell/DiscountConverter.js"],function(t,e){var o,i,r,s,a,l,u,d,c,h;return{setters:[function(e){o=e.Localizer},function(e){i=e.AssetUpgradeQuantityCalculator},function(e){r=e.QuoteLineUpgradeHandler},function(e){s=e.AppContext},function(e){a=e.PageContainer},function(e){l=e.RelationshipFieldManager},function(e){u=e.isAdditionalDiscountField,d=e.getUnitAndDisplayValue}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}c={ICON:"sf-icon-chevrondown",TOP_LEVEL:"top-level",OPTION:"option",INDENT:"sbIndent",RIGHT:"right",CENTER:"center",OVERRIDDEN:"overridden"},t("LETableCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-table-cell",this.properties={item:String,value:{notify:!0},model:{type:Object,notify:!0},fieldClass:String,data:Object,display:String,index:Number,detailsOnHover:{type:Boolean,value:!1},renderTooltip:{type:Boolean,value:!1},viewport:{type:Object,value:function(){return a.getViewport()}},editable:Boolean,calculateImmediately:{type:Object,value:function(){return s.org.calculateImmediately}}}}},{key:"_onTap",value:function(){}},{key:"attached",value:function(){this.isAttached=!0,this.scopeSubtree(this.$.field,!0),this.wasModelIsChangedCalledBeforeAttached&&this._modelIsChanged(),this.model.lineVO.record[this.constants.UPGRADED_ASSET_FIELD]&&this.model.groupModel.quoteModel.isAmendmentOrChangeQuote&&this.item===this.constants.QUANTITY_FIELD&&(this.quoteLineUpgradeHandler=new r(this.model),this.quoteLineUpgradeHandler.getSourceLineVO()&&this.quoteLineUpgradeHandler.getUpgradeLineVO()&&(this.addEventListener("value-changed",this._quantityChanged),this.assetUpgradeQuantityCalculator=new i(this.quoteLineUpgradeHandler)))}},{key:"_datePickerOpened",value:function(e){var t=e.detail.dateContainer,i=e.detail.datepicker,n=i.offsetParent.getBoundingClientRect(),o=t.getBoundingClientRect(),r=this.model.groupModel.quoteModel;!r.grouped&&r.editorModel.largeQuoteExperienceEnabled&&(i.style.left=-n.left+o.left+"px",i.style.top=o.bottom-n.top+"px"),o.left+i.offsetWidth>window.innerWidth&&(i.style.left="",i.style.right=n.right-o.right+17+"px"),e.stopPropagation()}},{key:"_modelIsChangedObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this._modelIsChanged(e,t,i)}},{key:"_modelIsChanged",value:function(){if(this.wasModelIsChangedCalledBeforeAttached=!this.isAttached,this.isAttached&&this.model)if(this.item!==this.constants.SUBSCRIPTION_SCOPE_FIELD||this.model.subscriptionScopeEditable){this.isMobile=this.viewport&&this.viewport.isMobile(),this.overrideEditable=this.classList.contains("mdqSummaryRow")||this.classList.contains("primary");var e=this._setEditable(),t=this._setFieldMD();this._setFieldClassAndFieldContent(t)||(!t.defaultValue||null!=this.value||t.controllingPicklist||t.dependentPicklist||(this.value=t.defaultValue),this.data&&this.value!=this.data[this.item]&&(this.value=this.data[this.item]),void 0===this.value&&(this.value=null),this.label=t.label,this.$.field.editing=e,this.$.field.md=t,this.$.field.property=this.item,this.model.segmented&&!/__c$/.test(this.item)&&"total"!=this.item&&(this.removeEventListener("mouseenter",this._showDetails),this.removeEventListener("mouseleave",this._showDetails),this.renderTooltip=!0,this.addEventListener("mouseenter",this._showDetails),this.addEventListener("mouseleave",this._showDetails)))}else this.fieldClass+=" "+c.OVERRIDDEN}},{key:"_updateOriginalValueObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._updateOriginalValue(e,t)}},{key:"_updateOriginalValue",value:function(){this.model.lineVO&&(this.model.lineVO.ui_original_record=this.model.lineVO.ui_original_record||JSON.parse(JSON.stringify(this.model.lineVO.record)));var e=this.get("model.lineVO.ui_original_record");this.$.field.originalValue=e[this.item]}},{key:"_dataOrValueChangedObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this._dataOrValueChanged(e,t,i)}},{key:"_dataOrValueChanged",value:function(e,t,i){t==e[i]&&(this.internal=!0,this.userChangedLookupValue?this._updateRelationshipName():this._updateLookupDisplayValue(),this.$.field.value=this.model&&u(this.model,i)?d(this.model,i).displayValue:t,this.internal=!1,this.userChangedLookupValue=!1)}},{key:"_updateRelationshipName",value:function(){this.model&&new l(this.item,this.data).addRelationshipName(this.value,this.display,this.model.getFieldMD(this.item).referenceTo[0])}},{key:"_updateLookupDisplayValue",value:function(){var e=new l(this.item,this.data);e.hasRelationship()?this.display=e.getRelationshipName():this.display=void 0}},{key:"_displayChanged",value:function(){this.userChangedLookupValue=!this.internal}},{key:"_setEditable",value:function(){return!this.overrideEditable&&this.model.isEditable(this.item)}},{key:"_editableChangedObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this._editableChanged(e,t,i)}},{key:"_editableChanged",value:function(){this.$.field.editing=!this.overrideEditable&&this.model.isEditable(this.item)}},{key:"_setFieldMD",value:function(){var e=this.model.getFieldMD(this.item)?this.model.getFieldMD(this.item):this.model.getFieldMD(this.constants.NET_TOTAL_FIELD);return e.CurrencyIsoCode=this.model.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode,this.constants.QUANTITY_FIELDS&&this.constants.QUANTITY_FIELDS.has(this.item)&&null!=this.model.lineVO.productQuantityScale&&(e=Object.assign({},e,{scale:this.model.lineVO.productQuantityScale})),e}},{key:"_setFieldClassAndFieldContent",value:function(e){var t="";if(this.model.editorModel.data.settings.productHierarchyVisualized&&!this.model.segmented&&(this.isMobile?this.item!==this.constants.PRODUCT_NAME_FIELD&&this.item!==this.constants.NET_TOTAL_FIELD||(t+=""+c.INDENT+this.record[this.constants.OPTION_LEVEL_FIELD]):this.item===this.constants.PRODUCT_NAME_FIELD&&(this.model.isBundle?t+=c.ICON+" ":this.model.component||(t+=c.TOP_LEVEL+" "),this.model.component&&(this.model.isBundle||(t+=c.OPTION+" "),t+=""+c.INDENT+this.record[this.constants.OPTION_LEVEL_FIELD]))),!this._isSegmentedDrawer()&&"number"!=e.type&&"double"!=e.type&&"percent"!=e.type&&"currency"!=e.type||(t+=" "+c.RIGHT,this.classList.contains("drawerCell")&&this._togglePreventNumericAlignment(),this._isSegmentedDrawer()&&this._toggleSegmentedAlignment()),this._isSegmentedDrawer()||"boolean"!==e.type||(t+=" "+c.CENTER),this.model.bundled&&this.item===this.constants.LIST_PRICE_FIELD)return this.overrideValue=s.properties.i18n.value().l("Included"),t+=" "+c.OVERRIDDEN,this.fieldClass=t,!0;var i=o.getLocalizedValue(this.model,this.item);return i?(this.overrideValue=i,t+=" "+c.OVERRIDDEN,this.fieldClass=t,!0):(this.fieldClass=t,!1)}},{key:"_togglePreventNumericAlignment",value:function(){this.$.field.preventNumericAlignment=!this.$.field.preventNumericAlignment}},{key:"_toggleSegmentedAlignment",value:function(){this.$.field.segmentedAlignment=!0}},{key:"_isSegmentedDrawer",value:function(){return"mdqSummaryRow"===this.model.itemClassMap.attributes&&!this.classList.contains("mdqSummaryRow")}},{key:"_quantityChanged",value:function(e){if(!this.model.internalUpdate){this.assetUpgradeQuantityCalculator.setQuantitiesByRatio();var t=this.quoteLineUpgradeHandler.getIndexes(),i=this.quoteLineUpgradeHandler.getSourceLineVO(),n=this.quoteLineUpgradeHandler.getUpgradeLineVO();this.fire("upgrade-asset-quantity-changed",{sourceIndex:t.sourceIndex,upgradeIndex:t.upgradeIndex,sourceLineVO:i,upgradeLineVO:n})}}},{key:"_handleFieldValueChanged",value:function(e){!e.detail.suppressImmediateCalculation&&this.calculateImmediately&&this.fire("calculate-immediately");var t={value:this.item};this.fire("field-updated",t)}},{key:"_showDetails",value:function(e){var t=e.type;this.detailsOnHover="mouseenter"==t}},{key:"_getLineModel",value:function(){if("total"!=this.item&&null!=this.model.segmentsByLabel)for(var e=Object.keys(this.model.segmentsByLabel),t=e.length,i=0;i<t;i++)if(e[i].replace(/\W/g,"")==this.item)return this.model.segmentsByLabel[e[i]];return this.model}},{key:"_getRecord",value:function(){return this._getLineModel().lineVO.record}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_modelIsChangedObserver(model, index, viewport)","_displayChanged(display)","_dataOrValueChangedObserver(data, value, item)","_updateOriginalValueObserver(model, item)","_editableChangedObserver(editable, model, item)"]}},{key:"listeners",get:function(){return{tap:"_onTap","datepicker-opened":"_datePickerOpened","sb-field-on-change-field":"_handleFieldValueChanged"}}},{key:"constants",get:function(){return this.model.editorModel.constants}},{key:"record",get:function(){return this.model.lineVO.record},set:function(e){this.model.lineVO.record=e}}]),h=e)),t("LETableCell",h),Polymer(h)}}}),System.register("quotes/layout/sb-le-table-cell/Localizer.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Localizer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,null,[{key:"getLocalizedValue",value:function(e,t,i){var n=e.editorModel.constants,o=e.groupModel.quoteModel.quoteVO.localizationByFieldByProductId[e.getField(n.PRODUCT)],r=e.getFieldMD(t);if(o&&r){var s=e.editorModel.data.developerPrefix,a=r&&r.calculatedFormula&&0===r.calculatedFormula.indexOf(s+"Product__r")?r.calculatedFormula.split(".")[1].replace(s,""):r.name,l=i?o[a][i]:o[a];if(l)return l.record[n.TEXT_FIELD]||l.record[n.TEXT_AREA_FIELD]||l.record[n.LONG_TEXT_AREA_FIELD]||l.record[n.RICH_TEXT_AREA_FIELD]}}}]),i=e)),t("Localizer",i)}}}),System.register("quotes/layout/sb-le-table-cell/QuoteLineUpgradeHandler.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=e,this.indexes={}}e("QuoteLineUpgradeHandler",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"isSourceLine",value:function(){return this.model.existing}},{key:"getLine",value:function(){return this.model.lineVO}},{key:"getLines",value:function(){return this.model.groupModel.standardLines}},{key:"getSourceOrUpgrade",value:function(e){var t=void 0;if(this.model.editorModel.data.settings.bundleKeptTogether)t=this._findLineWithTargetAssetId(e,this.model.groupModel);else for(var i=this.model.groupModel.quoteModel.lineGroups,n=0,o=i.length;n<o&&!t;n++)t=this._findLineWithTargetAssetId(e,i[n]);return t}},{key:"_findLineWithTargetAssetId",value:function(e,t){for(var i=!e,n=void 0,o=this.model.lineVO.record[this.constants.UPGRADED_ASSET_FIELD],r=0,s=t.standardLines.length;r<s;r++){var a=t.standardLines[r];if(a.lineVO.record[this.constants.UPGRADED_ASSET_FIELD]===o&&a.lineVO.record[this.constants.EXISTING_FIELD]===i){var l=i?"sourceIndex":"upgradeIndex";this.indexes[l]=r,n=a.lineVO}if(this.model.lineVO.key===a.lineVO.key){var u=!this.indexes.sourceIndex&&this.model.existing?"sourceIndex":"upgradeIndex";this.indexes[u]=r}}return n}},{key:"setSourceAndUpgrade",value:function(e,t){this.sourceLineVO=e,this.upgradeLineVO=t}},{key:"getSourceIdField",value:function(){return this.constants.PRODUCT}},{key:"getUpgradeConversionRateField",value:function(){return this.constants.UPGRADE_CONVERSION_RATE}},{key:"getSourceCurrentQuantityField",value:function(e){return e.record[this.constants.QUANTITY_FIELD]}},{key:"getUpgradeCurrentQuantityField",value:function(e){return e.record[this.constants.QUANTITY_FIELD]}},{key:"getSourcePriorQuantity",value:function(e){return e.record[this.constants.PRIOR_QUANTITY_FIELD]}},{key:"didSourceQuantityChange",value:function(e){return e}},{key:"didUpgradeQuantityChange",value:function(e){return!e}},{key:"isSelected",value:function(){return!0}},{key:"setUpdatedQuantity",value:function(e,t,i,n){e.record[this.constants.QUANTITY_FIELD]=i,t.record[this.constants.QUANTITY_FIELD]=n}},{key:"getIndexes",value:function(){return this.indexes}},{key:"getSourceLineVO",value:function(){return this.sourceLineVO}},{key:"getUpgradeLineVO",value:function(){return this.upgradeLineVO}},{key:"constants",get:function(){return this.model.fieldNames}}]),i=t)),e("QuoteLineUpgradeHandler",i)}}}),System.register("quotes/layout/sb-le-table-header/LETableHeader.js",["common/core/sb-page-container/PageContainer.js","quotes/models/UiNotifier.js","common/core/Events.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.PageContainer},function(e){o=e.setThenNotify},function(e){r=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LETableHeader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-table-header",this.properties={lineModels:{type:Object,notify:!0},fieldNames:Array,fieldLabelsMap:Object,fieldClasses:{type:Object,value:{}},constants:Object,fields:Object,settings:Object,actionsOnTheLeft:{type:Boolean,default:!1,computed:"_getActionsPlacement(settings)"},viewport:{type:Object,value:function(){return i.getViewport()}}}}},{key:"_getActionsPlacement",value:function(){return"Left"==this.settings.actionsColumnPlacement}},{key:"_buildRowsObserver",value:function(e,t,i,n,o,r,s){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o&&void 0!==r&&void 0!==s)return this._buildRows(e,t,i,n,o,r,s)}},{key:"_buildRows",value:function(){for(var e=[],t={},i=0,n=this.fieldNames.length;i<n;i++){var o=this.fieldNames[i];e.push(o);var r=this.fields[o];!r||"number"!=r.type&&"double"!=r.type&&"percent"!=r.type&&"currency"!=r.type?r&&"boolean"==r.type&&(this.fieldClasses[r.name]="center"):t[this.fieldLabelsMap[o]]=!0}if(this.columnNames){for(var s=0,a=this.columnNames.length;s<a;s++){var l=this.columnNames[s].replace(/\W/g,"");e.push(l),t[this.fieldLabelsMap[l]]=!0}e.push("total"),this.fieldClasses[this.constants.SEGMENT_LABEL_FIELD]="hiddenInMobile",t[this.fieldLabelsMap.total]=!0}this.header&&this.header.group.length!=e.length&&this.header.destroyGroup(),this.header=this.$.header,this.data=void 0,this.header.model=t,this.header.model.isStandard=!(this.columnNames&&0<this.columnNames.length),this.header.model.settings=this.settings,this.header.itemClassMap=this.fieldClasses,this.header.groupClass=this.viewport&&this.viewport.isMobile()?"tgroup":"leGroup",this.header.columnWidths=this.columnWidths,this.header.group||(this.header.group=e),this.data=this.fieldLabelsMap,this.displayDrawerIcon=this.editorModel&&0<this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length&&!this.columnNames,this.columnNames&&(this.expansionIconClass="sf-icon-right"),this.displayDrawerIcon&&(this.lineItemDrawerIconClass="sf-icon-chevronright")}},{key:"_columnWidthsChanged",value:function(){!this.header||this.viewport&&this.viewport.isMobile()||(this.header.columnWidths=this.columnWidths)}},{key:"toggleAllLinesExpansion",value:function(){if(this.columnNames){var e="sf-icon-right"!=this.expansionIconClass;this.expansionIconClass=e?"sf-icon-right":"sf-icon-down";for(var t=0,i=this.lineModels.length;t<i;t++)this.set("lineModels."+t+".lineVO.expanded",!e),this.set("lineModels."+t+".expandedIconClass",this.expansionIconClass)}else if(0<this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length){var n="sf-icon-chevronright"!=this.lineItemDrawerIconClass;this.lineItemDrawerIconClass=n?"sf-icon-chevronright":"sf-icon-chevrondown";for(var o=0,r=this.lineModels.length;o<r;o++)this.set("lineModels."+o+".lineVO.expanded",!n),this.set("lineModels."+o+".lineItemDrawerIconClass",this.lineItemDrawerIconClass)}this.editorModel.largeQuoteExperienceEnabled&&this.fire("line-toggled",{index:null})}},{key:"toggleAllCheckBoxes",value:function(){for(var e=0;e<this.lineModels.length;e++)o(this.lineModels[e],["selected"],this.selected)}},{key:"deselectCheckbox",value:function(){this.set("selected",!1)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[r.DESELECT_CHECKBOX]=this.deselectCheckbox,e}},{key:"observers",get:function(){return["_buildRowsObserver(fieldNames, columnNames, fieldLabelsMap, fields, constants, columnWidths, settings)","_columnWidthsChanged(columnWidths)"]}}]),s=e)),t("LETableHeader",s),Polymer(s)}}}),System.register("quotes/layout/sb-le-table-header-cell/LETableHeaderCell.js",["common/core/AppContext.js","quotes/models/Constants.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.AppContext},function(e){o=e.Constants}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LETableHeaderCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-table-header-cell",this.properties={byOrder:String,model:{type:Object,observer:"_modelChanged"},showSortableHeader:{type:Boolean,computed:"_showSortableHeader(model)"},prefix:{type:String,value:function(){return this.constants=new o(i.org.prefix+"__"),i.org.prefix}},overflowTrue:{type:Boolean,value:!1}}}},{key:"_modelChanged",value:function(){Polymer.dom(this.$.headerCell).observeNodes(function(){var e=this.$$("#header");this.toggleClass("right",this.model[this.value],e);var t=this.model.settings&&this.model.settings.productHierarchyVisualized&&this.model.isStandard&&this.getAttribute("item")===this.constants.PRODUCT_NAME_FIELD;this.toggleClass("bundlesVisualized",t,e)}.bind(this))}},{key:"sortLines",value:function(e){for(var t="",i=this.parentElement.children,n=0;n<i.length;n++)i[n].toggleClass("asc",!1,i[n].$$("#header")),i[n].toggleClass("desc",!1,i[n].$$("#header")),i[n].$$("#arrow")&&i[n].toggleClass("sf-icon-arrowup",!0,i[n].$$("#arrow")),i[n].$$("#arrow")&&i[n].toggleClass("sf-icon-arrowdown",!1,i[n].$$("#arrow")),Polymer.dom(i[n]).classList.remove("column-selected");this.byOrder?"asc"===this.byOrder?(t="desc",this.toggleClass("sf-icon-arrowup",!1,this.$$("#arrow")),this.toggleClass("sf-icon-arrowdown",!0,this.$$("#arrow"))):"desc"===this.byOrder&&(t=""):(t="asc",this.toggleClass("sf-icon-arrowup",!0,this.$$("#arrow"))),this.sortByField=t?this._getKeyByValue(this.value,this.data):null,this.toggleClass("column-selected",t),(this.byOrder=t)&&this.toggleClass(t,!0,this.$$("#header")),this.fire("table-header-sort-clicked",{order:this.byOrder,field:this.sortByField})}},{key:"_showSortableHeader",value:function(){return!this.model.lineVO&&this.getAttribute("item")!==this.constants.ADDITIONAL_DISCOUNT_FIELD&&!this.classList.contains("hoverFieldHeader")}},{key:"_getKeyByValue",value:function(e,t){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e)return i}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),r=e)),t("LETableHeaderCell",r),Polymer(r)}}}),System.register("quotes/layout/sb-segmented-detail-row/SegmentedDetailRow.js",["quotes/models/LineModel.js","../../../common/core/sb-page-container/PageContainer.js","common/signal/RowFocusSignaler.js"],function(t,e){var o,i,r,s;return{setters:[function(e){o=e.LineModel},function(e){i=e.PageContainer},function(e){r=e.RowFocusSignaler}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SegmentedDetailRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-segmented-detail-row",this.properties={lineModel:{type:Object,notify:!0},viewport:{type:Object,value:function(){return i.getViewport()}},columnName:String,itemClassMap:{type:Object,value:{}},highlightRowOnFocus:{type:Boolean,observer:"_highlightRowOnFocus"},index:{type:Number,reflectToAttribute:!0}}}},{key:"ready",value:function(){this.expanded=!1}},{key:"expand",value:function(e){this.isMobile&&this.enableEditableFields(),this.$.column.fire("group-expanded",{path:Polymer.dom(e).path})}},{key:"enableEditableFields",value:function(){var e=Polymer.dom(this.$.column.root).querySelectorAll("sb-le-table-cell"),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0)o.value.$$("sb-field").renderReadOnly=!1}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"_lineRecordChanged",value:function(e){if(e.path){var t=e.path.indexOf("#"),i=e.path.indexOf(".",t),n=e.path.substring(t+1,i);if(this._pathRefersToMySegmentRecord(n)){var o=e.path.split("."),r=o[o.length-1];"fieldEditability"==r?this._editabilityChanged():"fieldVisibility"==r?this._visibilityChanged():this.set("segmentRecord."+r,e.value)}}}},{key:"_lineModelChanged",value:function(){this.dimension=this.lineModel.lineVO.dimensionType,this.segmentModel=this.lineModel.segmentsByLabel[this.columnName]?this.lineModel.segmentsByLabel[this.columnName]:new o({key:null,record:{}},this.lineModel.groupModel);var e=this.$$("#column");if(this.isMobile&&e&&(this.lineModel.lineVO.expanded||!1)!=(this.expanded||!1)){var t=document.createEvent("HTMLEvents");t.initEvent("tap",!0,!1);var i=Polymer.dom(e.root).querySelectorAll("sb-le-table-cell")[0];i&&i.dispatchEvent(t)}}},{key:"_setGroupObserver",value:function(e,t,i,n,o){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o)return this._setGroup(e,t,i,n,o)}},{key:"_setGroup",value:function(){this.$.column.group||(this._initializeFieldVisibility(),this.$.column.group=this.detailFieldNames)}},{key:"_initializeFieldVisibility",value:function(){var t=this,i={};this.detailFieldNames.forEach(function(e){t.segmentModel.isFieldRendered(e,t.isMobile)||(i[e]=t.isMobile?"hiddenInMobile":"hiddenInDesktop")}),this.$.column.itemClassMap=i}},{key:"_visibilityChanged",value:function(){var n=this;this.segmentModel.lineVO.fieldVisibility&&this.detailFieldNames.forEach(function(e){var t=n.segmentModel.isFieldRendered(e,n.isMobile),i=[{class:"hiddenInMobile",value:!t},{class:"hiddenInDesktop",value:!t}];n.$.column.set("itemClassMap."+e,i)})}},{key:"_editabilityChanged",value:function(){var t=this;if(this.segmentModel.lineVO.fieldEditability&&this.detailFieldNames){var i={};this.detailFieldNames.forEach(function(e){t.segmentModel.lineVO.fieldEditability.hasOwnProperty(e)&&(i[e]=t.lineModel.isEditable(e,t.segmentModel.lineVO.fieldEditability))}),this.$.column.itemEditableMap=i}}},{key:"_pathRefersToMySegmentRecord",value:function(e){if(!this.segmentRecord)return!1;if(this.lineModel.segments&&!this.lineModel.segments[e])return!1;var t=this.lineModel.segments[e].lineVO,i=t.record[this.constants.SEGMENT_KEY_FIELD],n=t.record[this.constants.SEGMENT_INDEX_FIELD],o=t.record[this.constants.SEGMENT_LABEL_FIELD],r=this.segmentRecord[this.constants.SEGMENT_KEY_FIELD],s=this.segmentRecord[this.constants.SEGMENT_INDEX_FIELD],a=this.segmentRecord[this.constants.SEGMENT_LABEL_FIELD];return i===r&&n===s&&o===a}},{key:"_highlightRowOnFocus",value:function(){this.signaler=this.signaler||new r(this,"column","sb-le-table-cell",null,this.index),this.signaler.signalOnFocus("sb-row-focus-signal",!this.highlightRowOnFocus)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_lineRecordChanged(lineModel.segments.*)","_lineModelChanged(lineModel, columnName)","_setGroupObserver(detailFieldNames, segmentRecord, segmentModel, mobileCols, fieldLabelsMap)"]}},{key:"constants",get:function(){return this.lineModel.editorModel.constants}},{key:"selector",get:function(){return this.signaler?this.signaler.selector:null}},{key:"isMobile",get:function(){this.viewport&&this.viewport.isMobile()}}]),s=e)),t("SegmentedDetailRow",s),Polymer(s)}}}),System.register("quotes/layout/sb-segmented-line-details/SegmentedLineDetails.js",["quotes/models/LineModel.js","common/core/sb-page-container/PageContainer.js","common/signal/RowFocusSignaler.js","common/Util.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.LineModel},function(e){o=e.PageContainer},function(e){r=e.RowFocusSignaler},function(e){s=e.toFieldName}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SegmentedLineDetails",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-segmented-line-details",this.properties={lineModel:{type:Object,notify:!0},groupModel:{type:Object,notify:!0},fieldNames:Array,detailFieldNames:Array,fieldLabelsMap:Object,columnNames:Array,itemClassMap:{type:Object,value:{}},viewport:{type:Object,value:function(){return o.getViewport()}},tabIndex:{type:Number,computed:"_initTabIndex(viewport)"}},this.listeners={change:"_onChange","rte-value-changed":"_onChange"}}},{key:"attached",value:function(){var t=this;Polymer.RenderStatus.afterNextRender(this,function(){t.detailFieldNames.forEach(function(e){t._adjustDetailFieldHeights(e)})})}},{key:"_adjustDetailFieldHeights",value:function(e){var t=this.lineModel.getFieldMD(e);if(t&&("textarea"===t.type||"string"===t.type||"currency"===t.type)){var i=this.querySelectorAll("sb-le-table-cell[item='"+e+"'] #field");if(i){var n=Array.from(i),o=Math.max.apply(Math,function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(n.map(function(e){return e.scrollHeight})));n.forEach(function(e){e.offsetHeight<o&&(e.style.height=o+"px")});var r=this.querySelector("sb-le-table-header-cell[item='"+e+"'] #header");r&&r.offsetHeight<o&&(r.style.height=o+"px")}}}},{key:"_onChange",value:function(t){var i=this;t.detail&&Polymer.RenderStatus.afterNextRender(this,function(){var e=Polymer.dom(t).path.find(function(e){return"SB-LE-TABLE-CELL"===e.tagName});e&&i._adjustDetailFieldHeights(e.item)})}},{key:"isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"getSegmentRecord",value:function(e){return this.lineModel.segmentsByLabel[e]?this.lineModel.segmentsByLabel[e].lineVO.record:new i({key:null,record:{}},this.lineModel.groupModel).lineVO.record}},{key:"segmentExists",value:function(e){return this.lineModel.segmentsByLabel[e]?"":"desktopOnly"}},{key:"forwardFocusDown",value:function(e){9!==e.keyCode||e.shiftKey||r.signalFirstEditableTargetFirstRow(this,"sb-segmented-detail-row","index")}},{key:"forwardFocusUp",value:function(e){9===e.keyCode&&e.shiftKey&&r.signalLastEditableTargetLastRow(this,"sb-segmented-detail-row",this.columnNames.length,"index")}},{key:"_buildRowObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this._buildRow(e,t,i,n)}},{key:"_buildRow",value:function(){this._setColumnWidths(),this.$.header.itemClassMap=this.itemClassMap,this.detailFieldNamesWithLabel=this.isMobile()?[this.lineModel.editorModel.constants.SEGMENT_LABEL_FIELD].concat(this.detailFieldNames):this.detailFieldNames,this.$.header.group||(this.$.header.group=this.detailFieldNamesWithLabel)}},{key:"_isActionsOnTheLeft",value:function(e){return e.actionsOnTheLeft}},{key:"_setColumnWidths",value:function(){if(!this.isMobile()){var e=this.columnWidths;if(e&&this.columnNames){for(var t=0,i=0,n=this.fieldNames.length;i<n;i++)t+=e[this.fieldNames[i]];this.fieldNamesColWidth=t+"px",this.totalColWidth=e.total+"px"}}}},{key:"_segDetailColWidth",value:function(e,t){return t[s(e)]+"px"}},{key:"_columnWidthsChanged",value:function(){this._setColumnWidths()}},{key:"_initTabIndex",value:function(){return this.isMobile()?-1:0}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_buildRowObserver(detailFieldNames, fieldNames, lineModel, columnWidths)","_columnWidthsChanged(columnWidths)"]}}]),a=e)),t("SegmentedLineDetails",a),Polymer(a)}}}),System.register("quotes/layout/sf-le-table-header/SFLETableHeader.js",["common/core/sb-page-container/PageContainer.js","common/behaviors/DeviceBehavior.js","common/behaviors/TemplatizationBehavior.js","quotes/models/UiNotifier.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/tables/SFTableHeaderBehavior.js","common/core/Events.js"],function(t,e){var i,o,r,s,a,l;return{setters:[function(e){e.PageContainer},function(e){e.DeviceBehavior},function(e){i=e.TemplatizationBehavior},function(e){o=e.setThenNotify},function(e){r=e.TemplateGenerator},function(e){s=e.SFTableHeaderBehavior},function(e){a=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFLETableHeader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-le-table-header",this.properties=Polymer.Base.extend({lineModels:{type:Object,notify:!0},fields:Object},i.properties),this.properties=Polymer.Base.extend(this.properties,s.properties),this.listeners={tap:"onTap",mouseover:"onHover",mousedown:"startResize"}}},{key:"ready",value:function(){this.shadyRoot&&this.scopeSubtree(this.$.content,!0)}},{key:"onTap_hook",value:function(e){var t=this.findElementForEvent(e,"bundle-caret");if(t)return this._toggleBundleExpansion(t),!0;var i=this.findElementForEvent(e,"drawerIcon");if(i)return this._toggleStandardDrawers(i),!0;var n=this.findElementForEvent(e,"segmentedDrawer");return n?(this._toggleSegmentedDrawers(n),!0):void 0}},{key:"_toggleBundleExpansion",value:function(e){var t=this.uiData._caretContent===r.classNames.CHEVRON_DOWN_CONTENT;this._restampField("_caretContent",t?r.classNames.CHEVRON_RIGHT_CONTENT:r.classNames.CHEVRON_DOWN_CONTENT),this.fire("bundle-toggled",{expanded:!t})}},{key:"toggleSelection",value:function(e){var t=e.querySelector("input[type=checkbox]");if(t.checked=!t.checked,this.lineModels)for(var i=0;i<this.lineModels.length;i++)o(this.lineModels[i],["selected"],t.checked)}},{key:"deselectCheckbox",value:function(){var e=this.querySelector("div.selection div.checkboxcontainer");e&&(e.querySelector("input[type=checkbox]").checked=!1)}},{key:"_toggleStandardDrawers",value:function(e){var t=e.querySelector("span");t&&this._toggleDrawers(t,r.classNames.CHEVRON_RIGHT_ICON,r.classNames.CHEVRON_DOWN_ICON,"lineItemDrawerIconClass")}},{key:"_toggleSegmentedDrawers",value:function(e){var t=e.querySelectorAll("span")[1];t&&this._toggleDrawers(t,r.classNames.RIGHT_ICON,r.classNames.DOWN_ICON,"expandedIconClass")}},{key:"_toggleDrawers",value:function(e,t,i,n){var o=!e.classList.contains(t),r=o?t:i;if(e.classList.remove(t,i),e.classList.add(r),this.lineModels)for(var s=0,a=this.lineModels.length;s<a;s++)this.set("lineModels."+s+".lineVO.expanded",!o),this.set("lineModels."+s+"."+n,r);this.fire("line-toggled")}},{key:"getContentNode",value:function(){return Polymer.dom(this.$.content)}},{key:"getTooltipContent",value:function(e){return this.uiData[e]||""}},{key:"behaviors",get:function(){return[Polymer.Templatizer,window.CommonBehaviors.TemplatizationBehavior,window.CommonBehaviors.SFTableHeaderBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[a.DESELECT_CHECKBOX]=this.deselectCheckbox,e}}]),l=e)),t("SFLETableHeader",l),Polymer(l)}}}),System.register("quotes/layout/sf-le-table-row/ControllingField.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ControllingField",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"getFieldName",value:function(){}},{key:"updateControlledFields",value:function(e,t){}}]),i=e)),t("ControllingField",i)}}}),System.register("quotes/layout/sf-le-table-row/DesktopDelegate.js",["quotes/layout/sf-le-table-row/DeviceDelegate.js","quotes/layout/template-generator/TemplateGenerator.js"],function(t,e){var i,c,o,r;return{setters:[function(e){i=e.DeviceDelegate},function(e){c=e.TemplateGenerator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("DesktopDelegate",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),o(e,[{key:"toggleInlineEdit",value:function(e,t,i,n,o,r){var s=e.querySelector(".w"),a=e.querySelector(".r"),l="richtextarea"===n.extraTypeInfo;if(o.toggleCellClass("hidden",t&&!l,a,i),o.toggleCellClass(c.classNames.EDIT_MODE,t&&!l,e,i),t){s||(s=o._createWritableElement(i,e));var u=s.querySelector('input:not([type="hidden"]), checkbox, select, textarea, sb-rte');u&&setTimeout(function(){u.focus()},10)}else if(s&&(l||e.removeChild(s),o.commitPendingEdit(r))){var d=o._formatNewValue(i,n);setTimeout(function(){o.fire("line-toggled",{index:o.dataIndex})}),o._toggleDirtyClass(d,i,a)}}},{key:"onKeyDown",value:function(e,t){var i=!1;switch(e.keyCode){case 27:i=this._onEscapePress(e,t);break;case 32:i=this._onSpaceBarPress(e,t)}return i}},{key:"_onSpaceBarPress",value:function(e,t){var i=Polymer.dom(e).path[0];if(i.classList.contains(c.classNames.EDITABLE)&&i.classList.contains(c.classNames.BOOLEAN)||i.classList.contains(c.classNames.SELECTION)){var n=i.querySelector(".checkboxcontainer");if(n)return t.toggleCheckbox(n),!0}return!1}},{key:"_onEscapePress",value:function(e,t){var i=t.findElementForEvent(e,c.classNames.EDIT_MODE);if(i&&i.getAttribute("field"))if(t._getEditorModel&&i.getAttribute("field")===t._getEditorModel().constants.ADDITIONAL_DISCOUNT_FIELD){var n=i.querySelector("sb-discount");n&&n.resetToOriginal()}else t.setDiscardPendingEdit(!0);return!1}},{key:"applyFocus",value:function(e,t,i){var n=i.getTableComponent(t);n&&n.applyCellFocus(e)}},{key:"updateTemplate",value:function(){}},{key:"_updateEditableField",value:function(){}}]),r=e)),t("DesktopDelegate",r)}}}),System.register("quotes/layout/sf-le-table-row/DeviceDelegate.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("DeviceDelegate",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"initListeners",value:function(e){}},{key:"onTap",value:function(e,t){}},{key:"expansionChanged",value:function(e,t,i){}},{key:"toggleInlineEdit",value:function(e,t,i,n,o,r){}},{key:"onKeyDown",value:function(e,t){}},{key:"applyFocus",value:function(e,t,i){}}]),i=e)),t("DeviceDelegate",i)}}}),System.register("quotes/layout/sf-le-table-row/EditabilityControllingField.js",["quotes/layout/sf-le-table-row/ControllingField.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.ControllingField}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("EditabilityControllingField",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),o(e,[{key:"updateControlledFields",value:function(n,i){var o=this,r=!1;this._getEditableFieldValues().includes(i)?(this._getControlledFields().forEach(function(e){if(n.lineModel.isFieldRendered(e)&&n.lineModel.isEditable(e)){var t=n.querySelector("div[field='"+e+"']");if(t){var i=t.classList;i.contains("editable")||(r=!0,i.add("editable"))}}}),r&&n._handleEditableCellsHover(!0)):(this._getControlledFields().forEach(function(e){if(n.lineModel.isFieldRendered(e)){var t=n.querySelector("div[field='"+e+"']");t&&t.classList.remove("editable"),o._shouldClearFieldValue()&&n._clearFieldValue(e)}}),r=!0),this._getControlledFields().forEach(function(e){var t=o._getControlledFieldValue(e,i,r);void 0!==t&&n._updateFieldValue(e,t)})}},{key:"_getControlledFields",value:function(){return[]}},{key:"_getEditableFieldValues",value:function(){return[]}},{key:"_getControlledFieldValue",value:function(e,t,i){}},{key:"_shouldClearFieldValue",value:function(){return!0}}]),r=e)),t("EditabilityControllingField",r)}}}),System.register("quotes/layout/sf-le-table-row/MobileDelegate.js",["quotes/layout/sf-le-table-row/DeviceDelegate.js","quotes/layout/template-generator/TemplateGenerator.js"],function(t,e){var i,a,o,r;return{setters:[function(e){i=e.DeviceDelegate},function(e){a=e.TemplateGenerator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("MobileDelegate",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),o(e,[{key:"initListeners",value:function(e){e.listeners["row-swiped"]="onRowSwiped"}},{key:"onTap",value:function(e,t){if(e&&!t.expansionDisabled&&t.findElementForEvent(e,"primary")){var i=t.toggleExpanded(),n=t.querySelector("sb-swipe-container");null!==n&&(n.groupExpanded=i)}}},{key:"onRowSwiped",value:function(e,t){e&&e.detail&&(t.expansionDisabled=e.detail.isOpen)}},{key:"expansionChanged",value:function(e,t,i){if(!i.expansionDisabled){var n=i.$$(".container.first");if(n){var o=i.$$(".secondary");o||(this._loadSecondaryFields(i),o=i.$$(".secondary")),n.classList.toggle(a.classNames.EXPANDED,e),o.classList.toggle(a.classNames.EXPANDED,e)}}}},{key:"updateTemplate",value:function(t){t.secondaryTemplateInstance&&Object.keys(t.uiData).forEach(function(e){t.secondaryTemplateInstance[e]=t.uiData[e]})}},{key:"_loadSecondaryFields",value:function(i){i.secondaryTemplateInstance=i.hydrateTemplateFromNode(i.secondaryRowTemplate.cloneNode(!0),i.uiData),Polymer.dom(i.$.content).appendChild(i.secondaryTemplateInstance.root),Array.from(i.$$(".secondary").children).forEach(function(e){if(e.classList.contains(a.classNames.EDITABLE)&&!e.classList.contains(a.classNames.BOOLEAN)){var t=e.querySelector(".r");t&&i.toggleClass("hidden",!0,t),i.toggleInlineEdit(e,!0)}})}},{key:"toggleInlineEdit",value:function(e,t,i,n,o,r){var s=e.querySelector(".w");o.toggleCellClass(a.classNames.EDIT_MODE,t,e,i),t?s||o._createWritableElement(i,e):s&&o.commitPendingEdit(r)}},{key:"_updateEditableField",value:function(e,t,i,n,o){if(t._formatNewValue(i,n),o.firstChild)try{o.removeChild(o.firstChild),t._createEditField(o,e.getAttribute("index"),i)}catch(e){if(!(e instanceof DOMException&&"NotFoundError"===e.name))throw e}}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}]),r=e)),t("MobileDelegate",r)}}}),System.register("quotes/layout/sf-le-table-row/NonDiscountableControllingField.js",["quotes/QuoteContext.js","quotes/layout/sf-le-table-row/EditabilityControllingField.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.QuoteContext},function(e){o=e.EditabilityControllingField}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("NonDiscountableControllingField",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,o),r(e,[{key:"getFieldName",value:function(){return i.constants.NON_DISCOUNTABLE_FIELD}},{key:"_getControlledFields",value:function(){return[i.constants.ADDITIONAL_DISCOUNT_FIELD,i.constants.ADDITIONAL_DISCOUNT_RATE_FIELD,i.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD]}},{key:"_getEditableFieldValues",value:function(){return[!1]}}]),s=e)),t("NonDiscountableControllingField",s)}}}),System.register("quotes/layout/sf-le-table-row/PriceEditableControllingField.js",["quotes/QuoteContext.js","quotes/layout/sf-le-table-row/EditabilityControllingField.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.QuoteContext},function(e){o=e.EditabilityControllingField}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("PriceEditableControllingField",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,o),r(e,[{key:"getFieldName",value:function(){return i.constants.PRICE_EDITABLE_FIELD}},{key:"_getControlledFields",value:function(){return[i.constants.LIST_PRICE_FIELD]}},{key:"_getEditableFieldValues",value:function(){return[!0]}},{key:"_shouldClearFieldValue",value:function(){return!1}}]),s=e)),t("PriceEditableControllingField",s)}}}),System.register("quotes/layout/sf-le-table-row/PricingMethodControllingField.js",["quotes/QuoteContext.js","quotes/layout/sf-le-table-row/EditabilityControllingField.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.QuoteContext},function(e){o=e.EditabilityControllingField}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("PricingMethodControllingField",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,o),r(e,[{key:"getFieldName",value:function(){return i.constants.PRICING_METHOD_FIELD}},{key:"_getControlledFields",value:function(){return[i.constants.MARKUP_FIELD,i.constants.MARKUP_AMOUNT_FIELD,i.constants.MARKUP_RATE_FIELD]}},{key:"_getEditableFieldValues",value:function(){return["Cost"]}}]),s=e)),t("PricingMethodControllingField",s)}}}),System.register("quotes/layout/sf-le-table-row/PricingMethodEditableControllingField.js",["quotes/QuoteContext.js","quotes/layout/sf-le-table-row/EditabilityControllingField.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.QuoteContext},function(e){o=e.EditabilityControllingField}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("PricingMethodEditableControllingField",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,o),r(e,[{key:"getFieldName",value:function(){return i.constants.PRICING_METHOD_EDITABLE_FIELD}},{key:"_getControlledFields",value:function(){return[i.constants.PRICING_METHOD_FIELD]}},{key:"_getEditableFieldValues",value:function(){return[!0]}},{key:"_shouldClearFieldValue",value:function(){return!1}}]),s=e)),t("PricingMethodEditableControllingField",s)}}}),System.register("quotes/layout/sf-le-table-row/QLEDesktopDelegate.js",["quotes/layout/sf-le-table-row/DesktopDelegate.js","quotes/layout/template-generator/TemplateGenerator.js"],function(t,e){var i,r,o,s;return{setters:[function(e){i=e.DesktopDelegate},function(e){r=e.TemplateGenerator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("QLEDesktopDelegate",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),o(e,[{key:"initListeners",value:function(e){e.listeners.mouseover="onHovered",e.listeners.mouseout="onUnhovered",e.listeners["rte-esc"]="onRteCancel"}},{key:"expansionChanged",value:function(e,t,i){if(i.isSegmented){var n=i.$$(".segmentedContainer");n&&(n.classList.toggle(r.classNames.DOWN_ICON,e),n.classList.toggle(r.classNames.RIGHT_ICON,!e),i.uiData&&i.uiData._cellClasses&&(i.uiData._cellClasses._expansionIcon=e?r.classNames.DOWN_ICON:r.classNames.RIGHT_ICON))}else{var o=i.$$(".drawerContainer span");o&&(o.classList.toggle(r.classNames.CHEVRON_DOWN_ICON,e),o.classList.toggle(r.classNames.CHEVRON_RIGHT_ICON,!e))}}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}]),s=e)),t("QLEDesktopDelegate",s)}}}),System.register("quotes/layout/sf-le-table-row/SFLETableRow.js",["common/formatter/Formatter.js","quotes/sf-component-factory/SFComponentFactory.js","quotes/models/LineModel.js","quotes/tables/SFAbstractTable.js","common/behaviors/SFTableRowBehavior.js","common/behaviors/SFInlineEditBehavior.js","common/behaviors/TemplatizationBehavior.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/models/UiNotifier.js","common/forms/DependentPicklistBuilder.js","common/core/AppContext.js","common/behaviors/DeviceBehavior.js","quotes/layout/sf-le-table-row/QLEDesktopDelegate.js","quotes/layout/sf-le-table-row/MobileDelegate.js","quotes/QuoteContext.js","quotes/layout/sf-le-table-row/PricingMethodControllingField.js","quotes/layout/sf-le-table-row/NonDiscountableControllingField.js","quotes/layout/sf-le-table-row/PricingMethodEditableControllingField.js","quotes/layout/sf-le-table-row/PriceEditableControllingField.js","quotes/layout/sf-le-table-row/SubscriptionTypeControllingField.js","quotes/layout/sb-le-table-cell/DiscountConverter.js","quotes/models/ClientCache.js"],function(t,e){var l,i,u,o,r,s,a,d,c,h,f,p,v,g,y,m,b,_,C,S,k,O;return{setters:[function(e){l=e.Formatter},function(e){i=e.SFComponentFactory},function(e){u=e.LineModel},function(e){o=e.SFAbstractTable},function(e){e.SFTableRowBehavior},function(e){e.SFInlineEditBehavior},function(e){r=e.TemplatizationBehavior},function(e){s=e.TemplateGenerator},function(e){a=e.registerComponent},function(e){d=e.DependentPicklistBuilder},function(e){c=e.AppContext},function(e){h=e.DeviceBehavior},function(e){f=e.QLEDesktopDelegate},function(e){p=e.MobileDelegate},function(e){v=e.QuoteContext},function(e){g=e.PricingMethodControllingField},function(e){y=e.NonDiscountableControllingField},function(e){m=e.PricingMethodEditableControllingField},function(e){b=e.PriceEditableControllingField},function(e){_=e.SubscriptionTypeControllingField},function(e){C=e.getUnitAndDisplayValue},function(e){S=e.get,k=e.put}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFLETableRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-le-table-row",this.properties=Polymer.Base.extend({lineModel:{type:Object,notify:!0,observer:"_modelChanged"},isSegmented:{type:Boolean,value:!1},columnWidths:{type:Object,observer:"_columnsResized"},secondaryRowTemplate:{type:Object,observer:"_secondaryRowTemplateChanged"},isDirty:Boolean,dataIndex:{type:Number,reflectToAttribute:!0},expansionDisabled:{type:Boolean,value:!1}},r.properties),this.listeners={tap:"onTap",change:"onChange","selected-date-changed":"onChange","rte-value-changed":"onChange","lookup-value-changed":"onChange"},this.observers=["_recordChanged(lineModel.lineVO.record.*)","_expansionChanged(lineModel.lineVO.expanded)","_selectionChanged(lineModel.selected)","_bundleExpansionChanged(lineModel.bundleCollapsed)"]}},{key:"created",value:function(){this._deviceDelegate=c.isMobile?p.getInstance():f.getInstance(),this._deviceDelegate.initListeners(this)}},{key:"ready",value:function(){this.shadyRoot&&this.scopeSubtree(this.$.content,!0),this.deviceClasses="";var e=(new h).getDeviceClasses(),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.deviceClasses+=s+" "}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"getContentNode",value:function(){return Polymer.dom(this.$.content)}},{key:"getControllingFields",value:function(){return[new g,new y,new m,new b,new _]}},{key:"postPopulateContent",value:function(){this._deviceDelegate.updateTemplate(this),this._resetPencilLoaded(),this._refreshDirtyIndicators(),this.uiData.hasLineWarning&&this._loadLineWarning()}},{key:"_loadLineWarning",value:function(){var e=this.querySelector("#itemNumber .warning");if(e&&!e.hasChildNodes()){var t=document.createElement("sf-line-warning");t.key=this.uiData.lineWarningKey,t.message=this.uiData.lineWarningMsg,e.appendChild(t)}}},{key:"_recordChanged",value:function(e,t){if(this.templateInstance){var i=e.path;if(i!==u.recordPath){var n=i.substring(u.recordPath.length+1),o=e.value,r=this._getFieldMetadata(n);if(r){var s=l.formatFieldData(this.lineModel,o,r,this._getRecord());this._restampField(n,s),this._handleChangeControllingField(r.name,e.value);var a=this.querySelector('div.td[field="'+n+'"] div.w');a&&this._deviceDelegate._updateEditableField(a.parentElement,this,n,r,a)}}else this.templateInstance.lineModel=this.lineModel}}},{key:"onRteCancel",value:function(e){var t=o.findCell(e);this.toggleInlineEdit(t,!1),t.removeChild(t.querySelector(".w")),this._applyFocus(t,e)}},{key:"_updateDependentPicklist",value:function(o){var r=this,e=this._getEditorModel().getDependentFields(o);e&&0<e.length&&e.forEach(function(e){var t=r._getFieldValue(e);if(null!==t){var i=r._getFieldMetadata(e),n=new d(i,r._getFieldValue(o)).build();("multipicklist"===i.type?t.split(";"):[t]).some(function(t){return!n.some(function(e){return e.value===t})&&(r._clearFieldValue(e),r._updateDependentPicklist(e),!0)})}})}},{key:"_handleChangeControllingField",value:function(t,i){var n=this;this.getControllingFields().forEach(function(e){e.getFieldName()==t&&e.updateControlledFields(n,i)})}},{key:"_formatNewValue",value:function(e,t){var i=this._getFieldValue(e),n=void 0;e===v.constants.QUANTITY_FIELD&&t.scale!==this.lineModel.lineVO.productQuantityScale&&null!=this.lineModel.lineVO.productQuantityScale&&((n=JSON.parse(JSON.stringify(t))).scale=this.lineModel.lineVO.productQuantityScale);var o=n||t,r=l.formatFieldData(this.lineModel,i,o,this._getRecord());return this._restampField(e,r),i}},{key:"hook_onHovered",value:function(e){this.isSegmented&&this._handleSegmentedCellHover(e),this._handleEditableCellsHover()}},{key:"hook_onTap",value:function(e,t,i){var n=this._getEditorModel();this._deviceDelegate.onTap(e,this);var o=this.findElementForEvent(e,"checkboxcontainer");o&&this.toggleCheckbox(o),t||(n.hasDrawerFields()&&this.findElementForEvent(e,"drawerContainer")&&this.toggleDrawer(),this.lineModel.segments&&this.findElementForEvent(e,"segmentedContainer")&&this.toggleDrawer(),c.isBundleCollapsible(this._getEditorModel())&&this.findElementForEvent(e,"collapsible-bundle")&&this.toggleBundleExpansion())}},{key:"onKeyDown",value:function(e){this._deviceDelegate.onKeyDown(e,this)}},{key:"onRowSwiped",value:function(e){this._deviceDelegate.onRowSwiped(e,this)}},{key:"toggleCheckbox",value:function(e){if(e&&e.parentElement){var t=e.parentElement.parentElement,i=e.querySelector("input[type=checkbox]");if(t&&i)if(t.classList.contains(s.classNames.EDITABLE)){var n=t.getAttribute("field");n&&(this.set("lineModel.lineVO.record."+n,!i.checked),this._calculateImmediately(n)&&this.fire("calculate-immediately"))}else e.parentElement.classList.contains(s.classNames.SELECTION)&&this._getEditorModel().data.settings.multiLineDeleteEnabled&&(this.set("lineModel.selected",!i.checked),i.checked?this.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key]=this.lineModel:delete this.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key])}}},{key:"toggleDrawer",value:function(){this.toggleExpanded(),this._getEditorModel().largeQuoteExperienceEnabled&&this.fire("line-toggled",{index:this._getLineNumber()-1})}},{key:"toggleExpanded",value:function(){var e=!this.lineModel.lineVO.expanded;return this.set("lineModel.lineVO.expanded",e),e}},{key:"_expansionChanged",value:function(e,t){this._deviceDelegate.expansionChanged(e,t,this)}},{key:"toggleBundleExpansion",value:function(){var e=!this.lineModel.bundleCollapsed;this.set("lineModel.bundleCollapsed",e)}},{key:"_bundleExpansionChanged",value:function(e){var t=this;if(void 0!==e){var i="l"+this.lineModel.lineVO.key;S("BundleCollapsed",[i])!==e&&(this._restampField("_caretContent",e?s.classNames.CHEVRON_RIGHT_CONTENT:s.classNames.CHEVRON_DOWN_CONTENT),setTimeout(function(){t.fire("bundle-toggled",{key:t.lineModel.lineVO.key,expanded:!e})}),k("BundleCollapsed",["l"+this.lineModel.lineVO.key],e))}}},{key:"_selectionChanged",value:function(){this._getEditorModel().isMultiLineDeleteEnabled()&&this._applySelectionCheckboxStatus()}},{key:"_applySelectionCheckboxStatus",value:function(){var e=this.$$(".checkboxcontainer");e&&!e.classList.contains(s.classNames.DISABLED)&&(e.querySelector("input[type=checkbox]").checked=this.lineModel.selected)}},{key:"_getFieldMetadata",value:function(e,t){return this._getEditorModel().getFieldMetadata(e,t)}},{key:"_getEditorModel",value:function(){return this.lineModel.editorModel}},{key:"_getLineNumber",value:function(){return this.uiData.lineNumber}},{key:"_getRecord",value:function(){return this.uiData.lineModel.lineVO.record}},{key:"_getOriginalRecord",value:function(){return this.uiData.lineModel.lineVO.ui_original_record}},{key:"_isEditable",value:function(e){return this.uiData.lineModel.isEditable(e)}},{key:"_getFieldValue",value:function(e){return this._getRecord()[e]}},{key:"_clearFieldValue",value:function(e){this.set("lineModel.lineVO.record."+e,null),this.templateInstance&&this._restampField(e,null)}},{key:"_updateFieldValue",value:function(e,t){this.set("lineModel.lineVO.record."+e,t)}},{key:"_modelChanged",value:function(){a(this,"lineModel"),this.unlisten(this,"track","onTrack"),this._isDragAndDropEnabled()&&this.listen(this,"track","onTrack")}},{key:"_isDragAndDropEnabled",value:function(){return c.isDesktop&&!this.lineModel.editorModel.largeQuoteExperienceEnabled}},{key:"_handleSegmentedCellHover",value:function(e){var t=this.findElementForEvent(e,"container");if(t){var i=t.getAttribute("field");if(i&&!i.endsWith("__c")&&"total"!==i&&!t.querySelector("paper-tooltip")){var n=document.createElement("paper-tooltip");n.position="bottom",n.animationDelay=0,t.appendChild(n);var o=document.createElement("sf-segmented-cell-tooltip");o.lineModel=this.lineModel,o.field=i,Polymer.dom(n).appendChild(o)}}}},{key:"_handleEditableCellsHover",value:function(e){var t=this;if(!this._pencilLoaded||e){var i=this.querySelectorAll(".container.editable");if(i&&0<i.length){var n=Array.from(i);n.forEach(function(e){if(!e.querySelector("span.pencil")){var t=document.createElement("span");if(t.classList.add(s.classNames.EDIT_ICON),e.classList.contains(s.classNames.RIGHT)||e.classList.contains(s.classNames.CENTER)){var i=e.querySelector("div.r");i.insertBefore(t,i.firstChild)}else e.querySelector("div.r").appendChild(t)}}),setTimeout(function(){t.fire("line-toggled",{index:t.dataIndex})})}this._pencilLoaded=!0}}},{key:"_isAdditionalDiscountUpdated",value:function(t,e){var i={editorModel:this._getEditorModel(),constants:this.uiData.lineModel.constants,lineVO:this.uiData.lineModel.lineVO,getField:function(e){return t[e]},getLineVOProperty:function(e){return t[e]}},n=C(i,e),o=C(this.uiData.lineModel,e);return n.displayValue!==o.displayValue||n.unit!==o.unit}},{key:"_columnsResized",value:function(i,e){var n=this;null!=i&&null!=e&&Object.keys(i).forEach(function(e){var t=n.$$("div.container[field='"+e+"']");t&&(t.style.minWidth=i[e]+"px",t.style.maxWidth=i[e]+"px")})}},{key:"onTrack",value:function(e){if(e){if(this.querySelector("div.w"))return;for(var t=Polymer.dom(e).path,i=0,n=t.length;i<n;i++){var o=t[i].nodeName;if("SB-DIALOG"===o||"TEXTAREA"===o)return}this.domHost.onTrack(e)}}},{key:"deepCloneNode",value:function(){var e=this.cloneNode(!0),t=this.$$("#content div:first-child").cloneNode(!0);return e.querySelector("#content").appendChild(t),e}},{key:"_applyFocus",value:function(e,t){this._deviceDelegate.applyFocus(e,t,this)}},{key:"_calculateImmediately",value:function(e){return v.shouldCalulateImmediately(e,c.org.calculateImmediately,this.lineModel.quoteModel)}},{key:"toggleCellClass",value:function(e,t,i,n){if(this.toggleClass(e,t,i),this.lineModel){var o=this.lineModel.cellClasses[n]||{};o[e]=t,this.lineModel.cellClasses[n]=o}}},{key:"_getFieldMetadataForInlineEdit",value:function(e){return this._getFieldMetadata(e,this.lineModel.quoteModel.quoteVO.record)}},{key:"toggleInlineEditForDeviceDelegate",value:function(e,t,i,n,o){this._deviceDelegate.toggleInlineEdit(e,t,i,n,this,o)}},{key:"fireCalculateImmediately",value:function(e){this._calculateImmediately(e)&&this.fire("calculate-immediately")}},{key:"checkIsDirty",value:function(e,t,i){return v.isDiscountField(i)?this._isAdditionalDiscountUpdated(t,i):e!==t[i]}},{key:"handleControllingPicklistAndFields",value:function(e,t,i,n){e.controllingPicklist?this._updateDependentPicklist(t):e.relationshipName&&"lookup-value-changed"===i?this._getRecord()[e.relationshipName]=null==n.value?void 0:{Id:n.value,Name:n.refDisplay}:this._handleChangeControllingField(e.name,n.value)}},{key:"_getEditField",value:function(e,t){return i.getFieldComponent(e,this.lineModel,t)}},{key:"getCellClass",value:function(){return"sf-le-table-cell"}},{key:"_secondaryRowTemplateChanged",value:function(){c.isMobile&&this._deviceDelegate&&this.lineModel&&this.lineModel.lineVO&&this.lineModel.lineVO.expanded&&this._deviceDelegate.expansionChanged(!0,!1,this)}},{key:"behaviors",get:function(){return[Polymer.Templatizer,window.CommonBehaviors.SFTableRowBehavior,window.CommonBehaviors.TemplatizationBehavior,window.CommonBehaviors.SFInlineEditBehavior]}}]),O=e)),t("SFLETableRow",O),Polymer(O)}}}),System.register("quotes/layout/sf-le-table-row/SubscriptionTypeControllingField.js",["quotes/QuoteContext.js","quotes/layout/sf-le-table-row/EditabilityControllingField.js"],function(t,e){var o,i,r,s;return{setters:[function(e){o=e.QuoteContext},function(e){i=e.EditabilityControllingField}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("SubscriptionTypeControllingField",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),r(e,[{key:"getFieldName",value:function(){return o.constants.SUBSCRIPTION_TYPE_FIELD}},{key:"_getControlledFields",value:function(){return[o.constants.SUBSCRIPTION_TERM_FIELD,o.constants.END_DATE_FIELD,o.constants.EFFECTIVE_END_DATE_FIELD]}},{key:"_getEditableFieldValues",value:function(){return["","Renewable","One-time"]}},{key:"_getControlledFieldValue",value:function(e,t,i){if(e===o.constants.SUBSCRIPTION_TERM_FIELD){if("Evergreen"===t)return 1;if(i)return null}}},{key:"_shouldClearFieldValue",value:function(){return!0}}]),s=e)),t("SubscriptionTypeControllingField",s)}}}),System.register("quotes/layout/sf-line-actions/SFLineActions.js",["quotes/models/LineModel.js","common/core/AppContext.js","common/core/Events.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.LineModel},function(e){o=e.AppContext},function(e){r=e.Events,s=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFLineActions",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-line-actions",this.properties={lineModel:{Object:Object,observer:"_modelChanged"},actions:Array,showInfoIcon:{type:Boolean,computed:"_isShowInfoIcon(lineModel)"}}}},{key:"ready",value:function(){this.toggleClass("mobile",o.isMobile)}},{key:"attached",value:function(){var t=this;this._actionHandler=this.handleAction.bind(this),this.addEventListener("tap",this._actionHandler,{passive:!0}),Polymer.RenderStatus.afterNextRender(this,function(){var e=t.querySelector("button.showDSModal");e&&(e.addEventListener("mouseenter",t._actionHandler,{passive:!0}),e.addEventListener("mouseleave",t._actionHandler,{passive:!0}))})}},{key:"detached",value:function(){if(this._actionHandler){this.removeEventListener("tap",this._actionHandler);var e=this.querySelector("button.showDSModal");e&&(e.removeEventListener("mouseenter",this._actionHandler),e.removeEventListener("mouseleave",this._actionHandler))}}},{key:"_modelChanged",value:function(){var t=this;this.lineModel&&this.lineModel instanceof i&&(this.actions=this.lineModel.editorModel.lineCustomActions.filter(function(e){return!e.isHidden(t.lineModel)}))}},{key:"handleAction",value:function(e){var t=this,i=e.target.name;if(i){var n=this.actions.find(function(e){return e.name===i});if(n)if("showDSModal"===n.eventHandlerName)s(r.SCHEDULE_ACTION,{event:e,model:this.lineModel});else if("tap"===e.type){var o=function(){t.fire("le-action-tapped",{customAction:n,model:t.lineModel})};"onCloneLine"===n.eventHandlerName?(this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){o()},100)):o()}}}},{key:"_isShowInfoIcon",value:function(e){return!o.isMobile&&e&&e.hasParent}},{key:"behaviors",get:function(){return[window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[r.REFRESH_LINE_ACTIONS]=this._modelChanged,e}}]),a=e)),t("SFLineActions",a),Polymer(a)}}}),System.register("quotes/layout/sf-line-warning/SFLineWarning.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFLineWarning",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-line-warning",this.properties={key:String,message:String}}}]),i=e)),t("SFLineWarning",i),Polymer(i)}}}),System.register("quotes/layout/sf-preview-panel/PreviewPanel.js",["common/behaviors/TemplatizationBehavior.js","quotes/layout/template-generator/ListItemTemplateGenerator.js","common/formatter/Formatter.js"],function(t,e){var i,r,s,o;return{setters:[function(e){i=e.TemplatizationBehavior},function(e){r=e.ListItemTemplateGenerator},function(e){s=e.Formatter}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("PreviewPanel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-preview-panel",this.properties=Polymer.Base.extend({iconClass:String,title:String,data:{type:Array,observer:"_dataChanged"},metadata:{type:Object,observer:"_dataChanged"},templateOptions:Object,additionalUIData:Object},i.properties)}},{key:"ready",value:function(){this.shadyRoot&&this.scopeSubtree(this.querySelector(".dataList"),!0)}},{key:"_dataChanged",value:function(){var o=this;if(this.data&&this.metadata){var e=Object.keys(this.metadata),t=Object.keys(this.metadata).reduce(function(e,t){return e[t]=o.metadata[t].label,e},{});this.templateHTML=new r(this.metadata,this.templateOptions).generate(e,t);var i=Object.keys(this.metadata).reduce(function(e,t){var i=o.data.find(function(e){return e.field===t}),n=i?i.value:"";return e[t]=s.formatFieldData(null,n,o.metadata[t],o.data),e},{});this.additionalUIData&&(i=Object.assign(i,this.additionalUIData)),this.uiData=i}}},{key:"getContentNode",value:function(){return this.querySelector(".dataList")}},{key:"isTemplatizeWithRootDivNode",value:function(){return!1}},{key:"behaviors",get:function(){return[Polymer.Templatizer,window.CommonBehaviors.TemplatizationBehavior]}}]),o=e)),t("PreviewPanel",o),Polymer(o)}}}),System.register("quotes/layout/sf-segmented-cell-tooltip/SFSegmentedCellTooltip.js",["quotes/ui-data-manager/UIDataManager.js","common/behaviors/SFTableRowBehavior.js","common/behaviors/TemplatizationBehavior.js","quotes/layout/template-generator/TemplateGenerator.js"],function(t,e){var o,a,i;return{setters:[function(e){o=e.UIDataManager},function(e){e.SFTableRowBehavior},function(e){e.TemplatizationBehavior},function(e){a=e.TemplateGenerator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFSegmentedCellTooltip",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-segmented-cell-tooltip",this.properties={lineModel:Object,field:String},this.observers=["_initObserver(lineModel, field)"]}},{key:"ready",value:function(){this.shadyRoot&&this.scopeSubtree(this.$.content,!0)}},{key:"_initObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._init(e,t)}},{key:"_init",value:function(){if(this.lineModel&&this.field){var e=this._getSegmentedLine(),t=this.lineModel.editorModel,i=t.data.multiSegmentLineFieldNames,n=t.md.fieldsMap[t.data.quoteLineObjectName],o=t.md.fieldLabelsMap,r=this._prepareLineData(e,i,n),s=(new a).generateSegmentedTooltipFieldSetTemplate(i,o,t);this.templateInstance=this.hydrateTemplate(s,r),Polymer.dom(this.$.content).appendChild(this.templateInstance.root)}}},{key:"_prepareLineData",value:function(e,t,i){return o.prepareLineData([e],t,i)[0]}},{key:"_getSegmentedLine",value:function(){var t=this,e=this.lineModel;if(this.lineModel&&null!=this.lineModel.segmentsByLabel){var i=Object.keys(this.lineModel.segmentsByLabel).find(function(e){return/^\d/.test(e)&&(e="_"+e),t.field===e.replace(/\W/g,"")});i&&(e=this.lineModel.segmentsByLabel[i])}return e}},{key:"behaviors",get:function(){return[Polymer.Templatizer,window.CommonBehaviors.SFTableRowBehavior,window.CommonBehaviors.TemplatizationBehavior]}}]),i=e)),t("SFSegmentedCellTooltip",i),Polymer(i)}}}),System.register("quotes/layout/sf-table-header/SFTableHeader.js",["common/behaviors/TemplatizationBehavior.js","quotes/tables/SFTableHeaderBehavior.js","quotes/layout/template-generator/TableHeaderTemplateGenerator.js","common/Util.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.TemplatizationBehavior},function(e){o=e.SFTableHeaderBehavior},function(e){r=e.TableHeaderTemplateGenerator},function(e){s=e.pathGet}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFTableHeader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-table-header",this.properties=Polymer.Base.extend({fieldLabels:Object,fields:Object,options:{type:Object,value:{}}},i.properties),this.properties=Polymer.Base.extend(this.properties,o.properties),this.listeners={tap:"onTap",mouseover:"onHover"},this.observers=["_initObserver(fields, fieldLabels, options)"]}},{key:"ready",value:function(){this.shadyRoot&&this.scopeSubtree(this.$.content,!0)}},{key:"_initObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this._init(e,t,i)}},{key:"_init",value:function(e,t){this.templateHTML=new r(this.options).generate(e),this.uiData=t}},{key:"getContentNode",value:function(){return Polymer.dom(this.$.content)}},{key:"isTemplatizeWithRootDivNode",value:function(){return!1}},{key:"getTooltipContent",value:function(e){return s(this.uiData,e.split("."))||""}},{key:"behaviors",get:function(){return[Polymer.Templatizer,window.CommonBehaviors.TemplatizationBehavior,window.CommonBehaviors.SFTableHeaderBehavior]}}]),a=e)),t("SFTableHeader",a),Polymer(a)}}}),System.register("quotes/layout/template-generator/LETableHeaderTemplateGenerator.js",["quotes/layout/template-generator/TableHeaderTemplateGenerator.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/QuoteContext.js","common/core/AppContext.js"],function(e,t){var i,o,r,a,l,u,d;return{setters:[function(e){i=e.TableHeaderTemplateGenerator},function(e){o=e.TemplateGenerator},function(e){r=e.QuoteContext},function(e){a=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var o={hasSelectionColumn:e.isMultiLineDeleteEnabled(),hasItemNumberColumn:!0,columnWidths:t,allowColumnResizing:n},r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,o));return r.editorModel=e,r.segmentedColumns=i,r.isSegmented=!!i,r}l=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},u=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(n):void 0},e("LETableHeaderTemplateGenerator",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,i),l(s,[{key:"getLeadingColumns",value:function(){return this.editorModel.actionsOnTheLeft?'<div class="th lineActions"></div>':""}},{key:"getTrailingColumns",value:function(){var e=this.editorModel.actionsOnTheLeft?"":'<div class="th lineActions"></div>';return!this.isSegmented&&this.editorModel.hasDrawerFields()&&(e+=this._getDrawerColumnTemplate()),e}},{key:"generateItemNumberColumn",value:function(){return this.isSegmented?'<div class="th itemNumber segmentedDrawer"><span>#</span><span class="'+o.classNames.RIGHT_ICON+'"></span></div>':u(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"generateItemNumberColumn",this).call(this)}},{key:"_getDrawerColumnTemplate",value:function(){return'<div class="th drawerIcon"><span class="'+o.classNames.CHEVRON_RIGHT_ICON+'"></span></div>'}},{key:"getColumnAlignment",value:function(e){var t=this.editorModel.getFieldMetadata(e),i=[];return this.isSegmented&&(i=this.buildRowSegmentFieldSet(this.segmentedColumns)),t&&("number"===t.type||"double"===t.type||"percent"===t.type||"currency"===t.type)||0<=i.indexOf(e)?"rightAligned":t&&"boolean"===t.type?"centerAligned":"leftAligned"}},{key:"isSortable",value:function(e){return e!==this.editorModel.constants.ADDITIONAL_DISCOUNT_FIELD}},{key:"getBeforeFieldTemplate",value:function(e){return r.isProductNameField(e)&&a.isBundleCollapsible(this.editorModel)&&!this.isSegmented?'<span class="bundle-caret" inner-h-t-m-l="[[_caretContent]]"></span>':""}}]),d=s)),e("LETableHeaderTemplateGenerator",d)}}}),System.register("quotes/layout/template-generator/LETemplateGenerator.js",["quotes/layout/template-generator/TemplateGenerator.js","common/core/AppContext.js"],function(e,t){var s,o,i,d,r;return{setters:[function(e){s=e.TemplateGenerator},function(e){o=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return r.editorModel=e,r.groupModel=t,r.segmentedColumns=i,r.dimension=n,r.isSecondary=o,r}i=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},d=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(n):void 0},e("LETemplateGenerator",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,s),i(u,[{key:"generateRow",value:function(e){var t=void 0,i=!1;if(this.segmentedColumns){i=!0;var n=this.buildRowSegmentFieldSet(this.segmentedColumns);t=d(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"generateSegmentedFieldSetTemplate",this).call(this,e,n,this.dimension,this.groupModel,this.editorModel,this.isSecondary)}else t=d(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"generateFieldSetTemplate",this).call(this,e,this.groupModel,this.editorModel,this.isSecondary);var o=this.generateActionsTemplate(),r=this.generateItemNumberTemplate(i),s=this.generateCheckboxTemplate(""),a=this.generateDrawerCellTemplate(),l="";return l+=s+r+t,l=this.addLineActionsToTemplate(l,o),l+=a}},{key:"generateActionsTemplate",value:function(){return'<div id="swipe-menu" class="td sf-le-table-cell actionsContainer lineActions sf-le-table-row"><sf-line-actions class="'+(this.editorModel.actionsOnTheLeft?u.classNames.LEFT_ALIGNED:u.classNames.RIGHT_ALIGNED)+'" line-model="[[lineModel]]"></sf-line-actions></div>'}},{key:"generateItemNumberTemplate",value:function(e){return'<div tabindex="0" class="td sf-le-table-cell focusable sf-le-table-row" id="itemNumber"><span>[[lineNumber]]</span><span class="warning"></span>'+(e?'<span id="expandCollapseIcon" class$="{{computeCellClass(rowIndex, \'_expansionIcon\', _cellClasses)}} segmentedContainer" ></span>':"")+"</div>"}},{key:"generateDrawerCellTemplate",value:function(){return!this.segmentedColumns&&this.editorModel.hasDrawerFields()?'<div tabindex="0" class="td sf-le-table-cell focusable drawerContainer sf-le-table-row '+u.classNames.TAPPABLE+'"><span class="sf-icon-chevronright"></span></div>':""}},{key:"getColumnClass",value:function(e){var t=this.editorModel.getFieldMetadata(e),i=null==t&&this.segmentedColumns,n="",o=t?t.type:null,r=s.classNames;return"number"==o||"double"==o||"percent"==o||"currency"==o||i?n=r.RIGHT+" ":"boolean"==o&&(n=r.CENTER+" "+r.BOOLEAN+" "),n}},{key:"addLineActionsToTemplate",value:function(e,t){return this.editorModel.actionsOnTheLeft?t+e:e+t}},{key:"generateCheckboxTemplate",value:function(e){var t=s.classNames,i="";return(""!==e||this.editorModel.isMultiLineDeleteEnabled()&&""===e&&!this.isSecondary)&&(i=""!==e?d(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"generateCheckboxTemplate",this).call(this,e):'<div tabindex="0" class="td sf-le-table-cell focusable '+t.SELECTION+' sf-le-table-row"><div class$="checkboxcontainer sf-le-table-row {{computeCellClass(rowIndex, \'_selectionCB\', _cellClasses)}}">'+this.generateInnerCheckboxTemplate("lineModel.selected")+"</div></div>"),i}},{key:"generateProductCell",value:function(e){var t="";if(!this.segmentedColumns){var i="",n="";if(o.isBundleCollapsible(this.editorModel)&&(i="collapsible-bundle "+s.classNames.TAPPABLE+" sf-le-table-cell",n="button"),t+='<span tabindex="0" class$="bundle-caret '+i+" {{computeCellClass(rowIndex, '_isFocusable', _cellClasses)}} sf-le-table-row\" role=\""+n+'" aria-label="Product Name Bundle Caret" inner-h-t-m-l="[[_caretContent]]"></span> ',i)return t+' <span tabindex="0" class$="{{computeCellClass(rowIndex, \'_isFocusable\', _cellClasses)}} sf-le-table-cell sf-le-table-row">[['+e+"]]</span>"}return t+"[["+e+"]]"}}]),r=u)),e("LETemplateGenerator",r)}}}),System.register("quotes/layout/template-generator/ListItemTemplateGenerator.js",["quotes/layout/template-generator/TemplateGenerator.js"],function(e,t){var i,r,s;return{setters:[function(e){i=e.TemplateGenerator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return i.metadata=e,i.options=t||{},i}r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},e("ListItemTemplateGenerator",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,i),r(o,[{key:"generate",value:function(e,i){var n=this,o="";return e.forEach(function(e){var t=i[e]||"";o+='<li class="detail-block" role="listitem"><div class="truncate" title="'+t+'">'+t+"</div><div "+n._getAttributes(e)+">"+n.generateInnerFieldTemplate(e,n._getMetadata(e))+"</div></li>"}),o}},{key:"_getMetadata",value:function(e){return"function"==typeof this.metadata?this.metadata(e):this.metadata[e]}},{key:"_getAttributes",value:function(e){return(this.options.attributes||'class="truncate body"').replace("$field",e)}}]),s=o)),e("ListItemTemplateGenerator",s)}}}),System.register("quotes/layout/template-generator/MobileLETemplateGenerator.js",["quotes/layout/template-generator/LETemplateGenerator.js"],function(e,t){var i,o,s,a;return{setters:[function(e){i=e.LETemplateGenerator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},s=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(n):void 0},e("MobileLETemplateGenerator",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,i),o(r,[{key:"getPrimaryClass",value:function(e,t){return t?"":0===e?"primary first":"primary multi"}},{key:"generateInnerFieldSetTemplate",value:function(e,t,i,n){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;return n?s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"generateInnerFieldSetTemplate",this).call(this,e,t,i,n,o):"<div id='swipe-header'>"+s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"generateInnerFieldSetTemplate",this).call(this,e,t,i,n,o)+"</div>"}},{key:"generateRow",value:function(e){return this.isSecondary?s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"generateRow",this).call(this,e):'<sb-swipe-container variant="ui3qle">'+s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"generateRow",this).call(this,e)+"</sb-swipe-container>"}},{key:"addLineActionsToTemplate",value:function(e,t){return e+t}},{key:"generateActionsTemplate",value:function(){return this.isSecondary?"":s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"generateActionsTemplate",this).call(this)}},{key:"getFieldLabel",value:function(e,t){return t&&e?'<span class="field-label">'+e.label+"</span>":""}},{key:"getColWidths",value:function(e,t){return null}},{key:"generateItemNumberTemplate",value:function(e){return""}},{key:"generateDrawerCellTemplate",value:function(){return""}},{key:"generateProductCell",value:function(e){return"[["+e+"]]"}}]),a=r)),e("MobileLETemplateGenerator",a)}}}),System.register("quotes/layout/template-generator/TableHeaderTemplateGenerator.js",["quotes/layout/template-generator/TemplateGenerator.js","common/core/AppContext.js"],function(e,t){var o,r,s,a;return{setters:[function(e){o=e.TemplateGenerator},function(e){r=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t.options=e||{},t}s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},e("TableHeaderTemplateGenerator",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,o),s(i,[{key:"generateHeaderNode",value:function(e,t){this.isSegmented&&(e=e.concat(this.buildRowSegmentFieldSet(this.segmentedColumns)));var i=this.generate(e),n=document.createElement("div");return t&&Object.keys(t).forEach(function(e){n.setAttribute(e,t[e])}),n.innerHTML=i,n}},{key:"generate",value:function(e){var s=this,a=this.getLeadingColumns();a+=this.hasSelectionColumn()?this.generateSelectionColumn():"",a+=this.hasItemNumberColumn()?this.generateItemNumberColumn():"";var l=this.getColumnWidths(),u=this.getColumnWidthUnit();return e.forEach(function(e){var t=s.generateColAdjBar(),i=s.getColumnAlignment(e),n="",o="";s.isSortable(e)&&(n="sortable",o='<i class="arrow sf-icon-arrowup"></i>'),a+='<div field="'+e+'" class="th '+i+" arrow-on-hover "+n+'"',l&&l[e]&&(a+="px"===u?' style="min-width:'+l[e]+"px;max-width:"+l[e]+'px"':' style="width:'+l[e]+u+'"');var r=s.getBeforeFieldTemplate(e)||"";a+=">"+r+"[["+e+"]]"+o+t+"</div>"}),a+=this.getTrailingColumns(),a+=this.generateColumnIndicator()}},{key:"getBeforeFieldTemplate",value:function(e){return""}},{key:"isSortable",value:function(e){return"function"!=typeof this.options.isSortable||this.options.isSortable(e)}},{key:"getColumnAlignment",value:function(e){return""}},{key:"getLeadingColumns",value:function(){return""}},{key:"getTrailingColumns",value:function(){return""}},{key:"getColumnWidths",value:function(){return this.options.columnWidths||{}}},{key:"getColumnWidthUnit",value:function(){return this.options.columnWidthUnit||"px"}},{key:"hasSelectionColumn",value:function(){return!0===this.options.hasSelectionColumn}},{key:"hasItemNumberColumn",value:function(){return!0===this.options.hasItemNumberColumn}},{key:"generateSelectionColumn",value:function(){return'<div class="th selection"><div class="checkboxcontainer">'+this.generateInnerCheckboxTemplate(null)+"</div></div>"}},{key:"generateColumnIndicator",value:function(){return r.isColumnResizingEnabled&&!r.isMobile&&this.options.allowColumnResizing?'<div id="col-resize-indicator"><span id="col-adj-divider"></span></div>':""}},{key:"generateItemNumberColumn",value:function(){return'<div class="th itemNumber"><span>#</span></div>'}}]),a=i)),e("TableHeaderTemplateGenerator",a)}}}),System.register("quotes/layout/template-generator/TableRowTemplateGenerator.js",["quotes/layout/template-generator/TemplateGenerator.js"],function(e,t){var i,r,s;return{setters:[function(e){i=e.TemplateGenerator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return i.metadata=e,i.options=t||{},i}r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},e("TableRowTemplateGenerator",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,i),r(o,[{key:"generateRow",value:function(e){for(var t="",i=this.getColumnWidths(),n=this.getColumnWidthUnit(),o=0;o<e.length;o++)t+='<div tabindex="0" '+this.getAttributes(e[o]),i&&i[e[o]]&&(t+="px"===n?' style="min-width:'+i[e[o]]+"px;max-width:"+i[e[o]]+'px"':' style="width:'+i[e[o]]+n+'"'),t+=' index="'+o+'" field="'+e[o]+'" >',t+='<div class="r">',t+=this.generateInnerFieldTemplate(e[o],this.metadata[o]),t+="</div>",t+="</div>";return t}},{key:"getColumnWidths",value:function(){return this.options.columnWidths||{}}},{key:"getColumnWidthUnit",value:function(){return this.options.columnWidthUnit||"px"}},{key:"getAttributes",value:function(e){return(this.options.attributes||"").replace(/\$field/g,e)}}]),s=o)),e("TableRowTemplateGenerator",s)}}}),System.register("quotes/layout/template-generator/TemplateGenerator.js",["quotes/QuoteContext.js","common/core/AppContext.js","common/Util.js"],function(t,e){var c,h,i,o,r;return{setters:[function(e){c=e.QuoteContext},function(e){h=e.AppContext},function(e){i=e.toFieldName}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}o={CHEVRON_DOWN_ICON:"sf-icon-chevrondown",CHEVRON_RIGHT_ICON:"sf-icon-chevronright",CHEVRON_DOWN_CONTENT:"&#xe86b;",CHEVRON_RIGHT_CONTENT:"&#xe86a;",RIGHT_ICON:"sf-icon-right",DOWN_ICON:"sf-icon-down",OPTION:"option",RIGHT:"right",CENTER:"center",OVERRIDDEN:"overridden",TOP_LEVEL:"top-level",INDENT:"sbIndent",EDITABLE:"editable",DISABLED:"disabled",BOOLEAN:"boolean",HAS_FOCUS:"sf-has-focus",EDIT_ICON:"pencil",SECONDARY:"secondary",EXPANDED:"expanded",EDIT_MODE:"editMode",SELECTION:"selection",DIRTY:"dirty",HIDE_CHECKBOX:"hideCheckbox",TAPPABLE:"tappable",LEFT_ALIGNED:"left-aligned",RIGHT_ALIGNED:"right-aligned"},t("TemplateGenerator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"generateRowNode",value:function(e,t){var i=this.generateRow(e),n=document.createElement("div");return t&&Object.keys(t).forEach(function(e){n.setAttribute(e,t[e])}),n.innerHTML=i,n}},{key:"generateRow",value:function(e){throw new Error("generateRow() must be implemented!")}},{key:"generateFieldSetTemplate",value:function(e,t,i,n){var o=this.getColWidths(t);return this.generateInnerFieldSetTemplate(e,o,i,n)}},{key:"generateSegmentedTooltipFieldSetTemplate",value:function(e,i,n){var o=this,r="<table><tbody>";return e.filter(function(e){return i[e]&&n.md.fieldsMap[n.constants.QUOTE_LINE]&&n.md.fieldsMap[n.constants.QUOTE_LINE][e]}).forEach(function(e){r+="<tr><th>"+i[e]+"</th><td>";var t=n.getFieldMetadata(e);r+=o.generateInnerFieldTemplate(e,t),r+="</td></tr>"}),r+="</tbody></table>"}},{key:"generateSegmentedFieldSetTemplate",value:function(e,t,i,n,o,r){var s=this.getColWidths(n,i),a=this.generateInnerFieldSetTemplate(e,s,o,r);return h.isMobile||(a+=this.generateInnerFieldSetTemplate(t,s,o,r,e.length)),a}},{key:"generateInnerFieldSetTemplate",value:function(e,r,s,a){var l=this,t=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,u="",d=t;return e.forEach(function(e){var t=s.getFieldMetadata(e),i=l.getColumnClass(e),n=l.getPrimaryClass(d,a),o=c.isProductNameField(e)&&h.isBundleCollapsible(s)?"":"focusable";u+='<div tabindex="0" class$="container td sf-le-table-cell sf-le-table-row '+n+" "+o+" "+i+" {{computeCellClass(rowIndex, '"+e+"', _cellClasses)}}\"",r&&(u+='style="min-width:'+r[e]+"px;max-width:"+r[e]+'px"'),u+=' index="'+d+'" field="'+e+'" >',u+=l.getFieldLabel(t,a),u+='<div class="r">',c.isProductNameField(e)&&s.isProductHierarchyVisualized()?u+=l.generateProductCell(e):u+=l.generateInnerFieldTemplate(e,s.getFieldMetadata(e)),u+="</div>",u+="</div>",d++}),u}},{key:"generateProductCell",value:function(e){return""}},{key:"generateInnerFieldTemplate",value:function(e,t){var i=t?t.type:null;switch(t&&"richtextarea"===t.extraTypeInfo&&(i="richtextarea"),t&&t.calculatedFormula&&t.calculatedFormula.includes("IMAGE")&&(i="image"),t&&t.calculated&&t.htmlFormatted&&(i="formulaHtml"),i){case"boolean":return this.generateCheckboxTemplate(e);case"image":return'<div class="imgFormula" inner-h-t-m-l="[['+e+']]"></div>';case"richtextarea":case"formulaHtml":return'<div class="htmlField" inner-h-t-m-l="[['+e+']]"></div>';case"url":return'<a href="[['+e+']]" target="_blank">[['+e+"]]</a>";default:return"[["+e+"]]"}}},{key:"generateCheckboxTemplate",value:function(e){return'<div class="checkboxcontainer">'+this.generateInnerCheckboxTemplate(e)+"</div>"}},{key:"generateInnerCheckboxTemplate",value:function(e){return'<input type="checkbox" class="hidden" '+(e?'checked="[['+e+']]"':"")+'><div class="paper-checkbox"><div class="checkmark"></div></div>'}},{key:"generateColAdjBar",value:function(){return h.isColumnResizingEnabled&&!h.isMobile&&this.options.allowColumnResizing?'<span class="col-adj-bar"></span>':""}},{key:"getColumnClass",value:function(e){return""}},{key:"getPrimaryClass",value:function(e,t){return""}},{key:"getFieldLabel",value:function(e,t){return""}},{key:"getColWidths",value:function(e,t){return t?e.getDimensionColWidths(t):e.colWidth.Standard}},{key:"buildRowSegmentFieldSet",value:function(e){var t=e.map(i);return t.push("total"),t}}],[{key:"classNames",get:function(){return o}}]),r=e)),t("TemplateGenerator",r)}}}),System.register("quotes/layout/ubp-rate-row/UBPDesktopDelegate.js",["quotes/layout/sf-le-table-row/DesktopDelegate.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.DesktopDelegate}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("UBPDesktopDelegate",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),o(e,[{key:"initListeners",value:function(e){e.listeners.mouseover="onHovered",e.listeners.mouseout="onUnhovered"}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}]),r=e)),t("UBPDesktopDelegate",r)}}}),System.register("quotes/layout/ubp-rate-row/UBPRateRow.js",["common/behaviors/TemplatizationBehavior.js","common/core/AppContext.js","quotes/layout/ubp-rate-row/UBPDesktopDelegate.js","common/behaviors/SFInlineEditBehavior.js","common/formatter/Formatter.js","common/Util.js","quotes/models/ClientCache.js","quotes/models/DataHandlerBehavior.js","quotes/QuoteContext.js","quotes/usage-based-pricing-dao/UsageBasedPricingDao.js","quotes/sf-component-factory/SFComponentFactory.js","common/core/Events.js"],function(t,e){var i,f,o,p,v,g,h,y,r,m,s,b,_,C,a,l,u;return{setters:[function(e){i=e.TemplatizationBehavior},function(e){f=e.AppContext},function(e){o=e.UBPDesktopDelegate},function(e){e.SFInlineEditBehavior},function(e){p=e.Formatter},function(e){v=e.pathGet,g=e.pathMutate,h=e.Util},function(e){y=e.get},function(e){r=e.DataHandlerBehavior},function(e){m=e.QuoteContext},function(e){s=e.getDataFromCache,b=e.getDataFromCacheAsync,_=e.loadRateCardSummary,C=e.overrideRecValues},function(e){a=e.SFComponentFactory},function(e){l=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("UBPRateRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="ubp-rate-row",this.properties=Polymer.Base.extend({categoryId:String,rateId:String,unsavedUbpChanges:{type:Object,observing:{id:"UnsavedUbpChanges",path:[]}},inlineEditChanges:{type:Object,observing:{id:"UbpInlineEditChanges",path:["rates"]}},inlineEditedCategories:Array,rateRecord:{type:Object,observing:{idProperty:"rateId",path:["record"]}},dataIndex:{type:Number,reflectToAttribute:!0},fields:Array,isDirty:Boolean},i.properties),this.listeners={tap:"onTap",change:"onChange"}}},{key:"created",value:function(){this._deviceDelegate=o.getInstance(),this._deviceDelegate.initListeners(this)}},{key:"ready",value:function(){this.shadyRoot&&this.scopeSubtree(Polymer.dom(this.root).querySelector(".content"),!0)}},{key:"getContentNode",value:function(){return Polymer.dom(this.root).querySelector(".content")}},{key:"postPopulateContent",value:function(){var e=this;Polymer.RenderStatus.afterNextRender(this,function(){e.fire("rate-row-rendered")}),this._resetPencilLoaded(),this._refreshDirtyIndicators()}},{key:"hook_onHovered",value:function(e){var t=this.findCell(e);t&&t.getAttribute("field")===m.constants.UBP_FIELDS.ConsumptionSchedule+".Name"&&(this.showTooltip=!0,this._displayPreviewTooltip(t)),this._handleEditableCellsHover()}},{key:"hook_onUnhovered",value:function(e){var t=this.findCell(e);t&&t.getAttribute("field")===m.constants.UBP_FIELDS.ConsumptionSchedule+".Name"&&(this.showTooltip=!1,this.fire("toggle-tooltip",{show:!1}))}},{key:"findCell",value:function(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"td";return Polymer.dom(e).path.find(function(e){var t=e.classList;return t&&t.contains(i)})}},{key:"_mapToMasterUbpChanges",value:function(t,e){return e&&(t=h.deepClone(t),e.forEach(function(e){t[e.fieldPath]=t[""+m.constants.prefix+e.fieldPath+"__c"]})),t}},{key:"_displayPreviewTooltip",value:function(a){var l=this;if(this._previewPanel)this.fire("toggle-tooltip",{target:a,content:this._rateCardPreview,show:!0});else{var u=document.createElement("sf-preview-panel"),d=s(this.rateId,["record"]),c=d[m.constants.UBP_FIELDS.ConsumptionScheduleId];b(this.categoryId,["rateCardFields"],function(){return _(c)}).then(function(r){var s=r.reduce(function(e,t){return e[t.fieldPath]={type:t.type,label:t.label},e},{});b(c,["record"],function(){return _(c)}).then(function(t){var i={};if(l.unsavedUbpChanges&&l.unsavedUbpChanges.schedules&&l.unsavedUbpChanges.schedules[c]){var e=l.unsavedUbpChanges.schedules[c];t.attributes&&"ConsumptionSchedule"===t.attributes.type&&(e=l._mapToMasterUbpChanges(l.unsavedUbpChanges.schedules[c],r));var n=C(t,e,r);Object.keys(s).forEach(function(e){h.deepEquals(n[e],t[e])||(i[e]="dirty")}),t=n}var o=[];Object.keys(t).forEach(function(e){o.push({field:e,value:t[e]})}),u.additionalUIData={_cellClasses:i},u.templateOptions={attributes:'class$="truncate body {{_cellClasses.$field}}"'},u.data=o,u.metadata=s,u.title=v(d,(m.constants.UBP_FIELDS.ConsumptionSchedule+".Name").split(".")),u.iconClass="sf-icon-paired-lines",l._rateCardPreview=u,l.showTooltip&&l.fire("toggle-tooltip",{target:a,content:u,show:!0})})})}}},{key:"_updateUiDataObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this._updateUiData(e,t,i,n)}},{key:"_updateUiData",value:function(e,t,i,n){var o=this._computeUnsavedEditForRate(i,n),r=o?C(e,o,t):e;this.uiData=this._formatUiData(r,t,i,o)}},{key:"commitInlineEdit",value:function(e,t){this.inlineEditChanges[this.rateId]=this.inlineEditChanges[this.rateId]||{},this.inlineEditChanges[this.rateId][e]=t,this.fire("inline-edit-commit")}},{key:"_getInlineEditChangesForRate",value:function(e){return this.inlineEditChanges&&this.inlineEditChanges[e]||{}}},{key:"_formatUiData",value:function(e,t,i,n){var o={},r=!0,s=!1,a=void 0;try{for(var l,u=t[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value,c=d.fieldPath.split(".");f.org.isMultiCurrencyOrg&&"currency"===d.type&&!d.CurrencyIsoCode&&(d.CurrencyIsoCode=y(y("UBPClientState",["quoteLineOrProdId"]),["record","CurrencyIsoCode"]));var h=p.formatFieldData(null,v(e,c),d,e);g(o,c,h)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}return o.rateId=i,o.unsavedEdits=n,o}},{key:"_computeUnsavedEditForRate",value:function(e,t){var i={},n=y(e,["record"]);if(n){if(t){var o=n[m.constants.UBP_FIELDS.ConsumptionScheduleId];if(o&&t.schedules&&t.schedules[o]){var r=t.schedules[o];Object.keys(r).forEach(function(e){"Id"!==e&&"attributes"!==e&&(i[m.constants.UBP_FIELDS.ConsumptionSchedule+"."+e]=r[e])})}}this.appliedChanges&&this.appliedChanges[e]?i=C(i,this.appliedChanges[e],this.fields):t&&t.rates&&t.rates[e]&&(i=C(i,t.rates[e],this.fields)),this.inlineEditChanges&&(i=C(i,this._getInlineEditChangesForRate(e),this.fields))}return i}},{key:"computeClasses",value:function(){return f.isManualEditsForUBPEnabled?"inlineEditable":""}},{key:"getContentNode",value:function(){return this.querySelector("div.content")}},{key:"getCellClass",value:function(){return"sf-ubp-table-cell"}},{key:"_getFieldMetadataForInlineEdit",value:function(t){return this.fields.find(function(e){return e.fieldPath===t})}},{key:"_getFieldMetadata",value:function(e){return this._getFieldMetadataForInlineEdit(e)}},{key:"toggleInlineEditForDeviceDelegate",value:function(e,t,i,n){this._deviceDelegate.toggleInlineEdit(e,t,i,n,this)}},{key:"toggleCellClass",value:function(e,t,i,n){this.toggleClass(e,t,i)}},{key:"_getEditField",value:function(e,t){return a.getFieldComponent(e,null,t,this._getRecord())}},{key:"_getOriginalRecord",value:function(){return this.appliedChanges&&this.appliedChanges[this.rateId]?C(this.rateRecord,this.appliedChanges[this.rateId],this.fields):this.rateRecord}},{key:"_isEditable",value:function(e){return m.isUbpFieldInlineEditable(e,y("ConsumptionRateMetadata",["rateEditable"]))}},{key:"_getRecord",value:function(){var e=this._computeUnsavedEditForRate(this.rateId,this.unsavedUbpChanges);return C(this.rateRecord,e,this.fields)}},{key:"checkIsDirty",value:function(e,t,i){return e!==t[i]}},{key:"_formatNewValue",value:function(e,t){var i=this._computeUnsavedEditForRate(this.rateId,this.unsavedUbpChanges),n=p.formatFieldData(null,i[e],t,this.rateRecord);return this._restampField(e,n),i[e]}},{key:"_inlineEditedCategoriesChanged",value:function(e){var u=this;e&&e.indexSplices&&e.indexSplices.forEach(function(e){if(e.removed){var t=!1,i=!0,n=!1,o=void 0;try{for(var r,s=e.removed[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=y(a,["orderedRates"]);if(l&&-1<l.indexOf(u.rateId)){t=!0;break}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}t&&u._updateUiData(u.rateRecord,u.fields,u.rateId,u.unsavedUbpChanges)}})}},{key:"onKeyDown",value:function(e){this._deviceDelegate.onKeyDown(e,this)}},{key:"_refreshRow",value:function(e){e&&e.detail&&e.detail.id===this.rateId&&this._updateUiData(this.rateRecord,this.fields,this.rateId,this.unsavedUbpChanges)}},{key:"behaviors",get:function(){return[Polymer.Templatizer,window.CommonBehaviors.TemplatizationBehavior,window.CommonBehaviors.SFTableRowBehavior,window.CommonBehaviors.SFInlineEditBehavior,r,window.CommonBehaviors.EventBehavior]}},{key:"observers",get:function(){return["_updateUiDataObserver(rateRecord, fields, rateId, unsavedUbpChanges)","_inlineEditedCategoriesChanged(inlineEditedCategories.splices)"]}},{key:"events",get:function(){var e={};return e[l.UBP_ROW_REFRESH]=this._refreshRow,e}},{key:"appliedChanges",get:function(){var e=y("UBPClientState"),t="AppliedUbpChanges_"+e.quoteLineOrProdId+"_"+e.lineKey;return y(t,["rates"])}}]),u=e)),t("UBPRateRow",u),Polymer(u)}}}),System.register("quotes/md/sb-le-field-md/LEFieldMD.js",["common/core/AppContext.js","quotes/models/Constants.js"],function(t,e){var i,d,o;return{setters:[function(e){i=e.AppContext},function(e){d=e.Constants}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LEFieldMD",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-field-md",this.properties={data:{type:Object},md:{type:Object,notify:!0},error:{type:Object,notify:!0}}}},{key:"ready",value:function(){this.$.describe.addEventListener("describe-changed",function(e){var t=e.detail.value.md,i={},n={};this.constants||(this.constants=new d(this.prefix));var o=this.constants.UNIT_PRICE_FIELDS,r=this.constants.QUANTITY_FIELDS;for(var s in t){var a=s.split("."),l=a[0],u=a[1];i[l]||(i[l]={}),n[l]||(n[l]={}),o.has(t[s].name)?t[s].scale=this.settings.priceScale:"currency"==t[s].type&&this.settings.isMultiCurrencyOrg?t[s].scale=this.currencyDecimalScale:r.has(t[s].name)&&(t[s].scale=this.settings.quantityScale||0===this.settings.quantityScale?this.settings.quantityScale:t[s].scale),i[l][u]=t[s],l===this.prefix+"QuoteLine__c"&&(n[l][u]=t[s].label),n[u]=t[s].label}this.md={fieldsMap:i,fieldLabelsMap:n}}.bind(this)),this.$.describe.addEventListener("error-changed",function(e){this.error=e.detail.value}.bind(this))}},{key:"getFieldNames",value:function(){var e=[];for(var t in this.data)for(var i=0,n=this.data[t].length;i<n;i++){var o=this.data[t][i];e.push(t+"."+o)}this.$.describe.fields=e}},{key:"observers",get:function(){return["getFieldNames(data)"]}},{key:"prefix",get:function(){return i.org.prefix?i.org.prefix+"__":""}}]),o=e)),t("LEFieldMD",o),Polymer(o)}}}),System.register("quotes/pages/sb-line-editor/LineEditor.js",["common/core/AppContext.js","common/core/Events.js","common/core/Navigator.js","common/core/Page.js","common/data/client/ConnectionClient.js","common/rules/QuoteRuleExecutor.js","quoteLogger/QuoteLogger.js","quoteLogger/WindowChannel.js","quotes/layout/template-generator/ListItemTemplateGenerator.js","quotes/models/ClientCache.js","quotes/models/ClientModels.js","quotes/models/EditorModel.js","quotes/models/SafeClientCache.js","quotes/precaching/JSQCPrecacheWorkerManager.js","quotes/ui-data-manager/UIDataManager.js","quotes/usage-based-pricing-dao/UsageBasedPricingDao.js","logging/AppLogger.js"],function(t,e){var i,l,r,u,o,s,a,d,c,h,m,b,_,C,f,p,v,S,g,y,k,O,E,I;return{setters:[function(e){i=e.AppContext,l=e.localizeContent},function(e){r=e.Events,u=e.fireEvent},function(e){o=e.Navigator},function(e){s=e.Page},function(e){a=e.ConnectionClient},function(e){d=e.QuoteRuleExecutor},function(e){c=e.default},function(e){h=e.default},function(e){m=e.ListItemTemplateGenerator},function(e){b=e.get,_=e.put},function(e){C=e.UBPClientState},function(e){f=e.EditorModel},function(e){p=e.merge},function(e){v=e.JSQCPrecacheWorkerManager},function(e){S=e.UIDataManager},function(e){g=e.loadUbp},function(e){y=e.AppLogger,k=e.LOG_TYPE}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("LineEditor",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,s),E(e,[{key:"beforeRegister",value:function(){this.is="sb-line-editor",this.properties=Polymer.Base.extend({rawData:{type:Object},data:{type:Object,observer:"_dataIsChanged"},md:{type:Object,notify:!0},editorModel:{type:Object,notify:!0},groupModels:{type:Array},errors:{type:Array,notify:!0},quoteLevelTabs:{type:Array,value:[]},pageLoaded:{type:Boolean,value:!1},calculateGetCacheArray:{type:Array,value:[]},rules:Array},s.properties)}},{key:"_isColumnResizingEnabled",value:function(){return i.org.isColumnResizingEnabled&&!i.isMobile}},{key:"_updateIronList",value:function(){this.editorModel.largeQuoteExperienceEnabled&&u(r.UPDATE_IRON_LIST,{index:null})}},{key:"_loadObjectMD",value:function(){var e=this.app.org.prefix?this.app.org.prefix+"__":"";this.mdObjects=[e+"QuoteLineGroup__c",e+"QuoteLine__c",e+"Quote__c",e+"DiscountTier__c",e+"DiscountSchedule__c"]}},{key:"_loadProductRules",value:function(){var e=i.org.hasQuoteSelectionProductRules&&i.org.isJSProductRulesEnabled;return!1===e&&(this.rules={}),e}},{key:"_executeCustomAction",value:function(e){var t=e.detail,i=t.customAction.eventHandlerName;"onFlagCalculate"===i&&(this.calculateGetCacheArray=[]),this._doesUserHavePermissionForAction(i)?("onFlagCalculate"===i&&this.data.settings.diagnosticToolEnabled&&this._openDiagnosticTool(),this.eventDetail=t):this.errors=[this.i18n.l("Insufficient privileges to perform that action")]}},{key:"_doesUserHavePermissionForAction",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return!new Set(["onAddProducts","onSave","onQuickSave","onFlagCalculate"]).has(e)||!1!==i.user.hasQuoteEditPermission}},{key:"attached",value:function(){document.addEventListener("LineEditor-cached",function(){this.needsInit=!0}.bind(this))}},{key:"_createEditorModelObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._createEditorModel(e,t)}},{key:"_createEditorModel",value:function(e,t){if(0<e.settings.largeQuoteThreshold&&(e.settings.enableLQTValidations&&this._cacheProductRuleFields("validationErrorConditionDependencies"),e.settings.enableLQTSelectionRules&&this._cacheProductRuleFields("selectionErrorConditionDependencies")),this.ctx.params&&"onFlagCalculate"==this.ctx.params.cmd&&(e.quote.calculationRequired=!0,this.ctx.params.cmd=null),e.quote.calculationRequired)this.$.customActionServices.onFlagCalculate(this.pageLoaded);else{if(this.editorModel=new f(e,t,this),this._updateFieldLabelsMap(),this._handleGroupCustomActions(),this.groupModels=this._getGroupModels(),this.rightSideButton=!this.editorModel.deviceContext.isMobile&&1<this.groupModels.length&&this.editorModel.quoteModel.grouped,this.quoteId=this.editorModel.quoteModel.quoteVO.record.Id,this.hasQuoteFieldSet=0<this.editorModel.fieldsetMap.quoteFieldNames.length,this._viewportChanged(this.editorModel.deviceContext.isMobile),this.renumber(),this.quoteHasNoLines(),this.ctx.params&&null!=this.ctx.params.cmd?(this._executeCmd(this.ctx.params.cmd),this.ctx.params.cmd=null):this.$.sbLineEditorRead.isLastReadQuoteUnopened&&this.editorModel.quoteModel.quoteVO.isCoTermPrompted?this._navigateToContractLookupPage():this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_ID_FIELD]?this._executeDefaultCustomAction():this._handleMissingPricebook(),this._loadProductRules()&&this._redirectToLineEditor()?this.executeProductRules():this.pageLoaded=!0,(this.editorModel.deviceContext.isMobile||this.editorModel.largeQuoteExperienceEnabled)&&(this.quoteTotalDisplayed=!0),this.editorModel.largeQuoteExperienceEnabled){this.quoteDetailsIconClass="sf-icon-chevrondown";var i=this.returnGroupKeyAfterQuickSave?this.returnGroupKeyAfterQuickSave:this.ctx.params.groupKey,n=i&&this.editorModel.quoteModel.groupsByKey[i]?i:this.groupModels[0].groupKey}this.selectedGroupKey=this.editorModel.largeQuoteExperienceEnabled?n:null,this._isSubtitleCombined()}}},{key:"_cacheProductRuleFields",value:function(i){function t(e){var t={};return t[i]=e,p(t)}var e=this.$[i];e.read({uid:i}).then(function(e){return t({fields:e})}).catch(function(e){return t({errors:e})})}},{key:"_isSubtitleCombined",value:function(){this.subtitleCombined=this.editorModel.largeQuoteExperienceEnabled&&"doNotDisplay"!=this.data.settings.lineEditorTotalsField&&0<this.data.quote.lineItems.length}},{key:"_handleGroupCustomActions",value:function(e){if(this.editorModel){var t=this.viewport&&this.viewport.isDesktop()&&this.viewport.M.up;if(this.editorModel.groupCustomActions=t?this.editorModel.customActionsByLocation.Group:[this.editorModel.groupMobileMenuButtonAction],e||t||(this.editorModel.groupCustomActions[0].label=this.editorModel.customActionsByLocation.Group[0].label,this.editorModel.groupCustomActions[0].first=this.editorModel.customActionsByLocation.Group[0].first,this.editorModel.groupCustomActions[0].eventHandlerName=this.editorModel.customActionsByLocation.Group[0].eventHandlerName,this.editorModel.groupCustomActions[0].record=this.editorModel.customActionsByLocation.Group[0].record),e&&this.groupModels)for(var i=0,n=this.groupModels.length;i<n;i++)this.notifyPath("groupModels."+i+".editorModel.groupCustomActions")}}},{key:"_handleMissingPricebook",value:function(){if(this.addEventListener("pricebook-saved",function(e){this._executeDefaultCustomAction()}.bind(this)),-1<window.location.href.indexOf("cp=1"))document.location.assign(this.editorModel.communityPrefix+"/"+this.editorModel.quoteModel.quoteVO.record.Id);else{var e=this.data.userType;"Standard"==e||"PowerPartner"==e?this.$.pricebookDialog.open():this.errors=[l("msg_missing_pricebook_id")]}}},{key:"_updateFieldLabelsMap",value:function(){var e=this.editorModel.md.fieldLabelsMap,t=this.editorModel.data.quote.localizedMultiSegmentColumns,i=this.editorModel.data.quote.multiSegmentColumns;for(var n in i)for(var o=i[n],r=t[n],s=0,a=o.length;s<a;s++)e[o[s].replace(/\W/g,"")]=r[s];e.total=l("Total")}},{key:"_navigateToContractLookupPage",value:function(){this.nav("#",{qId:this.editorModel.quoteModel.quoteVO.record.Id},["contract","lookup"],!1)}},{key:"renumber",value:function(){this.editorModel.quoteModel.renumber(),u(r.ROWS_RENUMBERED)}},{key:"_updateFieldValidations",value:function(e){this.errors=e.detail.error?[e.detail.error]:null}},{key:"_calculateImmediately",value:function(t,e){null!==e&&!isNaN(e)||(e=50);var i=void 0===t.detail.showSpinner||t.detail.showSpinner,n=void 0===t.detail.setPageLoaded||t.detail.setPageLoaded;this.debounce("calculateImmediately",function(){this.$.customActionServices.onFlagCalculate(i,!1,function(e){n&&(this.pageLoaded=!0),t.detail.callback&&"function"==typeof t.detail.callback&&t.detail.callback(e)}.bind(this))}.bind(this),e)}},{key:"_executeCmd",value:function(e){var t=this.editorModel.customActionsByLocation.Quote;if(t&&0!==t.length)for(var i=0,n=t.length;i<n;i++)t[i].eventHandlerName===e&&this._executeCustomAction({detail:{customAction:t[i],model:this.editorModel.quoteModel}})}},{key:"_getValidDefaultCustomAction",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(!e||0===e.length||0<this.data.quote.lineItems.length||1<this.data.quote.lineItemGroups.length||this.editorModel.quoteModel.grouped)return[];var t=this.editorModel.quoteModel.isRenewal?"onRenewSubscriptions":"onAddProducts";return e.filter(function(e){return e._customActionsConditionsMet&&e.eventHandlerName===t})}},{key:"_executeDefaultCustomAction",value:function(){var t=this;this._getValidDefaultCustomAction(this.editorModel.defaultCustomActions).forEach(function(e){t._executeCustomAction({detail:{customAction:e,model:t.editorModel.quoteModel}})})}},{key:"viewportChanged",value:function(){this._handleGroupCustomActions(!0),this.viewport.isMobile()?this.isMobile=!0:this.isMobile=!1}},{key:"buildQuoteTabs",value:function(){if(this.editorModel){var e=[];if(0<this.editorModel.fieldsetMap.quoteFieldNames.length&&e.push("details"),this.editorModel.quoteModel.grouped)this.toggleClass("maxHeight",!0,this.$$("#quoteTabs")),0<this.groupModels.length&&e.push("groups");else{if(!this.groupModels.length)return;this.toggleClass("maxHeight",!1,this.$$("#quoteTabs")),this.groupModels[0]._groupHasSegmentedProducts()&&(this.buildUngroupedSegmentedTabs(),e.push("segmented")),this.groupModels[0]._groupHasStandardProducts()&&e.push("standard")}if(this._renderTabs(e)){this.$$("#quoteTabs")&&this.$$("#quoteTabs").destroyTabs();for(var t=[],i=0,n=e.length;i<n;i++){var o="t"+i,r=e[i],s=void 0;switch(r){case"details":s=["groupModels","editorModel"];break;case"groups":s=["groupModels","rightSideButton","editorModel"];break;case"standard":case"segmented":s=["groupModels"]}t.push({name:o,label:r,bind:s})}this.ungroupedMDQTabs=this.groupModels[0]?this.groupModels[0].quoteMDQTabs:null,this.selectedTabIndex=0,this.hideTabs=1==t.length,this.quoteLevelTabs=t}}}},{key:"_renderTabs",value:function(e){if(this.quoteLevelTabs.length!==e.length)return!0;if(this.groupModels[0]&&this.groupModels[0].quoteMDQTabs&&this.ungroupedMDQTabs.length!==this.groupModels[0].quoteMDQTabs.length)return!0;for(var t=0,i=this.quoteLevelTabs.length;t<i;t++)if(this.quoteLevelTabs[t].label!==e[t])return!0;return!1}},{key:"_onError",value:function(e){e&&e.detail&&e.detail.errorMessage&&(this.errors=[e.detail.errorMessage])}},{key:"_getGroupModels",value:function(){return this.editorModel.quoteModel.lineGroups}},{key:"quoteHasNoLines",value:function(){if(0==this.data.quote.lineItems.length){var e=this.editorModel.quoteModel;this.groupedQuoteHasNoGroups=e.grouped&&0==e.lineGroups.length,this.ungroupedQuoteHasNoLines=!e.grouped}}},{key:"updateQuote",value:function(e,t){if(null!=e){if(e.partialVO&&this.data.quote&&t&&((e=t(e,this.data.quote)).partialVO=!1),this.set("data.quote",e),this.data.settings.usesClientCalculator&&this.data.quote.calculationRequired)return void this.$.customActionServices.onFlagCalculate(!0,!0);this.editorModel||this._createEditorModel(this.data,this.md),this.editorModel.createQuoteModel(e),this.editorModel.styleQuoteAndGroupActionButtons();var i=this._getGroupModels();if(this._updateFieldLabelsMap(),this.set("groupModels",i),this.rightSideButton=this.viewport&&!this.viewport.isMobile()&&1<this.groupModels.length&&this.editorModel.quoteModel.grouped,this.notifyPath("editorModel.quoteModel.lineGroups.length",this.editorModel.quoteModel.lineGroups.length),this.set("editorModel.quoteModel",this.editorModel.quoteModel),this.renumber(),this.editorModel.largeQuoteExperienceEnabled){var n=this.editorModel.quoteModel,o=n.lineGroups;n.grouped&&1==o.length&&this.selectedGroupKey!=o[0].groupKey&&(this.selectedGroupKey=o[0].groupKey),this._isSubtitleCombined()}this.isMobile&&this.buildQuoteTabs()}this.quoteHasNoLines(),this.data.settings.multiLineDeleteEnabled&&u(r.DESELECT_CHECKBOX)}},{key:"updateAfterJSQC",value:function(s,a){var l=this;if(s){var e=function(e,t){for(var i in e){var n=s.originalPathValues[i],o=e[i].value,r=!a||"QuoteLineModel"!=e[i].root;(n!=o||i.endsWith(l.editorModel.constants.ADDITIONAL_DISCOUNT_FIELD))&&r&&(t(i,void 0),t(i,o))}};e(s.pathsToNotify,this.notifyPath.bind(this)),e(s.pathsToSet,this.set.bind(this)),i.isPricingGuidanceEnabled&&u(r.REFRESH_LINE_ACTIONS)}}},{key:"_initObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._init(e)}},{key:"_init",value:function(t){if(this.needsInit&&("undefined"!=typeof Visualforce&&t.settings.usesClientCalculator&&t.settings.orgUrl&&window.Worker&&new v(t).beginPrecaching(),this.needsInit=!1),t.settings.usesClientCalculator&&"undefined"!=typeof SB&&SB.JSQC&&!t.quote.calculationRequired){var e=new a(this.app.org.prefix),i=new SB.JSQC(t.settings,t.quote,null),n=[e.getConnection(),e.getConnection()];Promise.all(n).then(function(e){i.setConnection(e[0]),i.setCustomerOnlyConnection(e[1]),i.setLogger(c),t.settings.displayedLookupMap=this.$.customActionServices.getDisplayedLookupNames(t),i.onLoad().then(function(){this.data=t}.bind(this),this._setError.bind(this)).catch(this._setError.bind(this))}.bind(this),this._setError.bind(this))}else this.data=t}},{key:"_getNewQuoteRuleExecutor",value:function(){return new d(this.rawData.quote,this.rules,this.rawData.settings.developerPrefix,this.rawData.settings.jsprLabels)}},{key:"executeProductRules",value:function(){var t=this,e=this._getNewQuoteRuleExecutor(),i=void 0;try{i=e.execute()}catch(e){var n=void 0;n="object"===(void 0===e?"undefined":O(e))&&"info"===e.type?[e]:[{msg:e.toString(),type:"warning"}],Polymer.RenderStatus.afterNextRender(this,function(){t.errors=n})}i&&0<i.requiredProductIds.length?(this.handleLinesAddedByProductRules(),this.$.quoteLineAdder.quote=this.rawData.quote,this.$.quoteLineAdder.productIds=i.requiredProductIds):this.pageLoaded=!0}},{key:"_setError",value:function(e){this.error={message:e.message||e}}},{key:"_dataIsChanged",value:function(){var e=new CustomEvent("sf-qle-data-changed",{bubbles:!1,detail:this.data});document.dispatchEvent(e);var t=this.data.developerPrefix,i={};this._removeDuplicateLineFieldsInDrawer();for(var n=[],o=new Set,r=["lineFieldNames","lineFieldNamesTablet","lineFieldNamesPhone","standardLineItemDrawerFieldNames","multiSegmentLineFieldNames","multiSegmentLineSummaryFieldNames"],s=0,a=r.length;s<a;s++){var l=this.data[r[s]],u=l&&l.length;if(u)for(var d=0;d<u;d++){var c=l[d];o.has(c)||(o.add(c),n.push(c))}}for(var h=[t+"SubscriptionScope__c",t+"SegmentLabel__c",t+"StartDate__c",t+"EndDate__c",t+"PriceEditable__c"],f=0,p=h.length;f<p;f++){var v=h[f];o.has(v)||(o.add(v),n.push(v))}i[this.data.quoteLineObjectName]=[].concat(n);var g=this.data.settings.lineEditorSubtotalsField;g&&"Default"!=g&&"doNotDisplay"!=g?(i[this.data.quoteLineObjectName].push(g),o.add(g)):(i[this.data.quoteLineObjectName].push(t+"NetTotal__c"),o.add(t+"NetTotal__c")),i[this.data.quoteObjectName]=[].concat(this.data.quoteFieldNames);for(var y=0,m=this.data.quoteFieldNames.length;y<m;y++)o.add(this.data.quoteFieldNames[y]);var b=this.data.settings.lineEditorTotalsField;b&&"Default"!=b?(i[this.data.quoteObjectName].push(b),o.add(b)):this.data.quote.applyAdditionalDiscountLast?(i[this.data.quoteObjectName].push(t+"CustomerAmount__c"),o.add(t+"CustomerAmount__c")):(i[this.data.quoteObjectName].push(t+"NetAmount__c"),o.add(t+"NetAmount__c")),i[t+"QuoteLineGroup__c"]=[].concat(this.data.groupFieldNames);for(var _=0,C=this.data.groupFieldNames.length;_<C;_++)o.add(this.data.groupFieldNames[_]);var S=this.data.settings.lineEditorGroupSubtotalsField;S&&"Default"!=S?(i[t+"QuoteLineGroup__c"].push(S),o.add(S)):(i[t+"QuoteLineGroup__c"].push(t+"NetTotal__c"),o.add(t+"NetTotal__c")),i[t+"DiscountTier__c"]=this.data.discountScheduleModalFieldNames,i[t+"DiscountSchedule__c"]=["Name",t+"DiscountUnit__c"],this.fieldNameSet=o,this.$.md.data=i,this._logQLELoad()}},{key:"_removeDuplicateLineFieldsInDrawer",value:function(){var e=this.data.standardLineItemDrawerFieldNames;if(e&&0!=e.length){var r=this.data.developerPrefix,t=this.app.deviceContext,i=function(e,t){for(var i=new Set(e),n=0,o=t.length;n<o;n++)!i.has(t[n])&&t[n]!=r+"Number__c"||(t.splice(n,1),n--)};this.data.lineFieldNamesPhone&&t.isPhone?i(this.data.lineFieldNamesPhone,e):this.data.lineFieldNamesTablet&&(t.isTablet||t.isPhone)?i(this.data.lineFieldNamesTablet,e):i(this.data.lineFieldNames,e)}}},{key:"_errorEventHandled",value:function(){this.error&&(this.error.validations?(this.errors=this.error.validations,this.$.customActionServices.updateUIAfterCalculate(this.editorModel.quoteModel.quoteVO)):this.errors=[this.error.message]),this.$.customActionServices.showSpinner=!1,u(r.TOGGLE_QUICKSAVE,{enable:!0}),this.$.sbLineEditorRead.restoreCache()}},{key:"_logQLELoad",value:function(){if(!this._isCmpLoaded&&this.data&&this.data.quote&&this.data.quote.record){var e=null;this.data.quote.record[this.data.developerPrefix+"HeaderFieldSetName__c"]&&(e={usingDynamicQuoteHeader:!0}),this._log(this.data.quote.record.Id,k.LOAD_QLE,e),this._isCmpLoaded=!0}}},{key:"_log",value:function(e,t,i){(new y).log(e,t,i)}},{key:"_handleMobileCSE",value:function(e){this._openDialog({dialog:"cseDialog",groupModelKey:null})}},{key:"_handleCSE",value:function(e){this._openDialog(e.detail)}},{key:"_handleCSEResponse",value:function(e){this.updateQuote(e.detail.quoteVO),this.$.cseDialog.$.dialog.toggle()}},{key:"_openDialog",value:function(e){if("cseDialog"===e.dialog){var t=this.$.cseDialog,i=this.editorModel.quoteModel.groupsByKey[e.groupModelKey].segmentedLinesByDimension.Custom[0].segmentsByLabel,n=[];Object.keys(i).forEach(function(e){var t=i[e];t.lineVO.dimensionType==t.groupModel.editorModel.constants.CUSTOM_VALUE&&n.push(t)}),t.dataLineModels=n}this.$[e.dialog].$.dialog.toggle()}},{key:"toggleGroupPanel",value:function(){this.viewport.isMobile()&&u(r.TOGGLE_PANEL_CLICKED)}},{key:"resetColumnWidths",value:function(){var e=this.editorModel.fieldSetNames.lineFieldNames;u(r.RESET_COL_SIZES,{fieldSet:e}),this.querySelector("#cogDropdown").close()}},{key:"updateQuoteDetails",value:function(){this.quoteDetailsHidden=!this.quoteDetailsHidden,this.toggleQuoteDetails(!1)}},{key:"toggleQuoteDetails",value:function(e){this.set("quoteDetailsIconClass",this.quoteDetailsHidden?"sf-icon-chevronright":"sf-icon-chevrondown"),u(r.PAGE_RESIZED,{isFullScreenToggleEvent:e})}},{key:"toggleFullScreenMode",value:function(e){this._toggleFullscreen(e),this.quoteDetailsHidden=this.inFullScreenMode,this.toggleQuoteDetails(!0)}},{key:"_toggleFullscreen",value:function(e){this.inFullScreenMode?this.exitFullScreenMode():this.enterFullScreenMode(),e.stopPropagation()}},{key:"enterFullScreenMode",value:function(){var e=document.querySelector("sb-page-container");e.requestFullScreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),this.inFullScreenMode=!0}},{key:"exitFullScreenMode",value:function(){var e=document.querySelector("sb-page-container");e.requestFullScreen?document.cancelFullScreen():e.msRequestFullscreen?document.msExitFullScreen():e.mozRequestFullScreen?document.mozCancelFullScreen():e.webkitRequestFullscreen&&document.webkitCancelFullScreen(),this.inFullScreenMode=!1}},{key:"_viewportChanged",value:function(e){if(this.editorModel){this.toggleClass("hidden",!e,Polymer.dom(this.root).querySelector(".fixedActions"));var t=this.editorModel.standardPrimaryMobileCols.length;this.editorModel.standardPrimaryMobileCols=e?[this.editorModel.constants.PRODUCT_NAME_FIELD,this.editorModel.constants.NET_TOTAL_FIELD]:[];var i=this.editorModel.segmentedPrimaryMobileCols.length;if(this.editorModel.segmentedPrimaryMobileCols=e?[this.editorModel.constants.PRODUCT_NAME_FIELD,"total"]:[],this.editorModel.segmentedDetailsPrimaryMobileCols=e?[this.editorModel.constants.SEGMENT_LABEL_FIELD,this.editorModel.constants.NET_TOTAL_FIELD]:[],this.groupModels&&(t!==this.editorModel.standardPrimaryMobileCols.length||i!==this.editorModel.segmentedPrimaryMobileCols.length))for(var n=0;n<this.groupModels.length;n++)this.notifyPath("groupModels."+n+".editorModel.standardPrimaryMobileCols"),this.notifyPath("groupModels."+n+".editorModel.segmentedPrimaryMobileCols"),this.notifyPath("groupModels."+n+".editorModel.segmentedDetailsPrimaryMobileCols");e&&this.buildQuoteTabs(),this.isMobileRendered=e,this.isDesktopRendered=!e}}},{key:"buildUngroupedSegmentedTabs",value:function(){if(this.groupModels&&0!=this.groupModels.length){for(var e=[],t=this.groupModels[0].dimensions,i=0,n=t.length;i<n;i++){var o=t[i];if(this.groupModels[0].hasVisibleSegmentedLines[o]){var r="t"+i,s={name:r,key:o,label:this.groupModels[0].quoteModel.quoteVO.localizedDimensionNames[o],bind:["groupModel"]};"Custom"==o&&(s.iconId=r+"-"+this.groupModels[0].groupKey,s.iconClass="sb-icon-pencil",s.iconEvent="cseMobile"),e.push(s)}}this.groupModels[0].quoteMDQTabs=e,this.ungroupedMDQTabs||(this.ungroupedMDQTabs=e)}}},{key:"_openCSE",value:function(){event.currentTarget.attributes.dialog.value,this.$.cseDialog.$.dialog.toggle()}},{key:"_displayUpgradeQuantityToast",value:function(e){var t=e.detail.invalidQuantity,i=e.detail.validQuantity;if(this.errors=null,0<t){var n=this.i18n.l("Exceeded maximum quantity available. Value has been reduced to {0}",[i]);this.errors=[{type:"warning",msg:n}]}}},{key:"destampGroups",value:function(){this.isMobileRendered=!1,this.isDesktopRendered=!1}},{key:"handleProductRuleAlertModal",value:function(e,c){var h=this,t=c.guidedMessages;t&&0!==t.length&&("saveService"===e?(this.$.productAlertModal.cancelCB=function(){if(h.editorModel.data.settings.usesClientCalculator){for(var e=h.editorModel.data.quote,t=c.quote,i=e.lineItems.length,n=function(e,t){for(var i in t)e[i]=t[i]},o=0;o<i;o++){var r=e.lineItems[o],s=t.lineItems[o];r.record.Id=s.record.Id,delete s.record,n(r,s)}for(var a=e.lineItemGroups.length,l=0;l<a;l++){var u=e.lineItemGroups[l],d=t.lineItemGroups[l];u.record.Id=d.record.Id}e.record.Id=t.record.Id,delete t.lineItems,delete t.lineItemGroups,delete t.record,n(e,t),h.updateQuote(e),h.$.customActionServices.notifier&&h.updateAfterJSQC(h.$.customActionServices.notifier)}else h.updateQuote(c.quote)},this.$.productAlertModal.displayContinueButton=!0,this.$.productAlertModal.cancelText=l("lbl_close"),this.$.productAlertModal.continueCB=function(){h.$.customActionServices.navigateToReturnUrl(!0)}):(this.$.productAlertModal.cancelCB=null,this.$.productAlertModal.cancelText="Quick Save and Continue"),this.$.productAlertModal.alerts=t)}},{key:"_toggleEditors",value:function(e,t,i){i?(e.classList.remove("hidden"),t.classList.add("hidden")):(e.classList.add("hidden"),t.classList.remove("hidden"))}},{key:"_loadUbp",value:function(){return g()}},{key:"_toggleUbpEditor",value:function(e){var d=this,c=e.detail.lineModel,h=e.detail.visible,f=this.$.qlEditorContainer,p=this.$.ubpEditorContainer,v=this.querySelector("sf-ubp-editor");if(!h&&v)this._toggleEditors(p,f,h);else{this.$.customActionServices.showSpinner=!0;var g=c.lineVO.record,y=g.Id||g[this.editorModel.constants.SOURCE_FIELD]||g[this.editorModel.constants.PRODUCT],t=Math.trunc(window.innerHeight/30);_("UBPClientState",[],new C(y,c.lineVO.key,t)),_("UnsavedUbpChanges",[],c.lineVO.ubpChanges||{}),_("UbpInlineEditChanges",[],{rates:{},categories:[]}),_(y,["record","CurrencyIsoCode"],g.CurrencyIsoCode),this._loadUbp().then(function(){v||(v=document.createElement("sf-ubp-editor"),Polymer.dom(p).appendChild(v));var e=b(y,["related","ubpFields"]),t=e.map(function(e){return e.fieldPath}),i={},n={},o=!0,r=!1,s=void 0;try{for(var a,l=e[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;i[u.fieldPath]=u.label,n[u.fieldPath]=u}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}v.lineRecord=g,v.uiData=S.prepareSingleLineData(c,0,t,n),v.templateHTML=new m(function(e){return n[e]}).generate(t,i),d._toggleEditors(p,f,h),d.$.customActionServices.showSpinner=!1}).catch(this._setError.bind(this))}}},{key:"_togglePageLoaded",value:function(e){e&&e.detail&&(this.pageLoaded=!!e.detail.pageLoaded)}},{key:"_redirectToLineEditor",value:function(){if(!this.ctx.params||!this.ctx.params.jspr)return!1;var e=o.getPreviousRoute();return"product/pc"===e||"product/lookup"===e||"favorite/lookup"===e||"asset/lookup"===e||"subscription/lookup"===e||"recommend/lookup"===e}},{key:"handleLinesAddedByProductRules",value:function(){this.$.quoteLineAdder.addEventListener("lines-added-by-rules-changed",function(e){var t=JSON.parse(JSON.stringify(this.data));t.quote.lineItems=t.quote.lineItems.concat(e.detail.value),this.updateQuote(t.quote),this._calculateImmediately({detail:{showSpinner:!1,setPageLoaded:!0}})}.bind(this))}},{key:"toggleOptional",value:function(e){var t=e.detail.groupKey,i=e.detail.toggleOptionalBoolean;this.editorModel.quoteModel.toggleOptional(i,t)}},{key:"_setCalculateCached",value:function(e){this.pageLoaded&&this.calculateGetCacheArray.push(e.detail.cacheHit)}},{key:"test_isCalculateCached",value:function(){return 0<this.calculateGetCacheArray.length&&-1==this.calculateGetCacheArray.indexOf(!1)}},{key:"_openDiagnosticTool",value:function(){var e="QLEDiagnosticToolApp",t=window.open("/c/QLEDiagnosticToolApp.app",e,"resizable=1,scrollbars=1"),i=new h(window),n=new h(t),o=new c(i,n);o.initPublisher(),c.setInstance(o)}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[r.TOGGLE_OPTIONAL_CLICKED]=this.toggleOptional,e[r.VIEWPORT_CHANGED]=this.viewportChanged,e[r.COL_SIZE_ERR]=this._onError,e[r.GENERIC_ERROR]=this._onError,e}},{key:"listeners",get:function(){return{"le-action-tapped":"_executeCustomAction","cseMobile-tapped":"_handleMobileCSE","cse-tapped":"_handleCSE","segmented-changed":"_handleCSEResponse","change-ghost":"_handleGhostChanges","renumber-lines":"renumber","validate-quantity-changed":"_displayUpgradeQuantityToast","field-change-validated":"_updateFieldValidations","calculate-immediately":"_calculateImmediately","rte-saved":"_updateIronList","calculate-cache-get":"_setCalculateCached","toggle-ubp-editor":"_toggleUbpEditor","toggle-page-loaded":"_togglePageLoaded"}}},{key:"observers",get:function(){return["_createEditorModelObserver(data, md)","_errorEventHandled(error)","_loadObjectMD(app.org)","_initObserver(rawData, rules)"]}}]),I=e)),t("LineEditor",I),Polymer(I)}}}),System.register("quotes/pages/sf-ubp-editor/UBPEditor.js",["common/behaviors/TemplatizationBehavior.js","quotes/models/DataHandlerBehavior.js","quotes/models/ClientCache.js","quotes/models/ClientModels.js","quotes/usage-based-pricing-dao/UsageBasedPricingDao.js","quotes/QuoteContext.js"],function(t,e){var i,o,r,s,a,l,u;return{setters:[function(e){i=e.TemplatizationBehavior},function(e){o=e.DataHandlerBehavior},function(e){r=e.get,s=e.put},function(e){e.UBPClientState},function(e){a=e.loadRates},function(e){l=e.QuoteContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("UBPEditor",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-ubp-editor",this.properties=Polymer.Base.extend({lineRecord:Object,errorMsg:{type:String,observing:{id:"UBPClientState",path:["errorMsg"]}},successMsg:{type:String,observing:{id:"UBPClientState",path:["successMsg"]}},requestCount:{type:Number,observing:{id:"UBPClientState",path:["requestCount"]}},categoryIds:{type:Array,observing:{idFunction:"_getLineId(lineRecord)",path:["related","categoryIds"]}},categoryIndex:{type:Number,observing:{id:"UBPClientState",path:["categoryIndex"]},value:0}},i.properties),this.listeners={"selected-page-changed":"_onTabChanged","sb-cancel-backToQuote":"_closeConfirmationDialog"}}},{key:"ready",value:function(){this.shadyRoot&&(this.scopeSubtree(this.$.quoteLine,!0),this.scopeSubtree(this.querySelector(".ubpTabContainer",!0)))}},{key:"getContentNode",value:function(){return Polymer.dom(this.$.quoteLine)}},{key:"isTemplatizeWithRootDivNode",value:function(){return!1}},{key:"_getLineId",value:function(e){return e.Id||e[l.constants.SOURCE_FIELD]||e[l.constants.PRODUCT]}},{key:"_getCategoryId",value:function(e,t){return e[t]}},{key:"_hasCategories",value:function(e){return!!e&&0<e.length}},{key:"_getCategoryTabs",value:function(e){return e.map(function(e){return{label:r(e,["label"])}})}},{key:"_onBackToQLE",value:function(){this.$.ubpRateTable.clearSearch();var e=r("UbpInlineEditChanges",["categories"]);null!=e&&0<e.length?this.$.confirmationDialog.open():this.fire("toggle-ubp-editor",{visible:!1})}},{key:"_closeConfirmationDialog",value:function(){this.$.confirmationDialog.close()}},{key:"_discardAllUnappliedChanges",value:function(){this.$.ubpRateTable.discardUnappliedChanges(),this._closeConfirmationDialog(),this.fire("toggle-ubp-editor",{visible:!1})}},{key:"_getProductName",value:function(e){return e[l.constants.PRODUCT_NAME_FIELD]}},{key:"_onTabChanged",value:function(e){this.categoryIndex!==e.detail&&(s("UBPClientState",["categoryIndex"],e.detail),this._loadRates(0))}},{key:"_loading",value:function(e){return 0<e}},{key:"_loadRates",value:function(e){a(e)}},{key:"behaviors",get:function(){return[Polymer.Templatizer,window.CommonBehaviors.TemplatizationBehavior,o]}}]),u=e)),t("UBPEditor",u),Polymer(u)}}}),System.register("quotes/precaching/PrecacheSequenceRunners/DiscountScheduleSequenceRunner.js",[],function(e,t){var u;function i(i,n,o,l,r){return{executeSequence:function(){var e=function(){var e=n?n+"__":"",o={},r=e+"DiscountSchedule__c",s=e+"TermDiscountSchedule__c",a=e+"Product__c";return l.lineItems.forEach(function(e){var t=e.record[r],i=e.record[s],n=e.costScheduleId;null!=t&&(null==o[t]&&(o[t]=[]),o[t].push(e.record[a])),null!=i&&(null==o[i]&&(o[i]=[]),o[i].push(e.record[a])),null!=n&&(null==o[u(n)]&&(o[u(n)]=[]),o[u(n)].push(e.record[a]))}),o}();if(0==Object.keys(e).length)return Promise.resolve();var t={schedules:e,overrides:{},account:r};return i.load(n,"DiscountAndAccountCallout","AllDiscountsAndAccounts",t).then(function(e){o({successful:!0,provider:"DiscountAndAccountCallout",uid:"AllDiscountsAndAccounts",results:e})},function(e){self.postMessage({err:!0,sequence:"DiscountScheduleSequence",msg:e.message||e})})}}}return{setters:[],execute:function(){module.exports=i,u=require("../IdConverter.js")}}}),System.register("quotes/precaching/PrecacheSequenceRunners/MetadataSequenceRunner.js",[],function(e,t){function i(e,l,n,u,d){return{executeSequence:function(){var i=function(){if(null==u)return[];var e=l?l+"__":"",t=[],i=e+"QuoteLine__c",n=e+"Quote__c",o=e+"QuoteLineGroup__c",r=e+"QuoteLinePricingGuidance__c";for(var s in u){var a;if("Quote Line Pricing Guidance"===s){if(!d||!d.isPricingGuidanceEnabled)continue;a=r}else a="Quote Line"===s?i:"Group"===s?o:"Quote"===s?n:s;u.hasOwnProperty(s)&&u[s].forEach(function(e){t.push(a+"."+e)})}return t}();return 0==i.length?Promise.resolve():e.md("CustomField",i,l).then(function(e){var t=i.join(",");n({successful:!0,provider:"CustomField",uid:t,results:e})},function(e){self.postMessage({err:!0,sequence:"MetadataSequence",msg:e.msg||e})})}}}return{setters:[],execute:function(){module.exports=i}}}),System.register("quotes/precaching/PrecacheSequenceRunners/OptionSequenceRunner.js",[],function(e,t){function i(t,i,n,r,o){var s=i?i+"__":"";return{executeSequence:function(){var e={requiredIds:function(){var i={},n=[],o=s+"ProductOption__c";return r.lineItems.forEach(function(e){var t=e.record[o];t&&!i[t]&&(i[t]=!0,n.push(t))}),n}(),requiredFields:o||[]};return t.setOptions({escape:!1,timeout:12e4}),t.load(i,"ProductOptionServiceProvider.ProductOptionLoader","AllOptions",e).then(function(e){n({successful:!0,provider:"ProductOptionServiceProvider.ProductOptionLoader",uid:"AllOptions",results:e})},function(e){n({err:!0,sequence:"OptionSequence",msg:e.message||e})})}}}return{setters:[],execute:function(){module.exports=i}}}),System.register("quotes/precaching/PrecacheSequenceRunners/PriceRuleSequenceRunner.js",[],function(e,t){function i(c,h,t,f){return{executeSequence:function(){return c.read(h,"PriceRuleServiceProvider.PriceRuleReader","PriceRules").then(function(e){return t({successful:!0,provider:"PriceRuleServiceProvider.PriceRuleReader",uid:"PriceRules",results:e}),function(e){var t={svIds:function(e){function t(e){e[o]&&u.push(e[o]),e[r]&&u.push(e[r])}function i(e){e[s]&&u.push(e[s])}var n=h?h+"__":"",o=n+"FilterVariable__c",r=n+"TestedVariable__c",s=n+"SourceVariable__c",a=n+"PriceConditions__r",l=n+"PriceActions__r",u=[];0<e.length&&e.forEach(function(e){e[a]&&0<e[a].records.length&&e[a].records.forEach(t),e[l]&&0<e[l].records.length&&e[l].records.forEach(i)});return u}(e)};return c.load(h,"SummaryVariableServiceProvider.SummaryVariableLoader","SummaryVariables",t)}(e)}).then(function(e){return t({successful:!0,provider:"SummaryVariableServiceProvider.SummaryVariableLoader",uid:"SummaryVariables",results:e}),function(e){if(!f)return Promise.resolve([]);var t=h?h+"__":"",i=t+"TargetObject__c",n=t+"FilterField__c",o=t+"ConstraintField__c",r=t+"AggregateField__c",s=[],a=[];for(var l in e)if(e.hasOwnProperty(l)){var u=e[l];"Asset"==u[i]?(null!=u[n]&&s.push(u[n]),null!=u[o]&&s.push(u[o]),null!=u[r]&&s.push(u[r])):"Subscription"==u[i]&&(null!=u[n]&&a.push(u[n]),null!=u[o]&&a.push(u[o]),null!=u[r]&&a.push(u[r]))}var d={accountId:f,assetFields:s,subscriptionFields:a};return c.load(h,"AssetAndSubscriptionServiceProvider.AssetAndSubLoader","AssetsAndSubs",d)}(e)}).then(function(e){t({successful:!0,provider:"AssetAndSubscriptionServiceProvider.AssetAndSubLoader",uid:"AssetsAndSubs",results:e})}).catch(function(e){self.postMessage({err:!0,sequence:"Price Rule Sequence",msg:e.msg||e})})}}}return{setters:[],execute:function(){module.exports=i}}}),System.register("quotes/precaching/PrecacheSequenceRunners/PricingGuidanceSequenceRunner.js",[],function(e,t){function i(i,n,o,r,s,a){return{executeSequence:function(){var e=function(){var i=new Set;r.lineItems&&r.lineItems.forEach(function(e){var t=e.pricingGuidanceId;t&&i.add(t)});return Array.from(i)}();if(e&&0!=e.length){var t={pricingGuidanceIds:e,accountId:s};return i.load(n,"PricingGuidanceServiceProvider",null,t).then(function(e){o({successful:!0,provider:"PricingGuidanceServiceProvider",results:{results:e,account:s,settings:a}})},function(e){self.postMessage({err:!0,sequence:"PricingGuidanceSequence",msg:e.message||e})})}return Promise.resolve()}}}return{setters:[],execute:function(){module.exports=i}}}),System.register("quotes/precaching/PrecacheSequenceRunners/ProductSequenceRunner.js",[],function(e,t){function i(o,r,s,a,l){var u=r?r+"__":"";return{executeSequence:function(){var e=function(){var i={},n=[],o=u+"Product__c";return a.lineItems.forEach(function(e){var t=e.record[o];null!=t&&null==i[t]&&(i[t]=!0,n.push(t))}),n}(),t=[];a.record[u+"PricebookId__c"]&&t.push(a.record[u+"PricebookId__c"]);var i=[];a.record.CurrencyIsoCode&&i.push(a.record.CurrencyIsoCode);var n={requiredIds:e,productFields:l,pricebookFilter:t,currencyFilter:i};return o.setOptions({escape:!1,timeout:12e4}),o.load(r,"ProductServiceProvider.ProductLoader","AllProducts",n).then(function(e){s({successful:!0,provider:"ProductServiceProvider.ProductLoader",uid:"AllProducts",results:e})},function(e){s({err:!0,sequence:"ProductSequence",msg:e.message||e})})}}}return{setters:[],execute:function(){module.exports=i}}}),System.register("quotes/precaching/PrecacheSequenceRunners/RelatedRecordSequenceRunner.js",[],function(e,t){var u;function i(t,i,n,o,r,a){function s(n,e,t,i){if(e&&t&&0<t.length)for(var o in e)if(e.hasOwnProperty(o)){var r=e[o],s=l(r,i);t.forEach(function(e){var t=e.record[o];if(t){var i=u(t);if(!i)return;n.queryInfo[r]?n.queryInfo[r].referencedIds.push(i):n.queryInfo[r]={referencedFields:a[s],referencedIds:[i]}}})}}function l(e,t){switch(""!==t&&(t+="__"),e){case t+"Quote__c":return"Quote";case t+"QuoteLineGroup__c":return"Group";case t+"QuoteLine__c":return"Quote Line";default:return e}}return{executeSequence:function(){var e={queryInfo:{}};return s(e,r.quoteLookups,[o],i),s(e,r.groupLookups,o.lineItemGroups,i),s(e,r.lineLookups,o.lineItems,i),t.load(i,"JSQCLookupFieldServiceProvider.JSQCLookupFieldLoader","AllAdditionalLookups",e).then(function(e){n({successful:!0,provider:"JSQCLookupFieldServiceProvider.JSQCLookupFieldLoader",uid:"AllAdditionalLookups",results:e})},function(e){n({err:!0,sequence:"RelatedRecordSequence",msg:e.message||e})})}}}return{setters:[],execute:function(){module.exports=i,u=require("../IdConverter.js")}}}),System.register("quotes/precaching/PrecacheSequenceRunners/UbpSequenceRunner.js",[],function(e,t){function f(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function i(i,n,o,u,d){var c=n?n+"__":"",h=[],r="ConsumptionServiceProvider.UBPEditorLoader";return{executeSequence:function(){var e=d.isManualEditsForUBPEnabled||!1;if(!d.jsqcPlugin&&!e||!u.lineItems||0===u.lineItems.length)return Promise.resolve();var t=function(){var e=d.ubpReferencedFieldMap,t=e.ConsumptionRate,i=void 0===t?[]:t,n=e.ConsumptionSchedule,o=void 0===n?[]:n,r=new Set([].concat(f(i),f(function(e){return[e+"ProcessingOrder__c",e+"LowerBound__c",e+"UpperBound__c",e+"Price__c"]}(c)))),s=new Set([].concat(f(o),f(function(e){return[e+"Category__c"]}(c)))),a=c+"HasConsumptionSchedule__c",l=new Set;return u.lineItems.forEach(function(e){e.record[a]&&(l.add(e.record.Id),h.push(e))}),0!==h.length?{transactionIds:Array.from(l),scheduleFields:[].concat(f(s)),fields:[].concat(f(r))}:null}();return t?function(e){return i.setOptions({escape:!1,timeout:12e4}),i.load(n,r,null,e).then(function(i){if(!i.transactionIdsToSObjects||!i.transactionIdsToSObjects.ConsumptionSchedules)return Promise.resolve();var n={};h.forEach(function(e){var t=i.transactionIdsToSObjects.ConsumptionSchedules[e.record.Id];t&&(i.transactionIdsToSObjects.ConsumptionRates&&t.forEach(function(e){e.consumptionRates=i.transactionIdsToSObjects.ConsumptionRates[e.Id]}),n[e.record.Id]=t)}),o({successful:!0,provider:r,uid:null,results:n})},function(e){o({err:!0,sequence:"UbpSequence",msg:e.message||e})})}(t):Promise.resolve()}}}return{setters:[],execute:function(){module.exports=i}}}),System.register("quotes/tables/sf-segmented-table/SFSegmentedTable.js",["quotes/sb-line-sort/QuoteLineSort.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/ui-data-manager/UIDataManager.js","quotes/QuoteContext.js","../../layout/template-generator/LETableHeaderTemplateGenerator.js","quotes/tables/QLESegmentedTableBehavior.js","common/Util.js","common/core/AppContext.js","common/core/Events.js"],function(t,e){var l,i,o,r,s,a,u,d,c,h;return{setters:[function(e){l=e.depthFirstLineItemsTreeSort},function(e){i=e.TemplateGenerator},function(e){o=e.UIDataManager},function(e){r=e.QuoteContext},function(e){s=e.LETableHeaderTemplateGenerator},function(e){a=e.QLESegmentedTableBehavior},function(e){u=e.toFieldName},function(e){d=e.AppContext},function(e){c=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFSegmentedTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-segmented-table",this.properties=Polymer.Base.extend({rowTemplate:{type:Object},secondaryRowTemplate:Object,uiData:Object,originalFieldValues:{type:Object,value:{}},expansionIconClass:{type:String}},a.properties),this.listeners={"le-action-tapped":"unfocus"}}},{key:"ready",value:function(){var t=this;this.addEventListener("table-header-sort-clicked",this._onSortLinesByHeader),this.addEventListener("line-toggled",function(e){t.editorModel.largeQuoteExperienceEnabled&&t._onUpdateSizeForItem(e)})}},{key:"_modelReady",value:function(e){e&&!this._initialized&&(this._initialized=!0,this.editorModel.largeQuoteExperienceEnabled&&Polymer.RenderStatus.afterNextRender(this,function(){this.$$("iron-list").fire("iron-resize")}),r.constants=this.editorModel.constants,this._resetHeaderTemplate(),this._prepareUIData(),this.rowTemplate=this.getTemplateGenerator(this.editorModel,e,this.columnNames,this.dimension).generateRowNode(this._getFieldsForTemplate()),this.editorModel.deviceContext.isMobile&&(this.secondaryRowTemplate=this.getTemplateGenerator(this.editorModel,e,null,null,!0).generateRowNode(this._getFields(),{class:i.classNames.SECONDARY+" "+i.classNames.EXPANDED})))}},{key:"_prepareUIData",value:function(){var e=d.isMobile?this._getAllFields():this._getFields();this.uiData=o.prepareLineData(this.groupModel.segmentedLinesByDimension[this.dimension],e,this.quoteLineFields)}},{key:"getUIData",value:function(e){return this.uiData[e]}},{key:"computeCellClass",value:function(e,t){if(this.groupModel.segmentedLines[e]&&this.uiData[e]&&this.uiData[e]._cellClasses)return this.uiData[e]._cellClasses[t]||""}},{key:"_segmentedLinesByDimensionChanged",value:function(e){var t,i=void 0;if(t=0<=(i=e.path.split(".")).indexOf(this.dimension),this.lineModels=this.groupModel.segmentedLinesByDimension[this.dimension],"splices"==i[i.length-1]&&t){var n=e.value.indexSplices;n[0].removed&&0===n[0].object.length?this.hasVisibleSegmentedLines=!1:0<n[0].addedCount&&(this.hasVisibleSegmentedLines=!0),this._prepareUIData()}}},{key:"_render",value:function(){if(this.groupModel){this.toggleClass("largeQuote",this.editorModel.largeQuoteExperienceEnabled,this),this.dimension=this.attributes.key.value,this.hasVisibleSegmentedLines=this.groupModel.hasVisibleSegmentedLines[this.dimension],this.fieldNames=this._getFields(),this.lineModels=this.groupModel.segmentedLinesByDimension[this.dimension],this.linkPaths("groupModel.segmentedLinesByDimension."+this.dimension,"lineModels");var e={};for(var t in this.editorModel.md.fieldLabelsMap)e[u(t)]=this.editorModel.md.fieldLabelsMap[t];this.fieldLabelsMap=e,this.quoteLineFields=this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName],this.settings=this.editorModel.data.settings,this.detailFieldNames=this.editorModel.fieldsetMap.multiSegmentLineFieldNames;var i=this.groupModel.groupVO.multiSegmentColumns;i&&0<Object.keys(i).length?(this.columnNames=i[this.dimension],this.headerColumnNames=this.groupModel.groupVO.localizedMultiSegmentColumns[this.dimension]):(this.columnNames=this.groupModel.quoteModel.quoteVO.multiSegmentColumns[this.dimension],this.headerColumnNames=this.editorModel.quoteModel.quoteVO.localizedMultiSegmentColumns[this.dimension]),this.netMultiSegmentTotalField=this.editorModel.constants.NET_TOTAL_FIELD,this.columnWidths={},this._setColumnWidths(),this.expansionIconClass="sf-icon-right"}}},{key:"_getFieldsForTemplate",value:function(){return this.editorModel.deviceContext.isMobile?this.editorModel.segmentedPrimaryMobileCols:this._getFields()}},{key:"_getFieldSetName",value:function(){return this.editorModel.fieldSetNames.multiSegmentLineSummaryFieldNames}},{key:"sortLines",value:function(e,t,i,n,o){var r=void 0;if(t&&this.settings.lineLookups&&this.settings.lineLookups[t]){var s=RelationshipFieldManager.getRelationshipField(t,this.settings.lineLookups[t]).split(".");r=s[1],t=s[0]}var a=l(e,t,i,n,r);o?(this.unfocus(),this.set("groupModel.segmentedLinesByDimension."+this.dimension,a.slice()),this.notifyPath("lineModels",a.slice()),this._prepareUIData(),this.rowTemplate=this.getTemplateGenerator(this.editorModel,this.groupModel,this.columnNames,this.dimension).generateRowNode(this._getFields())):this.groupModel.segmentedLinesByDimension[this.dimension]=a}},{key:"columnNamesChanged",value:function(e,t){t&&this.editorModel&&this.editorModel.largeQuoteExperienceEnabled&&(this._prepareUIData(),this.rowTemplate=this.getTemplateGenerator(this.editorModel,this.groupModel,this.columnNames,this.dimension).generateRowNode(this._getFields()),this._resetHeaderTemplate())}},{key:"_resetHeaderTemplate",value:function(){if(!this.editorModel.deviceContext.isMobile){var e=new s(this.editorModel,this.columnWidths,this.columnNames);this.headerTemplate=e.generateHeaderNode(this._getFieldsForTemplate())}}},{key:"_getAllFields",value:function(){var e=this._getFields();return this.editorModel.segmentedPrimaryMobileCols&&(e=e.concat(this.editorModel.segmentedPrimaryMobileCols)),[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(new Set(e)))}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.SFAbstractTable,window.CommonBehaviors.QLESegmentedTableBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[c.GROUP_PANEL_CREATED]=this.groupPanelCreated,e[c.GROUP_PANEL_TOGGLED]=this.groupPanelToggled,e[c.GROUP_TOGGLED]=this.groupToggled,e[c.TOGGLE_OPTIONAL_CLICKED]=this.toggleOptional,e[c.OPEN_LOOKUP_DIALOG]=this._openLookupDialog,e[c.CLOSE_LOOKUP_DIALOG]=this._closeLookupDialog,e[c.REFRESH_TABLE]=this._prepareUIData,e[c.RESET_ON_ACTION]=this._resetOnAction,e[c.LINE_SPLICE_COMPLETE]=this.postLineSplice,e[c.SORT_LINES_REQUIRED]=this.sortLinesRequired,e[c.COL_WIDTHS_CHANGED]=this.colWidthsChanged,e[c.VIEWPORT_CHANGED]=this.viewportChanged,e}},{key:"observers",get:function(){return["_modelReady(groupModel)"]}}]),h=e)),t("SFSegmentedTable",h),Polymer(h)}}}),System.register("quotes/tables/sf-standard-table/SFStandardTable.js",["quotes/sb-line-sort/QuoteLineSort.js","quotes/tables/SFAbstractTable.js","quotes/tables/QLEStandardTableBehavior.js","quotes/models/DragDropModel.js","common/layout/table-layout-builder/TableLayoutBuilder.js","common/signal/RowFocusSignaler.js","common/relationship/RelationshipFieldManager.js","common/forms/NumberFormatter.js","quotes/layout/template-generator/LETemplateGenerator.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/ui-data-manager/UIDataManager.js","common/core/AppContext.js","../../layout/template-generator/LETableHeaderTemplateGenerator.js","quotes/models/ClientCache.js","common/core/Events.js"],function(t,e){var l,i,o,u,r,s,a,d,c,h,f,p;return{setters:[function(e){l=e.depthFirstLineItemsTreeSort},function(e){e.SFAbstractTable},function(e){i=e.QLEStandardTableBehavior},function(e){o=e.DragDropModel,e.isComponent,e.ifLineElementsShareParent,e.ifLineElementsAreParentChild,e.removeTableRowBorderClass},function(e){e.TableLayoutBuilder},function(e){e.RowFocusSignaler},function(e){u=e.RelationshipFieldManager},function(e){e.NumberFormatter},function(e){e.LETemplateGenerator},function(e){r=e.TemplateGenerator},function(e){s=e.UIDataManager},function(e){a=e.AppContext},function(e){d=e.LETableHeaderTemplateGenerator},function(e){c=e.get,h=e.put},function(e){f=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}9,147,t("SFStandardTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-standard-table",this.properties=Polymer.Base.extend({headerTemplate:{type:Object},rowTemplate:{type:Object},secondaryRowTemplate:Object,uiData:Object,originalFieldValues:{type:Object,value:{}}},i.properties),this.listeners={"le-action-tapped":"unfocus"}}},{key:"ready",value:function(){if(this.groupModel){this.init();var e=new Set(["sb-droppable-standardRows","sb-droppable-emptyTable","sb-droppable-sidePanelGroups","emptyTableMessage"]);this.editorModel.largeQuoteExperienceEnabled?(this.addEventListener("bundle-toggled",this._toggleBundleLines),this.addEventListener("line-toggled",this._onUpdateSizeForItem),this._resizeIronList()):this.dragDrop=new o(this,this.editorModel.data.settings.bundleKeptTogether,"sf-le-table-row",e,this.dragFunc.bind(this),this.trackFunc.bind(this),this.dropFunc.bind(this),9,147),this._prepareUIData(),this._prepareTemplates(!0)}}},{key:"_prepareUIData",value:function(){var e=a.isMobile?this._getAllFields(!0):this._getFields();this.uiData=s.prepareLineData(this.groupModel.standardLines,e,this.quoteLineFields)}},{key:"_prepareTemplates",value:function(e){if(this.rowTemplate=this.getTemplateGenerator(this.editorModel,this.groupModel,null).generateRowNode(this._getFieldsForTemplate(),{class:"row"}),a.isMobile)this.secondaryRowTemplate=this.getTemplateGenerator(this.editorModel,this.groupModel,null,null,!0).generateRowNode(this._getAllFields(!1),{class:r.classNames.SECONDARY+" "+r.classNames.EXPANDED});else if(e){var t=new d(this.editorModel,this.columnWidths,null,!0);this.headerTemplate=t.generateHeaderNode(this._getFieldsForTemplate(),{class:"header"})}}},{key:"getUIData",value:function(e){return this.uiData[e]}},{key:"computeCellClass",value:function(e,t){if(this.groupModel.standardLines[e]&&this.uiData[e]&&this.uiData[e]._cellClasses)return this.uiData[e]._cellClasses[t]||""}},{key:"_getAllFields",value:function(e){var t=this._getFields();return this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames&&(t=t.concat(this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames)),e&&this.editorModel.standardPrimaryMobileCols&&(t=t.concat(this.editorModel.standardPrimaryMobileCols)),[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(new Set(t)))}},{key:"_getFieldSetName",value:function(){if(this.editorModel&&this.editorModel.fieldSetNames)return this.editorModel.fieldSetNames.lineFieldNames}},{key:"postDrop",value:function(e,t){var i=e.domHost,n=t.domHost;i&&"SF-STANDARD-TABLE"===i.tagName&&i._prepareUIData(),n&&"SF-STANDARD-TABLE"===n.tagName&&i!==n&&n._prepareUIData()}},{key:"_getFieldsForTemplate",value:function(){return this.editorModel.deviceContext.isMobile?this.groupModel.editorModel.standardPrimaryMobileCols:this._getFields()}},{key:"_onSortLinesByHeader",value:function(e){this.sortLines(this.groupModel.standardLines,e.detail.lineSortField,e.detail.order,this.settings.bundleKeptTogether,!0)}},{key:"sortLines",value:function(e,t,i,n,o){var r=void 0;if(t&&this.settings.lineLookups&&this.settings.lineLookups[t]){var s=u.getRelationshipField(t,this.settings.lineLookups[t]).split(".");r=s[1],t=s[0]}this._hasNumberField()&&this._preserveNumberValues(e);var a=l(e,t,i,n,r);o?(this.unfocus(),this.set("groupModel.standardLines",a.slice()),this._prepareUIData(),this._prepareTemplates(!1)):this.groupModel.standardLines=a,this._resizeIronList()}},{key:"_resizeIronList",value:function(){this.editorModel.largeQuoteExperienceEnabled&&Polymer.RenderStatus.afterNextRender(this,function(){this.$$("iron-list")&&this.$$("iron-list").fire("iron-resize")})}},{key:"onRowsRenumbered",value:function(){this._prepareUIData(),this._resizeIronList()}},{key:"_preserveNumberValues",value:function(e){var o=this;e.forEach(function(e){var t=e.lineVO.record,i=t.Id||t[o.editorModel.constants.SOURCE_FIELD],n=o.editorModel.constants.NUMBER_FIELD;o.originalFieldValues[i]||(o.originalFieldValues[i]={}),o.originalFieldValues[i].hasOwnProperty(n)||(o.originalFieldValues[i][n]=t[n])})}},{key:"_hasNumberField",value:function(){return-1<this._getFields().indexOf(this.editorModel.constants.NUMBER_FIELD)}},{key:"postLineSplice",value:function(){this._hasNumberField()&&this._preserveNumberValues(this.groupModel.standardLines),this._prepareTemplates(!1)}},{key:"clearOriginalFieldValues",value:function(){var t=this;this.originalFieldValues&&Object.keys(this.originalFieldValues).forEach(function(e){delete t.originalFieldValues[e]})}},{key:"getRowComponentName",value:function(){return"sf-le-table-row"}},{key:"postBuildRowRefresh",value:function(){this.uiData&&(this._prepareUIData(),this._prepareTemplates(!0))}},{key:"colWidthsChanged",value:function(e){this._isMobile()||(this._setColumnWidths(e),this._prepareTemplates(!1))}},{key:"_toggleBundleLines",value:function(i){var n=this;if(i.detail.key){var e=this.groupModel.standardLines.find(function(e){return e.lineVO.key===i.detail.key});e&&(this._innerToggleBundleLines(e,i.detail.expanded),this._resizeIronList())}else h("BundleCollapsed","h"+this.groupModel.groupVO.key,!i.detail.expanded),this.groupModel.standardLines.forEach(function(e,t){e.isBundle&&n.set("groupModel.standardLines."+t+".bundleCollapsed",!i.detail.expanded)})}},{key:"_innerToggleBundleLines",value:function(e,i){var n=this,t=e&&e.isBundle;if(t){if(i&&e.bundleCollapsed)return;t.forEach(function(e){var t=n._getLineIndexFromKey(n.groupModel.standardLines,e.lineVO.key);n.set("groupModel.standardLines."+t+".bundleVisible",i),n._innerToggleBundleLines(e,i)})}}},{key:"_isLineVisible",value:function(e,t){return e&&t}},{key:"_getHeaderUIData",value:function(e){if(a.isBundleCollapsible(this.editorModel)){var t=c("BundleCollapsed","h"+this.groupModel.groupVO.key)||"Collapsed"===a.defaultBundleSetting?r.classNames.CHEVRON_RIGHT_CONTENT:r.classNames.CHEVRON_DOWN_CONTENT;return Object.assign({_caretContent:t},this.fieldLabelsMap)}return this.fieldLabelsMap}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.SFAbstractTable,window.CommonBehaviors.QLEStandardTableBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[f.GROUP_PANEL_CREATED]=this.groupPanelCreated,e[f.GROUP_PANEL_TOGGLED]=this.groupPanelToggled,e[f.GROUP_TOGGLED]=this.groupToggled,e[f.SORT_LINES_REQUIRED]=this.sortLinesRequired,e[f.TOGGLE_OPTIONAL_CLICKED]=this.toggleOptional,e[f.QUOTE_SAVED]=this.clearOriginalFieldValues,e[f.ROWS_RENUMBERED]=this.onRowsRenumbered,e[f.OPEN_LOOKUP_DIALOG]=this._openLookupDialog,e[f.CLOSE_LOOKUP_DIALOG]=this._closeLookupDialog,e[f.REFRESH_TABLE]=this._prepareUIData,e[f.LINE_SPLICE_COMPLETE]=this.postLineSplice,e[f.COL_WIDTHS_CHANGED]=this.colWidthsChanged,e[f.VIEWPORT_CHANGED]=this.viewportChanged,e}}]),p=e)),t("SFStandardTable",p),Polymer(p)}}}),System.register("quotes/tables/ubp-rate-table/UBPRateTable.js",["common/core/AppContext.js","common/layout/sb-html/Html.js","common/Util.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/layout/template-generator/TableRowTemplateGenerator.js","quotes/models/ClientCache.js","quotes/models/DataHandlerBehavior.js","quotes/usage-based-pricing-dao/UsageBasedPricingDao.js","quotes/QuoteContext.js","quotes/consumption-rate-validator/ConsumptionRateValidator.js","quotes/tables/SFAbstractTable.js","common/core/Events.js"],function(t,e){var o,i,s,l,a,u,r,h,f,d,c,p,v,g,y,m,b,_,C,S;return{setters:[function(e){o=e.localizeContent,y=e.AppContext},function(e){i=e.Html},function(e){s=e.pathGet,l=e.pathMutate,a=e.Util},function(e){u=e.TemplateGenerator},function(e){r=e.TableRowTemplateGenerator},function(e){h=e.get,f=e.put},function(e){d=e.DataHandlerBehavior},function(e){c=e.loadRates,e.search,p=e.overrideRecValues},function(e){v=e.QuoteContext},function(e){g=e.ConsumptionRateValidator},function(e){e.SFAbstractTable},function(e){m=e.Events,b=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},C=["Description","ConsumptionSchedule.Description"],t("UBPRateTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="ubp-rate-table",this.properties={clientCacheSearchInput:{type:String,observing:{id:"UBPClientState",path:["searchKeyword"]}},userSearchInput:{type:String,value:null},rowTemplate:{type:Object,computed:"_getRowTemplate(fields)"},categoryId:{type:String,observer:"_categoryIdChanged"},rateIds:{type:Object,observing:{idProperty:"categoryId",path:["orderedRates"]},observer:"_rateIdsChanged"},fields:{type:Object,observing:{idProperty:"categoryId",path:["fields"]}},totalRateCount:{type:Number,observing:{idProperty:"categoryId",path:["rateCount"]},value:0},sortField:{type:String,observing:{idProperty:"categoryId",path:["sortField"]}},sortOrder:{type:String,observing:{idProperty:"categoryId",path:["sortOrder"]}},quoteLineOrProdId:{type:String,observing:{id:"UBPClientState",path:["quoteLineOrProdId"]}},lineKey:{type:Number,observing:{id:"UBPClientState",path:["lineKey"]}},hasInlineEditChanges:{type:Boolean,value:!1},inlineEditedCategories:{type:Array,observing:{id:"UbpInlineEditChanges",path:["categories"]}},lineModel:Object},this.listeners={"table-header-sort-clicked":"_onSort","rate-row-rendered":"_resizeIronList","toggle-tooltip":"_toggleTooltip","iron-resize":"_checkThreshold","inline-edit-commit":"_inlineEditCommitted"}}},{key:"_categoryIdChanged",value:function(e,t){void 0===e&&t&&(this.rateIds=[],this.totalRateCount=0,this.fields=[]),this.hasInlineEditChanges=this.inlineEditedCategories&&-1<this.inlineEditedCategories.indexOf(this.categoryId)}},{key:"_toggleTooltip",value:function(e){for(var t=this.querySelector(".rateCardPreview");t.firstChild;)t.removeChild(t.firstChild);e.detail.show?(t._target=e.detail.target,t.appendChild(e.detail.content),t.updatePosition(),t.show()):t.hide()}},{key:"_checkThreshold",value:function(){this.rateIds&&this.rateIds.length!=this.totalRateCount&&this._previousRenderLength!==this.rateIds.length&&(this._previousRenderLength=this.rateIds.length,this.$.threshold.clearTriggers(),this.$.threshold.checkScrollThresholds())}},{key:"_resizeIronList",value:function(){this.$$("iron-list").fire("iron-resize")}},{key:"_rateIdsChanged",value:function(e){var t=this.$.ironList._scrollPosition;this.$.ironList.items=e,this.$.ironList._resetScrollPosition(t)}},{key:"_getSortLabel",value:function(t,e){if(t&&e){var i=e.find(function(e){return e.fieldPath===t});return i?i.label:t===v.constants.UBP_FIELDS.ConsumptionSchedule+".Name"?o("Consumption Schedule Name"):""}return""}},{key:"_onSort",value:function(e){var t=e.detail,i=t.lineSortField,n=t.order;f(this.categoryId,[],_({},h(this.categoryId,[]),{sortField:i,sortOrder:n})),this._loadRates(0)}},{key:"_getFieldLabels",value:function(e){var t={},i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;l(t,a.fieldPath.split("."),a.label)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"_getFieldOptions",value:function(e){var t=this._getWidthParameters(this._getFieldsFromMetadata(e));return t.isSortable=function(t){return t&&C.every(function(e){return e!==t})},t}},{key:"_getWidthParameters",value:function(e){return{columnWidths:this._calcColumnWidths(e),columnWidthUnit:"%"}}},{key:"_getFieldsFromMetadata",value:function(e){return e.map(function(e){return e.fieldPath})}},{key:"_calcColumnWidths",value:function(t){var i={};return 0<t.length&&t.forEach(function(e){i[e]=Math.floor(100/t.length)}),i}},{key:"_getRowTemplate",value:function(e){var t=this._getFieldsFromMetadata(e),i=this._getWidthParameters(t);return i.attributes="class$=\"container sf-ubp-table-cell td focusable ubp-rate-row {{computeCellClasses(rateId, '$field', unsavedEdits)}}\"",new r(e,i).generateRowNode(t)}},{key:"_search",value:function(){var e=this.userSearchInput?i.sanitizeHtmlText(this.userSearchInput):null;return f("UBPClientState",["searchKeyword"],e),this._loadRates(0)}},{key:"_clear",value:function(){this.set("userSearchInput",""),this._search()}},{key:"_onKeyPress",value:function(e){13!=e.keyCode||this._shouldDisableSearch(this.userSearchInput)||(this._search(),this.$.searchRateInput.blur())}},{key:"_getSearchPlaceholder",value:function(){return o("Search Consumption Schedule Name")}},{key:"_loadMore",value:function(){this._loadRates(this.rateIds?this.rateIds.length:0)}},{key:"_loadRates",value:function(e){c(e)}},{key:"_updateHeaderStateObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.updateHeaderState(e,t)}},{key:"updateHeaderState",value:function(e,t){this.$.tableHeader.setSort(e,t)}},{key:"_noSearchResults",value:function(e){return 0===e}},{key:"_shouldDisableSearch",value:function(e){return!!e&&!/(.*[^*?)( ]){2,}.*/g.test(e)}},{key:"_shouldShowSortMessage",value:function(e,t){return""!==e&&0<t}},{key:"_shouldShowSearchAppliesMessage",value:function(e){return!e}},{key:"_getSortMessage",value:function(e,t,i){return o("Items_Sorted_by",[e,this._getSortLabel(t,i)])}},{key:"clearSearch",value:function(){this.userSearchInput=null,f("UBPClientState",["searchKeyword"],null)}},{key:"computeCellClasses",value:function(e,t,i){var n="";if(i&&i.hasOwnProperty(t)){var o=h(e,["record"]),r=h(this.appliedChangeKey,["rates"]);r&&r[e]&&(o=p(o,r[e],[{fieldPath:t}])),n=a.deepEquals(i[t],s(o,t.split(".")))?"":"dirty "}return y.isManualEditsForUBPEnabled&&(n+=v.isUbpFieldInlineEditable(t,h("ConsumptionRateMetadata",["rateEditable"]))?u.classNames.EDITABLE:""),n}},{key:"normalizeAndMergeUnsavedChanges",value:function(e,n){var o=this,r={};return e.forEach(function(e){var t=e.Id,i=e.consumptionRates;r[t]=i.map(function(e){return p(e,n[e.Id],o.fields)})}),r}},{key:"_onUpdate",value:function(){this.fire("calculate-immediately",{callback:this._updateAfterCalculate.bind(this)})}},{key:"_updateAfterCalculate",value:function(e){var i=this;h(this.appliedChangeKey)||f(this.appliedChangeKey,[],{rates:{}});var n=this._getUnsavedUbpChanges(e),o=h("UbpInlineEditChanges",["rates"])||{},r=h(this.appliedChangeKey,["rates"]),t=this._getSavedSchedulesAndRates(),s=[],a={};t.forEach(function(e){e.consumptionRates.forEach(function(e){s.push(e.Id)})}),s.forEach(function(e){if(o[e]||n[e]||r[e]){var t=p(r[e]||{},o[e],i.fields);a[e]=p(t,n[e],i.fields)}});var l=this.normalizeAndMergeUnsavedChanges(t,a),u=h("ubpLabels",["labels"]),d=this._validateRates(l,u),c=0===d.length;c?(Object.keys(a).forEach(function(e){f(i.appliedChangeKey,["rates",e],a[e])}),this._onCancel()):this._overrideConflictingInlineEdits(s,n,o),f("UBPClientState",["successMsg"],c?[u.msg_changes_applied]:null),f("UBPClientState",["errorMsg"],c?null:[d[0].errorMsg])}},{key:"_overrideConflictingInlineEdits",value:function(e,n,o){e.forEach(function(t){if(n[t]&&o[t]){var i=!1;Object.keys(n[t]).forEach(function(e){"Id"!==e&&"attributes"!==e&&o[t][e]&&(delete o[t][e],i=!0)}),i&&b(m.UBP_ROW_REFRESH,{id:t})}})}},{key:"_getUnsavedUbpChanges",value:function(e){var t=this,i=h("UnsavedUbpChanges",["rates"]);if(i)return i;if(e&&e.lineItems){var n=e.lineItems.find(function(e){return(e.record.Id===t.quoteLineOrProdId||e.record[v.constants.PRODUCT]===t.quoteLineOrProdId)&&e.key===t.lineKey});if(n&&n.ubpChanges)return i=n.ubpChanges,f("UnsavedUbpChanges",[],i),i.rates}return{}}},{key:"_validateRates",value:function(e,t){return g(e,v.constants,t)}},{key:"_getSavedSchedulesAndRates",value:function(){var i=this,e=new window.SB.usageBasedPricingDAO(v.constants.prefix,null,null).getFromCache(this.quoteLineOrProdId)||[],t=h(this.categoryId,["name"]),n=e.filter(function(e){return e[v.constants.prefix+"Category__c"]===t||e[v.constants.prefix+"Category__c"]===""+v.constants.prefix+t});return y.org.isMultiCurrencyOrg&&function(){for(var t=h(i.quoteLineOrProdId,["record","CurrencyIsoCode"]),e=0;e<n.length;e++)n[e].consumptionRates=n[e].consumptionRates.filter(function(e){return e.CurrencyIsoCode===t})}(),n}},{key:"_onCancel",value:function(){var i=this;if(this.inlineEditedCategories){var e=this.inlineEditedCategories.indexOf(this.categoryId);if(-1<e){var n=h("UbpInlineEditChanges",["rates"]);n&&Object.keys(n).forEach(function(e){var t=h(e,["record",v.constants.prefix+"QuoteLineConsumptionSchedule__r",v.constants.prefix+"Category__c"]);t&&i.quoteLineOrProdId+"_"+t===i.categoryId&&delete n[e]}),this.splice("inlineEditedCategories",e,1),this.hasInlineEditChanges=!1}}}},{key:"_shouldShowManualEditButtons",value:function(){return y.isManualEditsForUBPEnabled&&this.hasInlineEditChanges}},{key:"_inlineEditCommitted",value:function(){this.hasInlineEditChanges=!0,-1===this.inlineEditedCategories.indexOf(this.categoryId)&&this.inlineEditedCategories.push(this.categoryId)}},{key:"getCellClass",value:function(){return"sf-ubp-table-cell"}},{key:"getZIndex",value:function(e){return this.totalRateCount+10-e}},{key:"_rowHasParentDiv",value:function(){return!0}},{key:"discardUnappliedChanges",value:function(){f("UbpInlineEditChanges",["categories"],[]),f("UbpInlineEditChanges",["rates"],{}),this.hasInlineEditChanges=!1}},{key:"behaviors",get:function(){return[d,window.CommonBehaviors.TemplatizationBehavior,Polymer.IronResizableBehavior,window.CommonBehaviors.SFAbstractTable]}},{key:"observers",get:function(){return["_updateHeaderStateObserver(sortField, sortOrder)"]}},{key:"appliedChangeKey",get:function(){return"AppliedUbpChanges_"+this.quoteLineOrProdId+"_"+this.lineKey}}]),S=e)),t("UBPRateTable",S),Polymer(S)}}}),System.register("assets/selection/routes/sb-asset-lookup/AssetLookup.js",["common/core/Page.js","common/filter/searcher/Searcher.js","common/data/format/ErrorFormatter.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.Page},function(e){o=e.Searcher},function(e){r=e.formatError}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("AssetLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),s(e,[{key:"beforeRegister",value:function(){this.is="sb-asset-lookup",this.properties=Polymer.Base.extend({selectedProducts:{type:Object,value:{}},lineEditorModel:Object,totalCount:String,hasTotalCount:Boolean,quote:Object,errors:{type:Array,value:[],notify:!0},error:{type:Array,value:[]},groupKey:{type:String,computed:"getGroupKey(ctx.params)"}},i.properties)}},{key:"ready",value:function(){this.preLoadObjects()}},{key:"handleProductsLoadServerResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.$.smLoadService.quote=this.quote=e.detail.value.quote}.bind(this)),this.$.smLoadService.addEventListener("search-model-changed",function(e){this.searchModel=e.detail.value,this.primaryMobileColumn=this.searchModel.resultFieldNames[0],this.searcher=new o(this.searchModel),this.hasTotalCount=0<this.searchModel.totalCount,this.totalCount=this.searchModel.totalCount}.bind(this))}},{key:"toggleFilter",value:function(){this.$$("sb-page-header")._closeMenu(),this.$.drawer.togglePanel()}},{key:"closeDrawer",value:function(){this.refocus(),this.$.drawer.closeDrawer()}},{key:"refocus",value:function(){this.$.af.focusFirstField()}},{key:"removeFilter",value:function(){this.$$(".actions").removeChild(this.$$("#fb"))}},{key:"deSelectAll",value:function(){this.$.lookupLayout.deSelectAll()}},{key:"onSelect",value:function(){if(this.selectedProducts&&0<Object.keys(this.selectedProducts).length)return this.navigateToAssetUpgradeRoute();this.onCancel()}},{key:"navigateToAssetUpgradeRoute",value:function(){var e={qId:this.lineEditorModel.quote.record.Id,pIds:Object.keys(this.selectedProducts)};return 0<Object.keys(this.selectedProducts).length&&(e.jspr=!0),void 0!==this.groupKey&&(e.groupKey=this.groupKey),this.nav("#",e,["asset","upgrade"],!1)}},{key:"onCancel",value:function(){this.spinner=!0;var e={qId:this.lineEditorModel.quote.record.Id};null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),this.nav("#",e,["quote","le"],!1)}},{key:"runSearcher",value:function(){this.$$("#submit").focus(),this.$.af.runService(),this.closeDrawer()}},{key:"bindFilterEnterCallBacks",value:function(){this.$.af.enterCallback=this.runSearcher.bind(this)}},{key:"clearFilterFields",value:function(){this.filterData=this.searcher.clearFields()}},{key:"preLoadObjects",value:function(){this.assetLookupObjects=["Asset"]}},{key:"getGroupKey",value:function(){if(void 0!==this.ctx.params)return this.ctx.params.groupKey}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.error=r(this.errors))}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.LookupBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}}]),a=e)),t("AssetLookup",a),Polymer(a)}}}),System.register("assets/upgrade/routes/sb-asset-upgrade/AssetUpgrade.js",["common/layout/tables/TableClassBuilder.js","common/layout/data/RecordGrouper.js","common/core/Page.js","common/data/format/ErrorFormatter.js"],function(t,e){var l,i,o,r;return{setters:[function(e){l=e.TableClassBuilder},function(e){e.RecordGrouper},function(e){i=e.Page},function(e){o=e.formatError}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("AssetUpgrade",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-asset-upgrade",this.properties=Polymer.Base.extend({upgrades:Array,upgradeSourceMap:Object,upgradeTargetMap:Object,errors:{type:Array,value:[],notify:!0},validationMessages:{type:Array,value:[]},assetHeaderSelectable:{type:Boolean,value:!1}},i.properties)}},{key:"ready",value:function(){this.initializeServiceSpinners(),this.initializeProperties(),this.preLoadObjects(),this.handleUpgradeSelected(),this.handleMetaDataResponse(),this.handleAddProductResponse(),this.handleLineEditorModelResponse(),this.handleSelectionResponse()}},{key:"initializeProperties",value:function(){this.upgradeSourceMap={},this.upgradeTargetMap={}}},{key:"initializeServiceSpinners",value:function(){this.$.addProducts.background=!1,this.$.smSelectService.background=!1}},{key:"onSelect",value:function(){var e=this.getSelectedUpgrades();!1!==e&&(this.$.addProducts.products=e)}},{key:"navigateToLineEditor",value:function(){var e=this.lineEditorModel?this.lineEditorModel.quote.record.Id:this.ctx.params.qId;this.nav("#",{qId:e},["quote","le"],!1)}},{key:"_renderUpgradesObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.renderUpgrades(e,t)}},{key:"renderUpgrades",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.upgrades[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;this.upgradeSourceMap[r.record.Product2Id]=this.upgradeSourceMap[r.record.Product2Id]||[],this.upgradeSourceMap[r.record.Product2Id].push({upgradeSelected:!1,Id:r.record.Id,name:r.record.Name}),r._transient_=r._transient_||{},r._transient_.index=this.upgradeSourceMap[r.record.Product2Id].length-1;var s=!0,a=!1,l=void 0;try{for(var u,d=r.availableUpgrades[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var c=u.value;this.setUpgradeTargetMap(r,c)}}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}this.upgradeResults=this.upgrades}},{key:"setUpgradeTargetMap",value:function(e,t){var i=e.record.Product2Id;this.upgradeTargetMap[t.record.Id]=this.upgradeTargetMap[t.record.Id]||{},this.upgradeTargetMap[t.record.Id][i]=this.upgradeTargetMap[t.record.Id][i]||[],this.upgradeTargetMap[t.record.Id][i].push({upgradeSelected:!1})}},{key:"getUpgrades",value:function(){void 0===this.ctx.params.pIds&&this.navigateToLineEditor(),this.$.smSelectService.selectedProducts=this.ctx.params.pIds.split(",")}},{key:"getSelectedProducts",value:function(){var e=this.getSelectedUpgrades(),t={},i=!0,n=!1,o=void 0;try{for(var r,s=(e||[])[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t[a.record.Id]={record:a.record,upgradedAssetId:a.upgradedAssetId}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"applyUpgrades",value:function(){var e=this.$.upgrades.getUpgrades();!1!==e&&(this.$.addProducts.products=e)}},{key:"getSelectedUpgrades",value:function(){var e=[],t=[],i=!0,n=!1,o=void 0;try{for(var r,s=this.upgrades[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=a._transient_.index,u=!0,d=!1,c=void 0;try{for(var h,f=a.availableUpgrades[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value.record.Id,v=a.record.Product2Id,g=this.upgradeTargetMap[p][v][l],y=this.upgradeSourceMap[v][l];!0!==y.upgradeSelected&&(y.upgradeSelected=g.upgradeSelected,y.upgrade=g.rowData,y.index=l)}}catch(e){d=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw c}}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}for(var m in this.upgradeSourceMap){var b=!0,_=!1,C=void 0;try{for(var S,k=this.upgradeSourceMap[m][Symbol.iterator]();!(b=(S=k.next()).done);b=!0){var O=S.value;!1!==O.upgradeSelected?e.push({record:O.upgrade,upgradedAssetId:O.Id,index:O.index}):t.push("You must select an upgrade for "+O.name)}}catch(e){_=!0,C=e}finally{try{!b&&k.return&&k.return()}finally{if(_)throw C}}}if(!(0<(this.validationMessages=t).length))return e}},{key:"handleUpgradeSelected",value:function(){this.addEventListener("selection-changed",function(e){this.ifRadioSelectedClearOtherRadioSelections(e);var t=e.detail.selected,i=e.detail.rowData._transient_.sourceProduct,n=this.upgradeTargetMap[e.detail.rowData.Id][i][e.detail.index];n.upgradeSelected=t,n.rowData=!0===t?e.detail.rowData:void 0}.bind(this))}},{key:"handleMetaDataResponse",value:function(){this.$.md.addEventListener("md-changed",function(e){var i=[],n=[],o={},r={},s={},a={};e.detail.value.fields.forEach(function(e){var t=e.name;i.push(t),n.push(e.label),o[t]=e.label,r[t]=e,s[e.label.replace(/\W/g,"")]=e.type,a[t]=e.type}.bind(this)),this.headerClassMap=new l(Object.keys(s),"Th",s,null,!0).build(),this.rowClassMap=new l(i,"Td",a).build(),this.mdMap=r,this.recordKeys=i,this.fieldLabels=n,this.fieldLabelMap=o}.bind(this))}},{key:"handleAddProductResponse",value:function(){this.$.addProducts.addEventListener("psm-response-changed",function(e){void 0!==e.detail.value.quote&&(this.lineEditorModel.quote=e.detail.value.quote,void 0!==e.detail.value.configuredProducts&&0<e.detail.value.configuredProducts.length?this.handleConfigurableProducts(e):this.navigateToLineEditor())}.bind(this))}},{key:"handleConfigurableProducts",value:function(e){var t=e.detail.value,i={},n=this.getConfigProductIds(t);i.qId=e.detail.value.quote.record.Id,void 0!==this.ctx.params.groupKey&&(i.groupKey=this.ctx.params.groupKey),i.pId=n,t.selectedProducts=this.getSelectedProducts(),this.nav("#",i,["product","pc"],!1)}},{key:"getConfigProductIds",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e.configuredProducts[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.record.Id)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t.join(",")}},{key:"handleLineEditorModelResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.$.addProducts.stripLinesThreshold=this.lineEditorModel.settings.largeQuoteThreshold,this.$.addProducts.stripLinesMessage=this.lineEditorModel.customLabels.msg_large_quote_sent_without_lines,this.$.addProducts.quote=this.$.smSelectService.quote=this.quote=e.detail.value.quote}.bind(this))}},{key:"handleSelectionResponse",value:function(){this.$.smSelectService.useCache=!1,this.$.smSelectService.addEventListener("result-changed",function(e){if(void 0===e.detail.value[0]||!1===Array.isArray(e.detail.value[0].availableUpgrades))return this.navigateToLineEditor();this.upgrades=e.detail.value}.bind(this))}},{key:"preLoadObjects",value:function(){this.assetUpgradeObjects=["Product2"]}},{key:"ifRadioSelectedClearOtherRadioSelections",value:function(e){if(!1!==e.detail.selected&&void 0!==e.detail.selected){var t=Polymer.dom(e).rootTarget,i=Polymer.dom(t.parentElement).querySelectorAll("sb-table-row"),n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;"radio"===l.selectionType&&l!==t&&(l.selected=!1)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.validationMessages=o(this.errors))}},{key:"buildRowDataArray",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=(e.availableUpgrades||[])[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;a.record._transient_=a.record._transient_||{},Object.assign(a.record._transient_,{sourceProduct:e.record.Product2Id,sourceProductIndex:e._transient_.index}),t.push(a)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_renderUpgradesObserver(upgrades, recordKeys)","getUpgrades(ctx.params.pIds)"]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}},{key:"fieldPrefix",get:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}}]),r=e)),t("AssetUpgrade",r),Polymer(r)}}}),System.register("common/forms/sb-checkbox/factory/CheckboxFactory.js",["common/forms/sb-field/factory/FormField.js"],function(e,t){var r;return{setters:[function(e){r=e.FormField}],execute:function(){e("checkboxFactory",function(e,t,i,n){var o=new r("sb-checkbox");return o.addAttribute("value",2,"value",e),o.addAttribute("disabled",1,"disabled",t),o.addAttribute("hide",1,"hide",i),o.addAttribute("tab-index",1,"tabIndex",n),o.formattedValue={value:e,label:""},o})}}}),System.register("common/forms/sb-datepicker/factory/DatePickerFactory.js",["common/forms/sb-field/factory/SimpleFieldFactory.js","common/core/sb-page-container/PageContainer.js","common/forms/sb-input/factory/InputFactory.js","common/forms/sb-field/factory/FormField.js"],function(e,t){var l,u,d,c;function h(e,t){return t.format(e,{date:!0})}function f(e,t,i){t.formattedValue={value:e,label:i}}return{setters:[function(e){l=e.simpleFieldFactory},function(e){u=e.PageContainer},function(e){d=e.inputFactory},function(e){c=e.FormField}],execute:function(){e("datePickerFactory",function(e,t,i,n,o,r){var s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:{range:!1},a=7<arguments.length&&void 0!==arguments[7]?arguments[7]:u;return t?a.isMobile()?function(e,t,i,n){return d(e,t,i,"dateInput",n)}(e,t,i,r):!0===s.range?function(e,t,i){var n=new c("sb-daterange");null===e&&(e="");var o=void 0!==e.start,r=void 0!==e.end;return n.addAttribute("formatted-value",2,"value",{start:o?e.start:e,end:r?e.end:e}),n.addAttribute("disabled",1,"disabled",t),n.addAttribute("use-mask",1,"useMask",!i),n.readOnlyKeyEvent="sb-date-esc",n.readOnlyBlurEvent="sb-date-blur",n.changeEvent="selected-date-range-changed",n}(e,i,o):function(e,t,i){var n=new c("sb-datepicker");return n.addAttribute("selected-date",2,"value",e),n.addAttribute("disabled",1,"disabled",t),n.readOnlyKeyEvent="sb-date-esc",n.readOnlyBlurEvent="sb-date-blur",n.changeEvent="selected-date-changed",f(e,n,h(e,i)),n}(e,i,n):function(e,t){var i=h(e,t),n=l(i);return f(e,n,i),n}(e,n)})}}}),System.register("common/forms/sb-discount/factory/DiscountFactory.js",["common/forms/sb-field/factory/FormField.js","quotes/layout/sb-le-table-cell/DiscountConverter.js"],function(e,t){var v,g,y,m;function b(e,t,i){if(!e||function(e){return null==e||""===e||isNaN(e)}(i))return{label:"",value:""};var n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(l.value===t)return{label:l.label,value:l.value}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}return{setters:[function(e){v=e.FormField},function(e){g=e.getUnitAndDisplayValue,y=e.setDiscountValue,m=e.updateUnitIfAmountInactive}],execute:function(){e("discountFactory",function(e,t,i,n,o,r,s){m(e,s);var a=g(e,s),l=a.units,u=a.unit,d=a.displayValue;y(e,s,d);var c=e.lineVO.record[e.constants.ADDITIONAL_DISCOUNT_FIELD],h=new v("sb-discount");h.addAttribute("model",1,"model",e),h.addAttribute("property",1,"property",s),h.addAttribute("disabled",1,"disabled",t),h.addAttribute("render-read-only",1,"renderReadOnly",i),h.addAttribute("input-type",1,"inputType",n),h.addAttribute("pattern",1,"pattern",o),h.addAttribute("formatter",1,"formatter",r),h.readOnlyBlurEvent="sb-discount-blur",h.changeEvent="sb-discount-change",h.readOnlyKeyDownEvent="sb-discount-keydown";var f=r.format(d),p=b(l,u,c);return u=null!=f&&""!==f?p.label:"",h.formattedValue={value:c,label:f,unit:u,unitValue:p.value},h.addAttribute("display-value",1,"displayValue",f),h.addAttribute("original",1,"original",h.formattedValue),h})}}}),System.register("common/forms/sb-field/factory/EncryptedFieldFactory.js",["common/forms/sb-field/factory/SimpleFieldFactory.js","common/core/AppContext.js"],function(e,t){var r,a;return{setters:[function(e){r=e.simpleFieldFactory},function(e){a=e.AppContext}],execute:function(){function o(e,t){if(a.viewEncryptedDataEnabled)return e;if(null==e)return e;if(!t)return"*********";var i=t.mask,n=t.maskType;if(!i||!n)return e;var o="",r="";switch(e=e.toString(),n){case"sin":o="XXX-XXX-XXX".replace(/X/g,i),r=3<e.length?e.substring(e.length-3):e;break;case"ssn":o="XXX-XX-XXXX".replace(/X/g,i),r=4<e.length?e.substring(e.length-4):e;break;case"lastFour":if(4<e.length){var s=e.substring(e.length-4);return e.replace(e,i.repeat(e.length-4)).concat(s)}return e;case"nino":return"XX XX XX XX X";case"creditCard":o="XXXX-XXXX-XXXX-XXXX".replace(/X/g,i),r=4<e.length?e.substring(e.length-4):e;break;case"all":return e.replace(e,i.repeat(e.length))}return o.substring(0,o.length-r.length).concat(r)}e("encryptedFieldFactory",function(e,t){var i=o(e,t),n=r(i);return n.formattedValue=i,n}),e("formatEncryptedString",o)}}}),System.register("common/forms/sb-field/factory/FieldFactory.js",["common/forms/sb-checkbox/factory/CheckboxFactory.js","common/forms/sb-datepicker/factory/DatePickerFactory.js","common/forms/sb-field/factory/NumericFieldFactory.js","common/forms/sb-field/factory/SimpleFieldFactory.js","common/forms/sb-lookup/factory/LookupFactory.js","common/forms/sb-select/factory/SelectFactory.js","common/forms/sb-field/factory/TextFieldFactory.js","common/forms/sb-field/factory/EncryptedFieldFactory.js"],function(e,t){var p,v,g,y,m,b,_,C;return{setters:[function(e){p=e.checkboxFactory},function(e){v=e.datePickerFactory},function(e){g=e.numericFieldFactory},function(e){y=e.simpleFieldFactory},function(e){m=e.lookupFactory},function(e){b=e.selectFactory},function(e){_=e.textFieldFactory},function(e){C=e.encryptedFieldFactory}],execute:function(){e("fieldFactory",function(e,t,i,n,o,r,s,a,l,u,d,c,h,f){switch(e){case"boolean":case"checkbox":return p(i,o,r,h);case"date":case"datetime":return v(i,n,o,l,u,e,f);case"discount":case"double":case"number":case"currency":case"percent":return g(t,i,n,o,a,l,u,0==s?"first numberInput":"numberInput",e);case"id":case"reference":return m(i,n,o,a,c,u);case"picklist":case"multipicklist":return b(i,n,o,e,a,l,!u,d);case"string":case"textarea":case"phone":case"url":case"email":return _(i,n,o,a,u,e);case"time":return _(l.formatTime(i),n,o,a,u,e);case"encryptedstring":return C(i,a);default:return y(i)}})}}}),System.register("common/forms/sb-field/factory/FormField.js",[],function(e,t){var l,u,i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.attributes=[],this.events=[]}l={0:"",1:"[[",2:"{{"},u={0:"",1:"]]",2:"}}"},e("FormField",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"addAttribute",value:function(e,t,i,n,o){this.attributes.push({name:e,binding:t,variable:i,value:n,equals:o||"="})}},{key:"addEvent",value:function(e,t,i){this.events.push({event:e,variable:t,handler:i})}},{key:"setInnerText",value:function(e,t,i){this.innerText={variable:e,binding:t,value:i}}},{key:"attachTo",value:function(t,e,i,n,o,r,s){var a=this;this._html="<"+this.name,this.attributes.forEach(function(e){a._html+=" "+e.name+e.equals+'"'+l[e.binding]+e.variable+u[e.binding]+'"',t[e.variable]=e.value}),this.events.forEach(function(e){a._html+=" on-"+e.event+'="'+e.variable+'"',t[e.variable]=e.handler}),e&&(this._html+=" on-"+this.readOnlyKeyEvent+'="'+e+'"'),i&&(this._html+=" on-"+this.readOnlyKeyDownEvent+'="'+i+'"'),n&&(this._html+=" on-"+this.readOnlyBlurEvent+'="'+n+'"'),o&&(this._html+=" on-"+this.changeEvent+'="'+o+'"'),r&&(this._html+=' hidden$="[['+r+']]"'),s&&(this._html+=' focus-on-attached="true"'),this._html+=' apply-focus="[[applyFocus]]"',this._html+=">",this.innerText&&(this._html+=""+l[this.innerText.binding]+this.innerText.variable+u[this.innerText.binding],t[this.innerText.variable]=this.innerText.value),this._html+="</"+this.name+">"}},{key:"formattedValue",get:function(){return this._formattedValue},set:function(e){this._formattedValue=null!=e&&-1!==Object.keys(e).indexOf("label")?e:{value:e,label:e}}},{key:"defaultValue",get:function(){return this._defaultValue},set:function(e){this._defaultValue=e}},{key:"readOnlyKeyEvent",get:function(){return this._readOnlyKeyEvent||"keyup"},set:function(e){this._readOnlyKeyEvent=e}},{key:"readOnlyKeyDownEvent",get:function(){return this._readOnlyKeyDownEvent||"keydown"},set:function(e){this._readOnlyKeyDownEvent=e}},{key:"readOnlyBlurEvent",get:function(){return this._readOnlyBlurEvent||"blur"},set:function(e){this._readOnlyBlurEvent=e}},{key:"changeEvent",get:function(){return this._changeEvent||"change"},set:function(e){this._changeEvent=e}},{key:"numeric",get:function(){return!!this._numeric},set:function(e){this._numeric=e}},{key:"html",get:function(){return this._html}}]),i=t)),e("FormField",i)}}}),System.register("common/forms/sb-field/factory/NumericFieldFactory.js",["common/forms/sb-discount/factory/DiscountFactory.js","common/forms/sb-input/factory/InputFactory.js","common/forms/NumberFormatter.js","common/core/sb-page-container/PageContainer.js","common/forms/Locale.js"],function(e,t){var g,y,m,b,_;return{setters:[function(e){g=e.discountFactory},function(e){y=e.inputFactory},function(e){m=e.NumberFormatter},function(e){b=e.PageContainer},function(e){_=e.Locale}],execute:function(){e("numericFieldFactory",function(e,t,i,n,o,r,s,a,l){var u=9<arguments.length&&void 0!==arguments[9]?arguments[9]:b,d=u.isMobile()&&!_.isCommaDecimal()?"number":"text",c=new m(i,o,r,l,u.getViewport());if(e&&(e.constants.ADDITIONAL_DISCOUNT_FIELD===o.name||e.constants.MARKUP_FIELD===o.name)){var h=g(e,n,s,d,null,c,o.name);return h.numeric=!0,h}var f=c.format(t,!0),p=i?c.format(t,!1):f,v=y(p,i,n,a,d,s);return v.formattedValue={value:t,label:f},v.numeric=!0,v})}}}),System.register("common/forms/sb-field/factory/SimpleFieldFactory.js",["common/forms/sb-field/factory/FormField.js"],function(e,t){var n;return{setters:[function(e){n=e.FormField}],execute:function(){e("simpleFieldFactory",function(e,t){var i=new n("sb-div");return i.addAttribute("value",1,"value",e),t&&i.addAttribute("class",1,"fieldClass",t,"$="),i})}}}),System.register("common/forms/sb-field/factory/TextFieldFactory.js",["common/forms/sb-textarea/factory/TextareaFactory.js","common/forms/sb-input/factory/InputFactory.js","common/forms/sb-rte/factory/RichTextEditorFactory.js","common/Util.js"],function(e,t){var a,l,u,d;return{setters:[function(e){a=e.textareaFactory},function(e){l=e.inputFactory},function(e){u=e.richTextEditorFactory},function(e){d=e.Util}],execute:function(){e("textFieldFactory",function(e,t,i,n,o,r){return"richtextarea"===n.extraTypeInfo?u(e,t,o,n):((s=255<n.maxLength||"multiline"===n.format||"textarea"===r?a(e,t,i,o):l(e,t,i,"textInput","text",o)).formattedValue=d.toHTML(e),s);var s})}}}),System.register("common/forms/sb-input/factory/InputFactory.js",["common/forms/sb-field/factory/SimpleFieldFactory.js","common/forms/sb-field/factory/FormField.js"],function(e,t){var a,l;return{setters:[function(e){a=e.simpleFieldFactory},function(e){l=e.FormField}],execute:function(){e("inputFactory",function(e,t,i,n,o,r,s){return t?function(e,t,i,n,o,r){var s=new l("sb-input");return s.addAttribute("value",2,"value",e),s.addAttribute("disabled",1,"disabled",t),s.addAttribute("input-class",1,"inputClass",i),s.addAttribute("input-type",1,"inputType",n),s.addAttribute("render-read-only",1,"renderReadOnly",o),s.addAttribute("pattern",1,"pattern",r),s.readOnlyKeyEvent="sb-input-key",s}(e,i,n,o||"text",r,s):a(e)})}}}),System.register("common/forms/sb-lookup/factory/LookupFactory.js",["common/core/sb-page-container/PageContainer.js","common/forms/sb-field/factory/FormField.js","common/forms/sb-lookup/map/LookupNameMapper.js"],function(e,t){var a,l;function u(e,t,i,n){var o=n[n.refDisplayName];if(o)return o;if(e&&(o=function(e,t){if(t){var i=t.property,n=t.obj,o=t.refObjects,r=i&&i.Name?i.Name:e.name;if(r){var s=r.lastIndexOf("Id"),a=0<=s?r.substring(0,s):0<=r.lastIndexOf("__c")?r.replace("__c","__r"):null,l=n&&n[a]?n[a].attributes.type:null;if(a&&n&&n[a]&&l&&o&&o[l]){var u=o[l].nameField.fieldName;return n[a][u]?n[a][u]:n[a].Id}}}}(i,n)),!o&&n.refTable&&i.relationshipName&&n.record){var r=new l(n.refTable).getNameField(),s=n.record[i.relationshipName];s&&(o=s[r])}return o||t||""}return{setters:[function(e){e.PageContainer},function(e){a=e.FormField},function(e){l=e.LookupNameMapper}],execute:function(){e("lookupFactory",function(e,t,i,n,o,r){return t?function(e,t,i,n,o){var r=new a("sb-lookup"),s=u(!1,e,i,n);return r.formattedValue={value:e,label:s},r.addAttribute("id",0,"lookup"),r.addAttribute("value",2,"value",e),r.addAttribute("label",1,n.refDisplayName,r.formattedValue.label),r.addAttribute("label-name",1,"labelName",n.refDisplayName),r.addAttribute("table-name",1,"refTable",n.refTable),r.addAttribute("disabled",1,"disabled",t),r.addAttribute("field-full-name",1,"fieldFullName",i.tableName+"."+i.name),r.addAttribute("field-label",1,"fieldLabel",i.label),r.addAttribute("revert-on-escape",1,"revertOnEscape",o),r.addAttribute("calculate-list-position",1,"calculateListPosition",!1),r.addAttribute("has-filter",1,"hasFilter",!!i.filteredLookupInfo),r.addAttribute("record",1,"record",n.record),i.filteredLookupInfo&&i.filteredLookupInfo.controllingFields&&r.addAttribute("controlling-fields",1,"controllingFields",i.filteredLookupInfo.controllingFields),r.readOnlyKeyEvent="sb-type-esc",r.readOnlyBlurEvent="sb-type-blur",r.changeEvent="lookup-value-changed",r}(e,i,n,o,r):function(e,t,i){var n=new a("span"),o=u(!0,e,t,i);return n.addAttribute("value",2,"_value_",e),n.addAttribute("class",1,"link","link","$="),n.setInnerText(i.refDisplayName,1,o),n.formattedValue={value:e,label:o},n.addEvent("tap","refClick",function(e){window.open(window.location.origin+"/"+e.target.value)}),n}(e,n,o)})}}}),System.register("common/forms/sb-lookup/map/LookupNameMapper.js",[],function(e,t){var i,o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.tableName=e}i={Contract:"ContractNumber",Case:"CaseNumber",WorkOrder:"WorkOrderNumber"},e("LookupNameMapper",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"getNameField",value:function(){return i[this.tableName]||"Name"}}]),o=t)),e("LookupNameMapper",o)}}}),System.register("common/forms/sb-lookup/query/LookupQueryBuilder.js",["common/relationship/RelationshipFieldManager.js","common/core/AppContext.js","common/forms/NumberParser.js","common/forms/DateParser.js"],function(e,t){var d,o,u,c,i;return{setters:[function(e){d=e.RelationshipFieldManager},function(e){o=e.AppContext},function(e){u=e.NumberParser},function(e){c=e.DateParser}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t,i,n,o,r,s,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),this.tableName=e,this.searchField=t,this.hasFilter=i,this.lookupFieldFullName=n,this.resultsLimit=o,this.currentRecordFields=r,this.currentRecord=s,this.applyMruOptimization=a,this.fields=l,this.fieldTypeByName=l&&l.fieldTypeObjByName?l.fieldTypeObjByName:null,this.numberParser=new u,this.dateParser=new c(!0)}e("LookupQueryBuilder",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(g,[{key:"build",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n="%",o="";null!=e&&""!==e&&(n=e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'").replace(/%/g,"\\%").replace(/[*]+/g,"%"),o=e.replace(/\*/g,""),n.endsWith("%")||(n+="%"));var r=this.getScope(o),s="";this.hasFilter?s=" USING SCOPE "+r+", LOOKUP "+this.lookupFieldFullName:"mru"===r&&(s=" USING SCOPE mru");var a=this.getSelectClause(t),l=this.getWhereClause(n,e,i),u="mru"===r?"ORDER BY LastViewedDate DESC":"ORDER BY "+this.searchField,d=a+" FROM "+this.tableName+s+" WHERE "+l+" "+u+" LIMIT "+this.resultsLimit;if(this.hasFilter&&this.currentRecordFields&&0<Object.keys(this.currentRecordFields).length&&this.currentRecord){var c=0;for(var h in this.currentRecordFields){var f="function"==typeof this.currentRecord.getValue?this.currentRecord.getValue(h):this.currentRecord[h],p=this.currentRecordFields[h];this.omitField(f,p)||(0===c&&(d+=" BIND "),0<c++&&(d+=", "),d+=h+" = "+this.getBindValue(f,p))}}return d}},{key:"getScope",value:function(e){if(!this.applyMruOptimization)return"everything";var t=null==e?0:e.length;if(2<t)return"everything";var i=o.user.lang;return 0<t&&("zh_CN"===i||"zh_TW"===i||"ja"===i||"ko"===i||"th"===i)?"everything":"mru"}},{key:"omitField",value:function(e,t){return null==e&&(this.isNumericType(t)||this.isLookupType(t)||this.isDateType(t))}},{key:"getBindValue",value:function(e,t){return null==e?"''":!0===e||!1===e?e:this.isNumericType(t)||this.isDateType(t)?e:"'"+e+"'"}},{key:"isNumericType",value:function(e){switch(e){case"double":case"number":case"currency":case"percent":case"int":return!0}return!1}},{key:"isLookupType",value:function(e){switch(e){case"id":case"reference":return!0}return!1}},{key:"isDateType",value:function(e){switch(e){case"date":case"datetime":return!0}return!1}},{key:"getSelectClause",value:function(e){var t=e&&this.fields&&this.fields.fieldNames?g._buildFields(this.fields):[this.searchField];return"SELECT Id, "+(t=t.filter(function(e){return"Id"!==e&&""!==e})).join(",")}},{key:"getWhereClause",value:function(e,t,i){var n=[this.searchField+" LIKE '"+e+"'"];if(!(i&&this.fields&&this.fields.additionalSearchFields&&this.fieldTypeByName))return n[0];var o=void 0,r=void 0,s=g._buildFields(this.fields,"additionalSearchFields"),a=!0,l=!1,u=void 0;try{for(var d,c=s[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value,f=this.fieldTypeByName[h];if(null!=f&&null!=f.type&&(f=f.type),!this.isLookupType(f))if(this.isDateType(f)){if(null==t||""===t)continue;if(void 0===o&&(o=this.dateParser.parse(t)),null==o)continue;var p=o.toISOString().split("T")[0];"datetime"===f&&(p+="T00:00:00.000+0000"),n.push(h+" >= "+p)}else if(this.isNumericType(f)){if(null==t||""===t)continue;if(void 0===r&&(r=this.numberParser.parse(t,!0)),isNaN(r))continue;var v=r;"int"===f&&(v=parseInt(v)),n.push(h+" >= "+v)}else n.push(h+" LIKE '"+e+"'")}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}return n.join(" OR ")}}],[{key:"_buildFields",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"fieldNames",i=[].concat(e[t]),n=[],o=!0,r=!1,s=void 0;try{for(var a,l=e.fieldsOfTypeLookup[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;-1!==i.indexOf(u.name)&&n.push(d.getRelationshipField(u.name,u.table))}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}return 0<n.length&&(i=i.concat(n)),i}}]),i=g)),e("LookupQueryBuilder",i)}}}),System.register("common/forms/sb-rte/dialog/RichTextEditorDialog.js",["common/core/AppContext.js"],function(h,e){var f,p,v,g,y,m,b,_,C,S,k,O,E,I,w,M,L,D,T,P,F,A,x,R,N,j;function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function q(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function V(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}return{setters:[function(e){f=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return B(this,e),q(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}function t(){return B(this,t),q(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}function i(){return B(this,i),q(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}function o(){return B(this,o),q(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}function r(){return B(this,r),q(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}function s(){return B(this,s),q(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}function a(){return B(this,a),q(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}function l(){return B(this,l),q(this,(l.__proto__||Object.getPrototypeOf(l)).apply(this,arguments))}function u(){return B(this,u),q(this,(u.__proto__||Object.getPrototypeOf(u)).apply(this,arguments))}function d(){return B(this,d),q(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments))}function c(){B(this,c)}p=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},v=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(n):void 0},g=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},y="//fonts.googleapis.com/css?family=Dosis|Droid+Sans|Droid+Serif|Merriweather|Montserrat|Open+Sans|Play|PT+Sans|PT+Serif|Roboto:300,400|Titillium+Web|Ubuntu",m=Quill.import("delta"),b=Quill.import("attributors/style/size"),_=Quill.import("attributors/style/font"),C=Quill.import("attributors/style/align"),S=Quill.import("attributors/style/direction"),k=Quill.import("blots/inline"),O=Quill.import("parchment"),E=Quill.import("blots/block/embed"),(I=Quill.import("blots/block")).tagName="DIV",b.whitelist=["11px","13px","16px","19px","24px","32px","48px"],_.whitelist=["arial","courier","dosis","droid sans","droid serif","helvetica","montserrat","noto sans jp","noto sans kr","noto sans sc","noto sans tc","open sans","play","pt sans","pt serif","roboto","roboto light","times","titillium web","ubuntu"],V(e,k),(w=e).blotName="SFDCTags",w.tagName=["address","big","br","blockquote","caption","col","colgroup","del","dfn","hr","ins","kbd","q","samp","small","strike","tfoot","tt","var","p"],V(t,E),(M=t).blotName="divider",M.tagName="hr",V(i,k),(L=i).blotName="HeaderLowercase",L.tagName=["h1","h2","h3","h4","h5","h6"],V(o,E),g(o,null,[{key:"create",value:function(e){return e}},{key:"value",value:function(e){var t="";return"DL"===e.tagName&&(t=e),t}}]),(D=o).blotName="DefinitionTag",D.tagName=["dl","dt","dd"],V(r,k),g(r,null,[{key:"create",value:function(e){var t=v(r.__proto__||Object.getPrototypeOf(r),"create",this).call(this);return"string"==typeof e&&t.setAttribute("title",e),t}},{key:"formats",value:function(e){var t=e.getAttribute("title");return t||!0}}]),(T=r).blotName="abbr",T.tagName=["ABBR","acronym"],V(s,k),g(s,null,[{key:"create",value:function(e){var t=v(s.__proto__||Object.getPrototypeOf(s),"create",this).call(this);return t.setAttribute("dir",e),t}},{key:"formats",value:function(e){return e.getAttribute("dir")}}]),(P=s).blotName="bdo",P.tagName="BDO",V(a,E),g(a,[{key:"offset",value:function(e){return e.domNode.innerText.length-this.domNode.innerText.length}},{key:"deleteAt",value:function(e,t){v(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"deleteAt",this).call(this,e,t)}},{key:"index",value:function(e,t){}}],[{key:"create",value:function(e){var t=p(e,3),i=t[0],n=t[1],o=t[2],r=v(a.__proto__||Object.getPrototypeOf(a),"create",this).call(this,e),s=document.createElement("TBODY");return i.forEach(function(e){var i=document.createElement("TR");s.appendChild(i),e.forEach(function(e){var t=document.createElement("TD");t.colSpan&&t.setAttribute("colspan",t.colSpan),t.rowSpan&&t.setAttribute("rowspan",t.rowSpan),t.innerHTML=e,i.appendChild(t)})}),n&&r.appendChild(n),o&&r.appendChild(o),r.appendChild(s),r}},{key:"value",value:function(e){var t,i,n=[];if("TABLE"===e.tagName){t=e.caption?e.caption:"",i=e.querySelector("colgroup")?e.querySelector("colgroup"):"";for(var o=e.rows,r=0;r<o.length;r++){n[r]=[];for(var s=0;s<o[r].cells.length;s++)n[r].push(o[r].cells[s].innerHTML)}}return[n,t,i]}}]),(F=a).blotName="table",F.className="table",F.tagName="TABLE",V(l,k),g(l,null,[{key:"create",value:function(e){var t=v(l.__proto__||Object.getPrototypeOf(l),"create",this).call(this);return t.setAttribute("href",e.href),e.title&&t.setAttribute("title",e.title),e.target&&t.setAttribute("target",e.target),t}},{key:"formats",value:function(e){return{href:e.href,title:e.title,target:e.target,innerHTML:e.innerHTML}}}]),(A=l).blotName="AnchorBlot",A.tagName="a",V(u,k),g(u,null,[{key:"create",value:function(e){return v(u.__proto__||Object.getPrototypeOf(u),"create",this).call(this,e)}},{key:"formats",value:function(e){return e.innerHTML}}]),(x=u).blotName="CiteBlot",x.tagName="cite",V(d,O.Attributor.Style),g(d,[{key:"add",value:function(e,t){return 0===t?(this.remove(e),!0):v(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"add",this).call(this,e,t+"em")}}]),R=new d("indent","margin-left",{scope:O.Scope.BLOCK,whitelist:["1em","2em","3em","4em","5em","6em","7em","8em","9em"]}),N=new O.Attributor.Style("text-decoration","text-decoration",{scope:O.Scope.BLOCK,whitelist:["underscore","line-through"]}),Quill.register("formats/text-decoration",N,!0),Quill.register(b,!0),Quill.register(_,!0),Quill.register(C,!0),Quill.register(S,!0),Quill.register(R,!0),Quill.register(I,!0),Quill.register(w,!0),Quill.register(M,!0),Quill.register(L,!0),Quill.register(D,!0),Quill.register(T,!0),Quill.register(P,!0),Quill.register(F,!0),Quill.register(A,!0),Quill.register(x,!0),h("RichTextEditorDialog",(g(c,[{key:"beforeRegister",value:function(){this.is="sb-rte-dialog",this.properties={value:{type:String,observer:"_valueChanged",notify:!0},tooltipTextMap:{type:Object},imageDialogOpened:{type:Boolean,value:!1},currentSelection:{type:Number},saving:{type:Boolean,value:!1}},this.listeners={"rte-image-saved":"_imageURLValueSaved","rte-image-closed":"_imageDialogClosed","rte-open-image-dialog":"_openImageDialog"}}},{key:"ready",value:function(){this._encapsulateStyle=!1;for(var e=document.querySelectorAll("head > link[rel=stylesheet]"),t=e?e.length:0,i=0;i<t;i++)if(e[i].getAttribute("href")==y)return;var n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("href",y),document.head.appendChild(n)}},{key:"attached",value:function(){this.tooltipTextMap=this._getTooltipMap()}},{key:"_initialize",value:function(){function i(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=e.getFormat(t.index,t.length),o=n&&n.indent?n.indent:"0em",r=parseInt(o.substring(0,o.length-2));if(!i||0!==r){var s=i?r-1:r+1;e.format("indent",s)}}var e=this,t={modules:{toolbar:{container:"#rteToolbar",handlers:{image:function(){this.container.dispatchEvent(new Event("rte-open-image-dialog",{bubbles:!0}))}}},clipboard:{matchVisual:!1},keyboard:{bindings:{indent:{key:9,format:["indent","list"],handler:function(e){i(this.quill,e)}},outdent:{key:9,format:["indent","list"],shiftKey:!0,handler:function(e){i(this.quill,e,!0)}},"outdent backspace":{key:8,format:["indent","list"],offset:0,handler:function(e,t){null!=t.format.indent?i(this.quill,e,!0):null!=t.format.list&&this.quill.format("list",!1)}}}}},theme:"snow"};this.quillInstance=new Quill("#rteContainer",t),Polymer.dom(this.root).querySelector("#rteContainer .ql-editor").classList.add("style-scope","sb-rte-dialog"),Polymer.dom(this.root).querySelector(".ql-undo").addEventListener("click",function(){e.quillInstance.history.undo()}),Polymer.dom(this.root).querySelector(".ql-redo").addEventListener("click",function(){e.quillInstance.history.redo()})}},{key:"onSave",value:function(){this.saving=!0;var e=this.quillInstance.root.innerHTML,t=f.properties.i18n.value().l("Click to edit description");this.value=e!==t?e:null,this.rte.value=this.value,this.rte.fire("rte-value-changed",{value:this.value}),this.rte.fire("rte-saved"),this.close()}},{key:"onCancel",value:function(){this.imageDialogOpened||(this.rte.fire("rte-esc",{keyCode:27}),this.close())}},{key:"open",value:function(){var e=f.properties.i18n.value().l("Click to edit description");this.$.dialog.open(),this.value!==e&&null!=this.value||(this.value=null),this.$.rteContainer.focus(),Polymer.dom(this.root).querySelector(".title").innerHTML=f.properties.i18n.value().l("Edit "+this.rte.label),this.quillInstance?this.quillInstance.root.innerHTML!==this.value&&this._valueChanged():(this._initialize(),this._valueChanged()),this.quillInstance.history.clear(),this.addEventListener("sb-rte-cancel",this.onCancel)}},{key:"close",value:function(){this.saving=!1;var e=f.properties.i18n.value().l("Click to edit description");this.rte.fire("rte-blur"),this.$.dialog.close(),this.value===e&&(this.value=null),this.removeEventListener("sb-rte-cancel",this.onCancel)}},{key:"_imageURLValueSaved",value:function(e){var t=e.detail;this.quillInstance.updateContents((new m).retain(this.currentSelection).insert({image:t.src},{width:t.width,height:t.height}))}},{key:"_imageDialogClosed",value:function(e){this.imageDialogOpened=!1,Polymer.dom(this.$$("#rteContainer")).removeChild(this.$$("rte-image-dialog"))}},{key:"_openImageDialog",value:function(e){var t=this.quillInstance.getSelection();this.currentSelection=t?t.index:0;var i=this.$$("#rteContainer"),n=document.createElement("rte-image-dialog");Polymer.dom(i).appendChild(n),this.imageDialogOpened=!0}},{key:"_valueChanged",value:function(){if(!this.saving&&this.$$("#rteContainer .ql-editor")){var e=this.value;this.setContentToQuill(e)}}},{key:"setContentToQuill",value:function(e){this.quillInstance.setText(""),this.quillInstance.clipboard.dangerouslyPasteHTML(0,e);var t=this.quillInstance.editor.delta;if(1<=t.ops.length&&t.ops[t.ops.length-1].insert.endsWith("\n")){var i=t.length();this.quillInstance.updateContents((new m).retain(i-1).delete(1))}}},{key:"_getTooltipMap",value:function(){return{bold:f.properties.i18n.value().l("Bold"),italic:f.properties.i18n.value().l("Italic"),underline:f.properties.i18n.value().l("Underline"),strike:f.properties.i18n.value().l("Strikethrough"),fontSize:f.properties.i18n.value().l("Font size"),headerSize:f.properties.i18n.value().l("Header size"),fontFamily:f.properties.i18n.value().l("Font family"),alignLeft:f.properties.i18n.value().l("Align left"),center:f.properties.i18n.value().l("Center"),alignRight:f.properties.i18n.value().l("Align right"),textColor:f.properties.i18n.value().l("Text color"),backgroundColor:f.properties.i18n.value().l("Background color"),subscript:f.properties.i18n.value().l("Subscript"),superscript:f.properties.i18n.value().l("Superscript"),numberedList:f.properties.i18n.value().l("Numbered list"),bulletList:f.properties.i18n.value().l("Bullet list"),decreaseIndent:f.properties.i18n.value().l("Decrease indent"),increaseIndent:f.properties.i18n.value().l("Increase indent"),blockQuote:f.properties.i18n.value().l("Block quote"),link:f.properties.i18n.value().l("Insert or edit link"),image:f.properties.i18n.value().l("Insert or edit image"),clearFormatting:f.properties.i18n.value().l("Clear formatting"),undo:f.properties.i18n.value().l("Undo"),redo:f.properties.i18n.value().l("Redo")}}}]),j=c)),h("RichTextEditorDialog",j),Polymer(j)}}}),System.register("common/forms/sb-rte/factory/RichTextEditorFactory.js",["common/forms/sb-field/factory/FormField.js","common/core/sb-page-container/PageContainer.js","common/forms/sb-field/factory/SimpleFieldFactory.js"],function(e,t){var r,s,a;return{setters:[function(e){r=e.FormField},function(e){s=e.PageContainer},function(e){a=e.simpleFieldFactory}],execute:function(){e("richTextEditorFactory",function(e,t,i,n){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:s;return t&&!o.isMobile()?function(e,t,i){null===e&&(e="");var n=new r("sb-rte");return n.addAttribute("value",2,"value",e),n.addAttribute("render-read-only",1,"renderReadOnly",t),n.addAttribute("label",1,"label",i.label),n.readOnlyKeyEvent="rte-esc",n.readOnlyBlurEvent="rte-blur",n.changeEvent="rte-value-changed",n}(e,i,n):a(e)})}}}),System.register("common/forms/sb-rte/imageDialog/RTEImageDialog.js",["common/core/AppContext.js"],function(t,e){var i;return{setters:[function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("RTEImageDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="rte-image-dialog",this.properties={img:{type:Object,value:null},originalWidth:String,originalHeight:String,widthDim:{type:Number},heightDim:{type:Number},imageSrc:{type:String,value:"",observer:"_setupNewImage"},isChecked:{type:Boolean,value:!0}},this.observers=["_updateImageSizesObserver(widthDim, heightDim, img, isChecked)"]}},{key:"ready",value:function(){this.$.imageDialog.open(),this.addEventListener("rte-image-dialog-cancel",this.onCancel)}},{key:"onSave",value:function(){var e=this.img;this.imageSrc&&(e.width&&e.height||(e.width=this.originalWidth,e.height=this.originalHeight),this.fire("rte-image-saved",e)),this.close()}},{key:"onCancel",value:function(){this.close()}},{key:"close",value:function(){this.$.imageDialog.close(),this.fire("rte-image-closed"),this.removeEventListener("rte-image-dialog-cancel",this.onCancel)}},{key:"_setupNewImage",value:function(){var e=this;this.img||(this.img=new Image),this.img.src=this.imageSrc,this.imageSrc?this.img.onload=function(){e.originalWidth=e.img.width,e.originalHeight=e.img.height,e.widthDim=e.originalWidth,e.heightDim=e.originalHeight}:(this.originalWidth=0,this.originalHeight=0,this.widthDim="",this.heightDim="")}},{key:"_updateImageSizesObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this._updateImageSizes(e,t,i,n)}},{key:"_updateImageSizes",value:function(e,t,i,n){var o=parseInt(e),r=parseInt(t),s=i.width,a=i.height;if(!(o===s&&r===a||isNaN(o)||isNaN(r)||0===o||0===r))if(n)if(o!==s){var l=this._conversion(o,s,r);this.img.width=o,this.img.height=l,this.heightDim=l}else{var u=this._conversion(r,a,o);this.img.width=u,this.img.height=r,this.widthDim=u}else this.img.width=o,this.img.height=r}},{key:"_conversion",value:function(e,t,i){var n=Math.floor(e*i/t);return isNaN(n)||n===1/0?i:n}}]),i=e)),t("RTEImageDialog",i),Polymer(i)}}}),System.register("common/forms/sb-select/factory/SelectFactory.js",["common/forms/sb-field/factory/SimpleFieldFactory.js","common/forms/sb-field/factory/FormField.js","common/forms/sb-select/Select.js"],function(e,t){var u,d,c;function h(e,t,i){if(!t)return e;var n=c.getValues(e,i);if(0===n.length)return e;var o=null,r=!0,s=!1,a=void 0;try{for(var l,u=t[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value;-1!==n.indexOf(d.value)&&(i&&null!=o?o+=";"+d.label:o=d.label)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}return o||e}return{setters:[function(e){u=e.simpleFieldFactory},function(e){d=e.FormField},function(e){c=e.Select}],execute:function(){e("selectFactory",function(e,t,i,n,o,r,s,a){var l="multipicklist"===n;return t?function(e,t,i,n,o,r,s){var a=new d("sb-select");return!i.defaultValue||null!=e||i.controllerName||i.restrictedPicklist||(e=i.defaultValue,a.defaultValue=e),a.addAttribute("id",0,"picklist"),a.addAttribute("value",2,"value",e),a.addAttribute("md",1,"md",i),a.addAttribute("disabled",1,"disabled",t),a.addAttribute("options",1,"options",r),a.addAttribute("is-required",1,"isRequired",!!i.required),a.addAttribute("multi-select",1,"multiSelect",s),o&&a.addAttribute("none-label",1,"noneLabel","--"+n.l("None")+"--"),null!=i.precision&&a.addAttribute("size",1,"size",i.precision),a.formattedValue={value:e,label:h(e,r,s)},a}(e,i,o,r,s,a,l):u(h(e,a,l))})}}}),System.register("common/forms/sb-textarea/factory/TextareaFactory.js",["common/forms/sb-field/factory/SimpleFieldFactory.js","common/forms/sb-field/factory/FormField.js"],function(e,t){var o,r;return{setters:[function(e){o=e.simpleFieldFactory},function(e){r=e.FormField}],execute:function(){e("textareaFactory",function(e,t,i,n){return t?function(e,t,i){null===e&&(e="");var n=new r("sb-textarea");return n.addAttribute("value",2,"value",e),n.addAttribute("disabled",1,"disabled",t),n.addAttribute("render-read-only",1,"renderReadOnly",i),n.readOnlyKeyEvent="sb-textarea-key",n}(e,i,n):o(e)})}}}),System.register("contracts/selection/routes/sb-contract-lookup/ContractLookup.js",["common/core/Page.js","common/data/format/DataBuilder.js","../sf-contract-lookup-table/ContractLookupTable.js"],function(t,e){var i,l,c,o,h,f,r;return{setters:[function(e){i=e.Page},function(e){l=e.DataBuilder},function(e){e.ContractLookupTable}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},h="evergreen",f="nonevergreen",t("ContractLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),o(e,[{key:"beforeRegister",value:function(){this.is="sb-contract-lookup",this.listeners={"contract-selected":"handleContractSelected"},this.properties=Polymer.Base.extend({prefix:{type:String,computed:"getPrefix(app.org)"},contractsByType:{type:Object,value:{}},contractLookupObjects:Array,contracts:Array,contractTabs:Array,lineEditorModel:Object,selectedContractId:String,selectedEvergreenContractId:String,action:String,accountId:String,selectedAssetIds:String,validationMessages:{type:Array,value:[]}},i.properties)}},{key:"ready",value:function(){this.setAndPrefetchObject(),this.setPropertyFromUrl(),this.setSkipActionClass(),this.handleLineEditorModelResponse(),this.handleContractModelLoadResponse(),this.handleContractModelSaveResponse(),this.action&&this.handleContractModelLoadRequest({uid:this.accountId,action:this.action})}},{key:"setAndPrefetchObject",value:function(){this.contractLookupObjects=this.isServiceCloudEnabled()?["ServiceContract"]:["Contract"]}},{key:"isServiceCloudEnabled",value:function(){return this.app.org.isServiceCloudEnabled}},{key:"getPrefix",value:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}},{key:"setPropertyFromUrl",value:function(){this.action=this.ctx.params.action,this.accountId=this.ctx.params.accId,this.selectedAssetIds=this.ctx.params.selectedAssetIds}},{key:"setSkipActionClass",value:function(){var e=Polymer.dom(this.$.skip).node,t=void 0;this.action?"Amend"===this.action&&(t="skipActionAmend"):t="skipActionAddOn",this.toggleClass(t,!0,e)}},{key:"handleLineEditorModelResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.handleContractModelLoadRequest({uid:this.lineEditorModel.quote.record.Id})}.bind(this))}},{key:"handleContractModelLoadRequest",value:function(e){this.$.contractModelLoadService.uid=null,this.$.contractModelLoadService.context=e}},{key:"handleContractModelLoadResponse",value:function(){this.$.contractModelLoadService.addEventListener("response-changed",function(e){if(this.contracts=e.detail.value,0!=this.contracts.length){this.contractsByType[h]=[],this.contractsByType[f]=[];var t=(this.isServiceCloudEnabled()?this.scPrefix:this.prefix)+"Evergreen__c",i=!0,n=!1,o=void 0;try{for(var r,s=this.contracts[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;a.record[t]?this.contractsByType[h].push(a):this.contractsByType[f].push(a)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this.buildContractsTabs()}}.bind(this))}},{key:"handleContractSelected",value:function(e){e.detail.contractType==f?this.selectedContractId=e.detail.selectedContractId:this.selectedEvergreenContractId=e.detail.selectedContractId}},{key:"handleContractModelSaveResponse",value:function(){this.$.contractModelSaveService.addEventListener("response-changed",function(e){e.detail.value&&(e.detail.value.Id?this.quoteId=e.detail.value.Id:e.detail.value.quote&&e.detail.value.quote.record&&(this.quoteId=e.detail.value.quote.record.Id,this.lineEditorModel=e.detail.value,this.$.qo.cache(this.quoteId,this.lineEditorModel))),this.navigateToLineEditor()}.bind(this))}},{key:"buildContractsTabs",value:function(){var e=[],t=[[f,this.i18n.l("Active Contracts")],[h,this.i18n.l("Evergreen Contracts")]],i=!0,n=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=c(r.value,2),l=a[0],u=a[1];if(0<this.contractsByType[l].length){var d={name:l,label:u};e.push(d)}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this.contractTabs=e}},{key:"navigateToLineEditor",value:function(){var e=this.lineEditorModel?this.lineEditorModel.quote.record.Id:this.quoteId;this.nav("#",{qId:e},["quote","le"],!1)}},{key:"onSkip",value:function(){this.action?this.$.contractModelSaveService.model=this.buildModel(null,null,null):this.navigateToLineEditor()}},{key:"onSelect",value:function(){if(this.validationMessages=[],this.selectedContractId||this.selectedEvergreenContractId){if(this.selectedContractId){var e=!0,t=!1,i=void 0;try{for(var n,o=this.contractsByType[f][Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;if(this.selectedContractId==r.record.Id){if(this.lineEditorModel.quote.record[this.prefix+"StartDate__c"]>r.record.EndDate)return void(this.validationMessages=[this.i18n.l("Can't select the contract because its end date is before the quote's start date")]);break}}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}var s=void 0;if(this.action)s=this.buildModel(null,this.selectedContractId,this.selectedEvergreenContractId);else{var a=(new l).addObject("quote",this.lineEditorModel.quote.record);a.add("selectedContractId",this.selectedContractId),a.add("selectedEvergreenContractId",this.selectedEvergreenContractId),s=a.build()}this.$.contractModelSaveService.model=s}else this.validationMessages=[this.i18n.l("Select a record or Skip to continue")]}},{key:"buildModel",value:function(e,t,i){return{quote:e||null,selectedContractId:t,selectedEvergreenContractId:i,action:this.action,accountId:this.accountId,selectedAssetIds:this.selectedAssetIds}}},{key:"onCancel",value:function(){this.showSpinner=!0,this.navigateToDetailPage()}},{key:"navigateToDetailPage",value:function(){var e=void 0;if(e=this.action?this.accountId:this.lineEditorModel.quote.record.Id,this.isLightningExperience())!0===PageContainer.getViewport().isMobile()?this.navigateToURL("#/sObject/"+this.prefix+"Quote__c/home"):sforce.one.navigateToSObject(e);else{var t="/"+e;window.parent?window.parent.location.href=t:window.location.href=t}}},{key:"isLightningExperience",value:function(){return"undefined"!=typeof sforce&&sforce&&!!sforce.one}},{key:"navigateToURL",value:function(e){sforce.one.navigateToURL(e)}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"scPrefix",get:function(){return this.app.org.scPrefix?this.app.org.scPrefix:""}}]),r=e)),t("ContractLookup",r),Polymer(r)}}}),System.register("contracts/selection/routes/sf-contract-lookup-table/ContractLookupTable.js",["common/core/AppContext.js","common/layout/tables/TableClassBuilder.js"],function(t,e){var i,l,o;return{setters:[function(e){i=e.AppContext},function(e){l=e.TableClassBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ContractLookupTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-contract-lookup-table",this.properties={name:String,contractsByType:Object},this.listeners={"selection-changed":"handleContractSelected"}}},{key:"ready",value:function(){this.$.header.selectable=!1,this.handleMetaDataResponse()}},{key:"handleMetaDataResponse",value:function(){this.$.md.addEventListener("md-changed",function(e){var i=[],n=[],o={},r={},s={},a={};e.detail.value.fields.forEach(function(e){var t=e.name;i.push(t),n.push(e.label),o[t]=e.label,r[t]=e,s[e.label.replace(/\W/g,"")]=e.type,a[t]=e.type}.bind(this)),this.headerClassMap=new l(Object.keys(s),"Th",s,null,!0).build(),this.rowClassMap=new l(i,"Td",a).build(),this.mdMap=r,this.recordKeys=i,this.fieldLabels=n,this.fieldLabelMap=o}.bind(this))}},{key:"setFieldSet",value:function(){var e=[],t=!0,i=!1,n=void 0;try{for(var o,r=this.contracts[0].activeContractFieldSets[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;e.push(this.contractObject+"."+s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.$.md.fields=e}},{key:"_handleContractLoadResponseObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.handleContractLoadResponse(e,t)}},{key:"handleContractLoadResponse",value:function(){this.contracts=this.contractsByType[this.name],0<this.contracts.length&&this.setFieldSet()}},{key:"handleContractSelected",value:function(e){e.detail.selected?this.selectedId=e.detail.Id:this.selectedId=null;var t={contractType:this.name,selectedContractId:this.selectedId};e.detail.selected&&this.ifRadioSelectedClearOtherRadioSelections(e),this.fire("contract-selected",t)}},{key:"ifRadioSelectedClearOtherRadioSelections",value:function(e){if(!1!==e.detail.selected&&void 0!==e.detail.selected){var t=Polymer.dom(e).rootTarget,i=Polymer.dom(t.parentElement).querySelectorAll("sb-table-row"),n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;l!==t&&(l.selected=!1)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_handleContractLoadResponseObserver(contractsByType, name)"]}},{key:"contractObject",get:function(){return i.org.isServiceCloudEnabled?"ServiceContract":"Contract"}}]),o=e)),t("ContractLookupTable",o),Polymer(o)}}}),System.register("products/config/actions/sb-custom-actions/CustomActions.js",["common/Util.js","common/core/AppContext.js","common/core/sb-page-container/PageContainer.js","common/core/sb-page-header/PageHeader.js","products/config/message/ProductMessenger.js","common/core/Events.js"],function(t,e){var u,i,o,r,s,a,d,l;return{setters:[function(e){u=e.Util},function(e){i=e.AppContext},function(e){o=e.PageContainer},function(e){r=e.PageHeader},function(e){s=e.ProductMessenger},function(e){a=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}d={"Product Code":"ProductCode"},t("CustomActions",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-custom-actions",this.properties={customActions:Array,products:Array,isClassic:Boolean,productIndex:Number,firstItem:Object,remainingItems:Array,customActionsExist:Boolean,moreThanOneCustomActionsExist:{type:Boolean,value:!1},menuClosed:{type:Boolean,value:!0},viewport:{type:Object,observer:"_viewportChanged",value:function(){return o.getViewport()}},buttonsCollapsed:{type:Boolean,notify:!0},messenger:{type:Object,computed:"_newMessenger(quote, products, productIndex)"},quote:{type:Object,notify:!0},popupResponse:{type:Object,notify:!0,observer:"_updateQuoteFromPopupResponse"}}}},{key:"_initObserver",value:function(e,t,i,n,o){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o)return this.init(e,t,i,n,o)}},{key:"init",value:function(){var i=this;if(this.isClassic&&1<this.products.length)return this.classList.add("hide"),void(this.customActionsExist=!1);var n=this.prefix+"URL__c",o=this.prefix+"Label__c",r=this.prefix+"Page__c",s=this.prefix+"URLTarget__c",a=this.prefix+"Action__c",l=this.prefix+"BrandButton__c",u=[];if(this.customActions.forEach(function(e){if("Product Configurator"===e[r]&&i.checkCustomActionsConditionsMet(e)){var t="";!0===e[l]&&(t="primary"),u.push({label:e[o],url:e[n],target:e[s],action:e[a],brandButtonClass:t})}}),0===u.length)return this.classList.add("hide"),void(this.customActionsExist=!1);this.firstItem=u[0],1<u.length&&(this.remainingItems=u.slice(1),this.moreThanOneCustomActionsExist=!0),this.customActionsExist=!0,this.buttonsCollapsed=!(this.viewport&&!this.viewport.isMobile()&&this.viewport.M.up),this.classList.remove("hide")}},{key:"_itemSelected",value:function(e){var t=e.target.id,i="firstItem"===t?this.firstItem:this.remainingItems[t];void 0!==i.url?this.handleURLAction(i):"Apply Edit Rules"===i.action&&this.applyRules()}},{key:"handleURLAction",value:function(e){"Popup"===e.target?this.handlePopup(e.url):this.handleNav(e.url)}},{key:"handlePopup",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this.$.popup.url=e,this.$.popup.autoLaunched=t,this.$.popup.redirectOnCancelOrClose=i,this.$.popup.messenger=this.messenger,this.$.popup.open()}},{key:"handleNav",value:function(e){this._isLightningExperience()?sforce.one.navigateToURL(e):window.location.href=e}},{key:"applyRules",value:function(){this.fire("sb-apply-edit-rules",{bundleId:this.products[this.productIndex].record.Id})}},{key:"_isLightningExperience",value:function(){return"undefined"!=typeof sforce&&sforce&&!!sforce.one}},{key:"checkCustomActionsConditionsMet",value:function(e){var o=this,t=this.prefix+"Custom_Action_Conditions__r",r=this.prefix+"Field__c",s=this.prefix+"Operator__c",a=this.prefix+"FilterValue__c",l=this.prefix+"TargetObject__c";return!1!==this._checkPackagedCustomActionConditionMet(e)&&(void 0===e[t]||e[t].records.some(function(e){if(void 0===e[r]||void 0===e[a]||void 0===e[s])return!1;var t="Product";e[l]&&(t=e[l]);var i=d[e[r]]||e[r],n="Quote"===t?o.quote.record:o.products[o.productIndex].record;return u.arithmeticOperatorConversion(n[i],e[a],e[s])}))}},{key:"_checkPackagedCustomActionConditionMet",value:function(e){return"Launch External"!==e.Name||void 0!==e[this.prefix+"URL__c"]&&!!this.products[this.productIndex].record[this.prefix+"ExternallyConfigurable__c"]}},{key:"_changeMenu",value:function(e){this.menuClosed=r.changeMenu(e,this.menuClosed,this.$$("#remainingItems"),"open",this)}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"_viewportChanged",value:function(){this.buttonsCollapsed=!(this.viewport&&!this.viewport.isMobile()&&this.viewport.M.up)}},{key:"_newMessenger",value:function(){return new s(this.quote,this.products[this.productIndex],this.prefix,this.currencyIsoCode,Polymer.Base)}},{key:"_updateQuoteFromPopupResponse",value:function(){this.quote=this.popupResponse.quote}},{key:"events",get:function(){var e={};return e[a.VIEWPORT_CHANGED]=this.viewportChanged,e}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"observers",get:function(){return["_initObserver(customActions, products, productIndex, isClassic, menuClosed)"]}},{key:"prefix",get:function(){return i.org.prefix?i.org.prefix+"__":""}}]),l=e)),t("CustomActions",l),Polymer(l)}}}),System.register("products/config/attribute/sb-attribute-item/AttributeItem.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("AttributeItem",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-attribute-item",this.properties={value:{notify:!0,observer:"_notifyAttributeChanged"},item:String,model:Object,md:Object,data:{type:Object,notify:!0},label:{type:String,reflectToAttribute:!0}}}},{key:"_setRequiredObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.setRequired(e,t,i)}},{key:"setRequired",value:function(){!1!==this.attributeMD.required&&!0!==this.attributeMD.autoSelect&&this.toggleClass("mandatory-no-value",!1===this.isValidValue(),this.$.attributeField)}},{key:"isValidValue",value:function(){return!(void 0===this.value||null===this.value||""===this.value)}},{key:"_setAttributeMDObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.setAttributeMD(e,t,i)}},{key:"setAttributeMD",value:function(){if(this.model.fields){this.attributeMD=this.model.attributeMD[this.item],this.$.field.disabled=this.attributeMD.autoSelect,this.hidden=this.attributeMD.hidden;var e=JSON.parse(JSON.stringify(this.model.fields[this.targetField]));"picklist"!==e.type&&"multipicklist"!==e.type||(e.picklistValues=this.getPicklistValues(e.picklistValues),e.required=this.attributeMD.required),this.md=e}}},{key:"_setTargetFieldObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setTargetField(e,t)}},{key:"setTargetField",value:function(){(this.$.field.record=this).targetField=this.model.attributeMD[this.item].targetFieldName}},{key:"setLabel",value:function(){this.label=this.md.label}},{key:"getPicklistValues",value:function(e){if(void 0===this.attributeMD)return e;if(!this.attributeMD.shownValues&&!this.attributeMD.hiddenValues)return e;var t=this.attributeMD.shownValues||[];if(!this.attributeMD.shownValues){var i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.value)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}var l=this.attributeMD.hiddenValues||[];return e.filter(function(e){return-1!==t.indexOf(e.value)&&-1===l.indexOf(e.value)})}},{key:"_notifyAttributeChanged",value:function(e){this.model&&this.fire("sb-config-attribute-changed",{Id:this.item,bundleId:this.model.attributeMD[this.item].bundleId,changed:!0,path:!0})}},{key:"getValue",value:function(e){var t=this.model.attributeFieldMD[e];if(t&&0<t.length)return this.data[t[0]]}},{key:"setValue",value:function(e,t){this.set("data."+e,t)}},{key:"equals",value:function(e){return this.data===e.data}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_setAttributeMDObserver(item, model, targetField)","_setTargetFieldObserver(item, model)","_setRequiredObserver(value, model, attributeMD)","setLabel(md)"]}}]),i=e)),t("AttributeItem",i),Polymer(i)}}}),System.register("products/config/attribute/sb-attribute-table/AttributeTable.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,d,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}d=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},t("AttributeTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-attribute-table",this.properties={featureId:String,position:String,model:Object,configAttributes:Object,addedClass:String,md:Object,showTable:{type:Boolean,value:!1},viewport:{type:Object,value:function(){return i.getViewport()}},spinner:{type:Boolean,notify:!0}}}},{key:"ready",value:function(){this.$.optionFieldMetadata.addEventListener("md-changed",function(e){this.setMD(e),this.spinner=!1}.bind(this)),this.addEventListener("lookup-value-changed",this._setReferencedData.bind(this))}},{key:"_getMDObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.getMD(e,t)}},{key:"getMD",value:function(){this.spinner=!0;var e={},t=this.model.configurationAttributeModelMap;for(var i in t)e[t[i].targetFieldName]=null;this.$.optionFieldMetadata.fields=Object.keys(e)}},{key:"setMD",value:function(e){this.md={fields:e.detail.value.fieldsByObject[this.model.prefix+"ProductOption__c"],attributeMD:this.model.configurationAttributeModelMap,attributeFieldMD:this.model.configurationAttributeTargetFieldMap}}},{key:"_generateColumnsObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this.generateColumns(e,t,i,n)}},{key:"prepareColumns",value:function(e,t){for(var i=[],n=[],o=[],r=e.length,s=0;s<r;s++){var a=e[s].myId;e[s].position!=t&&t||(1==e[s].columnOrder?i.push(a):2==e[s].columnOrder?n.push(a):o.push(a))}return[i,n,o]}},{key:"createFeatureAttributesByFieldName",value:function(e,t){for(var i={},n=e.length,o=0;o<n;o++){var r=e[o].myId;t.attributeMD[r].processed=!0;var s=e[o].targetFieldName,a=i[s]||[];a.push(r),i[s]=a}return i}},{key:"generateColumns",value:function(e,t,i,n){var o=(t.configAttributesByFeatureId[e]||[]).filter(function(e){return n.fields&&n.fields.hasOwnProperty(e.targetFieldName)}),r=this.prepareColumns(o,this.position),s=d(r,3),a=s[0],l=s[1],u=s[2];this.normalizeData(this.createFeatureAttributesByFieldName(o,n)),this.setColumns(a,l,u)}},{key:"normalizeData",value:function(e){for(var t in e){var i=e[t],n=this.md.attributeFieldMD[t];if(n.length<=i.length)return;var o=!0,r=!1,s=void 0;try{for(var a,l=n[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;if(-1===i.indexOf(u)&&this.md.attributeMD[u].processed){var d=!0,c=!1,h=void 0;try{for(var f,p=i[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var v=f.value;this.configAttributes[v]=this.configAttributes[u]}}catch(e){c=!0,h=e}finally{try{!d&&p.return&&p.return()}finally{if(c)throw h}}break}}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}}}},{key:"setColumns",value:function(e,t,i){0<e.length&&(this.showTable=!0,this.$.firstColumn.overridePropagateFromParentToChild(this.captureCallBack),this.$.firstColumn.setFromChildToParentExtension(this.captureCallBack),this.$.firstColumn.model=this.md,this.$.firstColumn.group||(this.$.firstColumn.group=e)),0<t.length&&(this.showTable=!0,this.$.secondColumn.overridePropagateFromParentToChild(this.captureCallBack),this.$.secondColumn.setFromChildToParentExtension(this.captureCallBack),this.$.secondColumn.model=this.md,this.$.secondColumn.group||(this.$.secondColumn.group=t)),0<i.length&&(this.showTable=!0,this.$.thirdColumn.overridePropagateFromParentToChild(this.captureCallBack),this.$.thirdColumn.setFromChildToParentExtension(this.captureCallBack),this.$.thirdColumn.model=this.md,this.$.thirdColumn.group||(this.$.thirdColumn.group=i))}},{key:"captureCallBack",value:function(e){var t=this.elements,i=e.path.split(".")[1];if(void 0!==i)for(var n=this.model.attributeMD[i].targetFieldName,o=0,r=t.length;o<r;o++)t[o].item.split(".")[0]!==i&&this.model.attributeMD[t[o].item].targetFieldName===n&&(t[o].value=e.value)}},{key:"bindDataToModel",value:function(e){if(void 0!==e.path&&"configAttributes"!==e.path){var t=this._getTargetFieldNameFromModel(e.path.split(".")[1]);this.model.product.configuration.configurationData[t]=e.value}}},{key:"_setReferencedData",value:function(e){if(e&&e.detail&&e.detail.obj&&e.detail.item){var t=this._getTargetFieldNameFromModel(e.detail.item),i=this.md.fields[t].relationshipName;if(null!==i){var n=null===e.detail.value?null:{attributes:e.detail.obj.attributes,Id:e.detail.obj.Id,Name:e.detail.obj.Name};this.model.product.configuration.configurationData[i]=n}}}},{key:"_getTargetFieldNameFromModel",value:function(e){return this.model.configurationAttributeModelMap[e].targetFieldName}},{key:"isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_generateColumnsObserver(featureId, model, configAttributes, md)","_getMDObserver(configAttributes, model)","bindDataToModel(configAttributes.*)"]}}]),o=e)),t("AttributeTable",o),Polymer(o)}}}),System.register("products/config/bundles/sb-product-bundles-filter-item/ProductBundlesFilterItem.js",["common/core/Events.js"],function(t,e){var i,o;return{setters:[function(e){i=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductBundlesFilterItem",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-bundles-filter-item",this.properties={value:{notify:!0},item:String,model:Object,label:String}}},{key:"setFieldData",value:function(){for(var e=void 0,t=0,i=this.model.length;t<i;t++)if(this.model[t].name===this.item){this.label=this.model[t].label,e="picklist"===this.model[t].type||"multipicklist"===this.model[t].type?this.model[t]:{type:"string"};break}this.$.field.editing=!0,this.$.field.property=this.item,this.$.field.md=e}},{key:"clear",value:function(){this.value=null}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[i.CLEAR_PRODUCT_FILTER]=this.clear,e}},{key:"observers",get:function(){return["setFieldData(model)"]}}]),o=e)),t("ProductBundlesFilterItem",o),Polymer(o)}}}),System.register("products/config/bundles/sb-product-bundles-layout/ProductBundlesLayout.js",["../../search/ConfiguratorSearch.js","../../../../common/core/sb-page-container/PageContainer.js","common/core/AppContext.js","common/core/Events.js"],function(t,e){var a,i,o,r,s,l;return{setters:[function(e){a=e.ConfiguratorSearch},function(e){i=e.PageContainer},function(e){o=e.AppContext},function(e){r=e.Events,s=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductBundlesLayout",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-bundles-layout",this.properties={productIndex:{type:Number,notify:!0},selectedTabIndex:{type:Number,value:0},configuredProducts:Array,setToSections:{type:Boolean,value:!0},isClassic:Boolean,noHeader:{type:Boolean,value:!1},hasSelected:{type:Boolean,value:!1},hasMultipleBundles:{type:Boolean,value:!1,observer:"formatBundlesLayout"},drawerState:String,qId:String,searchFilters:Array,searchValuesByFilter:Object,searchFieldMD:Object,searchFilterTypeMap:Object,configSearch:Object,viewport:{type:Object,value:function(){return i.getViewport()}},isMobile:{type:Boolean,value:!1,computed:"_setIsMobile(viewport)"}}}},{key:"_resize",value:function(){this.resize()}},{key:"initSearchFilter",value:function(){this.$.group.group=this.searchFilters,this.$.group.model=this.searchFieldMD,this.$.group.data=this.searchValuesByFilter;var e={},t=!0,i=!1,n=void 0;try{for(var o,r=this.searchFieldMD[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;e[s.name]=s.type}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.searchFilterTypeMap=e,this.configSearch=new a(this.searchValuesByFilter,this.prefix,this.searchFilterTypeMap)}},{key:"ready",value:function(){this.handleResize(),this.handlePanelSlide(),this.handlePanelEvents(),this.handleMD()}},{key:"handlePanelEvents",value:function(){this.addEventListener("side-toggle-clicked",function(){this.toggle()}.bind(this)),this.addEventListener("iron-select",function(){"drawer"==this.$.drawer.selected?this.drawerState="open":this.drawerState="closed"}.bind(this)),this.addEventListener("x-clicked",function(){this.$.search.closeDrawer()}.bind(this)),this.addEventListener("enter-keypress",function(){this.searchFilters&&this.applyFilters()}.bind(this))}},{key:"handleMD",value:function(){this.$.md.addEventListener("md-changed",function(e){this.searchFieldMD=e.detail.value.fields}.bind(this))}},{key:"navTo",value:function(e){for(var t=Polymer.dom(e).rootTarget.id.split("_")[1],i=this.configuredProducts.length,n=this.productIndex,o=0;o<i;o++)this.getProductId(o)===t&&(n=o);this.setSelected(t),!this.isMobile&&this.isClassic?this.$$("#Bundle"+t).scrollIntoView():this.fire("bundle-panel-clicked",n)}},{key:"toggle",value:function(){this.toggleTransition(!0),this.$.drawer.togglePanel()}},{key:"classicOrSelectedIndex",value:function(e,t){return this.isClassic&&!this.isMobile||this.configuredProducts[this.productIndex]===e||!this.productIndex&&0===t||this.productIndex>=this.configuredProducts.length&&0===t}},{key:"handleResize",value:function(){var e=document.querySelector("#sidebarCell");e&&e.addEventListener("click",this.resize.bind(this)),window.addEventListener("resize",this.resize.bind(this))}},{key:"resize",value:function(){this.toggleTransition(!1),"drawer"===this.$.drawer.selected?this._setBundleContainerWidth(!1):this._setBundleContainerWidth(!0)}},{key:"handlePanelSlide",value:function(){this.isMobile||this.addEventListener("iron-select",function(){"drawer"===this.$.drawer.selected?this._setBundleContainerWidth(!1):this._setBundleContainerWidth(!0)}.bind(this)),this.isMobile&&this.addEventListener("iron-deselect",function(e){"drawer"===e.detail.item.id&&document.activeElement.blur()}.bind(this))}},{key:"_selectBundleObserver",value:function(e,t,i,n,o){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o)return this.selectBundle(e,t,i,n,o)}},{key:"selectBundle",value:function(){if(this.$.search.$$("#scrim").style.width="100%",this.isMobile&&(this.navWidth=0,this.$.drawer.$$("#scrim").style.width="100%"),1===this.configuredProducts.length&&(this.navWidth=0),this.buildPanelIfMultipleBundesAndNotMobile(),!this.isClassic||this.isMobile){var e=this.getProductId(this.productIndex);this.fire("bundle-name-changed",{name:this.configuredProducts[this.productIndex].record.Name}),Polymer.dom(this.$.panel).observeNodes(function(){this.setSelected(e)}.bind(this))}this.resize()}},{key:"buildPanelIfMultipleBundesAndNotMobile",value:function(){1===this.configuredProducts.length||this.isMobile||(this.panelWidth=256,this.navWidth=24,this.$.panel.rightSideButton=!0,this.toggleTransition(!1),"1"===this.isOpen?(this.$.drawer.selected="drawer",this.drawerState="open",this._setBundleContainerWidth(!1)):(this.$.drawer.selected="main",this.drawerState="closed",this._setBundleContainerWidth(!0)))}},{key:"_setBundleContainerWidth",value:function(e){this.configuredProducts&&this.configuredProducts.length<2||(this.toggleClass("open",!e,this.$.bundleContainer),this.toggleClass("close",e,this.$.bundleContainer))}},{key:"toggleTransition",value:function(e){this.$.drawer._transition=e,this.toggleClass("transition",e,this.$.bundleContainer)}},{key:"defaultState",value:function(){return"1"===this.isOpen?"drawer":"main"}},{key:"toggleSearch",value:function(){this.$.search.togglePanel()}},{key:"refocus",value:function(){this.$.search.querySelector("#searchPanel").querySelector("sb-group").$$("sb-product-bundles-filter-item").$$("sb-field").$$("div#f").firstChild.focus()}},{key:"reverseFocus",value:function(){this.$.clear.focus()}},{key:"setMD",value:function(){this.$.md.object="ProductOption__c",this.$.md.fields=this.searchFilters}},{key:"applyFilters",value:function(){this.$.clear.focus(),this.$.search.closeDrawer(),this.configSearch=new a(this.searchValuesByFilter,this.prefix,this.searchFilterTypeMap)}},{key:"clearFields",value:function(){s(r.CLEAR_PRODUCT_FILTER),this.blur(),this.configSearch=new a(this.searchValuesByFilter,this.prefix,this.searchFilterTypeMap)}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"getProductId",value:function(e,t){var i=this.configuredProducts[e];return(t?"_":"")+(i.productKey||i.record.Id)}},{key:"setSelected",value:function(e){this.removeAllSelected(),this.toggleClass("selected-tab",!0,this.$$("#_"+e))}},{key:"removeAllSelected",value:function(){var e=Polymer.dom(this.root).querySelectorAll("div.nav-item"),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.toggleClass("selected-tab",!1,s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"_setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"_updateProductFromPopupResponseObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._updateProductFromPopupResponse(e,t)}},{key:"_updateProductFromPopupResponse",value:function(){var e=this.popupResponse.products;if(e&&0!==e.length){var t=this.configuredProducts.length,i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;this.push("configuredProducts",a)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}1===t&&this.buildPanelIfMultipleBundesAndNotMobile()}}},{key:"formatBundlesLayout",value:function(){this.toggleClass("multiple-bundles",this.hasMultipleBundles,this.$.bundleContainer)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[r.VIEWPORT_CHANGED]=this.viewportChanged,e}},{key:"observers",get:function(){return["setMD(searchFilters)","initSearchFilter(searchFieldMD)","_updateProductFromPopupResponseObserver(popupResponse, configuredProducts)","_resize(configuredProducts.*)","_selectBundleObserver(isMobile, configuredProducts, isClassic, hasMultipleBundles, productIndex)"]}},{key:"prefix",get:function(){return o.org.prefix?o.org.prefix+"__":""}}]),l=e)),t("ProductBundlesLayout",l),Polymer(l)}}}),System.register("products/config/feature/sb-product-feature/ProductFeature.js",["../../../../common/layout/fields/FieldSetHandler.js","../../../../common/core/sb-page-container/PageContainer.js","common/core/AppContext.js","common/core/Events.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.FieldSetHandler},function(e){o=e.PageContainer},function(e){r=e.AppContext},function(e){s=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductFeature",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-feature",this.listeners={"selection-changed":"handleSelectionCounter"},this.properties={featureId:String,model:Object,maxOptions:Object,feature:Object,fieldSetKey:String,fieldSetHandler:Object,tabNames:{type:Array,readOnly:!0,value:["options","attributes"]},tabs:{type:Array,value:[]},viewport:{type:Object,value:function(){return o.getViewport()}},configSearch:Object,isMobile:{type:Boolean,value:!1,computed:"_setIsMobile(viewport)"},hasConfigAttributes:{type:Boolean,value:!1,computed:"_setHasConfigAttributes(model, featureId)"},hasTopConfigAttributes:{type:Boolean,computed:"_setHasTopConfigAttributes(model, featureId)"},hasBottomConfigAttributes:{type:Boolean,computed:"_setHasBottomConfigAttributes(model, featureId)"},mobileHasConfigAttributes:{type:Boolean,value:!1},hasOptions:{type:Boolean,computed:"_setHasOptions(model, featureId)"},mobileHasOptions:Boolean,hasOptionsAndConfigAttributes:{type:Boolean,value:!1,computed:"_setHasOptionsAndConfigAttributes(hasConfigAttributes, hasOptions)"},mobileHasOptionsAndConfigAttributes:Boolean,hasInstructions:{type:Boolean,computed:"_setHasInstructions(feature)"},mobileHasInstructions:Boolean,expanded:{type:Boolean,value:!1},selectedOptions:{type:Number,value:0},hasSelectedOptions:{type:Boolean,value:!1,computed:"_hasSelectedOptions(selectedOptions)"},featureIndex:Number,configAttributes:{type:Object,notify:!0},hasUpgradeOptions:{type:Boolean,computed:"_setHasUpgradedOptions(feature)"},mobileRendering:{type:Boolean,value:!1},mobileExpanded:{type:Boolean,value:!1},spinner:{type:Boolean,notify:!0},tabIndex:{type:Number,value:null}}}},{key:"_setHasUpgradedOptions",value:function(){return this.model.getHasUpgradeOptions(this.feature)}},{key:"_hasSelectedOptions",value:function(e){return!e}},{key:"_renderObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.render(e,t)}},{key:"render",value:function(){this.model.featureIdsWithOptionsOrConfigAttr[this.featureId]&&(this.setFeatureAndOptionSelectionMethod(),this.setOptionsDetails(),this.setFieldSetHandler(),this.renderFeatureInDesktopOrMobileView(),this.initSelectedOptions(),this.handleDeleteOptions(),this.handleOptionChangedByRule())}},{key:"_buildTabsObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.buildTabs(e,t,i)}},{key:"buildTabs",value:function(){if(this.isMobile){var e=r.properties.i18n.value(),t={name:"t1",label:e.l("Options"),pageComponent:"sb-product-option-table",attributes:[{name:"id",value:"ot"}],bind:["model","featureId","fieldSet","fieldSetName","routeSource","isClickSelection","disabledStateMap","configSearch","hasUpgradeOptions"]},i={name:"t2",label:e.l("Attributes"),pageComponent:"sb-attribute-table",attributes:[{name:"id",value:"configAttributesTop"},{name:"added-class",value:"header-attributes"}],bind:["featureId","model","configAttributes"]};this.tabs=[t,i]}}},{key:"setFieldSetHandler",value:function(){this.fieldSetHandler=new i(this.model.product.optionFieldSets,"OptionConfiguration","OptionConfigurationTablet","OptionConfigurationPhone")}},{key:"setFeatureAndOptionSelectionMethod",value:function(){this.feature=this.model.getFeature(this.featureId)}},{key:"setOptionsDetails",value:function(){this.isClickSelection="Click"===this.feature.optionSelectionMethod,this.routeSource="Configurator"}},{key:"featureChanged",value:function(){var e=this.feature.record[this.model.prefix+"ConfigurationFieldSet__c"];this.fieldSetKey=void 0===e?null:e}},{key:"setFieldSetFromViewport",value:function(){var e=this.fieldSetHandler.getByViewport(this.viewport);this.fieldSet=e.fields,this.fieldSetName=e.name}},{key:"_initFieldSetObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.initFieldSet(e,t,i)}},{key:"initFieldSet",value:function(){this.fieldSetKey?(this.fieldSet=this.model.product.optionFieldSets[this.fieldSetKey],this.fieldSetName=this.fieldSetKey):this.setFieldSetFromViewport()}},{key:"_setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"_setHasConfigAttributes",value:function(e,t){var i=this.model.configAttributesByFeatureId[t];if(!i)return!1;for(var n=0;n<i.length;n++)if(!i[n].hidden)return!0;return!1}},{key:"_setHasTopConfigAttributes",value:function(e,t){return this._hasTopOrBottomConfigAttributes("Top",t)}},{key:"_setHasBottomConfigAttributes",value:function(e,t){return this._hasTopOrBottomConfigAttributes("Bottom",t)}},{key:"_hasTopOrBottomConfigAttributes",value:function(e,t){if(!this.model.configAttributesByFeatureId[t])return!1;var i=!0,n=!1,o=void 0;try{for(var r,s=this.model.configAttributesByFeatureId[t][Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;if(a.position===e&&!a.hidden)return!0}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return!1}},{key:"_setHasOptions",value:function(){return!!this.model.optionsByFeatureId[this.featureId]||this.model.featureIdsWIthSelectionMethodDynamic[this.featureId]}},{key:"_setHasOptionsAndConfigAttributes",value:function(e,t){return e&&t}},{key:"_setHasInstructions",value:function(){return!!this.feature.instructionsText||!!this.feature.additionalInstructions}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport,this.fieldSetKey||this.setFieldSetFromViewport()}},{key:"renderFeatureInDesktopOrMobileView",value:function(){this.toggleClass("group",!this.isMobile,this.$.feature)}},{key:"applyFilters",value:function(){var e=this.model.getOptionsByFeatureId(this.featureId),t=new ConfiguratorSearch(this.searchFilters,e,{});this.filtered=!t.hasOptions||!t.containsFeature(this.feature)}},{key:"mobileExpand",value:function(e){var t=this;this.mobileExpanded?this.expand(e):this.mobileRendering||(this.mobileRendering=!0,this.toggleClass("first",!1,this.$$("header")),Polymer.RenderStatus.afterNextRender(this,function(){t.mobileHasInstructions=t.hasInstructions,t.mobileHasOptionsAndConfigAttributes=t.hasOptionsAndConfigAttributes,t.mobileHasConfigAttributes=t.hasConfigAttributes,t.mobileHasOptions=t.hasOptions,Polymer.dom(t.$.feature).observeNodes(function(){this.mobileExpanded=!0,this.mobileRendering=!1,this.toggleClass("first",!0,this.$$("header")),this.expand(e)}.bind(t))}))}},{key:"expand",value:function(e){this.expanded=!this.expanded,this.fire("feature-expanded",{expanded:this.expanded,path:Polymer.dom(e).path})}},{key:"initSelectedOptions",value:function(){for(var e=""!==r.org.prefix?r.org.prefix+"__":"",t=this.model.getOptionsByFeatureId(this.featureId),i=0,n=t.length;i<n;i++)if(t[i].selected&&this.selectedOptions++,void 0===t[i].record[e+"UnitPrice__c"])return console.warn("Option is missing entry in selected pricebook => "+t[i].record[e+"ProductCode__c"]+": "+t[i].record[e+"ProductName__c"]),!0}},{key:"handleSelectionCounter",value:function(e){e.detail.changed&&("radio"!==e.detail.selectionType?(this.selectedOptions||e.detail.selected)&&(this.selectedOptions+=e.detail.selected?1:-1):this.selectedOptions=e.detail.selected?1:0)}},{key:"handleDeleteOptions",value:function(e){this.addEventListener("delete-tapped",function(e){0<this.selectedOptions&&this.selectedOptions--})}},{key:"handleOptionChangedByRule",value:function(e){this.addEventListener("option-changed-by-rule",function(e){e.detail.added?this.selectedOptions++:this.selectedOptions--})}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[s.VIEWPORT_CHANGED]=this.viewportChanged,e}},{key:"observers",get:function(){return["_renderObserver(featureId, model)","_buildTabsObserver(viewport, model, featureId)","featureChanged(feature)","_initFieldSetObserver(model, fieldSetKey, fieldSetHandler)"]}}]),a=e)),t("ProductFeature",a),Polymer(a)}}}),System.register("products/config/feature/sb-product-feature-category-list/ProductFeatureCategoryList.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductFeatureCategoryList",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-feature-category-list",this.properties={categoryNamesOrFeatures:Array,hasCategories:{type:Boolean,value:!1}}}},{key:"setHasCategories",value:function(e){this.hasCategories=e.checkAtLeastOneFeatureHasCategory()}},{key:"_setCategoryNamesOrFeaturesObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setCategoryNamesOrFeatures(e,t)}},{key:"setCategoryNamesOrFeatures",value:function(e,t){this.categoryNamesOrFeatures=t?Object.keys(e.getTabFeaturesMap()):e.featuresWithOptionsOrConfigAttr}},{key:"getFeaturesByCategory",value:function(e){return this.model.getTabFeaturesMap()[e]}},{key:"observers",get:function(){return["setHasCategories(model)","_setCategoryNamesOrFeaturesObserver(model, hasCategories)"]}}]),i=e)),t("ProductFeatureCategoryList",i),Polymer(i)}}}),System.register("products/config/feature/sb-product-feature-layout/ProductFeatureLayout.js",["../../../../common/core/Page.js","../../../../common/core/sb-page-container/PageContainer.js","../../viewmodel/ProductViewModel.js","../../../resources/optionConstraints/OptionConstraintsHandler.js","common/core/Events.js"],function(t,e){var i,o,r,s,a,l,u,d;return{setters:[function(e){i=e.Page},function(e){o=e.PageContainer},function(e){r=e.ProductViewModel},function(e){s=e.OptionConstraintsHandler},function(e){a=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("ProductFeatureLayout",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),u(e,[{key:"beforeRegister",value:function(){this.is="sb-product-feature-layout",this.properties=Polymer.Base.extend({qId:String,product:Object,model:Object,configAttributes:{type:Object,notify:!0},features:{type:Object,value:{},computed:"_setFeatures(model)"},vp:{type:Object,value:function(){return o.getViewport()}},isMobile:{type:Boolean,value:!1,computed:"_setIsMobile(vp)"},hasTopConfigAttributes:{type:Boolean,computed:"_setHasTopConfigAttributes(configAttributes)"},hasBottomConfigAttributes:{type:Boolean,computed:"_setHasBottomConfigAttributes(configAttributes)"},hasFeaturelessConfigAttributes:{type:Boolean,computed:"_setHasFeaturelessConfigAttributes(configAttributes)"},isMobileAndHasConfigAttributes:{type:Boolean,value:!1,computed:"_setIsMobileAndHasFeaturelessConfigAttributes(isMobile, hasFeaturelessConfigAttributes)"},isSectionLayout:{type:Boolean,value:!1},isPaginationRequired:{type:Boolean,value:!1},tabsForFeatureLayout:Object,tabsForTabsAndWizardLayout:Object,selectedTabIndex:{type:Number,notify:!0},optionConstraintsHandler:{type:Object,value:{},computed:"setOptionConstraintsHandler(model)"},disabledStateMap:{type:Object,value:{}},configSearch:Object,listenersAttached:{type:Boolean,value:!1},spinner:{type:Boolean}},i.properties)}},{key:"_buildModelObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.buildModel(e,t,i)}},{key:"buildModel",value:function(){this.model=new r(this.qId,this.product,this.app.org.prefix,this.currencyIsoCode)}},{key:"_setConfigAttributes",value:function(){this.configAttributes=this.model.configurationAttributeValueMap}},{key:"_setHasFeaturelessConfigAttributes",value:function(){var e=this.model.configAttributesByFeatureId.featureless;if(!e)return!1;for(var t=0;t<e.length;t++)if(!e[t].hidden)return!0;return!1}},{key:"_setFeatures",value:function(e){return e.featuresWithOptionsOrConfigAttr}},{key:"_setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"_setHasTopConfigAttributes",value:function(e){if(!this.model||!this.model.configAttributesByFeatureId.featureless)return!1;var t=!0,i=!1,n=void 0;try{for(var o,r=this.model.configAttributesByFeatureId.featureless[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;if("Top"===s.position&&!s.hidden)return!0}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return!1}},{key:"_setHasBottomConfigAttributes",value:function(e){if(!this.model||!this.model.configAttributesByFeatureId.featureless)return!1;var t=!0,i=!1,n=void 0;try{for(var o,r=this.model.configAttributesByFeatureId.featureless[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;if("Bottom"===s.position&&!s.hidden)return!0}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return!1}},{key:"_setIsMobileAndHasFeaturelessConfigAttributes",value:function(e,t){return e&&t}},{key:"viewportChanged",value:function(e){this.vp=e.detail.viewport}},{key:"_renderObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.render(e,t)}},{key:"render",value:function(){var e=this.model.getOptionLayout();if(this.isMobile&&(e="Sections",this.hasFeaturelessConfigAttributes))return this.buildFeatureLayoutTabs(),void this.handleOptionSelectionChanged();this.isSectionLayout&&(e="Sections"),this.isMobile||"Tabs"!==e&&!this.model.checkAtLeastOneFeatureHasCategory()?"Wizard"===e?(this.buildTabsAndWizardLayoutTabs(),this.isPaginationRequired=!0):"Sections"!==e&&"None"!==e||(this.isSectionLayout=!0):(this.buildTabsAndWizardLayoutTabs(),this.isPaginationRequired=!1),this.handleOptionSelectionChanged(),this.listenersAttached=!0}},{key:"buildFeatureLayoutTabs",value:function(){var e={name:"t1",label:this.i18n.l("Features"),pageComponent:"sb-product-feature-category-list",bind:["model","configAttributes","disabledStateMap","configSearch"]},t={name:"t2",label:this.i18n.l("Attributes"),pageComponent:"sb-attribute-table",attributes:[{name:"id",value:"globalConfigAttributes"},{name:"added-class",value:"header-attributes"},{name:"feature-id",value:"featureless"}],bind:["model","configAttributes"]};this.tabsForFeatureLayout=[e,t]}},{key:"buildTabsAndWizardLayoutTabs",value:function(){for(var e=this.model.getTabFeaturesMap(),t=Object.keys(e),i=[],n=0,o=t.length;n<o;n++){var r="t"+n;i.push({name:r,label:t[n]})}this.isSectionLayout=!1,this.tabsForTabsAndWizardLayout=i}},{key:"setOptionConstraintsHandler",value:function(){return new s(this.model.product,this.model.prefix)}},{key:"handleOptionSelectionChanged",value:function(){this.listenersAttached||(this.addEventListener("selection-changed",function(e){if(e&&e.detail){if(!1===e.detail.selected&&this.model.getOption(e.detail.Id).added){var t=this.model.getOption(e.detail.Id);t.added=!1,t.removed=!0}this.handleOptionConstraints(e.detail.Id,e.detail.selected)}}),this.addEventListener("delete-tapped",function(e){if(e&&e.detail&&!this.hasSameOptionAdded(e.detail.Id)){var t=this.model.getOption(e.detail.Id);t.added=!1,t.removed=!0,t._transient_&&(t._transient_.rendered=!1),this.handleOptionConstraints(e.detail.Id,!1)}}.bind(this)))}},{key:"hasSameOptionAdded",value:function(e){for(var t=this.model.getOption(e).record[this.model.prefix+"Feature__c"],i=this.model.getFeature(t),n=i?i._transient_.optionConfigurations:[],o=0,r=n.length;o<r;o++)if(n[o].record.Id===e)return!0;return!1}},{key:"handleOptionConstraints",value:function(e,t){var i=this,n=this.optionConstraintsHandler.handleOptionConstraints(e,t);n&&n.forEach(function(e){i.set("disabledStateMap."+e.optionId,e.disabledState)})}},{key:"_handleProductRulesResponseObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.handleProductRulesResponse(e,t)}},{key:"handleProductRulesResponse",value:function(){this.domHost&&this.product.configuration.productRulesActions&&(this.setOptionsDisabledByRules(Object.keys(this.product.configuration.productRulesActions.enableOptions),!1),this.setOptionsDisabledByRules(Object.keys(this.product.configuration.productRulesActions.disableOptions),!0),this.setOptionsHiddenByRules(Object.keys(this.product.configuration.productRulesActions.hideOptions),!0),this.setOptionsHiddenByRules(Object.keys(this.product.configuration.productRulesActions.showOptions),!1),this.setOptionsSelectedByRules(Object.keys(this.product.configuration.productRulesActions.selectOptions),!0),this.setOptionsSelectedByRules(Object.keys(this.product.configuration.productRulesActions.deselectOptions),!1),this.set("model.productRulesActions",this.product.configuration.productRulesActions),delete this.product.configuration.productRulesActions)}},{key:"setOptionsDisabledByRules",value:function(e,t){var i=t?"disableOptions":"enableOptions",n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(this.model.optionSystemOrRequired(l))delete this.product.configuration.productRulesActions[i][l];else{var u=t?this.optionConstraintsHandler.optionShouldBeDisabled(l):!this.optionConstraintsHandler.optionShouldBeDisabled(l);this.product.configuration.productRulesActions[i][l]=u;var d=!!(t&&u||!t&&!u);this.model.getOption(l).disabledData={disabled:t,constrained:d}}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}},{key:"setOptionsHiddenByRules",value:function(e,t){var i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=this.model.getOption(a);l.hidden=t,l.hiddenByRule=t,this.handleFeatureVisibility(this.model.featureIdByOptionId[a])}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}},{key:"setOptionsSelectedByRules",value:function(e,t){var i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=this.model.getOption(a);l.selected=t,l.selectedByRule=t}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}},{key:"_setOptionSelections",value:function(i,e,n){e&&Object.keys(e).forEach(function(e){var t=i.getOption(e);t&&t.selected!==n&&(t.selected=n)})}},{key:"handleFeatureVisibility",value:function(t){var e=this.checkFeatureHasVisibleOptions(t),i=this.features.findIndex(function(e){return e.record.Id===t});this.set(["features",i,"hidden"],e)}},{key:"checkFeatureHasVisibleOptions",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.model.optionsByFeatureId[e][Symbol.iterator]();!(t=(o=r.next()).done);t=!0)if(!o.value.hidden)return!1}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return!0}},{key:"_setOptionDataObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._setOptionData(e,t)}},{key:"_setOptionData",value:function(){this.domHost&&(this.set("model.optionDataByOptionIdAndIndex",this.product.configuration.optionDataByOptionIdAndIndex),delete this.product.configuration.optionDataByOptionIdAndIndex)}},{key:"_updateProductFromPopupResponseObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._updateProductFromPopupResponse(e,t)}},{key:"_updateProductFromPopupResponse",value:function(){this.popupResponse.dynamicOptions&&0<this.popupResponse.dynamicOptions.length||this._bindResponseChangesToUI()}},{key:"_bindResponseChangesToUI",value:function(){this.model.init(this.popupResponse.product),this._setConfigAttributes(),this.set("model.optionNotifications",this.popupResponse.optionNotifications)}},{key:"handleDynamicOptionsAdded",value:function(e){for(var t in e){var i=this._getDynamicOption(t,e[t].record[this.model.prefix+"Feature__c"]),n=this._extendDataToOption(e[t],i),o=this.model.getFeature(i.featureId);this.popupResponse.product.options.push(n),o._transient_.optionConfigurations.push(n),o._transient_.changedExternally=!0}this.syncConfigurationAttributesToProduct(n),this._bindResponseChangesToUI()}},{key:"_getDynamicOption",value:function(t,i){return this.popupResponse.dynamicOptions.find(function(e){return e.productId.substring(0,15)===t.substring(0,15)&&e.featureId.substring(0,15)===i.substring(0,15)})}},{key:"_extendDataToOption",value:function(e,t){if(t.configurationData&&"object"===l(t.configurationData))for(var i in t.configurationData)e.record[i]=t.configurationData[i];return e.record[this.model.prefix+"Quantity__c"]=t.Quantity,e.index=t.index,e.isDynamicOption=!0,e.selected=!0,e.added=!0,void 0===e.record[this.model.prefix+"UnitPrice__c"]&&(e.record[this.model.prefix+"UnitPrice__c"]=0),e}},{key:"syncConfigurationAttributesToProduct",value:function(e){if(void 0===this.autoSelectAttributes){var t=!0,i=!(this.autoSelectAttributes={}),n=void 0;try{for(var o,r=this.popupResponse.product.configurationAttributes[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;!0===s.autoSelect&&void 0===this.autoSelectAttributes[s.targetFieldName]&&(this.autoSelectAttributes[s.targetFieldName]=!0)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}for(var a in this.autoSelectAttributes)this.popupResponse.product.configuration.configurationData[a]=e.record[a]}},{key:"_createConstraintsHoverMessagesObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._createConstraintsHoverMessages(e,t)}},{key:"_createConstraintsHoverMessages",value:function(){this.model.optionConstraintsByConstrained||this.model.createConstraintsHoverMessages(this.optionConstraintsHandler.optionConstraints.byConstrained)}},{key:"_setSelectedForConstraintsObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setSelectedForConstraints(e,t)}},{key:"setSelectedForConstraints",value:function(){var e=this.optionConstraintsHandler.getConstrainingByConstrained(),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value,a=!0,l=!1,u=void 0;try{for(var d,c=s[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value,f=h.selected&&!this.disabledStateMap[h.record.Id];this.handleOptionConstraints(h.record.Id,f)}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[a.VIEWPORT_CHANGED]=this.viewportChanged,e}},{key:"observers",get:function(){return["_setConfigAttributes(model)","_renderObserver(model, isSectionLayout)","_buildModelObserver(product, qId, currencyIsoCode)","_handleProductRulesResponseObserver(model, disabledStateMap, product.configuration.*)","_setOptionDataObserver(model, product.configuration.optionDataByOptionIdAndIndex)","_updateProductFromPopupResponseObserver(popupResponse, model)","_createConstraintsHoverMessagesObserver(model, optionConstraintsHandler)","_setSelectedForConstraintsObserver(optionConstraintsHandler.optionConstraints, disabledStateMap)"]}}]),d=e)),t("ProductFeatureLayout",d),Polymer(d)}}}),System.register("products/config/feature/sb-product-feature-list/ProductFeatureList.js",["common/core/AppContext.js","common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.AppContext},function(e){o=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductFeatureList",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-feature-list",this.properties={features:Object,configSearch:Object,model:Object,label:String,spinner:{type:Boolean,value:!1},show:{type:Boolean,value:!1},tabIndex:{type:Number,value:null},viewport:{type:Object,value:function(){return o.getViewport()}}}}},{key:"_initLazyTabRenderingObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.initLazyTabRendering(e,t)}},{key:"initLazyTabRendering",value:function(e,t){this.show=!0===this.isMobile()||null===e,!1===this.show&&this.addEventListener("sb-tab-selected",this.handleTabSelected.bind(this))}},{key:"_initFeaturesObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.initFeatures(e,t)}},{key:"initFeatures",value:function(){this.features=this.features||this.model.getTabFeaturesMap()[this.label]}},{key:"filterFeaturesFromRules",value:function(e){this.configSearch&&this.features&&e&&0<Object.keys(e).length&&this.filterFeatures(this.configSearch,this.features,this.model,e)}},{key:"_filterFeaturesObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.filterFeatures(e,t,i)}},{key:"filterFeatures",value:function(e,t,i,n){this.domHost?this._filterFeatures(e,t,i,n):this._filterQueuedForNextRender||(Polymer.RenderStatus.afterNextRender(this,this._filterFeatures.bind(this,e,t,i,n)),this._filterQueuedForNextRender=!0)}},{key:"_filterFeatures",value:function(e,t,i,n){for(var o=!0,r=0,s=this.features.length;r<s;r++)o=this._filterFeatureByIndex(e,t,i,n,r)&&o;this._parentHandleContentFiltered(!o),this._filterQueuedForNextRender=!1}},{key:"_parentHandleContentFiltered",value:function(e){null!=this.label&&this.domHost&&"function"==typeof this.domHost.contentFilteredHandler&&this.domHost.contentFilteredHandler(this.label,e)}},{key:"_filterFeatureByIndex",value:function(e,t,i,n,o){var r=n?n.showOptions:null,s=i.optionsByFeatureId[t[o].record.Id]||[];s=e.setOptionVisibility(s);var a=this._hideFeature(e,t[o],i,s,r);return this.set("features."+o+".hidden",a),a}},{key:"_hideFeature",value:function(e,t,i,n,o){if(e.hasRequiredConfigAttributes(t,i))return!1;if(!e.containsFeature(t))return!0;if(e.hasVisibleOptions(n,o))return!1;var r=e.allOptionsHiddenByRule(n),s=e.hasConfigAttributes(t,i);if(r&&s)return!1;var a=t.optionSelectionMethod;return"Click"===a||!!i.maxOptionsMet(t)||"Dynamic"!==a&&!e.hasVisibleOptions(t._transient_.optionConfigurations,o)}},{key:"handleFeatureExpandEvent",value:function(){this.addEventListener("feature-expanded",function(t){t.detail.path.forEach(function(e){if("feature-header"===e.id)for(;e.nextElementSibling;)e.classList.toggle("expanded",t.detail.expanded),e=e.nextElementSibling}.bind(this))}.bind(this))}},{key:"handleTabSelected",value:function(){!0!==this.show&&(this.spinner=!0,this.async(this.renderComponent.bind(this),0))}},{key:"renderComponent",value:function(){this.renderingComponent||(this.renderingComponent=!0,Polymer.RenderStatus.afterNextRender(this,function(){this.show=!0,this.spinner=!1,this.renderingComponent=!1}.bind(this)))}},{key:"isMobile",value:function(){return!(!this.viewport||!this.viewport.isMobile())}},{key:"_setFeatureOptionsAsRenderedObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.setFeatureOptionsAsRendered(e,t,i)}},{key:"setFeatureOptionsAsRendered",value:function(){var i=this;!1!==this.show&&this.features.forEach(function(e){i.model.getOptionsByFeatureId(e.record.Id).forEach(function(t){"Add"==e.optionSelectionMethod&&(t=i.model.product.options.find(function(e){return e.record.Id===t.record.Id})),t._transient_=t._transient_||{},t._transient_.rendered=!0})})}},{key:"observers",get:function(){return["_initFeaturesObserver(label, model)","_filterFeaturesObserver(configSearch, features, model)","filterFeaturesFromRules(model.productRulesActions)","handleFeatureExpandEvent(features)","_setFeatureOptionsAsRenderedObserver(show, features, model)","_initLazyTabRenderingObserver(tabIndex, viewport)"]}},{key:"prefix",get:function(){return i.org.prefix?i.org.prefix+"__":""}}]),r=e)),t("ProductFeatureList",r),Polymer(r)}}}),System.register("products/config/option/sb-option-cell/OptionCell.js",["common/core/AppContext.js","common/relationship/RelationshipFieldManager.js","common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.AppContext},function(e){o=e.RelationshipFieldManager},function(e){r=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("OptionCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-option-cell",this.properties={item:String,itemLabel:String,value:{notify:!0},model:Object,data:Object,prefix:{type:String,value:function(){return i.org.prefix?i.org.prefix+"__":""}},selected:{type:Boolean,value:!1},index:Number,display:String,viewport:{type:Object,value:function(){return r.getViewport()}},optionDrawer:{type:Boolean,value:function(){return this.classList.contains("drawerCell")}},renderReadOnly:{type:Boolean,computed:"getRenderReadOnly(optionDrawer)"},isDisabled:{type:Boolean,computed:"getDisabled(optionDrawer, selected)"}}}},{key:"_buildCellObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this.buildCell(e,t,i,n)}},{key:"buildCell",value:function(){this.field=this.getField(),this.itemLabel===this.prefix+"Quantity__c"?this.initQuantityCell():this.itemLabel===this.prefix+"UnitPrice__c"?this.initUnitPriceCell():this.initCell()}},{key:"getQuantityEditable",value:function(){return this.getFieldRecordValue("QuantityEditable__c")||!1===this.data.recordHasQuantity}},{key:"getPriceEditable",value:function(){return"Yes"===this.getFieldRecordValue("PriceEditable__c")&&!1===this.getFieldRecordValue("Bundled__c")}},{key:"getField",value:function(){return this.model.fieldDetails[this.item]}},{key:"initQuantityCell",value:function(){if(!0===this.data.hasDimension&&!0===this.data.isSegmented&&!0===this.data.configured)return this.mdqWarningIcon=!0;this.editable=this.getQuantityEditable(),null!=this.getFieldRecordValue("ProductQuantityScale__c")?(this.field=JSON.parse(JSON.stringify(this.field)),this.field.scale=this.getFieldRecordValue("ProductQuantityScale__c")):void 0!==i.org.quantityScale&&(this.field.scale=i.org.quantityScale),this.$.field.preventNumericAlignment=!0,this.attachQuantityChangeCallback(),this.initCell()}},{key:"initUnitPriceCell",value:function(){this.editable=this.getPriceEditable(),null!=i.org.currencyDecimalScale&&(this.field.scale=i.org.currencyDecimalScale),this.initCell()}},{key:"initCell",value:function(){0===this.index&&this.viewport&&this.viewport.isMobile()&&(this.editable=!1),void 0===this.editable&&this.optionDrawer&&(this.editable=!0),void 0===this.editable&&(this.editable=this.field.updateable&&this.quoteLineHasField(this.itemLabel)),void 0===this.value&&(this.value=""),this.setDisplayIfRelationshipItem(),this.attachValueChangedCallback(),this.handleOriginalValues(),(this.$.field.record=this).$.field.md=this.field}},{key:"attachQuantityChangeCallback",value:function(){this.addEventListener("value-changed",function(e){this.fire("sb-quantity-changed",{Id:this.data.record.Id,bundleId:this.getBundleId(),changed:!0,invalidQuantity:this.data.invalidQuantity,validQuantity:this.data.validQuantity,path:e.composedPath?e.composedPath():[e.target.parentNode]})}.bind(this))}},{key:"attachValueChangedCallback",value:function(){this.addEventListener("value-changed",this.syncValueChangeWithOptionConfiguration.bind(this))}},{key:"getBundleId",value:function(){return this.data.parentProductKey||this.getFieldRecordValue("ConfiguredSKU__c")}},{key:"getFieldRecordValue",value:function(e){return this.data.record[this.prefix+e]}},{key:"quoteLineHasField",value:function(e){return!!this.model.quoteLineFields[e]}},{key:"setItemLabel",value:function(){this.item.startsWith("record.")?this.itemLabel=this.item.split(".")[1]:this.itemLabel=this.item}},{key:"syncValueChangeWithOptionConfiguration",value:function(){if(this.data.configuration&&0!=this.data.configuration.length&&!(1<this.data.configuration.length)){var e=this.data.configuration[0].optionData;if(e){var t=this.item.split("."),i=t[t.length-1];void 0!==e[i]&&(e[i]=this.value)}}}},{key:"handleOriginalValues",value:function(){!this.data._transient_.original&&this.data.record&&(this.data._transient_.original={},this.data._transient_.original.record=JSON.parse(JSON.stringify(this.data.record))),this.data._transient_.original&&(this.data._transient_.original.record.hasOwnProperty(this.item.split(".")[1])||this.set("data._transient_.original."+this.item,this.value),this.$.field.originalValue=this.get("data._transient_.original."+this.item))}},{key:"setDisplayIfRelationshipItem",value:function(){var t=this,e=new o(this.item,null,function(e){return t.get("data."+e)},this.setValue.bind(this));e.hasRelationship()&&(this.display=e.getRelationshipName())}},{key:"_displayChangedObserver",value:function(e,t,i,n,o){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n&&void 0!==o)return this._displayChanged(e,t,i,n,o)}},{key:"_displayChanged",value:function(){var t=this;new o(this.item,null,function(e){return t.get("data."+e)},this.setValue.bind(this)).addRelationshipName(this.value,this.display,this.field.referenceTo[0])}},{key:"getValue",value:function(e){return this.data.record[e]}},{key:"setValue",value:function(e,t){this.set("data."+e,t)}},{key:"equals",value:function(e){return this.data===e.data}},{key:"getRenderReadOnly",value:function(){return!this.optionDrawer}},{key:"getDisabled",value:function(){return!!this.optionDrawer||this.selected}},{key:"observers",get:function(){return["_buildCellObserver(itemLabel, model, data, prefix)","setItemLabel(item)","_displayChangedObserver(value, display, item, data, field)"]}}]),s=e)),t("OptionCell",s),Polymer(s)}}}),System.register("products/config/option/sb-option-drawer/OptionDrawer.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("OptionDrawer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-option-drawer",this.properties={option:Object,md:Object,fieldNames:Array,richTextFields:Array}}},{key:"_setFieldNamesAndRichTextFieldsObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setFieldNamesAndRichTextFields(e,t)}},{key:"setFieldNamesAndRichTextFields",value:function(){var e=[],t=[];for(var i in this.option._transient_.attributeItems)e.push("record."+i),this.md.fieldDetails["record."+i]&&"richtextarea"===this.md.fieldDetails["record."+i].extraTypeInfo&&t.push("record."+i);this.fieldNames=e,this.richTextFields=t}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_setFieldNamesAndRichTextFieldsObserver(option, md)"]}}]),i=e)),t("OptionDrawer",i),Polymer(i)}}}),System.register("products/config/option/sb-product-option-table/ProductOptionTable.js",["../../../../common/core/AppContext.js","common/layout/tables/ImageCellSizer.js","common/layout/tables/TableClassBuilder.js","common/core/sb-page-container/PageContainer.js","products/resources/optionUpgrades/OptionUpgradeHandler.js","../../../../common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js","common/core/Events.js"],function(t,e){var r,i,o,a,l,s,c,u;return{setters:[function(e){e.AppContext},function(e){r=e.ImageCellSizer},function(e){i=e.TableClassBuilder},function(e){o=e.PageContainer},function(e){a=e.OptionUpgradeHandler},function(e){l=e.AssetUpgradeQuantityCalculator},function(e){s=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},t("ProductOptionTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-option-table",this.properties={featureId:String,model:Object,isClickSelection:Boolean,index:String,routeSource:String,options:Array,showAddOptionsButton:Boolean,md:Object,fieldSet:Array,featureless:Boolean,prefix:{type:String,computed:"getPrefix(model)"},primaryMobileCol:{type:Array,computed:"_getPrimaryMobileColumns(prefix, fieldSet, fieldSetName)"},parentIdDataPath:{type:String,computed:"setParentIdDataPath(model, prefix)"},disabledStateMap:Object,disableAllFields:Boolean,configSearch:Object,viewport:{type:Object,value:function(){return o.getViewport()}},showUpgradeOptions:{type:Boolean,value:!1},upgradeOptionButtonText:{type:String,value:"Show Available Upgrades"},hasUpgradeOptions:Boolean,headerActions:{type:Array,value:[]},spinner:{type:Boolean,notify:!0},attributeItemFields:{type:Array,value:[]},productHasAttributeSet:Boolean,displayStyle:{type:String,computed:"_getDisplayStyle(productHasAttributeSet)"},tabIndex:{type:Number,value:null}}}},{key:"ready",value:function(){this.$.header.selectable=!1,this.handleSelectionChanged(),this.handleMetadataChanged(),this.handleDeleteOption(),this.handleConfigureOption(),this.viewport&&this.viewport.isMobile()||(this.editFirstWhenSelected="sb-field")}},{key:"handleSelectionChanged",value:function(){this.addEventListener("selection-changed",this._selectionChanged.bind(this)),this.addEventListener("sb-quantity-changed",this._handleOptionUpgrades.bind(this))}},{key:"_selectionChanged",value:function(e){this.model.setOptionSelected(e.detail.Id,e.detail.selected),this.ifRadioSelectedClearOtherRadioSelections(e);var t=null!=e.detail.index?e.detail.index:this.getOptionIndex(e.detail.Id);if(!(t<0)){if(!0===e.detail.selected&&"Configurator"===this.routeSource?(this._displayAvailableRowActions(t,!1),this.set(["options",t,"selected"],e.detail.selected)):this._displayAvailableRowActions(t,!0),!e.detail.selected&&e.detail.changed){var i=this.model.originalDataByOptionIds[e.detail.Id];i.priceRule&&(this.set(["options",t,"record",this.prefix+"Discount__c"],i.discountRate),this.set(["options",t,"record",this.prefix+"DiscountAmount__c"],i.discountAmount),this.set(["options",t,"record",this.prefix+"UnitPrice__c"],i.unitPrice),this.set(["options",t,"record",this.prefix+"Quantity__c"],i.quantity))}"Configurator"===this.routeSource&&e.detail.path&&this.options.length>t&&(this.options[t].upgradedAssetId||this.options[t].sourceProductIds)&&this._handleOptionUpgrades(e,t)}}},{key:"_displayAvailableRowActions",value:function(e,t){if(!(this.options.length<=e))for(var i=0;i<this.options[e]._transient_.rowActions.length;i++)this.set(["options",e,"_transient_.rowActions",i,"invisible"],t),"OptionLookup"===this.routeSource&&this.set(["options",e,"_transient_.rowActions",i,"hidden"],t),"Configure"===this.options[e]._transient_.rowActions[i].title&&!0!==this.options[e].configurable&&this.set(["options",e,"_transient_.rowActions",i,"invisible"],!0)}},{key:"handleMetadataChanged",value:function(){this.$.fieldMetaData.addEventListener("md-changed",function(e){var t=this.initFieldMetadata(e.detail.value.fieldsByObject);this.rowClassMap=t.fieldSetMd.rowClassMap,this.md=t.fieldSetMd,this.attributeItemMd=t.attributeItemMd,this.spinner=!1}.bind(this))}},{key:"_handleOptionUpgrades",value:function(e,t){var i=this;if("Amendment"===this.model.product.quoteType){var n=this.options[t||this.getOptionIndex(e.detail.Id)],o=new a(this.prefix,this.options,n);if(new l(o).setQuantitiesByRatio(),o.getSourceOption()||o.getUpgradeOption()){var r=this.getOptionIndex(o.getSourceOption().record.Id),s=this.getOptionIndex(o.getUpgradeOption().record.Id);this.debounce("Wait for function to finish",function(){var e=o.getSourceOption(),t=o.getUpgradeOption();e.invalidQuantity?i._notifyQuantityChange(r,s,e,!0):t.invalidQuantity?i._notifyQuantityChange(s,r,t,!0):i._notifyQuantityChange(r,s),e.invalidQuantity=null,t.invalidQuantity=null},10)}}}},{key:"_notifyQuantityChange",value:function(e,t,i,n){n&&(i.record[this.prefix+"Quantity__c"]=i.invalidQuantity,this.notifyPath(["options",e,"record",this.prefix+"Quantity__c"]),i.record[this.prefix+"Quantity__c"]=i.validQuantity),this.notifyPath(["options",t,"record",this.prefix+"Quantity__c"]),this.notifyPath(["options",e,"record",this.prefix+"Quantity__c"])}},{key:"_getPrimaryMobileColumns",value:function(){var e=["record."+this.prefix+"ProductName__c"];return e&&0<e.length&&this.fieldSetName.endsWith("Phone")&&(e=["record."+this.fieldSet[0]]),e}},{key:"_setMetadataRequestObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this.setMetadataRequest(e,t,i,n)}},{key:"setMetadataRequest",value:function(){this.spinner=!0;var e=new Set,t=[],i=!0,n=!1,o=void 0;try{for(var r,s=this.fieldSet[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;e.add(a)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}e=this.setAttributeItemMetaData(e);var l=!0,u=!1,d=void 0;try{for(var c,h=e.values()[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var f=c.value;t.push("ProductOption__c."+f),t.push("QuoteLine__c."+f)}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}JSON.stringify(this.$.fieldMetaData.fields)!==JSON.stringify(t)&&(this.$.fieldMetaData.fields=t)}},{key:"setAttributeItemMetaData",value:function(e){var t=new Set,i=!0,n=!1,o=void 0;try{for(var r,s=this.options[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;if(this.hasAttributeItems(a))for(var l in a._transient_.attributeItems)e.add(l),t.add(l)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}var u=!0,d=!1,c=void 0;try{for(var h,f=t.values()[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;this.attributeItemFields.push(p)}}catch(e){d=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw c}}return e}},{key:"initFieldMetadata",value:function(e){var t={fieldLabelMap:{},recordKeys:[],fieldLabels:[],fieldDetails:{},labelTypeMap:{},itemTypeMap:{},fields:this.fieldSet},i={fieldLabelMap:{},recordKeys:[],fieldLabels:[],fieldDetails:{},labelTypeMap:{},itemTypeMap:{},fields:this.attributeItemFields};for(var n in e[this.prefix+"ProductOption__c"]){var o=e[this.prefix+"ProductOption__c"][n];"currency"===o.type.toLowerCase()&&(o.CurrencyIsoCode=this.model.currencyIsoCode),this.addMetaDataProperties(t,o),0<this.attributeItemFields.length&&this.addMetaDataProperties(i,o)}return this.addAdditionalMetaDataProperties(t,e),this.addAdditionalMetaDataProperties(i,e),{fieldSetMd:t,attributeItemMd:i}}},{key:"addMetaDataProperties",value:function(e,t){var i=t.name;if(-1!=e.fields.indexOf(i)){e.fieldLabels.push(t.label),e.recordKeys.push("record."+i),e.fieldLabelMap[i]=t.label;var n=(e.fieldDetails["record."+i]=t).type;if(!this._isMobile()){i===this.prefix+"Quantity__c"&&(n="string");var o=new r(t).getImageWidth(20);o&&(n+=":"+o)}e.labelTypeMap[t.label.replace(/\W/g,"")]=n,e.itemTypeMap["record."+i]=n}}},{key:"addAdditionalMetaDataProperties",value:function(e,t){e.quoteLineFields=t[this.prefix+"QuoteLine__c"],e.headerClassMap=new i(Object.keys(e.labelTypeMap),"Th",e.labelTypeMap,null,!0).build(),e.rowClassMap=new i(e.recordKeys,"Td",e.itemTypeMap,["initial"]).build(),delete e.fields}},{key:"_initOptionsObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this.initOptions(e,t,i,n)}},{key:"initOptions",value:function(){this.productHasAttributeSet=!this._isMobile()&&this.model.product._transient_&&this.model.product._transient_.hasAttributeItems,this.options=this.model.getOptionsByFeatureId(this.featureId)}},{key:"_notifyObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.notify(e,t)}},{key:"notify",value:function(t){if(this.isClickSelection)for(var e=0,i=this.options.length;e<i;e++){var n=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;this.notifyPath("options."+e+"."+l)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}else{this.model.getFeature(this.featureId)._transient_.changedExternally&&this._optionsExternallyChanged();var u=Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row");u.length&&u.forEach(function(e){e.notify(t)})}}},{key:"_optionsExternallyChanged",value:function(){Polymer.dom(this.$.tbody).querySelector('template[is="dom-repeat"]').render(),this._renderChangedRows(),this.isFeatureOptionless(),this._setHeaderActions()}},{key:"_renderChangedRows",value:function(){for(var e=Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row"),t=this.options.length-1;0<=t;t--)this.options[t].selected?this._addSelectedOption(this.options[t],e[t],t):this.deleteOption(this.options[t].record.Id,t)}},{key:"_addSelectedOption",value:function(e,t,i){t.rowData||(e._transient_.rowActions=this.model.getOption(e.record.Id)._transient_.rowActions,t.rowData=e,t.$.row.selected=!0,this._displayAvailableRowActions(i,!1))}},{key:"deselectOptionsOnOptionLookup",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.options.entries()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=c(n.value,2),s=r[0];r[1],this.set("options."+s+".selected",!1)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"getOptionIndex",value:function(e){for(var t=-1,i=0,n=this.options.length;t<0&&i<n;)this.options[i].record.Id===e&&(t=i),i++;return t}},{key:"ifRadioSelectedClearOtherRadioSelections",value:function(e){if("radio"===e.detail.selectionType&&e.detail.selected){var t=Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row");if(t&&0!=t.length){var i=Polymer.dom(e).rootTarget,n=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;"radio"==l.selectionType&&l!==i&&(l.$.row.fire("group-selected",{selected:!1}),l.selected=!1)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}}},{key:"setParentIdDataPath",value:function(){return"record."+this.prefix+"ConfiguredSKU__c"}},{key:"navigationChanged",value:function(){this.model.getFeature(this.featureId)._transient_.changedExternally||this.reset()}},{key:"_setOptionsDisabledDataObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setOptionsDisabledData(e,t)}},{key:"setOptionsDisabledData",value:function(){this.options.length&&this.disabledStateMap&&Object.keys(this.disabledStateMap).length&&this.options.forEach(function(e,t){this.optionShouldChange(e)&&this.changeOptionDisabled(e,t)}.bind(this))}},{key:"disabledStateMapChanged",value:function(e){if(this.options&&this.options.length&&Object.keys(this.disabledStateMap).length){var t=e.path.split(".")[1],i=this.model.optionsById[t],n=this.options.findIndex(function(e){return e.record.Id===t});0<=n&&this.optionShouldChange(i)&&this.changeOptionDisabled(i,n)}}},{key:"optionShouldChange",value:function(e){return e.disabledData&&this.disabledStateMap[e.record.Id]!==e.disabledData.constrained}},{key:"changeOptionDisabled",value:function(e,t){var i=!!this.disabledStateMap[e.record.Id],n=e.disabledData.disabled;this.set("options."+t+".disabledData",{disabled:n,constrained:i}),this.isClickSelection||1!=this.disabledStateMap[e.record.Id]||this.deleteOption(e.record.Id,t,!0)}},{key:"reset",value:function(){Polymer._collections.delete(this.options)}},{key:"routeToLookup",value:function(){var e={qId:this.model.qId,pId:this.model.product.record.Id,fId:this.featureId};"Dynamic"===this.model.getFeature(this.featureId).optionSelectionMethod&&(e.path=["product","dl"]),this.fire("add-option-clicked",e)}},{key:"isFeatureOptionless",value:function(){this.options&&(this.featureless=0===this.options.length?"featureless":null)}},{key:"isOptionSelected",value:function(e){return"OptionLookup"!==this.routeSource&&!!e.selected}},{key:"handleDeleteOption",value:function(){this.addEventListener("delete-tapped",function(e){this.deleteOption(e.detail.Id,e.detail.index)}.bind(this))}},{key:"deleteOption",value:function(e,t,i){var n=this.sameOptionAdded(e,this.options[t].index,!0);n||(this.model.optionsById[e].selected=!1),this.fire("sb-option-deleted",this.options[t]),this.splice("options",t,1),this.showOrHideAddOptionsButton(),i&&n&&this.deleteOption(n.id,n.index,!0)}},{key:"sameOptionAdded",value:function(e,t){var i=null,n=!0,o=!1,r=void 0;try{for(var s,a=this.options.entries()[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=c(s.value,2),u=l[0],d=l[1];if(d.record.Id===e){if(d.index===t)continue;i={id:e,index:u},d.index>t&&d.index--}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}},{key:"handleConfigureOption",value:function(){this.addEventListener("configure-tapped",function(e){var t=this.isClickSelection?null:e.detail.index,i=this.isClickSelection?this.model.optionsById[e.detail.Id]:this.model.getFeature(this.featureId)._transient_.optionConfigurations[e.detail.index];this.fire("configure-option-tapped",{addedIndex:i.index||0,index:t,optionId:i.record.Id,optionalSKU:i.record[this.prefix+"OptionalSKU__c"],productId:this.model.product.record.Id,tabIndex:this.tabIndex,optionData:i.record,isDynamicOption:i.isDynamicOption})}.bind(this))}},{key:"_filterOptionsObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.filterOptions(e,t)}},{key:"filterOptions",value:function(){for(var e=this.configSearch.setOptionVisibility(this.options),t=0;t<this.options.length;t++)this.options[t].hiddenByRule||this.set("options."+t+".hidden",e[t].hidden)}},{key:"setOptionIndex",value:function(){for(var e={},t=0;t<this.options.length;t++){e[this.options[t].record.Id]||(e[this.options[t].record.Id]=0),void 0===this.options[t].index&&this.set("options."+t+".index",e[this.options[t].record.Id]);var i="_"+this.options[t].record.Id+"_"+this.options[t].index,n=this.model.product.configuration.configuredOptions&&this.model.product.configuration.configuredOptions[i];this.set("options."+t+".configured",n),e[this.options[t].record.Id]++}}},{key:"setProductRulesActions",value:function(){0!=Object.keys(this.model.productRulesActions).length&&this.model.optionsByFeatureId[this.featureId]&&(0==this.isClickSelection&&this.setUnaddedOptionsRulesActions(),void 0!==this.options[0]&&this.setDisplayedOptionsRulesActions())}},{key:"setUnaddedOptionsRulesActions",value:function(){for(var e=this.model.optionsByFeatureId[this.featureId],t=0;t<e.length;t++){var i=e[t];this.model.productRulesActions.selectOptions[i.record.Id]&&!this.sameOptionAdded(i.record.Id,t)&&(i.selected=!0,i.added=!0,this.push("options",i),this.showOrHideAddOptionsButton(),this.fireOptionChangedByRule(!0)),this.model.productRulesActions.showOptions[i.record.Id]&&(i.hidden=!1,i.hiddenByRule=!1),this.model.productRulesActions.hideOptions[i.record.Id]&&(i.hidden=!0,i.hiddenByRule=!0),!0===this.model.productRulesActions.disableOptions[i.record.Id]&&(i.disabledData={disabled:!0,constrained:!0}),!1===this.model.productRulesActions.disableOptions[i.record.Id]&&(i.disabledData={disabled:!0,constrained:!1}),!0===this.model.productRulesActions.enableOptions[i.record.Id]&&(i.disabledData={disabled:!1,constrained:!1}),!1===this.model.productRulesActions.enableOptions[i.record.Id]&&(i.disabledData={disabled:!1,constrained:!0})}}},{key:"setDisplayedOptionsRulesActions",value:function(){for(var e=0;e<this.options.length;e++)if(this.model.productRulesActions.hideOptions[this.options[e].record.Id]&&(this.set("options."+e+".hidden",!0),this.options[e].hiddenByRule=!0),this.model.productRulesActions.showOptions[this.options[e].record.Id]&&(this.set("options."+e+".hidden",!1),this.options[e].hiddenByRule=!1),!0===this.model.productRulesActions.disableOptions[this.options[e].record.Id]&&this.set("options."+e+".disabledData",{disabled:!0,constrained:!0}),!1===this.model.productRulesActions.disableOptions[this.options[e].record.Id]&&this.set("options."+e+".disabledData",{disabled:!0,constrained:!1}),!0===this.model.productRulesActions.enableOptions[this.options[e].record.Id]&&this.set("options."+e+".disabledData",{disabled:!1,constrained:!1}),!1===this.model.productRulesActions.enableOptions[this.options[e].record.Id]&&this.set("options."+e+".disabledData",{disabled:!1,constrained:!0}),this.isClickSelection&&this.model.productRulesActions.selectOptions[this.options[e].record.Id]&&(this.set("options."+e+".selected",!0),this.fireOptionChangedByRule(!0)),this.model.productRulesActions.deselectOptions[this.options[e].record.Id])if(this.isClickSelection)this.set("options."+e+".selected",!1),this.fireOptionChangedByRule(!1);else{if(this.deleteOption(this.options[e].record.Id,e),void 0===this.options[e])return;e--}}},{key:"fireOptionChangedByRule",value:function(e){this.viewport&&!this.viewport.isMobile()||this.fire("option-changed-by-rule",{added:e})}},{key:"_firePriceRules",value:function(){var e=this.model.optionDataByOptionIdAndIndex,t=this.options;if(null!=t)for(var i=0;i<t.length;i++){var n=t[i].optionId||t[i].record.Id,o=t[i].index;if(e[n]&&null!=e[n][o]){var r=this._getPriceActions(t[i],n,o);for(var s in r)r.hasOwnProperty(s)&&this.set(["options",i,"record",s],r[s])}}}},{key:"_getPriceActions",value:function(e,t,i){var n={},o=this.model.optionDataByOptionIdAndIndex[t][i].optionData;for(var r in o)o.hasOwnProperty(r)&&"attributes"!=r&&e.record[r]!=o[r]&&(n[r]=o[r]);return this._calculateUnitPrice(n,o),n}},{key:"_calculateUnitPrice",value:function(e,t){var i=this.getPrefix()+"UnitPrice__c";if(void 0!==t[i])return e[i]=t[i]}},{key:"setUpgradeOptionClass",value:function(){Polymer.dom(this.$.tbody).observeNodes(function(){for(var e=Polymer.dom(this.$.tbody).node.querySelectorAll("#row[hidden]"),t=0;t<e.length;t++)e[t].rowData.isUpgrade&&this.toggleClass("upgradeOption",!0,e[t])}.bind(this))}},{key:"toggleUpgradeOptions",value:function(){var e=this.options;this.showUpgradeOptions=!this.showUpgradeOptions,this.showUpgradeOptions?this.upgradeOptionButtonText="Hide Available Upgrades":this.upgradeOptionButtonText="Show Available Upgrades";for(var t=0;t<e.length;t++)!0===e[t].isUpgrade&&(this.showUpgradeOptions?this.set("options."+t+".hidden",!1):this.set("options."+t+".hidden",!0))}},{key:"_showOrHideAddOptionsButtonObserver",value:function(e,t,i){if(void 0!==e&&void 0!==t&&void 0!==i)return this.showOrHideAddOptionsButton(e,t,i)}},{key:"showOrHideAddOptionsButton",value:function(){this.showAddOptionsButton=!this.isClickSelection&&!this.model.maxOptionsMet(this.model.getFeature(this.featureId))}},{key:"getPrefix",value:function(){return this.model.prefix}},{key:"_setHasUpgradeOptionsObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.setHasUpgradeOptions(e,t)}},{key:"setHasUpgradeOptions",value:function(e,t){this.hasUpgradeOptions=e&&!t}},{key:"_setHeaderActions",value:function(){if("OptionLookup"!==this.routeSource&&0!==this.options.length&&this.options[0]._transient_.rowActions){this.headerActions=JSON.parse(JSON.stringify(this.options[0]._transient_.rowActions));for(var e=this.headerActions.length-1;0<=e;e--)this.headerActions[e].invisible=!0;this.isClickSelection||(this.headerActions[0].hidden=!0)}}},{key:"_getDisplayStyle",value:function(){return this.productHasAttributeSet?"table-row":"table-row-group"}},{key:"_showUpgradeOptionIfSelectionMethodAddObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._showUpgradeOptionIfSelectionMethodAdd(e,t)}},{key:"_showUpgradeOptionIfSelectionMethodAdd",value:function(){if(!this.isClickSelection)for(var e=0;e<this.options.length;e++)this.options[e].isUpgrade&&this.set("options."+e+".hidden",!1)}},{key:"_isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"hasAttributeItems",value:function(e){return!this._isMobile()&&"Add"!==this.model.getFeature(this.featureId).optionSelectionMethod&&e&&e._transient_&&e._transient_.attributeItems&&0<Object.keys(e._transient_.attributeItems).length||!1}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[s.NAVIGATION_CHANGED]=this.navigationChanged,e}},{key:"observers",get:function(){return["_setMetadataRequestObserver(model, fieldSet, prefix, options)","_initOptionsObserver(model, featureId, isClickSelection, fieldSet)","disabledStateMapChanged(disabledStateMap.*)","_setOptionsDisabledDataObserver(disabledStateMap, options)","setUpgradeOptionClass(options)","_filterOptionsObserver(configSearch, options)","setProductRulesActions(options, model.productRulesActions.*)","_firePriceRules(options, model.optionDataByOptionIdAndIndex.*)","_notifyObserver(model.optionNotifications, options)","_showOrHideAddOptionsButtonObserver(model, featureId, isClickSelection)","_setHasUpgradeOptionsObserver(hasUpgradeOptions, showAddOptionsButton)","_setHeaderActions(options)","_showUpgradeOptionIfSelectionMethodAddObserver(options, isClickSelection)","setOptionIndex(options)","isFeatureOptionless(options.splices)"]}}]),u=e)),t("ProductOptionTable",u),Polymer(u)}}}),System.register("products/config/routes/sb-dynamic-lookup/DynamicLookup.js",["common/core/Page.js","common/layout/tables/TableClassBuilder.js","common/filter/searcher/Searcher.js","common/core/sb-page-container/PageContainer.js","products/localization/LocalizeFields.js","../../viewmodel/ProductViewModel.js","common/data/format/ErrorFormatter.js","common/core/Events.js"],function(t,e){var i,o,r,u,s,a,l,d,c;return{setters:[function(e){i=e.Page},function(e){e.TableClassBuilder},function(e){o=e.Searcher},function(e){e.PageContainer},function(e){r=e.LocalizeFields},function(e){u=e.ProductViewModel},function(e){s=e.formatError},function(e){a=e.Events,l=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}d=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("DynamicLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),d(e,[{key:"beforeRegister",value:function(){this.is="sb-dynamic-lookup",this.properties=Polymer.Base.extend({quote:Object,model:Object,feature:Object,selectedProducts:{type:Object,value:{}},lineEditorModel:Object,redirectUrl:String,defaultFilters:{type:Object,value:{}},internal:{type:Boolean,value:!1},errors:{type:Array,value:[],notify:!0},error:{type:Array,value:[]},productIds:{type:String,computed:"getProductIds(ctx)"},optionId:{type:String,computed:"getOptionId(ctx)"},ignoreCache:{type:Boolean,computed:"getIgnoreCache(ctx)"},hasInstructions:{type:Boolean,computed:"setHasInstructions(feature)"},validationMessages:Array},i.properties)}},{key:"searchModelChanged",value:function(){this.deSelectAll()}},{key:"ready",value:function(){this.$.lookupLayout.additionalFields=["PricebookEntry.UnitPrice"],this.$.drawer.addEventListener("transitionend",this.refocus.bind(this)),this.addEventListener("iron-deselect",this.handleDrawerClosed.bind(this)),this.handleOptionConfiguratorResponse()}},{key:"cancel",value:function(){this.spinner=!0;var e=this._createQueryParams();this.nav("#",e,["product","pc"],!1)}},{key:"add",value:function(){if(0!==Object.keys(this.selectedProducts).length){var e=[];for(var t in this.selectedProducts)e.push(this.ctx.params.fId+":"+t);var i=this.validateMaximumOptionsNotExceeded(e.length);this.validationMessages=[],0<i?this.validationMessages=[this.i18n.l("Please deselect at least {0} option(s). The max number of options allowed for this feature is {1}.",[i,this.feature.record[this.prefix+"MaxOptionCount__c"]])]:(this.$.productLoader.featureOptionIds=e,this.$.productLoader.ignoreCache=!0)}else this.cancel()}},{key:"convertProductsToOptions",value:function(e){for(var t in e){var i=e[t];i.record[this.prefix+"UnitPrice__c"]=this.selectedProducts[t].record.UnitPrice,i.isDynamicOption=!0,this.push("product.options",i),this.push("feature._transient_.optionConfigurations",i)}this.syncConfigurationAttributesToProduct(i);var n=this._createQueryParams();this.nav("#",n,["product","pc"],!1)}},{key:"syncConfigurationAttributesToProduct",value:function(e){if(void 0===this.autoSelectAttributes){var t=!0,i=!(this.autoSelectAttributes={}),n=void 0;try{for(var o,r=this.product.configurationAttributes[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;!0===s.autoSelect&&void 0===this.autoSelectAttributes[s.targetFieldName]&&e.record[this.prefix+"Feature__c"]===s.featureId&&(this.autoSelectAttributes[s.targetFieldName]=!0)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}for(var a in this.autoSelectAttributes)this.product.configuration.configurationData[a]=e.record[a]}},{key:"_createQueryParams",value:function(){var e={qId:this.model.qId},t=this.ctx.params;return t&&(t.pId&&(e.pId=t.pId),t.oId&&(e.oId=t.oId,e.origin="dl"),t.lineKey&&(e.lineKey=t.lineKey),t.redirectUrl&&(e.redirectUrl=t.redirectUrl),t.productIdx&&(e.productIdx=t.productIdx),t.tab&&(e.tab=t.tab),t.groupKey&&(e.groupKey=t.groupKey),t.aId&&(e.aId=t.aId)),e}},{key:"handleProductsLoadServerResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.isoCode=this.lineEditorModel.quote.record.CurrencyIsoCode||null,this.quote=e.detail.value.quote,this.$.productLoader.productIds=this.productIds,this.$.productLoader.quote=this.$.optionConfigure.quote=this.quote,this.headerSubtitle=e.detail.value.headerSubtitle}.bind(this)),this.$.productLoader.addEventListener("product-load-model-changed",function(e){if(0<Object.keys(this.selectedProducts).length)return this.convertProductsToOptions(e.detail.value);var t=this.ctx.params.productIdx?e.detail.value.configuredProducts[this.ctx.params.productIdx]:e.detail.value.configuredProducts[0];if(this.localizer=new r(this.prefix),""!==this.optionId)return this.$.optionConfigure.product=t;this.setCurrentProductModel(t)}.bind(this)),this.$.smLoadService.addEventListener("search-model-changed",function(e){var t=this.localizer.localizeSearchModel(e.detail.value),i=this.product.productFieldSets[this.feature.record[this.prefix+"DynamicProductLookupFieldSet__c"]];i&&(t.resultFieldNames=i),this.$.lookupLayout.fieldPrefix=t.targetObjectName+".",this.searchModel=t,this.buildDelegator()}.bind(this))}},{key:"handleOptionConfiguratorResponse",value:function(){this.$.optionConfigure.addEventListener("option-configurator-response-changed",function(e){this.setCurrentProductModel(e.detail.value.configuredProducts[0])}.bind(this))}},{key:"setCurrentProductModel",value:function(e){if(this.product=e,this.model=new u(this.quote.record.Id,e,this.app.org.prefix,this.isoCode,this.ctx.params.fId),this.feature=this.model.getFeature(this.ctx.params.fId),void 0!==this.feature){var t=[],i=!1;if(this.feature.searchFilters){null!=this.defaultFilters[this.feature.record.Id]?i=!0:this.defaultFilters[this.feature.record.Id]=[];var n=!0,o=!1,r=void 0;try{for(var s,a=this.feature.searchFilters[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;null!=l.valueObject&&(l.stringValue=this.getStringValue(l)),t.push(JSON.stringify(l)),i||this.defaultFilters[this.feature.record.Id].push(l)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}this.$.smLoadService.filters=t,this.$.smLoadService.fieldSet=this.feature.record[this.prefix+"DynamicProductFilterFieldSet__c"],this.$.smLoadService.quote=this.quote}else this.validationMessages=[this.i18n.l("Attempted to access a feature not associated with this bundle.")]}},{key:"buildDelegator",value:function(){var e=new o(this.searchModel);e.dynamicSearchFilters=this.defaultFilters[this.feature.record.Id]?this.defaultFilters[this.feature.record.Id]:[],e.fieldSet=this.feature.record[this.prefix+"DynamicProductLookupFieldSet__c"],this.searcher=e}},{key:"toggleFilter",value:function(){this.$$("sb-page-header")._closeMenu(),this.panelHeader="Product Filter",this.$.drawer.togglePanel(),this.refocus()}},{key:"closeDrawer",value:function(){this.refocus(),this.$.drawer.closeDrawer()}},{key:"refocus",value:function(){this.$.pf.focusFirstField()}},{key:"reverseFocus",value:function(){this.$.clearfilter.focus()}},{key:"runSearcher",value:function(){this.$$("#submit").focus(),this.lastSubmit="pf",this.$.pf.runService(),this.closeDrawer()}},{key:"removeFilter",value:function(){this.$$(".actions").removeChild(this.$$("#fb"))}},{key:"getConfigProductIds",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e.detail.value.configuredProducts[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.record.Id)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t.join(",")}},{key:"deSelectAll",value:function(){this.$.lookupLayout.deSelectAll()}},{key:"getOrderedSelectedProducts",value:function(){var e=Object.keys(this.selectedProducts).sort(function(e,t){return this.selectedProducts[e].index-this.selectedProducts[t].index}.bind(this)),t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(this.selectedProducts[a])}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"handleDrawerClosed",value:function(){"main"===this.$.drawer.selected&&l(a.PANEL_CLOSED)}},{key:"clearFilterFields",value:function(){this.filterData=this.searcher.clearFields()}},{key:"getStringValue",value:function(e){return"Product"===e.valueObject?this.product.record[e.valueField]:"Quote"===e.valueObject?this.quote.record[e.valueField]:"Configuration Attributes"===e.valueObject?this.product.configuration.configurationData[e.valueField]:void 0}},{key:"bindFilterEnterCallBacks",value:function(){this.$.pf.enterCallback=this.runSearcher.bind(this)}},{key:"getProductIds",value:function(){return this.ctx.params&&this.ctx.params.pId||""}},{key:"getOptionId",value:function(){return this.ctx.params&&this.ctx.params.oId||""}},{key:"getIgnoreCache",value:function(){return!!this.ctx.params&&"true"===this.ctx.params.ignoreCache}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.validationMessages=s(this.errors),this.spinner=!1)}},{key:"setHasInstructions",value:function(){return!!this.feature.instructionsText||!!this.feature.additionalInstructions}},{key:"validateMaximumOptionsNotExceeded",value:function(e){return this.feature._transient_.optionConfigurations.length+e-this.feature.record[this.prefix+"MaxOptionCount__c"]}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.LookupBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}},{key:"observers",get:function(){return["searchModelChanged(searchModel)"]}},{key:"prefix",get:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}}]),c=e)),t("DynamicLookup",c),Polymer(c)}}}),System.register("products/config/routes/sb-option-lookup/OptionLookup.js",["../../../../common/core/Page.js","../../../resources/rules/RuleProcessor.js","../../viewmodel/ProductViewModel.js","../../../resources/optionConstraints/OptionConstraintsHandler.js","common/data/format/ErrorFormatter.js"],function(t,e){var i,o,r,s,a,l,u;return{setters:[function(e){i=e.Page},function(e){o=e.RuleProcessor},function(e){r=e.ProductViewModel},function(e){s=e.OptionConstraintsHandler},function(e){a=e.formatError}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}l=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("OptionLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),l(e,[{key:"beforeRegister",value:function(){this.is="sb-option-lookup",this.properties=Polymer.Base.extend({topLevelBundle:Object,currentProductModel:Object,feature:Object,disabledStateMap:{type:Object,value:{}},optionConstraintsHandler:Object,headerSubtitle:String,selectedOptions:Object,productIds:{type:String,computed:"getProductIds(ctx)"},lineKey:{type:Number,computed:"getLineKey(ctx)"},ignoreCache:{type:Boolean,computed:"getIgnoreCache(ctx)"},hasUpgradeOptions:{type:Boolean,computed:"setHasUpgradeOptions(feature)"},optionId:{type:String,computed:"getOptionId(ctx)"},validationMessages:Array,errors:{type:Array,value:[],notify:!0}},i.properties)}},{key:"ready",value:function(){this.preLoadObjects(),this._handleLineEditorModelResponse(),this._handleProductLoadResponse(),this.handleOptionConfiguratorResponse(),this.addEventListener("selection-changed",this._handleOptionSelection)}},{key:"_selectAndAdd",value:function(){this.validationMessages=[];var e=this._validateMaximumOptionsNotExceeded();0<e?this.validationMessages=[this.i18n.l("Please deselect at least {0} option(s). The max number of options allowed for this feature is {1}.",[e,this.feature.record[this.prefix+"MaxOptionCount__c"]])]:this._addSelected()}},{key:"add",value:function(){this._selectAndAdd(!1),this._routeToConfig()}},{key:"addMore",value:function(){this._selectAndAdd(),this._resetPage()}},{key:"cancel",value:function(){for(var e in this.selectedOptions)this.currentProductModel.optionsById[e].added=!1,this.currentProductModel.optionsById[e].selected=!1;this._routeToConfig()}},{key:"_handleLineEditorModelResponse",value:function(){this.$.lineEditorRead.addEventListener("line-editor-model-changed",function(e){this.$.productLoad.quote=this.$.optionConfigure.quote=e.detail.value.quote,this.headerSubtitle=e.detail.value.headerSubtitle}.bind(this))}},{key:"_handleProductLoadResponse",value:function(){this.$.productLoad.addEventListener("product-load-model-changed",function(e){var t=e.detail&&e.detail.value?e.detail.value.configuredProducts:null,i=this.ctx.params&&this.ctx.params.productIdx?this.ctx.params.productIdx:0,n=t?t[i]:e.detail.value;if(n.rulesProcessed||new o(n.configuration,n).initProductRulesActions(""===this.optionId?"load":"reconfigure"),this.topLevelBundle=n,""!==this.optionId)return this.$.optionConfigure.product=n;this.setCurrentProductModel(n)}.bind(this))}},{key:"handleOptionConfiguratorResponse",value:function(){this.$.optionConfigure.addEventListener("option-configurator-response-changed",function(e){this.setCurrentProductModel(e.detail.value.configuredProducts[0])}.bind(this))}},{key:"setCurrentProductModel",value:function(e){var t=e.currencyCode||null;this.currentProductModel=new r(this.$.productLoad.quote.record.Id,e,this.app.org.prefix,t,this.ctx.params.fId),this.feature=this.currentProductModel.getFeature(this.ctx.params.fId),void 0!==this.feature?(this.selectedOptions={},this.optionConstraintsHandler=new s(this.currentProductModel.product,this.currentProductModel.prefix),this.$.optionTable.fieldSetName="OptionLookup",this.$.optionTable.fieldSet=this.currentProductModel.product.optionFieldSets[this.$.optionTable.fieldSetName],this.$.optionTable.displayDelete=!1,this._createConstraintsHoverMessages(),this._fireSelectionStatesForOtherFeatures()):this.validationMessages=[this.i18n.l("Attempted to access a feature not associated with this bundle.")]}},{key:"_handleOptionSelection",value:function(e){e&&e.detail&&(this._toggleOptionSelection(e.detail.Id,e.detail.selected),this._handleOptionConstraints(e.detail.Id,e.detail.selected))}},{key:"_fireSelectionStatesForOtherFeatures",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=Object.keys(this.currentProductModel.featureIdsWithSelectionMethodClick)[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value,s=!0,a=!1,l=void 0;try{for(var u,d=this.currentProductModel.optionsByFeatureId[r][Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var c=u.value;this._handleOptionConstraints(c.record.Id,c.selected)}}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"_resetPage",value:function(){this.selectedOptions={},this.$.optionTable.deselectOptionsOnOptionLookup(),this._fireSelectionStatesForOtherFeatures()}},{key:"_toggleOptionSelection",value:function(e,t){!t&&this.selectedOptions[e]?delete this.selectedOptions[e]:t&&!this.selectedOptions[e]&&(this.selectedOptions[e]=this.currentProductModel.getOption(e))}},{key:"_handleOptionConstraints",value:function(t,e){var i=this,n=this.feature._transient_.optionConfigurations.find(function(e){return e.record.Id===t}),o=n&&n.selected,r=this.optionConstraintsHandler.handleOptionConstraints(t,e||o);r&&r.forEach(function(e){i.set("disabledStateMap."+e.optionId,e.disabledState)})}},{key:"_addSelected",value:function(){function e(t){var e=JSON.parse(JSON.stringify(i.currentProductModel.optionsById[t]));i.currentProductModel.initOptionActions(e,!0),e.addedManually=!0,e.index=i.feature._transient_.optionConfigurations.filter(function(e){return e.record.Id===t}).length,e.configured=!1,i.currentProductModel.setOptionDisabledData(e),i.push("feature._transient_.optionConfigurations",e),i.currentProductModel.optionsById[t].added=!0,i.currentProductModel.optionsById[t].selected=!0}var i=this;for(var t in this.selectedOptions)e(t)}},{key:"_validateMaximumOptionsNotExceeded",value:function(){return this.feature._transient_.optionConfigurations.length+Object.keys(this.selectedOptions).length-this.feature.record[this.prefix+"MaxOptionCount__c"]}},{key:"_routeToConfig",value:function(){this.selectedOptions={};var e=this._createQueryParams();this.nav("#",e,["product","pc"],!1)}},{key:"_createQueryParams",value:function(){var e={qId:this.currentProductModel?this.currentProductModel.qId:this.ctx.params.qId},t=this.ctx.params;return t&&(t.pId&&(e.pId=t.pId),t.oId&&(e.oId=t.oId,e.origin="ol"),t.lineKey&&(e.lineKey=t.lineKey),t.redirectUrl&&(e.redirectUrl=t.redirectUrl),t.productIdx&&(e.productIdx=t.productIdx),t.tab&&(e.tab=t.tab),t.groupKey&&(e.groupKey=t.groupKey),t.aId&&(e.aId=t.aId)),e}},{key:"preLoadObjects",value:function(){this.optionLookupObjects=[this.prefix+"ProductOption__c",this.prefix+"QuoteLine__c"]}},{key:"getProductIds",value:function(){return this.ctx.params&&this.ctx.params.pId||""}},{key:"getLineKey",value:function(){return this.ctx.params?parseInt(this.ctx.params.lineKey||-1):-1}},{key:"getIgnoreCache",value:function(){return!!this.ctx.params&&"true"===this.ctx.params.ignoreCache}},{key:"setHasUpgradeOptions",value:function(){return this.currentProductModel.getHasUpgradeOptions(this.feature)}},{key:"_createConstraintsHoverMessages",value:function(){this.currentProductModel.createConstraintsHoverMessages(this.optionConstraintsHandler.optionConstraints.byConstrained)}},{key:"getOptionId",value:function(){return this.ctx.params&&this.ctx.params.oId||""}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.validationMessages=a(this.errors),this.spinner=!1)}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}},{key:"prefix",get:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}}]),u=e)),t("OptionLookup",u),Polymer(u)}}}),System.register("products/config/routes/sb-product-config/ProductConfig.js",["../../../../common/core/Page.js","../../../resources/rules/RuleProcessor.js","products/resources/reconfigure/ProductReconfigurer.js","products/resources/optionUpgrades/OptionUpgradeHandler.js","../../../resources/model/nestedOptions/NestedOptionsModel.js","common/data/format/ErrorFormatter.js","common/core/Navigator.js","common/core/AppContext.js"],function(t,e){var o,f,p,y,v,r,s,a,l,u,d,m;function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}return{setters:[function(e){o=e.Page},function(e){f=e.RuleProcessor},function(e){p=e.ProductReconfigurer},function(e){y=e.OptionUpgradeHandler},function(e){v=e.NestedOptionsModel},function(e){r=e.formatError},function(e){s=e.Navigator},function(e){a=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return c(this,e),h(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}function i(e){c(this,i);var t=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t.name=u,t.message=e,t}l=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},u="ConfigurationError",t("ProductConfig",(g(e,o),l(e,[{key:"beforeRegister",value:function(){this.is="sb-product-config",this.properties=Polymer.Base.extend({lineEditorModel:Object,productSelectionModel:Object,topLevelBundle:Object,currentTarget:Object,productIndex:Number,headerSubtitle:String,hasMultipleBundles:Boolean,isClassic:Boolean,searchValuesByFilter:Object,searchFilters:Array,validationMessages:Array,headerTitle:String,isMobileAndHasMultipleBundles:{type:Boolean,value:!1,computed:"_setIsMobileAndHasMultipleBundles(viewport, hasMultipleBundles)"},productIds:{type:String,computed:"getProductIds(ctx)"},lineKey:{type:Number,computed:"getLineKey(ctx)"},groupKey:{type:Number,computed:"getGroupKey(ctx)"},ignoreCache:{type:Boolean,computed:"getIgnoreCache(ctx)"},optionId:{type:String,computed:"getOptionId(ctx)"},spinner:{type:Boolean,value:!1},errors:{type:Array,value:[],notify:!0},preventPreLoadObjects:{type:Boolean,value:!1}},o.properties)}},{key:"ready",value:function(){this.handleLineEditorModelResponse(),this.handleProductLoadResponse(),this.handleOptionSaveResponse(),this.handleProductRulesInvokerResponse(),this.handleCustomActionsCollapsed(),this.handleOnAddOptionClick(),this.handleBundlePanelClick(),this.handleChangeEvents(),this.handleApplyEditRulesAction(),this.handleBundleNameChange(),this.handleExternalConfiguration(),this.handleConfigureOptionEvent(),this.handleOptionConfiguratorResponse()}},{key:"attached",value:function(){this.preventPreLoadObjects||this.preLoadObjects()}},{key:"handleLineEditorModelResponse",value:function(){this.$.lineEditorRead.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.isoCode=this.lineEditorModel.quote.record.CurrencyIsoCode||null,this.$.optionSave.stripLinesThreshold=this.lineEditorModel.settings.largeQuoteThreshold,this.$.optionSave.stripLinesMessage=this.lineEditorModel.customLabels.msg_large_quote_sent_without_lines,this.$.productLoad.quote=this.$.optionSave.quote=this.$.productRulesInvoke.quote=this.$.optionConfigure.quote=e.detail.value.quote,this.headerSubtitle=e.detail.value.headerSubtitle}.bind(this))}},{key:"handleProductLoadResponse",value:function(){this.$.productLoad.addEventListener("product-load-model-changed",function(e){if(!e.detail.value||e.detail.value.returnToQuote||void 0!==e.detail.value.configuredProducts){var t=this.handleProductConfigurationInitializer(e.detail.value);if(t.returnToQuote)return this.$.productAlerts.displayContinueButton=!1,this.$.productAlerts.cancelCB=function(){return this.nav("#",{qId:this.lineEditorModel.quote.record.Id},["quote","le"],!1)}.bind(this),this.$.productAlerts.alerts=[t.returnToQuote];if(""!==this.optionId)return this.setOptionConfigurationDetails(t);if(this.loadedModelIsReconfigure(t)){var i=t.configuredProducts[0];i.quoteType=this.lineEditorModel.quote.record[this.prefix+"Type__c"],(new p).reconfigure(i),this.addAttributeSetFromServerProductVO(t.configuredProducts[0])}var n=!0,o=!1,r=void 0;try{for(var s,a=t.configuredProducts[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;l.rulesProcessed||new f(l.configuration,l).initProductRulesActions(!0),null!=t.attributeSet&&0<Object.keys(t.attributeSet.attributeItemIdsByOptionId).length&&(l._transient_=l._transient_||{},l._transient_.attributeSet=t.attributeSet),null!=l.configuration&&null==l.nestedOptionModel&&(l.nestedOptionModel=new v(l.configuration)),l.configuration.configuredOptions=l.nestedOptionModel.getConfiguredOptionsFromPath()}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}this.productSelectionModel=void 0,this.productSelectionModel=t,this.hasMultipleBundles=1<this.productSelectionModel.configuredProducts.length,this.isClassic=this.hasMultipleBundles&&"Classic"===this.lineEditorModel.settings.multipleBundlesView,this.currentTarget=this.productSelectionModel;for(var u=0;u<this.productSelectionModel.configuredProducts.length;u++)this.productIndex=u;this.productIndex=this.getProductIndex(),this.searchFilters=this.productSelectionModel.configuredProducts[0].optionFieldSets.SearchFilters;var d={};if(this.searchFilters&&!this.productSelectionModel.searchValuesByFilter){for(var c=0,h=this.searchFilters.length;c<h;c++)d[this.searchFilters[c]]=null;this.productSelectionModel.searchValuesByFilter=d}this.$.bundles.searchValuesByFilter=this.productSelectionModel.searchValuesByFilter,this.$.bundles.searchFilters=this.searchFilters,this.checkForExternalConfiguration()}else this._handleExternalDynamicOptionsResponse(e.detail.value)}.bind(this))}},{key:"handleOptionSaveResponse",value:function(){this.$.optionSave.addEventListener("psm-response-changed",function(e){var t=this;this.validationMessages=null;var i=e.detail.value,n=new f(i,this.topLevelBundle);return n.initValidationMessages(),this.validationMessages=n.getValidationMessages(),0<this.validationMessages.length?(this.spinner=!1,void(""!==this.optionId&&this.topLevelBundle.nestedOptionModel.removeClonedConfiguration())):i.guidedMessages&&0<i.guidedMessages.length?(this.$.productAlerts.cancelCB=function(){""!==t.optionId&&t.topLevelBundle.nestedOptionModel.removeClonedConfiguration()},this.$.productAlerts.displayContinueButton=!0,this.$.productAlerts.continueCB=function(){""!==t.optionId&&t.topLevelBundle.nestedOptionModel.swapConfiguration(i),t.afterSaveNavigate(i,n)},this.spinner=!1,void(this.$.productAlerts.alerts=i.guidedMessages)):(""!==this.optionId&&this.topLevelBundle.nestedOptionModel.swapConfiguration(i),void this.afterSaveNavigate(i,n))}.bind(this))}},{key:"afterSaveNavigate",value:function(e,t){var i="none",n=void 0;""!==this.optionId&&(n=this.topLevelBundle.nestedOptionModel.getLastFromPath().tabIndex,i=this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU()||"none",t.initDescendantTree());var o=this.ctx.params?this.ctx.params.redirectUrl:null,r=this.createPathParams(o),s=void 0;""!==this.optionId?s=this.createQueryParams({oId:i,ignoreCache:!1,jspr:!0},n):(s={qId:e.quote.record.Id},null!=this.ctx.params.groupKey&&(s.groupKey=this.ctx.params.groupKey),this.ctx.params.aId&&"quote"!==r[0]&&(s.aId=this.ctx.params.aId)),e.quote&&(this.lineEditorModel.quote=e.quote),this.nav("#",s,r,!1)}},{key:"handleProductRulesInvokerResponse",value:function(){this.$.productRulesInvoke.addEventListener("config-response-changed",this._processProductRulesInvokerResponse.bind(this))}},{key:"_processProductRulesInvokerResponse",value:function(e){var t=e.detail.value,i=this.currentTarget.configuredProducts.findIndex(function(e){return(e.productKey||e.record.Id)===t.configuredProductKey}),n=this.currentTarget.configuredProducts[i],o=new f(t,n);o.init(void 0!==this.topLevelBundle?this.topLevelBundle.nestedOptionModel:n.nestedOptionModel),this.validationMessages=o.getValidationMessages(),void 0!==n.configuration&&void 0!==n.configuration.configurationData&&(t.configurationData=n.configuration.configurationData),n.configuration=this._setHiddenAndDisabledOptionIds(n.configuration,t.hiddenOptionIds,t.disabledOptionIds),this.$.bundles.set("configuredProducts."+i+".configuration.productRulesActions",o.getProductRulesActions()),this.$.bundles.set("configuredProducts."+i+".configuration.optionDataByOptionIdAndIndex",o.getOptionDataByOptionIdAndIndex()),Polymer.RenderStatus.afterNextRender(this,function(){this.spinner=!1})}},{key:"_setHiddenAndDisabledOptionIds",value:function(e,t,i){return e.hiddenOptionIds=t,e.disabledOptionIds=i,e}},{key:"handleCustomActionsCollapsed",value:function(){this.changeAllActions(this.$.customActions.buttonsCollapsed),this.$.customActions.addEventListener("buttons-collapsed-changed",function(e){var t=e.detail.value;this.changeAllActions(t)}.bind(this))}},{key:"handleOnAddOptionClick",value:function(){var r=void 0;this.addEventListener("selected-page-changed",function(e){r=e.detail}.bind(this)),this.addEventListener("add-option-clicked",function(e){var t=""===this.optionId?e.detail:Object.assign({},e.detail,{oId:this.optionId}),i=void 0;""===this.optionId&&(i=this.getProductIndex(e.detail.pId));var n=this.createQueryParams(t,r),o=null!=t.path?t.path:["product","ol"];void 0!==i&&(n.productIdx=i),this.nav("#",n,o,!1)}.bind(this))}},{key:"handleBundlePanelClick",value:function(){this.addEventListener("bundle-panel-clicked",this.navToBundle)}},{key:"navToBundle",value:function(e){var t=this.createQueryParams(this.ctx.params);t.productIdx=e.detail,t.open=1,t.tab&&delete t.tab,this.nav("#",t,["product","pc"],!1)}},{key:"handleChangeEvents",value:function(){this.addEventListener("selection-changed",function(e){this.handleChangeEvent(e,"On Selection")}.bind(this)),this.addEventListener("sb-quantity-changed",function(e){this.handleChangeEvent(e,"On Quantity Change")}.bind(this)),this.addEventListener("sb-config-attribute-changed",function(e){this.handleChangeEvent(e,"On Attribute Change")}.bind(this)),this.addEventListener("sb-option-deleted",function(e){var t=this.topLevelBundle||this.productSelectionModel.configuredProducts[this.productIndex];t.nestedOptionModel&&t.nestedOptionModel.removeAddedOption(e.detail)}.bind(this))}},{key:"handleApplyEditRulesAction",value:function(){this.addEventListener("sb-apply-edit-rules",function(e){var t=this.getProductById(e.detail.bundleId);this.handleApplyImmediatelyProductRules(t,e.detail,"On Apply Rules")})}},{key:"handleBundleNameChange",value:function(){this.isMobileViewport()?this.addEventListener("bundle-name-changed",function(e){this.headerTitle=e.detail.name}.bind(this)):this.headerTitle=this.i18n.l("Configure Products")}},{key:"handleExternalConfiguration",value:function(){this.addEventListener("sb-close-popup",function(e){if(e.detail.dynamicOptions&&0<e.detail.dynamicOptions.length&&e.detail.featureOptionIds)this._handleExternalDynamicOptions(e.detail);else{if(!e.detail.redirect)return null;if(1===this.productSelectionModel.configuredProducts.length){if(!e.detail.redirect.auto)return null;e.detail.redirect.save?this.save():this.cancel()}else{var t=this.lineEditorModel.settings.thirdPartyConfigurator;if(t&&e.detail.redirect.save)this.productIndex===this.productSelectionModel.configuredProducts.length-1?this.save():this.navToBundle({detail:this.productIndex+1});else{if(!t)return null;this.cancel()}}}})}},{key:"handleProductConfigurationInitializer",value:function(e){if(this.isReconfigure(e))return e;if(e.hasInitializedProductConfiguration)return e;var t=!0,i=!1,n=void 0;try{for(var o,r=e.configuredProducts[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value,a=s.configuration,l=!0,u=!1,d=void 0;try{for(var c,h=a.optionConfigurations[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var f=c.value,p=f.optionData.Id,v=!0,g=!1,y=void 0;try{for(var m,b=s.options[Symbol.iterator]();!(v=(m=b.next()).done);v=!0){var _=m.value;if(_.record.Id===p)for(var C in f.optionData)void 0!==_.record[C]&&_.record[C]!=f.optionData[C]&&(_.record[C]=f.optionData[C])}}catch(e){g=!0,y=e}finally{try{!v&&b.return&&b.return()}finally{if(g)throw y}}}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return e.hasInitializedProductConfiguration=!0,e}},{key:"save",value:function(){if(!1!==this.configurationAttributesValid()){if(this.validationMessages=null,""!==this.optionId){var e=this.prepareProductForServer(this.currentTarget.configuredProducts[0]);if(this.validationMessages)return;return this.spinner=!0,this.$.optionSave.configuration=void 0,this.$.optionSave.configuration=e.configuration}var t=this.isReconfigure(this.productSelectionModel)?this.getConfiguredProductsToSave():this.getSelectedProductsToSave();this.validationMessages||(this.spinner=!0,this.$.optionSave.products=void 0,this.$.optionSave.products=t)}else this.validationMessages=[this.i18n.l(this.lineEditorModel.customLabels.Configuration_Attribute_Error)+this.getConfigurationAttributeMissingFeaturesMessage()]}},{key:"cancel",value:function(){if(this.spinner=!0,""===this.optionId){var e={qId:this.lineEditorModel.quote.record.Id};return null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),s.back(this,e,["quote","le"])}this.topLevelBundle.nestedOptionModel.cancel();var t=this.topLevelBundle.nestedOptionModel.getLastFromPath().tabIndex,i=this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU(),n=i?this.createQueryParams({oId:i,ignoreCache:!1},t):this.createQueryParams({qId:this.lineEditorModel.quote.record.Id},t);this.nav("#",n,["product","pc"],!1)}},{key:"getConfiguredProductsToSave",value:function(){var t=this,i=[];return this.productSelectionModel.configuredProducts.forEach(function(e){i.push(t.prepareProductForServer(e))}),i}},{key:"getSelectedProductsToSave",value:function(){var e=this.productSelectionModel.configuredProducts,t={},i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=this.prepareProductForServer(a),u=a.record.Id,d=t[u];d||(d=[]),d.push(l),t[u]=d}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}var c=this.productSelectionModel.selectedProducts,h=Object.keys(c).sort(function(e,t){return c[e].index-c[t].index}),f=[],p=!0,v=!1,g=void 0;try{for(var y,m=h[Symbol.iterator]();!(p=(y=m.next()).done);p=!0){var b=y.value,_=c[b],C=t[b];C?f=f.concat(C):_.invalid||f.push(_)}}catch(e){v=!0,g=e}finally{try{!p&&m.return&&m.return()}finally{if(v)throw g}}return f}},{key:"checkForExternalConfiguration",value:function(){var e=this.productSelectionModel.configuredProducts[this.productIndex],t=this.prefix+"ExternallyConfigurable__c",i=this.lineEditorModel.settings.externalConfiguratorUrl,n=this.lineEditorModel.settings.thirdPartyConfigurator;!e.record[t]||e.visitedExternal&&!n||this.isClassic||null===i||(e.visitedExternal=!0,this.$.customActions.handlePopup(i,!0,n))}},{key:"_handleExternalDynamicOptions",value:function(e){this.$.productLoad.featureOptionIds=e.featureOptionIds,this.$.productLoad.ignoreCache=void 0,this.$.productLoad.ignoreCache=!0,e.redirect&&e.redirect.auto&&(e.redirect.save?this.redirectAfterOptionsAdded="save":this.redirectAfterOptionsAdded="cancel")}},{key:"_handleExternalDynamicOptionsResponse",value:function(e){this.$.bundles.$$("#features").handleDynamicOptionsAdded(e),void 0!==this.redirectAfterOptionsAdded&&("save"===this.redirectAfterOptionsAdded?this.save():this.cancel())}},{key:"handleChangeEvent",value:function(e,t){if(e&&e.detail&&e.detail.bundleId&&e.detail.changed&&e.detail.path){var i=this.getProductById(e.detail.bundleId);this.handleApplyImmediatelyProductRules(i,e.detail,t)}if("On Quantity Change"===t&&(this.validationMessages=null,0<e.detail.invalidQuantity)){var n=this.i18n.l(this.lineEditorModel.customLabels.Maximum_Quantity_Error,[e.detail.validQuantity]);this.validationMessages=[{type:"warning",msg:n}]}}},{key:"handleApplyImmediatelyProductRules",value:function(e,t,i){e&&this.isAppliedImmediately(e,t,i)&&(this.spinner=!0,this.debounce("ApplyImmediatelyProductRules",function(){this.$.productRulesInvoke.product=void 0,e=this.prepareProductForServer(e,!0),this.$.productRulesInvoke.upgradeAssetId=e.upgradedAssetId||null,this.$.productRulesInvoke.product=e},250))}},{key:"isAppliedImmediately",value:function(e,t,i){var n=this.prefix+"AppliedImmediately__c",o=this.prefix+"AppliedImmediatelyContext__c",r=void 0,s=void 0;return"On Apply Rules"===i||("On Attribute Change"===i?(r=e.configurationAttributes.find(function(e){return e.myId===t.Id})).appliedImmediately:("Always"===(s=(r=e.options.find(function(e){return e.record.Id===t.Id})).record[o])||s===i||void 0===s&&"On Selection"===i)&&r.record[n])}},{key:"handleConfigureOptionEvent",value:function(){this.addEventListener("configure-option-tapped",function(e){var t=this.prepareProductForNestedConfigure(e.detail),i=this.createQueryParams({oId:t.nestedOptionModel.getLastFromPath().optionalSKU,ignoreCache:!1},0);this.nav("#",i,["product","pc"],!1)}.bind(this))}},{key:"prepareProductForNestedConfigure",value:function(e){var t=void 0;if(""===this.optionId){var i=this.productSelectionModel.currentIndex=this.getProductIndex(e.productId);t=this.productSelectionModel.configuredProducts[i]}else t=this.topLevelBundle;return t.nestedOptionModel=t.nestedOptionModel||new v,t.nestedOptionModel.addToPath(e.optionId,e.optionalSKU,e.addedIndex,e.tabIndex),t.nestedOptionModel.stagedOption={optionData:e.optionData,isDynamicOption:e.isDynamicOption},t}},{key:"handleOptionConfiguratorResponse",value:function(){this.$.optionConfigure.addEventListener("option-configurator-response-changed",function(e){this.currentTarget=e.detail.value;var t=this.currentTarget.configuredProducts[0];if(this.ctx.params.oId&&0==t.options.length&&0==t.configurationAttributes.length&&!this.hasDynamicFeature(t)){var i=this.topLevelBundle.nestedOptionModel.getLastFromPath().tabIndex,n=this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU(),o=n?this.createQueryParams({oId:n,ignoreCache:!1},i):this.createQueryParams({qId:this.lineEditorModel.quote.record.Id},i);return this.$.productAlerts.displayContinueButton=!1,this.$.productAlerts.cancelCB=function(){return this.nav("#",o,["product","pc"],!1)}.bind(this),this.$.productAlerts.alerts=[this.i18n.l(this.lineEditorModel.customLabels.msg_has_no_options_config)]}this.topLevelBundle.nestedOptionModel&&(this.topLevelBundle.nestedOptionModel.descendLevel?(t.configuration=this.topLevelBundle.nestedOptionModel.configure(t.configuration),t.quoteType=this.lineEditorModel.quote.record[this.prefix+"Type__c"],(new p).reconfigure(t,t.configuration),this.ctx.params.tab&&(this.ctx.params.tab=0)):(t.configuration=this.topLevelBundle.nestedOptionModel.getCurrentConfiguration(),t.configuration.configuredOptions=this.topLevelBundle.nestedOptionModel.getConfiguredOptionsFromPath())),t.rulesProcessed||new f(t.configuration,t).initProductRulesActions(!0),this.addAttributeSetFromServerProductVO(t);var r=this.topLevelBundle.optionFieldSets.SearchFilters,s={},a=!0,l=!1,u=void 0;try{for(var d,c=r[Symbol.iterator]();!(a=(d=c.next()).done);a=!0)s[d.value]=null}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}this.productIndex=0,this.$.bundles.searchValuesByFilter=s,this.$.bundles.searchFilters=r,this.$.bundles.set("configuredProducts",this.currentTarget.configuredProducts)}.bind(this))}},{key:"getProductById",value:function(t){return this.currentTarget.configuredProducts.find(function(e){return(e.productKey||e.record.Id)===t})}},{key:"getProductIndex",value:function(e){if(""===this.optionId){if(e)for(var t=0;t<this.productSelectionModel.configuredProducts.length;t++)if(this.productSelectionModel.configuredProducts[t].record.Id===e)return t;if(!this.ctx.params||!this.ctx.params.productIdx)return 0;var i=+this.ctx.params.productIdx;return Number.isNaN(i)||i<0||i>=this.currentTarget.configuredProducts.length?0:i}}},{key:"hasDynamicFeature",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e.features[Symbol.iterator]();!(t=(o=r.next()).done);t=!0)if("Dynamic"===o.value.record[this.prefix+"OptionSelectionMethod__c"])return!0}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return!1}},{key:"addAttributeSetFromServerProductVO",value:function(e){e.attributeSet&&0===Object.keys(e.attributeSet.attributeItemIdsByOptionId).length||(e._transient_=e._transient_||{},e._transient_.attributeSet=e.attributeSet)}},{key:"changeAllActions",value:function(e){e?this.$$("#allActions").classList.add("actionsCollapsed"):this.$$("#allActions").classList.remove("actionsCollapsed")}},{key:"prepareProductForServer",value:function(e,t){var i={record:{}},n=this.topLevelBundle?this.topLevelBundle.nestedOptionModel:e.nestedOptionModel;i.upgradedAssetId=e.upgradedAssetId;var o=void 0;try{o=this.getSelectedAndRemovedOptions(e,t)}catch(e){if(e.name===u)return void(this.validationMessages=[e.message]);throw e}return i.configuration=n.save(o,t),i.configuration.configurationData=e.configuration.configurationData,i.configuration.configuredProductId=i.record.Id=e.record.Id,i}},{key:"getSelectedAndRemovedOptions",value:function(e,t){var i={selectedOptions:[],removedOptions:[]},n=!0,o=!1,r=void 0;try{for(var s,a=e.features[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=!0,d=!1,c=void 0;try{for(var h,f=l._transient_.optionConfigurations[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;if(p.selected){if(!t&&p.configurationRequired&&!0!==p.configured){var v=this.i18n.l(this.lineEditorModel.customLabels.msg_options_missing_config);throw new m(v)}p.isUpgrade&&new y(this.prefix,e.options,p).setUpgradedAssetId();var g=JSON.parse(JSON.stringify(p));this.buildOptionForLineEditor(g,i.selectedOptions)}else i.removedOptions.push(p)}}catch(e){d=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw c}}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}},{key:"buildOptionForLineEditor",value:function(e,t){e.optionConfigurations=e.optionConfigurations||[],e.optionId=e.record.Id,e.optionData=e.record,void 0===e.configurationData&&(e.configurationData={}),e.isDynamicOption=e.isDynamicOption||e.isUpgrade,delete e.record,t.push(e)}},{key:"createQueryParams",value:function(e,t){var i=this.ctx.params;return i&&(i.pId?e.pId=i.pId:e.pId=this.getAllProductIds(),i.redirectUrl&&(e.redirectUrl=i.redirectUrl),e.oId&&(e.qId=i.qId,"none"===e.oId&&delete e.oId),i.productIdx?e.productIdx=i.productIdx:null!=i.pId&&"string"!=typeof i.pId&&1<i.pId.length&&(e.productIdx=0),i.lineKey&&(e.lineKey=i.lineKey),null==e.ignoreCache&&i.ignoreCache&&(e.ignoreCache=!1),t||0==t?e.tab=t:i.tab&&(e.tab=i.tab),i.groupKey&&(e.groupKey=i.groupKey),i.aId&&(e.aId=i.aId)),e}},{key:"getAllProductIds",value:function(){var e=[],t=!0,i=!1,n=void 0;try{for(var o,r=this.currentTarget.configuredProducts[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;e.push(s.record.Id)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return e.join()}},{key:"createPathParams",value:function(e){return""!==this.optionId?["product","pc"]:"ProductLookup"===e?["product","lookup"]:"RecommendationLookup"===e?["recommend","lookup"]:["quote","le"]}},{key:"toggle",value:function(){this.viewport.isMobile()&&this.hasMultipleBundles&&this.$.bundles.toggle()}},{key:"isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"_setIsMobileAndHasMultipleBundles",value:function(e,t){return e.isMobile()&&t}},{key:"getRequiredConfigurationAttributes",value:function(){if(this.requiredConfigAttributes)return this.requiredConfigAttributes;for(var e=this.currentTarget.configuredProducts,t={},i=0,n=e.length;i<n;i++){for(var o=e[i].configurationAttributes,r={},s=0,a=o.length;s<a;s++){var l=o[s];!0===l.required&&-1===Object.keys(r).indexOf(l.targetFieldName)&&(r[l.targetFieldName]=l)}t[i]=r}return this.requiredConfigAttributes=t,this.requiredConfigAttributes}},{key:"configurationAttributesValid",value:function(){for(var e=this.getRequiredConfigurationAttributes(),t={},i=this.currentTarget.configuredProducts,n=0,o=i.length;n<o;n++){var r=i[n].configuration.configurationData,s=e[n];for(var a in s)this.requiredConfigurationAttributeValid(r[a])||(t[a]=!0)}return this.requiredAttributeMissingValue=t,0===Object.keys(t).length}},{key:"getConfigurationAttributeMissingFeaturesMessage",value:function(){var e={};for(var t in void 0===this.requiredAttributeMissingValue&&this.getRequiredConfigurationAttributes(),this.requiredConfigAttributes)for(var i in this.requiredConfigAttributes[t])if(!0===this.requiredAttributeMissingValue[i]){var n=this.getFeatureNameFromId(this.requiredConfigAttributes[t][i].featureId);void 0!==n&&(e[n]=void 0)}var o=Object.keys(e);return 0===o.length?"":" in the following features: "+o}},{key:"getFeatureNameFromId",value:function(e){if(void 0!==e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.currentTarget.configuredProducts[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value,a=!0,l=!1,u=void 0;try{for(var d,c=s.features[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value;if(h.record.Id===e)return h.record.Name}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}}},{key:"requiredConfigurationAttributeValid",value:function(e){return!this.isNil(e)}},{key:"search",value:function(){this.$.bundles.toggleSearch()}},{key:"setOptionConfigurationDetails",value:function(e){if(this.topLevelBundle=e.currentIndex?e.configuredProducts[e.currentIndex]:e.configuredProducts[0],null==this.topLevelBundle.nestedOptionModel)return delete this.ctx.params.oId,this.nav("#",this.ctx.params,["product","pc"],!1);var t=this.topLevelBundle.nestedOptionModel.getExistingConfiguration();this.topLevelBundle.nestedOptionModel&&t&&(t.configured||t.changedByProductActions||t.optionConfigurations.length)&&(this.$.optionConfigure.featureOptionalSKUs=this.buildDynamicConfigurations(t),this.$.optionConfigure.configuration=t),this.topLevelBundle.nestedOptionModel?this.$.optionConfigure.ignoreCache="ol"!==this.ctx.params.origin&&this.topLevelBundle.nestedOptionModel.descendLevel:this.$.optionConfigure.ignoreCache=!0,this.$.optionConfigure.product=void 0,this.$.optionConfigure.product=this.topLevelBundle}},{key:"buildDynamicConfigurations",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e.optionConfigurations[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;if(a.isDynamicOption){var l=a.optionData;l.Id&&l[this.prefix+"Feature__c"]&&l[this.prefix+"OptionalSKU__c"]&&t.push(l[this.prefix+"Feature__c"]+":"+l[this.prefix+"OptionalSKU__c"]+":"+l.Id)}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"preLoadObjects",value:function(){this.configuratorObjects=[this.prefix+"DiscountSchedule__c",this.prefix+"ProductOption__c",this.prefix+"QuoteLine__c"]}},{key:"getProductIds",value:function(){return this.ctx.params&&this.ctx.params.pId||""}},{key:"getLineKey",value:function(){return this.ctx.params?parseInt(this.ctx.params.lineKey||-1):-1}},{key:"getGroupKey",value:function(){return this.ctx.params?parseInt(this.ctx.params.groupKey||-1):-1}},{key:"getIgnoreCache",value:function(){return!!this.ctx.params&&"true"===this.ctx.params.ignoreCache}},{key:"getOptionId",value:function(){return this.ctx.params&&this.ctx.params.oId||""}},{key:"isNil",value:function(e){return null==e||""===e}},{key:"loadedModelIsReconfigure",value:function(e){return!e.quote&&1==e.configuredProducts.length}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.validationMessages=r(this.errors),this.spinner=!1)}},{key:"isReconfigure",value:function(e){return!e.selectedProducts}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}},{key:"prefix",get:function(){return a.org.prefix?a.org.prefix+"__":""}}]),d=e)),t("ProductConfig",d),g(i,Error),m=i,Polymer(d)}}}),System.register("products/resources/model/nestedOptions/NestedOptionsModel.js",["products/resources/tree/ConfigTree.js"],function(e,t){var o,c,r;return{setters:[function(e){o=e.ConfigTree}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.init(e,t)}c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},e("NestedOptionsModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"init",value:function(e,t){this.path=[],this.descendLevel=!1,this.configTree=new o(e),this._setConfiguredOptionsObject(t),this.CONFIG_TAG="config",this.SAVE_TAG="save"}},{key:"configure",value:function(e){var t=this.getLastFromPath(),i=this._getParentConfiguration();e.index=e.index||t.index,e.optionId=e.optionId||t.optionId,void 0!==this.stagedOption&&(e.optionData=this.stagedOption.optionData||e.optionData,e.isDynamicOption=this.stagedOption.isDynamicOption||e.isDynamicOption||!1);var n=this._setAndReturnConfiguration(e,i,this.CONFIG_TAG);return n.configuredOptions=this.getConfiguredOptionsFromPath(),this.descendLevel=!1,n}},{key:"save",value:function(e,t){var i=this._setAndGetConfiguration(t),n=this._getTagForSave(t);return this._removeDeselectedOptions(e.removedOptions,n,null),this._addSelectedOptions(e.selectedOptions,n),this._sortOptionConfigurations(i,e.selectedOptions),t||this._setConfigured(i),i}},{key:"_getTagForSave",value:function(e){return 0===this.path.length?null:e?this.CONFIG_TAG:this.SAVE_TAG}},{key:"cancel",value:function(){var e=this.getCurrentConfiguration(),t=this._getParentConfiguration();this._removeSubtree(e,t,this.CONFIG_TAG,!0)}},{key:"remove",value:function(e,t,i){var n=this._getConfiguration(t);!n.getChildren||n.getChildren().length<1||(e.optionId=e.record?e.record.Id:e.optionId,e.index=e.index||0,this._removeSubtree(e,n,i))}},{key:"removeAddedOption",value:function(e){var t=0===this.path.length?null:this.CONFIG_TAG;this.remove(e,t,null)}},{key:"swapConfiguration",value:function(e){var t=this._getParentConfiguration(),i=this.getSaveConfiguration();e.index=i.index,this._removePreviousConfigurations(t),this._addToConfigTree(t,e),this._setConfigured(e),e.tag="saved"}},{key:"removeClonedConfiguration",value:function(){var e=this.getSaveConfiguration(),t=this._getParentConfiguration();this._removeSubtree(e,t,this.SAVE_TAG,!0)}},{key:"handleDescendantRules",value:function(e,i,t,n,o){var r=this,s=this.configTree.getFromPath(this.path.concat(e)),a=void 0;if(s){s.changedByProductActions=o;var l={};a=s.getChildren(),i.forEach(function(t){l[t.optionId]=void 0===l[t.optionId]?0:l[t.optionId]+1,t.index=l[t.optionId],void 0===a.find(function(e){return r._buildId(t)===e.nodeId})&&(r.configTree.buildSubtree(t),a.push(t))});for(var u=function(e){var t=a[e];void 0===i.find(function(e){return t.nodeId===r._buildId(e)})&&r._removeSubtree(t,s)},d=a.length-1;0<=d;d--)u(d);s.disabledOptionIds=n,s.hiddenOptionIds=t}}},{key:"getExistingConfiguration",value:function(){return this._getConfiguration()}},{key:"getCurrentConfiguration",value:function(){return this._getConfiguration(this.CONFIG_TAG)}},{key:"getSaveConfiguration",value:function(){return this._getConfiguration(this.SAVE_TAG)}},{key:"_getConfiguration",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=this._createPath(e);return this.configTree.getFromPath(t)}},{key:"addToPath",value:function(e,t,i,n){this.path.push({optionId:e,optionalSKU:t,index:i,tabIndex:n}),this.descendLevel=!0}},{key:"popFromPathAndGetNextSKU",value:function(){this.path.pop(),this.descendLevel=!1;var e=this.getLastFromPath();return e?e.optionalSKU:e}},{key:"getLastFromPath",value:function(){return this.path[this.path.length-1]}},{key:"getConfiguredOptionsFromPath",value:function(){return this.configuredOptions[this._buildPathString(!0)]||{}}},{key:"_getParentConfiguration",value:function(){var e=0<this.path.length?this.CONFIG_TAG:null,t=this.path.slice(0,this.path.length-1),i=this._createPath(e,t);return this.configTree.getFromPath(i)}},{key:"_setConfiguredOptionsObject",value:function(e){this.configuredOptions={},e&&(this._addConfigsToConfigurationObject(this.configTree.root,[]),this.configTree.root.configuredOptions=this.getConfiguredOptionsFromPath())}},{key:"_addConfigsToConfigurationObject",value:function(e,i){var n=this;e.getChildren().forEach(function(e){var t={optionId:e.optionId,index:e.index};n._addConfigsToConfigurationObject(e,i.concat([t]))}),this._setConfigured(e,i)}},{key:"_setConfigured",value:function(e,t){var i=this._buildPathString(!1,t);e.configured=!0,e.configurationEntered=!0,i&&(this.configuredOptions[i]=this.configuredOptions[i]||{},this.configuredOptions[i][e.nodeId]=!0)}},{key:"_updateThenGetSubtree",value:function(e,t,i,n){var o=this._buildId(e),r=this._findInConfiguration(o,t);return r?(this._updateSubtree(r,e,i),r):(this._appendSubtree(e,t,n),e.staged=!0,e)}},{key:"_updateSubtree",value:function(e,t,i){i&&(delete e.staged,e.optionData=t.optionData,e.externalConfigurationData=t.externalConfigurationData),this._propagateRuleData(e,t.disabledOptionIds,t.hiddenOptionIds),this._propagateAttributes(e.configurationData,t.configurationData),this._mergeNestedConfigurations(t,e)}},{key:"_mergeNestedConfigurations",value:function(e,t){var i=this;if(0<e.optionConfigurations.length){var n={};e.optionConfigurations.forEach(function(e){n[e.optionId]=void 0===n[e.optionId]?0:n[e.optionId]+1,e.index=n[e.optionId],e.selected=!0,i._updateThenGetSubtree(e,t,!1)})}}},{key:"_propagateRuleData",value:function(e,t,i){e.disabledOptionIds=e.disabledOptionIds||t,e.hiddenOptionIds=e.hiddenOptionIds||i}},{key:"_propagateAttributes",value:function(t,i){Object.keys(i).forEach(function(e){t[e]=t[e]||i[e]})}},{key:"_setAndReturnConfiguration",value:function(e,t,i){var n=i===this.SAVE_TAG?this._cloneConfiguration(e,t):e;return n.tag=i,n.staged=!0,this._addToConfigTree(t,n)}},{key:"_cloneConfiguration",value:function(e,t){var i=this._buildId(e,this.CONFIG_TAG),n=this._findInConfiguration(i,t);return JSON.parse(JSON.stringify(n))}},{key:"_addToConfigTree",value:function(e,t){return this.configTree.buildSubtree(t),e.getChildren().push(t),t}},{key:"_appendSubtree",value:function(e,t,i){this._addIndexProperty(e,t),this.configTree.buildSubtree(e),null!=i?t.getChildren().splice(i,0,e):t.getChildren().push(e)}},{key:"_removeSubtree",value:function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=this._getChildIndexAndAdjustIndices(e.optionId,e.index,t.getChildren(),i,n);0<=o&&this._removeConfiguration(t,o,this._buildId(e,i))}},{key:"_removeConfiguration",value:function(e,t,i){var n=this._buildPathString(!0);e.getChildren().splice(t,1),n&&this.configuredOptions[n]&&this.configuredOptions[n][i]&&!this._findInConfiguration(i,e)&&delete this.configuredOptions[n][i]}},{key:"_findInConfiguration",value:function(e,t){var i=e.constructor===String?e:this._buildId(e);return t.getChildren().find(function(e){return e.nodeId===i})}},{key:"_addIndexProperty",value:function(e,t){for(var i=e.index||0;this._findInConfiguration(this._buildId({optionId:e.optionId,index:i}),t);)i++;e.index=i}},{key:"_getChildIndexAndAdjustIndices",value:function(e,t,i,n,o){var r=0,s=-1,a=this._buildId({optionId:e,index:t},n===this.SAVE_TAG?"":n),l=!0,u=!1,d=void 0;try{for(var c,h=i[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var f=c.value;f.nodeId===a||n===this.SAVE_TAG&&-1!==f.nodeId.indexOf(a)?s=r:!o&&f.optionId===e&&f.index>t&&this._alterIndexPropertyAndNodeId(f),r++}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}return s}},{key:"_alterIndexPropertyAndNodeId",value:function(e){var t=e.nodeId;e.index--,e.nodeId=this._buildId(e);var i=this._buildPathString(!0);i&&this.configuredOptions[i]&&(this.configuredOptions[i][e.nodeId]=!0,delete this.configuredOptions[i][t])}},{key:"_buildId",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return"_"+e.optionId+"_"+e.index+(t?"_"+t:"")}},{key:"_buildPathString",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.path,i=this.configTree.root.nodeId,n=e?0:1,o=0;o<t.length-n;o++)i+="-"+this._buildId(t[o]);return i}},{key:"_createPath",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.path,i=[],n=!0,o=!1,r=void 0;try{for(var s,a=t.entries()[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=c(s.value,2),u=l[0],d=l[1];u===t.length-1?d.tag=e:d.tag=this.CONFIG_TAG,i.push(d)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}},{key:"_setAndGetConfiguration",value:function(e){return 0===this.path.length?this.getExistingConfiguration():e?this.getCurrentConfiguration():this._setAndReturnConfiguration(this.getCurrentConfiguration(),this._getParentConfiguration(),this.SAVE_TAG)}},{key:"_removeDeselectedOptions",value:function(e,t,i){var n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;this.remove(l,t,i)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}},{key:"_addSelectedOptions",value:function(e,t){var i=this._getConfiguration(t),n=!0,o=!1,r=void 0;try{for(var s,a=e.entries()[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=c(s.value,2),u=l[0],d=l[1];this._updateThenGetSubtree(d,i,!0,u)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}},{key:"_sortOptionConfigurations",value:function(e,t){if(t&&0!==t.length&&t.length===e.getChildren().length){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=t.entries()[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=c(s.value,2),u=l[0],d=l[1];i[u]=this._findInConfiguration(d,e)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}e.optionConfigurations=i}}},{key:"_removePreviousConfigurations",value:function(e){var t=this.getExistingConfiguration();t&&this._removeSubtree(t,e,null,!0),this._removeSubtree(this.getCurrentConfiguration(),e,this.CONFIG_TAG,!0),this._removeSubtree(this.getSaveConfiguration(),e,this.SAVE_TAG,!0)}}]),r=i)),e("NestedOptionsModel",r)}}}),System.register("products/selection/filter/sb-suggester/Suggester.js",["../../../../common/Util.js","common/data/client/ServiceClient.js","common/core/AppContext.js","common/forms/sb-lookup/map/LookupNameMapper.js"],function(e,t){var v,r,y,i;return{setters:[function(e){v=e.Util},function(e){r=e.ServiceClient},function(e){e.AppContext},function(e){y=e.LookupNameMapper}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.prefix=e,this.searchModel=t,this.searchFilterData={},this.filterContext=i}e("Suggester",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"buildFields",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.replace("Product2","ProcessInput__c"))}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"getSearchTable",value:function(){return this.prefix+"ProcessInput__c"}},{key:"getGroupKey",value:function(e){return e.record.Id}},{key:"setDefaultFilterValues",value:function(e,t){var c={},i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=!0,d=!1,h=void 0;try{for(var f,p=this.searchModel.quoteProcess.inputs[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var v=f.value;if(v.record.Id===l){this.searchModel.processInputValues[l]&&t&&this.isLookupType(t[l].model.type)&&this.searchModel.processInputValues[l][this.prefix+"Value__c"]&&i.push(this.queryLookupFilterName(this.searchModel.processInputValues[l][this.prefix+"Value__c"],t[l].model.referenceTo[0]));var g=null;g=this.searchModel.processInputValues[l]?this.searchModel.processInputValues[l][this.prefix+"Value__c"]||null:v.record[v.record[this.prefix+"InputField__c"]]||null,c[l]={value:g,hidden:!1,field:v.targetFieldName};break}}}catch(e){d=!0,h=e}finally{try{!u&&p.return&&p.return()}finally{if(d)throw h}}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return new Promise(function(d){0===i.length?(this.searchFilterData=c,d(c)):Promise.all(i).then(function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value.records[0];if(s){var a=new y(s.attributes.type).getNameField();for(var l in c){var u=c[l];if(u.value&&u.value.substring(0,15)===s.Id.substring(0,15)){u.label=s[a];break}}}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.searchFilterData=c,this.evaluateProcessInputConditions(),d(c)}.bind(this))}.bind(this))}},{key:"getFilterContext",value:function(){var e=JSON.parse(JSON.stringify(this.filterContext)),t=!0,i=!1,n=void 0;try{for(var o,r=e.inputs[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.searchFilterData[s.record.Id].hidden?(s.record[s.targetFieldName]=null,s.hidden=!0):this.searchFilterData[s.record.Id]&&(""===this.searchFilterData[s.record.Id].value?s.record[s.targetFieldName]=null:s.record[s.targetFieldName]=this.searchFilterData[s.record.Id].value)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}for(var a=e.inputs.length,l=0;l<a;l++)e.inputs[l].hidden&&(e.inputs.splice(l,1),a--,l--);return e}},{key:"getAdditionalProperties",value:function(){return null}},{key:"evaluateProcessInputConditions",value:function(){var e=JSON.parse(JSON.stringify(this.searchFilterData)),t=!0,i=!1,n=void 0;try{for(var o,r=this.filterContext.inputs[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value,a=0;if(0!==s.conditions.length){var l=!0,u=!1,d=void 0;try{for(var c,h=s.conditions[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var f=c.value,p=e[f[this.prefix+"MasterProcessInput__c"]].value;v.arithmeticOperatorConversion(p,f[this.prefix+"Value__c"],f[this.prefix+"Operator__c"])&&a++}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}"All"===s.record[this.prefix+"ConditionsMet__c"]?e[s.record.Id].hidden=!(a===s.conditions.length):e[s.record.Id].hidden=!(0<a)}else e[s.record.Id].hidden=!1}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return this.searchFilterData=e}},{key:"runOnLoad",value:function(){var e=[],t=!0,i=!1,n=void 0;try{for(var o,r=this.searchModel.quoteProcess.inputs[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;e.push(s.record.Id)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.setDefaultFilterValues(e)}},{key:"isLookupType",value:function(e){return"reference"===e||"id"===e}},{key:"queryLookupFilterName",value:function(e,t){var i=new y(t).getNameField(),n=e?"'"+e+"'":null;return(new r).query(("SELECT Id, "+i+" FROM "+t+" WHERE Id = ").concat(n))}}]),i=o)),e("Suggester",i)}}}),System.register("products/selection/routes/sb-product-lookup/ProductLookup.js",["common/core/Page.js","common/layout/fields/FieldSetHandler.js","common/filter/searcher/Searcher.js","products/selection/filter/sb-suggester/Suggester.js","common/core/sb-page-container/PageContainer.js","products/localization/LocalizeFields.js","common/data/format/ErrorFormatter.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js","common/rules/RuleExecutor.js","quotes/models/SafeClientCache.js","common/core/Events.js"],function(t,e){var i,o,r,s,a,l,u,d,c,h,f,p,v;return{setters:[function(e){i=e.Page},function(e){e.FieldSetHandler},function(e){o=e.Searcher},function(e){r=e.Suggester},function(e){s=e.PageContainer},function(e){a=e.LocalizeFields},function(e){l=e.formatError},function(e){u=e.QuoteLineAggregator},function(e){e.RuleExecutor},function(e){d=e.put},function(e){c=e.Events,h=e.fireEvent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}f=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},p=["#gslayout","#pflayout"],t("ProductLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),f(e,[{key:"beforeRegister",value:function(){this.is="sb-product-lookup",this.properties=Polymer.Base.extend({selectedProducts:{type:Object,value:{}},lineEditorModel:Object,redirectUrl:String,totalCount:String,hasTotalCount:Boolean,quote:Object,internal:{type:Boolean,value:!1},viewport:{type:Object,value:function(){return s.getViewport()}},errors:{type:Array,value:[],notify:!0},error:{type:Array,value:[]},isMobile:{type:Boolean,computed:"_setIsMobile(viewport)"},searchContext:String,searchedValue:String,filterContext:Object,searcher:Object},i.properties)}},{key:"_modalObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.modal(e,t)}},{key:"modal",value:function(){!this.modalActive&&this.hasQuoteProcess?(this.$.selectionSaver.save({uid:this.quote.record.Id,model:{modalActive:!0}}),this.toggleClass("modaloverflow",!0,this),this.$.modal.show=!0,this.refocus()):(this.hasQuoteProcess||this.setPanelDisplay("#pflayout"),!0===this.lineEditorModel.settings.openSearchFilterByDefault&&this.toggleFilter(),this.panelSuggester=this.suggester,this.panelGroupItems=this.groupItems)}},{key:"ready",value:function(){this.setSpinnerMessage(),this.preLoadObjects(),this.handleClearSelected(),this.handleSelectButtonClickedServerResponseAndNavigation(),this.$.lookupLayout.additionalFields=["PricebookEntry.UnitPrice"],this.$.modal.addEventListener("sb-gs-modal-close",this.closeDialog.bind(this)),this.$.drawer.addEventListener("transitionend",this.refocus.bind(this)),this.$.modal.addEventListener("filter-item-value-changed",this.handleLabelChanged.bind(this)),this.addEventListener("iron-deselect",this.handleDrawerClosed.bind(this)),this.addEventListener("clear-filters",this.clearFilterFields),this.addEventListener("sb-type-clear",this.resetSearchBar),this.attachSearchBarEventListeners()}},{key:"setSpinnerMessage",value:function(){d("RootState","spinnerMessage","Large bundle configuration enabled. It may take a minute to process your bundle.")}},{key:"handleTransientCache",value:function(){this.$.selectionReader.read({uid:this.quote.record.Id}).then(function(e){this.lastSubmit=e?e.lastSubmit:null,this.modalActive=!!e&&e.modalActive,"gs"===this.lastSubmit?(this.suggester.runOnLoad(),this.runSuggester()):"pf"===this.lastSubmit&&(this.searcher.runOnLoad(e.filterValues),this.runSearcher())}.bind(this))}},{key:"handleProductsLoadServerResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.quote=e.detail.value.quote,this.inputField=this.prefix+"InputField__c",this.localizer=new a(this.prefix);var t=parseInt(this.ctx.params.groupKey),i=this.getQuoteProcessId(this.quote,t);this.hasQuoteProcess=null!==i,!0===this.hasQuoteProcess?this.setPanelDisplay("#gslayout"):this.setPanelDisplay("#pflayout"),this.ctx.params.aId&&(this.$.smLoadService.actionId=this.ctx.params.aId),this.$.smLoadService.processId=i,this.$.smLoadService.quote=this.$.smSelectService.quote=this.quote}.bind(this)),this.$.smLoadService.addEventListener("search-model-changed",function(e){var t=this.localizer.localizeSearchModel(e.detail.value);void 0!==this.guidedOnly&&null!==this.guidedOnly||null==t.searchFiltersTabShown||(this.guidedOnly=!t.searchFiltersTabShown),this.onLoadSearchModel||(this.onLoadSearchModel=Object.assign({},t)),this.$.lookupLayout.groupByField=t.productResultsGroupFieldName,this.$.lookupLayout.fieldPrefix=t.targetObjectName+".",t=this._removeInactiveQuoteProcessInputs(t),this.quoteProcess=t.quoteProcess,this.searchModel=t,this.buildDelegator(),this.handleTransientCache()}.bind(this))}},{key:"getQuoteProcessId",value:function(e,t){var i=void 0,n=!0,o=!1,r=void 0;try{for(var s,a=e.lineItemGroups[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(l.key===t){i=l.record[this.prefix+"QuoteProcess__c"];break}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i||e.record[this.prefix+"QuoteProcessId__c"]||null}},{key:"attachSearchBarEventListeners",value:function(){this.addEventListener("sb-search-invoked",this.searchBarResultsChanged.bind(this)),this.addEventListener("sb-search-item-selected",this.searchBarItemSelected.bind(this)),this.addEventListener("sb-search-reset-clicked",this.searchBarResetClicked.bind(this)),this.addEventListener("sb-search-nil-search-invoked",this.searchBarNilSearchInvoked.bind(this))}},{key:"handleSelectButtonClickedServerResponseAndNavigation",value:function(){this.$.smSelectService.addEventListener("result-changed",function(e){this._updateQuote(e.detail.value.quote),0==e.detail.value.configuredProducts.length&&this.handleNonConfigurableProducts(e),0<e.detail.value.configuredProducts.length&&this.handleConfigurableProducts(e)}.bind(this))}},{key:"handleNonConfigurableProducts",value:function(e){"LineEditor"===this.redirectUrl?this.navigateToLineEditor():"ProductLookup"===this.redirectUrl&&(this.$.smSelectService.quote=e.detail.value.quote,this.$.lookupLayout.deSelectAll(),this.navigateToSelf(),this.spinner=!1)}},{key:"handleConfigurableProducts",value:function(e){var t={};e.detail.value.selectedProducts=this.selectedProducts;var i=this.getConfigProductIds(e);t.qId=e.detail.value.quote.record.Id,void 0!==this.ctx.params.groupKey&&(t.groupKey=this.ctx.params.groupKey),void 0!==this.ctx.params.aId&&(t.aId=this.ctx.params.aId),t.pId=i,t.redirectUrl=this.redirectUrl,t.open=0,this.nav("#",t,["product","pc"],!1)}},{key:"_updateQuote",value:function(e){if(e.partialVO){var t=this.lineEditorModel.quote.lineItems;e.lineItems=t.concat(e.lineItems),delete e.existingProductIds,delete e.segmentTemplatesByDimensionTypeByGroupKey,delete e.emptyGroupKeys,e.partialVO=!1}this.lineEditorModel.quote=e}},{key:"handleLabelChanged",value:function(e){this.searchFilterData&&(this.searchFilterData[e.detail.item].label=e.detail.value)}},{key:"buildDelegator",value:function(){this.hasQuoteProcess&&(this.suggester=new r(this.prefix,this.searchModel,this.quoteProcess)),this.searcher||(this.searcher=new o(this.searchModel))}},{key:"_removeInactiveQuoteProcessInputs",value:function(e){if(!this.hasQuoteProcess)return e;var t=e.quoteProcess.inputs;if(void 0===t||0===t.length)return e;var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;!1!==l.record[this.prefix+"Active__c"]&&i.push(l)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return e.quoteProcess.inputs=i,e}},{key:"handleValueChanged",value:function(){this.internal||(this.internal=!0,this.updateSearchFilterData(),this.internal=!1)}},{key:"updateSearchFilterData",value:function(){this.suggester.searchFilterData=this.searchFilterData;var e=this.suggester.evaluateProcessInputConditions();this.searchFilterData=e}},{key:"setPanelDisplay",value:function(i){var n=this;p.forEach(function(e){var t=i===e;n.toggleClass("hidden-panel",!t,n.$$(e)),n.toggleClass("visible-panel",t,n.$$(e))})}},{key:"toggleFilter",value:function(){this.togglePanel("pflayout")}},{key:"toggleGuidedSelling",value:function(){this.togglePanel("gslayout")}},{key:"togglePanel",value:function(e){this.$$("sb-page-header")._closeMenu(),this.$$(".visible-panel").id!==e&&"main"!==this.$.drawer.selected||this.$.drawer.togglePanel(),this.setPanelDisplay("#"+e),this.refocus()}},{key:"closeDrawer",value:function(){this.refocus(),this.$.drawer.closeDrawer()}},{key:"refocus",value:function(e){e&&"transitionend"===e.type||this.$$(".visible-panel")&&(this.$.modal.show?this.$.modalGroup.focusFirstField():"gslayout"===this.$$(".visible-panel").id?this.$.gs.focusFirstField():"pflayout"===this.$$(".visible-panel").id&&this.$.pf.focusFirstField())}},{key:"reverseFocus",value:function(){this.$$(".visible-panel")&&(this.$.modal.show?this.$.suggest.focus():"gslayout"===this.$$(".visible-panel").id?this.$.cleargs.focus():"pflayout"===this.$$(".visible-panel").id&&this.$.clearfilter.focus())}},{key:"closeDialog",value:function(){this.toggleClass("modaloverflow",!1,this),this.suggester.skipDefaults=!0,this.panelSuggester=this.suggester,this.panelGroupItems||(this.panelGroupItems=this.groupItems),this.$.modal.show=!1}},{key:"suggestClicked",value:function(){this.suggest=!0,this.runSuggester()}},{key:"runSuggester",value:function(){this.searchContext=this.searchedValue,this.saveCache(),this.lastSubmit="gs",this.closeDialog(),this.$.gs.runService(),this.closeDrawer()}},{key:"runSearcher",value:function(e){this.$$("#submit").focus(),this.searchContext=this.searchedValue,this.saveCache(),this.lastSubmit="pf",this.$.pf.actionId=this.ctx.params.aId,this.searchContext=this.searchedValue,this.filterContext=this.$.pf.filterDelegator.getFilterContext(),this.$.pf.runService(),this.closeDrawer()}},{key:"saveCache",value:function(){this.$.selectionSaver.save({uid:this.quote.record.Id,model:{modalActive:!0,lastSubmit:this.$$(".visible-panel").id.substring(0,2),filterValues:this.searcher.searchFilterData}})}},{key:"getConfigProductIds",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e.detail.value.configuredProducts[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.record.Id)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t.join(",")}},{key:"onSelect",value:function(){this.redirectUrl="LineEditor",this.selectedProducts&&0<Object.keys(this.selectedProducts).length?(this._addAggregateDataIfThresholdExceeded(),this.spinner=!0,this.quoteProcess&&(this.$.smSelectService.quoteProcess=this.suggester.getFilterContext()),this.$.smSelectService.selectedProductList=this.getOrderedSelectedProducts()):this.navigateToLineEditor()}},{key:"onSelectMore",value:function(){this.redirectUrl="ProductLookup",this.selectedProducts&&0<Object.keys(this.selectedProducts).length?(this._addAggregateDataIfThresholdExceeded(),this.spinner=!0,this.quoteProcess&&(this.$.smSelectService.quoteProcess=this.suggester.getFilterContext()),this.$.smSelectService.selectedProductList=this.getOrderedSelectedProducts()):this.navigateToSelf()}},{key:"_addAggregateDataIfThresholdExceeded",value:function(){var e=this.lineEditorModel.settings.largeQuoteThreshold;if(null!=e&&this.quote.lineItems.length>e){this.$.smSelectService.stripQuoteLines=!0;var t=this.lineEditorModel.customLabels.msg_large_quote_sent_without_lines;t=t.replace("{0}",this.lineEditorModel.quote.record.Id).replace("{1}",e),console.log(t);var i=new u(this.quote);this.quote.existingProductIds=i.getExistingProductIdsFromLines();var n=this.ctx.params.groupKey,o=i.getSegmentTemplatesByDimensionTypeForGroupKey(n);this.quote.segmentTemplatesByDimensionTypeByGroupKey={},this.quote.segmentTemplatesByDimensionTypeByGroupKey[(n||-1)+""]=o,this.quote.emptyGroupKeys=i.getKeysOfEmptyGroups()}}},{key:"getOrderedSelectedProducts",value:function(){var e=Object.keys(this.selectedProducts).sort(function(e,t){return this.selectedProducts[e].index-this.selectedProducts[t].index}.bind(this)),t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=this.selectedProducts[a];l.invalid||(delete l.record.UnitPrice,t.push(l))}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"onCancel",value:function(){this.spinner=!0;var e={qId:this.quote.record.Id};null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),this.nav("#",e,["quote","le"],!1)}},{key:"navigateToLineEditor",value:function(){var e={qId:this.quote.record.Id};0<Object.keys(this.selectedProducts).length&&(e.jspr=!0),null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),this.nav("#",e,["quote","le"],!1)}},{key:"navigateToSelf",value:function(){var e=this.ctx.params.aId?"&aId="+this.ctx.params.aId:"";h(c.NAVIGATION_CHANGED,{url:"#",location:"#/product/lookup?qId="+this.quote.record.Id+e}),this.$.plSelectMore.blur()}},{key:"navToFavorites",value:function(){var e={qId:this.quote.record.Id};void 0!==this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),void 0!==this.ctx.params.aId&&(e.aId=this.ctx.params.aId),this.nav("#",e,["favorite","lookup"],!1)}},{key:"handleAutoSelect",value:function(){if(this.suggest&&this.quoteProcess&&this.quoteProcess.record[this.prefix+"ProductAutoSelected__c"]&&1===this.searchModel.results.length){var e=this.searchModel.results[0];this.selectedProducts[e.record.Product2Id]={record:{Id:e.record.Product2Id,attributes:e.record.attributes,UnitPrice:e.record.UnitPrice},invalid:!1},this.suggest=!1,this.onSelect()}}},{key:"handleClearSelected",value:function(){this.addEventListener("suggestion-loaded",function(){this.$.lookupLayout.deSelectAll()}.bind(this))}},{key:"handleDrawerClosed",value:function(){"main"===this.$.drawer.selected&&h(c.PANEL_CLOSED)}},{key:"clearFilterFields",value:function(){this.filterData=this.searcher.clearFields()}},{key:"clearGSFields",value:function(){var e=JSON.parse(JSON.stringify(this.suggester.searchFilterData));for(var t in e)e[t].value=null;this.suggester.searchFilterData=e,this.searchFilterData=this.suggester.evaluateProcessInputConditions()}},{key:"bindFilterEnterCallBacks",value:function(){this.$.pf.enterCallback=this.runSearcher.bind(this),this.$.gs.enterCallback=this.runSuggester.bind(this),this.$.modalGroup.enterCallback=this.runSuggester.bind(this)}},{key:"searchBarResultsChanged",value:function(e){var t=e.detail.searchModel,i=e.detail.searchValue;this.searchContext=i,this.searchedValue=i,this.$$("#headersearch").toggleResetButton(!0),void 0!==t&&(this.searchModel=t)}},{key:"searchBarItemSelected",value:function(e){var t=e.detail.item,i=Object.assign({},this.searchModel),n=e.detail.searchValue;this.searchContext=n,this.searchedValue=n,void 0!==t&&(this.$$("#headersearch").toggleResetButton(!0),i.results=[t],i.totalCount=1,this.searchModel=i)}},{key:"searchBarResetClicked",value:function(){this.searchContext="",this.searchedValue="",this.$$("#headersearch").toggleResetButton(!1),this.searchModel=Object.assign({},this.onLoadSearchModel)}},{key:"searchBarNilSearchInvoked",value:function(){this.searcher.hasSearchFilterValues()?this.runSearcher():this.searchBarResetClicked()}},{key:"resetSearchBar",value:function(){this.searchContext="",this.searchedValue=""}},{key:"preLoadObjects",value:function(){this.lookupObjects=["Product2","PricebookEntry",this.prefix+"ProcessInput__c"]}},{key:"hideFilters",value:function(e,t){return e||t.every(function(e){return e.hidden})}},{key:"isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.error=l(this.errors),this.spinner=!1)}},{key:"_setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.LookupBehavior]}},{key:"observers",get:function(){return["handleAutoSelect(searchModel)","_modalObserver(quote, modalActive)","handleValueChanged(searchFilterData.*)"]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}},{key:"prefix",get:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}}]),v=e)),t("ProductLookup",v),Polymer(v)}}}),System.register("quotes/layout/sb-le-summary-row/sb-le-summary-cell/LESummaryCell.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LESummaryCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-summary-cell",this.properties={model:Object,item:String,summaries:Object}}},{key:"_getMD",value:function(e,t){var i=e.md.fieldsMap[e.data.quoteLineObjectName][t];return i.CurrencyIsoCode=this.model.quoteModel.quoteVO.record.CurrencyIsoCode,i}},{key:"_getValue",value:function(e,t){return e[t.toLowerCase()]}},{key:"_setWidthStyleObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this._setWidthStyle(e,t)}},{key:"_setWidthStyle",value:function(e,t){this.style.minWidth=e.Standard[t]+"px",this.style.maxWidth=this.style.minWidth}},{key:"observers",get:function(){return["_setWidthStyleObserver(model.colWidth, item)"]}}]),i=e)),t("LESummaryCell",i),Polymer(i)}}}),System.register("quotes/layout/sb-line-editor-tabs/sb-group-tabs/GroupTabs.js",["common/core/AppContext.js"],function(t,e){var i;return{setters:[function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("GroupTabs",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-group-tabs",this.properties={isGroupFieldPage:{type:Boolean,computed:"_setIsGroupFieldPage(pageType)"},isSegmentedLinesPage:{type:Boolean,computed:"_setIsSegmentedLinesPage(pageType)"},isStandardLinesPage:{type:Boolean,computed:"_setIsStandardLinesPage(pageType)"},editorModel:{notify:!0,type:Object}}}},{key:"buildPage",value:function(){this.groupModel&&(this.pageType=this.attributes.label.value,this.pageComponent="sf-segmented-table",this.groupObjectName=this.groupModel.groupObjectName,this.groupModel.groupMDQTabs&&(this.tabs=this.groupModel.groupMDQTabs),this.hideTabs=!!this.tabs&&1==this.tabs.length&&"Custom"!=this.tabs[0].key,this.containerClass=this.groupModel.editorModel.largeQuoteExperienceEnabled?"largeQuote":"",this.containerClass+=" sbGroupTabs")}},{key:"_setIsGroupFieldPage",value:function(e){return"details"===e}},{key:"_setIsStandardLinesPage",value:function(e){return"standard"===e}},{key:"_setIsSegmentedLinesPage",value:function(e){return"segmented"===e}},{key:"observers",get:function(){return["buildPage(groupModel)"]}}]),i=e)),t("GroupTabs",i),Polymer(i)}}}),System.register("quotes/layout/sb-line-editor-tabs/sb-quote-tabs/QuoteTabs.js",["common/core/sb-page-container/PageContainer.js","common/core/AppContext.js","common/core/Events.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.PageContainer},function(e){e.AppContext},function(e){o=e.Events}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("QuoteTabs",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-quote-tabs",this.properties={isQuoteFieldPage:{type:Boolean,computed:"_setIsQuoteFieldPage(pageType)"},isGroupsPage:{type:Boolean,computed:"_setIsGroupsPage(pageType)"},isSegmentedLinesPage:{type:Boolean,computed:"_setIsSegmentedLinesPage(pageType)"},isStandardLinesPage:{type:Boolean,computed:"_setIsStandardLinesPage(pageType, groupModel)"},editorModel:{notify:!0,type:Object},groupModels:{notify:!0,type:Object},viewport:{type:Object,value:function(){return i.getViewport()}},segmentedCompName:String}}},{key:"_groupModelsChanged",value:function(e){if(1==this.groupModels.length&&"groupModels"!=e.path&&!this.groupModels[0].quoteModel.grouped){var t=e.path.split("."),i=t.splice(2,t.length).join(".");this.set("groupModel."+i,e.value)}}},{key:"ready",value:function(){this.handleResize(),this.segmentedCompName="sf-segmented-table"}},{key:"attached",value:function(){this.resize()}},{key:"buildPage",value:function(){this.groupModels&&(this.pageType=this.attributes.label.value,"details"!=this.pageType&&"groups"!=this.pageType&&(this.groupModel=this.groupModels[0],this.quoteModel=this.groupModel.quoteModel),"segmented"==this.pageType&&this.groupModel.quoteMDQTabs&&(this.segmentedTabs=this.groupModel.quoteMDQTabs),this.hideTabs=!!this.segmentedTabs&&1==this.segmentedTabs.length&&"Custom"!=this.segmentedTabs[0].key,this.resize())}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"handleResize",value:function(){window.addEventListener("resize",function(e){this.resize()}.bind(this))}},{key:"resize",value:function(){if(this.domHost){var e=1==this.domHost.tabs.length&&"Custom"!=this.domHost.tabs[0].key?0:43;this.layoutHeight=this.domHost.getBoundingClientRect().height-e+"px",Polymer.dom(this).parentNode.style.height=this.layoutHeight}}},{key:"_setIsQuoteFieldPage",value:function(e){return"details"===e}},{key:"_setIsGroupsPage",value:function(e){return"groups"===e}},{key:"_setIsSegmentedLinesPage",value:function(e){return"segmented"===e}},{key:"_setIsStandardLinesPage",value:function(e,t){return"standard"===e&&t}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.EventBehavior]}},{key:"events",get:function(){var e={};return e[o.VIEWPORT_CHANGED]=this.viewportChanged,e}},{key:"observers",get:function(){return["buildPage(groupModels)","_groupModelsChanged(groupModels.*)"]}}]),r=e)),t("QuoteTabs",r),Polymer(r)}}}),System.register("subscriptions/selection/routes/sb-subscription-lookup/SubscriptionLookup.js",["../../../../common/core/Page.js","common/layout/fields/FieldSetHandler.js","common/layout/tables/TableClassBuilder.js","common/filter/searcher/Searcher.js","common/data/format/ErrorFormatter.js","../../../../common/data/client/ConnectionClient.js"],function(t,e){var i,o,r,d,s,a;return{setters:[function(e){i=e.Page},function(e){e.FieldSetHandler},function(e){e.TableClassBuilder},function(e){o=e.Searcher},function(e){r=e.formatError},function(e){d=e.ConnectionClient}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("SubscriptionLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),s(e,[{key:"beforeRegister",value:function(){this.is="sb-subscription-lookup",this.properties=Polymer.Base.extend({selectedProducts:{type:Object,value:{}},lineEditorModel:Object,totalCount:String,hasTotalCount:String,errors:{type:Array,value:[],notify:!0},error:{type:Array,value:[]}},i.properties)}},{key:"ready",value:function(){this.preLoadObjects(),this.handleSelectButtonClickedServerResponseAndNavigation()}},{key:"handleProductsLoadServerResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.quote=this.$.smLoadService.quote=this.$.smSelectService.quote=e.detail.value.quote}.bind(this)),this.$.smLoadService.addEventListener("search-model-changed",function(e){this.searchModel=e.detail.value,this.primaryMobileColumn=this.searchModel.resultFieldNames[0],this.searcher=new o(this.searchModel),this.hasTotalCount=0<this.searchModel.totalCount,this.totalCount=this.searchModel.totalCount,this.maxSelectAll=this.lineEditorModel.settings.usesClientAmendRenew?500:100}.bind(this))}},{key:"handleSelectButtonClickedServerResponseAndNavigation",value:function(){this.$.smSelectService.addEventListener("result-changed",function(e){var t=this.lineEditorModel.quote.lineItems;this.lineEditorModel.quote=e.detail.value,this.lineEditorModel.settings.usesClientCalculator&&(this.lineEditorModel.quote.lineItems=t.concat(this.lineEditorModel.quote.lineItems)),this.navigateToLineEditor()}.bind(this))}},{key:"refocus",value:function(){this.$.sf.focusFirstField()}},{key:"toggleFilter",value:function(){this.$$("sb-page-header")._closeMenu(),this.$.drawer.togglePanel()}},{key:"removeFilter",value:function(){this.$$(".actions").removeChild(this.$$("#fb"))}},{key:"closeDrawer",value:function(){this.refocus(),this.$.drawer.closeDrawer()}},{key:"getConfigProductIds",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e.detail.value.configuredProducts[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.record.Id)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t.join(",")}},{key:"deSelectAll",value:function(){this.$.lookupLayout.deSelectAll()}},{key:"onSelect",value:function(){var u=this;if(this.spinner=!0,this.selectedProducts&&0<Object.keys(this.selectedProducts).length){if(this.lineEditorModel.settings.usesClientAmendRenew)return new Promise(function(s,a){if(SB&&SB.JSARSettings&&SB.JSARServices&&SB.JSARLineGenManager){var l=new SB.JSARSettings(u.app.orgPrefix,u.lineEditorModel.amendRenewSettings);new d(u.app.orgPrefix).getConnection().then(function(e){var t=SB.JSARServices.constructFromJsarSettings(e,l),i=new SB.JSARLineGenManager(e,l,t),n=u.lineEditorModel.quote,o="Renewal"===n.record[u.prefix+"Type__c"],r=Object.keys(u.selectedProducts);(o?i.renewSubscriptionsToQuote(r,n,u.ctx.params.groupKey):i.amendSubscriptionsToQuote(r,n,u.ctx.params.groupKey)).then(function(e){s(e)},function(e){a(e.message||e)})},function(e){a(e.message||e)})}else a("ERROR: Could not find Client-Side Amend/Renew")}).then(function(e){e.calculationRequired=!0,u.lineEditorModel.quote=e,u.navigateToLineEditor()},function(e){u.errors=[e]});this.$.smSelectService.selectedProducts=this.selectedProducts}else this.navigateToLineEditor()}},{key:"onCancel",value:function(){this.spinner=!0;var e={qId:this.lineEditorModel.quote.record.Id};null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),this.nav("#",e,["quote","le"],!1)}},{key:"navigateToLineEditor",value:function(){var e={qId:this.lineEditorModel.quote.record.Id};0<Object.keys(this.selectedProducts).length&&(e.jspr=!0),null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),this.nav("#",e,["quote","le"],!1)}},{key:"runSearcher",value:function(){this.$$("#submit").focus(),this.$.sf.runService(),this.closeDrawer()}},{key:"preLoadObjects",value:function(){this.subscriptionLookupObjects=[this.prefix+"Subscription__c","Contract"]}},{key:"bindFilterEnterCallBacks",value:function(){this.$.sf.enterCallback=this.runSearcher.bind(this)}},{key:"clearFilterFields",value:function(){this.filterData=this.searcher.clearFields()}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.error=r(this.errors),this.spinner=!1)}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.LookupBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}},{key:"prefix",get:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}}]),a=e)),t("SubscriptionLookup",a),Polymer(a)}}}),System.register("products/config/routes/services/sb-pc-option-configure/OptionConfigurator.js",["common/data/format/DataBuilder.js"],function(t,e){var i,o;return{setters:[function(e){i=e.DataBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("OptionConfigurator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-pc-option-configure",this.properties={quote:Object,product:Object,optionId:String,featureOptionalSKUs:{type:Array,value:[]},ignoreCache:{type:Boolean,value:!1},configuration:Object,error:{type:Array,notify:!0},optionConfiguratorResponse:{type:String,notify:!0}}}},{key:"ready",value:function(){var e=this.$.service;e.addEventListener("response-changed",function(e){this.optionConfiguratorResponse=e.detail.value}.bind(this)),e.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"_loadObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this.load(e,t,i,n)}},{key:"load",value:function(){this.$.service.uid=this.optionId,this.$.service.ignoreCache=this.ignoreCache;var e=this.quote.lineItems;this.quote.lineItems=[];var t=(new i).addQuote("quote",this.quote).add("optionId",this.optionId).add("featureOptionalSKUs",this.featureOptionalSKUs).addObject("configuration",this.configuration).addObject("parentProduct",this.serverProduct).addObject("stagedOption",this.stagedOption);this.quote.lineItems=e,this.$.service.context=t.build()}},{key:"observers",get:function(){return["_loadObserver(quote, product, optionId, ignoreCache)"]}},{key:"serverProduct",get:function(){var e={};return e.configurationAttributes=this.product.configurationAttributes,e.inheritedConfigurationAttributes=this.product.inheritedConfigurationAttributes,void 0===this.product.configuration||(e.configuration={configurationData:this.product.configuration.configurationData,inheritedConfigurationData:this.product.configuration.inheritedConfigurationData}),e}},{key:"stagedOption",get:function(){return null==this.product.nestedOptionModel||null==this.product.nestedOptionModel.stagedOption||this.product.nestedOptionModel.stagedOption.isDynamicOption?null:this.product.nestedOptionModel.stagedOption.optionData}}]),o=e)),t("OptionConfigurator",o),Polymer(o)}}}),System.register("products/config/routes/services/sb-pc-option-save/OptionSaver.js",["common/data/format/DataBuilder.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js","common/data/minimize/QuoteMinimizer.js","common/aggregate/quote-aggregator/QuoteAggregator.js","quotes/models/SafeClientCache.js"],function(t,e){var i,o,r,s,a,l;return{setters:[function(e){i=e.DataBuilder},function(e){o=e.QuoteLineAggregator},function(e){r=e.QuoteMinimizer},function(e){s=e.QuoteAggregator},function(e){a=e.put}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("OptionSaver",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-pc-option-save",this.properties={quote:Object,products:Array,configuration:Object,upgradeAssetId:String,groupKey:{type:Number,value:-1},error:{type:Array,notify:!0},psmResponse:{type:String,notify:!0},background:{type:Boolean,value:!0},stripLinesThreshold:Number,stripLinesMessage:String,cache:String}}},{key:"ready",value:function(){this.setSpinnerMessage(),this.$.service.addEventListener("response-changed",function(e){var t=e.detail.value.quote;if(t&&t.partialVO){var i=new s(this.quote,t,this.requiredKeys);e.detail.value.quote=i.reconcileServerQuoteWithUIQuote()}this.psmResponse=e.detail.value}.bind(this)),this.$.service.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"setSpinnerMessage",value:function(){a("RootState","spinnerMessage","Large bundle configuration enabled. It may take a minute to process your bundle.")}},{key:"_topLevelSaveObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.topLevelSave(e,t)}},{key:"topLevelSave",value:function(){void 0!==this.cache&&(this.$.service.uid=this.quote.record.Id.substring(0,15)),this.$.service.warningCallback=function(e){var t=e.detail.value.validationMessages;console.log(t)};var e=new i;if(e.addObject("products",this.products),null!=this.groupKey&&0<=this.groupKey&&e.add("groupKey",this.groupKey),null==this.stripLinesThreshold||this.quote.lineItems.length<=this.stripLinesThreshold)e.addQuote("quote",this.quote),this.$.service.model=e.build();else{var t=new r(this.quote,this.products,this.groupkey,this.stripLinesThreshold,this.stripLinesMessage);this.quote=t.reduceQuote(),this.requiredKeys=t.getRequiredKeys(),e.addQuote("quote",this.quote),this.$.service.model=e.build(),this.quote=t.revertQuote()}}},{key:"_nestedConfigurationSaveObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.nestedConfigurationSave(e,t)}},{key:"nestedConfigurationSave",value:function(){void 0!==this.cache&&(this.$.service.uid=this.quote.record.Id.substring(0,15)),this.$.service.warningCallback=function(e){var t=e.detail.value.validationMessages;console.log(t)},this.quote.priorBundledQuantityByLineKey=new o(this.quote).mapPriorBundledQuantityByLineKey();var e=this.quote.lineItems;this.quote.lineItems=null;var t=(new i).addQuote("quote",this.quote).addObject("configuration",this.configuration);this.quote.lineItems=e,delete this.quote.priorBundledQuantityByLineKey,this.$.service.model=t.build()}},{key:"observers",get:function(){return["_topLevelSaveObserver(quote, products)","_nestedConfigurationSaveObserver(quote, configuration)"]}}]),l=e)),t("OptionSaver",l),Polymer(l)}}}),System.register("products/config/routes/services/sb-pc-product-load/ProductLoader.js",["common/data/format/DataBuilder.js","quotes/models/SafeClientCache.js"],function(t,e){var r,i,o;return{setters:[function(e){r=e.DataBuilder},function(e){i=e.put}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductLoader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-pc-product-load",this.properties={productIds:{type:String,value:""},lineKey:{type:Number,value:-1},featureOptionIds:{type:Array,value:null},groupKey:{type:Number,value:-1},fieldSet:{type:String,value:null},quote:Object,product:{type:Object,notify:!0},error:{type:Array,notify:!0},productLoadModel:{type:Object,notify:!0},ignoreCache:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.setSpinnerMessage(),this.$.service.addEventListener("response-changed",function(e){this.featureOptionIds=null,this.productLoadModel=e.detail&&e.detail.value?e.detail.value:null}.bind(this)),this.$.service.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"setSpinnerMessage",value:function(){i("RootState","spinnerMessage","Large bundle configuration enabled. It may take a minute to process your bundle.")}},{key:"_loadObserver",value:function(e,t,i,n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==n)return this.load(e,t,i,n)}},{key:"load",value:function(){if(null!=this.lineKey&&0<=this.lineKey&&this.lineKey>this.quote.nextKey)return this.productLoadModel={returnToQuote:"The quote line you are attempting to reconfigure does not exist. Please add the product again to configure it."};var t=[];this.productIds.split(",").forEach(function(e){t.push({record:{Id:e}})}),this.$.service.context=void 0,this.$.service.uid=this.featureOptionIds?"dynamic":this.quote.record.Id.substring(0,15),this.$.service.ignoreCache=this.ignoreCache;var e=new r;if(null!=this.featureOptionIds)e.add("featureOptionIds",this.featureOptionIds).add("fieldSet",this.fieldSet),e.addObject("quoteRecord",this.quote.record);else if(null!=this.lineKey&&0<=this.lineKey){e.add("lineKey",this.lineKey);var i=this._getLinesRelevantToParentKey(this.lineKey),n=this.quote.lineItems;this.quote.lineItems=i,e.addObject("quote",this.quote,!1,!1,!1),this.quote.lineItems=n}else{e.addObject("products",t);var o=this.quote.lineItems;this.quote.lineItems=[],e.addQuote("quote",this.quote),this.quote.lineItems=o}null!=this.groupKey&&0<=this.groupKey&&e.add("groupKey",this.groupKey),this.$.service.context=e.build()}},{key:"_getLinesRelevantToParentKey",value:function(e){var n=this,o="Quote__c"==this.quote.record.attributes.type?"":this.quote.record.attributes.type.slice(0,-8),r=new Set;!function t(i){r.add(i),n.quote.lineItems.forEach(function(e){e.parentItemKey===i&&(r.add(e.key),e.record[o+"Bundle__c"]&&t(e.key),null!=e.sourceLineKey&&t(e.sourceLineKey))})}(e);var t=[];return this.quote.lineItems.forEach(function(e){r.has(e.key)&&t.push(e)}),t}},{key:"observers",get:function(){return["_loadObserver(quote, productIds, lineKey, ignoreCache)"]}}]),o=e)),t("ProductLoader",o),Polymer(o)}}}),System.register("products/config/routes/services/sb-product-rules-invoke/ProductRulesInvoker.js",["common/data/format/DataBuilder.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js","quotes/models/SafeClientCache.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.DataBuilder},function(e){o=e.QuoteLineAggregator},function(e){r=e.put}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductRulesInvoker",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-rules-invoke",this.properties={quote:Object,product:Object,upgradeAssetId:{type:String,value:null},error:{type:Array,notify:!0},configResponse:{type:String,notify:!0}}}},{key:"ready",value:function(){this.setSpinnerMessage(),this.$.service.addEventListener("response-changed",function(e){this.configResponse=e.detail.value}.bind(this)),this.$.service.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"setSpinnerMessage",value:function(){r("RootState","spinnerMessage","Large bundle configuration enabled. It may take a minute to process your bundle.")}},{key:"_updateObserver",value:function(e,t){if(void 0!==e&&void 0!==t)return this.update(e,t)}},{key:"update",value:function(){this.product.configuration.configuredProductKey=this.product.productKey||this.product.configuration.configuredProductId,this.quote.priorBundledQuantityByLineKey=new o(this.quote).mapPriorBundledQuantityByLineKey();var e=this.quote.lineItems;this.quote.lineItems=null,this.$.service.model=(new i).addQuote("quote",this.quote,!0).addObject("configuration",this.product.configuration).add("upgradedAssetId",this.upgradeAssetId).build(),this.quote.lineItems=e,delete this.quote.priorBundledQuantityByLineKey}},{key:"observers",get:function(){return["_updateObserver(quote, product)"]}}]),s=e)),t("ProductRulesInvoker",s),Polymer(s)}}});
//# sourceMappingURL=/resource/1660875268623/SBQQ__sb_app_map
